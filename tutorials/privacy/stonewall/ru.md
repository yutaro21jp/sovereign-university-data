---
name: Stonewall
description: Понимание и использование транзакций Stonewall
---
![cover stonewall](assets/cover.webp)

***ВНИМАНИЕ:** После ареста основателей кошелька Samourai и изъятия их серверов 24 апреля, использование приложения Samourai Wallet теперь требует подключения к собственному Dojo для корректной работы. Несмотря на это, транзакции Stonewall вообще не затронуты и могут быть выполнены без каких-либо проблем. Действительно, эти типы транзакций проводятся автономно, без необходимости внешнего сотрудничества или подключения через Soroban.*

_Мы внимательно следим за развитием этого дела, а также за развитием связанных инструментов. Будьте уверены, что мы обновим этот учебник, как только появится новая информация._

_Этот учебник предоставляется только для образовательных и информационных целей. Мы не поддерживаем и не поощряем использование этих инструментов в преступных целях. Каждый пользователь несет ответственность за соблюдение законов в своей юрисдикции._

---

> *"Разрушьте предположения анализа блокчейна с математически доказуемым сомнением между отправителем и получателем ваших транзакций."*

## Что такое транзакция Stonewall?
Stonewall — это специфическая форма биткойн-транзакции, направленная на увеличение конфиденциальности пользователя во время транзакции путем имитации coinjoin между двумя сторонами, без фактического ее выполнения. Фактически, эта транзакция не является совместной. Пользователь может создать ее самостоятельно, используя только свои собственные UTXO в качестве входов. Таким образом, вы можете создать транзакцию Stonewall для любого случая, не нуждаясь в координации с другим пользователем.

Принцип работы транзакции Stonewall следующий: в качестве входа отправитель использует 2 UTXO, принадлежащие ему. В качестве выхода транзакция производит 4 выхода, включая 2, которые будут точно такого же размера. Два других будут сдачей. Среди 2 выходов одинакового размера только один фактически пойдет получателю платежа.

В транзакции Stonewall есть только 2 роли:
- Отправитель, который осуществляет фактический платеж;
- Получатель, который может быть не осведомлен о специфике транзакции и просто ожидает платеж от отправителя.

Давайте рассмотрим пример, чтобы понять структуру этой транзакции. Алиса находится в булочной, чтобы купить свою багет, который стоит `4,000 сатоши`. Она хочет заплатить биткойнами, сохраняя при этом определенный уровень конфиденциальности своего платежа. Поэтому она решает создать транзакцию Stonewall для оплаты.
![transaction stonewall bakery](assets/en/1.webp)
Анализируя эту транзакцию, мы видим, что пекарь действительно получил `4,000 сатоши` в качестве оплаты за багет. Алиса использовала 2 UTXO в качестве входов: один на `10,000 сатоши` и один на `15,000 сатоши`. В качестве выхода она получила 3 UTXO: один на `4,000 сатоши`, один на `6,000 сатоши` и один на `11,000 сатоши`. У Алисы чистый баланс `-4,000 сатоши` в этой транзакции, что соответствует цене багета.

В этом примере я намеренно опустил комиссии за майнинг для упрощения понимания. На самом деле, комиссии за транзакцию полностью оплачиваются отправителем.

## В чем разница между Stonewall и Stonewall x2?
Транзакция Stonewall работает так же, как и транзакция StonewallX2, с единственным отличием: последняя требует сотрудничества, в отличие от классической транзакции Stonewall, отсюда и обозначение "x2". Действительно, транзакцию Stonewall можно выполнить без внешнего сотрудничества: отправитель может провести её без помощи другого человека. Однако для транзакции Stonewall x2 требуется дополнительный участник, называемый "соучастником", который присоединяется к процессу. Соучастник вносит свои собственные биткоины в качестве входа вместе с биткоинами отправителя и получает всю сумму на выходе (за вычетом комиссии за майнинг).

Давайте вернемся к нашему примеру с Алисой в булочной. Если бы она хотела совершить транзакцию Stonewall x2, Алисе пришлось бы сотрудничать с Бобом (третьей стороной) при создании транзакции. Каждый из них предоставил бы входной UTXO. Затем Боб получил бы полную сумму своего входа на выходе. Булочник получил бы оплату за свой багет так же, как и в транзакции Stonewall, в то время как Алиса получила бы обратно свой первоначальный баланс, за вычетом стоимости багета.
![транзакция stonewall x2](assets/en/2.webp)

С внешней точки зрения структура транзакции осталась бы точно такой же.
![Stonewall или Stonewall x2 ?](assets/en/3.webp)

В итоге, транзакции Stonewall и Stonewall x2 имеют идентичную структуру. Различие между ними заключается в их коллаборативной природе. Транзакция Stonewall разрабатывается индивидуально, без необходимости сотрудничества. В отличие от этого, транзакция Stonewall x2 опирается на сотрудничество двух людей для её реализации.

[**-> Узнать больше о транзакциях Stonewall x2**](https://planb.network/tutorials/privacy/on-chain/stonewall-x2-05120280-f6f9-4e14-9fb8-c9e603f73e5b)

## Какова цель транзакции Stonewall?
Структура Stonewall добавляет значительное количество энтропии к транзакции и затрудняет анализ цепочки. С внешней точки зрения такая транзакция может быть интерпретирована как небольшой coinjoin между двумя людьми. Но на самом деле, как и в случае с транзакцией Stonewall x2, это платеж. Таким образом, этот метод создает неопределенности в анализе цепочки и может даже привести к ложным следам.

Давайте вернемся к примеру Алисы в булочной. Транзакция в блокчейне выглядела бы следующим образом:
![Stonewall или Stonewall x2 ?](assets/en/4.webp)
Внешний наблюдатель, опирающийся на общие эвристики анализа цепочки, мог бы ошибочно заключить, что "*двое людей совершили небольшой coinjoin, каждый с одним входным UTXO и двумя выходными UTXO каждый*".
![Stonewall или Stonewall x2 ?](assets/en/5.webp)
Эта интерпретация неверна, потому что, как вы знаете, UTXO был отправлен булочнику, 2 UTXO на входе поступили от Алисы, и она получила 3 выхода сдачи.

![транзакция stonewall булочника](assets/en/1.webp)
Даже если внешний наблюдатель сумеет определить шаблон транзакции Stonewall, у него не будет всей информации. Он не сможет определить, какой из двух UTXO одинаковых сумм соответствует платежу. Более того, он не сможет установить, исходят ли два UTXO во входе от двух разных людей или они принадлежат одному человеку, который их объединил. Этот последний момент связан с тем, что транзакции Stonewall x2, о которых мы говорили выше, следуют точно такому же шаблону, как и транзакции Stonewall. Снаружи и без дополнительной информации о контексте невозможно отличить транзакцию Stonewall от транзакции Stonewall x2. Однако первые не являются совместными транзакциями, в то время как последние являются таковыми. Это добавляет еще больше сомнений относительно этого расхода. ![Stonewall или Stonewall x2?](assets/en/3.webp)
## Как совершить транзакцию Stonewall в Samourai Wallet?
В отличие от транзакций Stowaway или Stonewall x2 (сговор), для совершения транзакции Stonewall не требуется использование Paynyms. Это можно сделать напрямую, без каких-либо подготовительных шагов. Для этого следуйте нашему видеоуроку по Samourai Wallet:
![Учебник по Stonewall - Samourai Wallet](https://youtu.be/mlRtZvWGuk0?si=e_lSKJLvybWUna1j)

## Как совершить транзакцию Stonewall в Sparrow Wallet?
В отличие от транзакций Stowaway или Stonewall x2 (сговор), для совершения транзакции Stonewall не требуется использование Paynyms. Это можно сделать напрямую, без каких-либо подготовительных шагов. Для этого следуйте нашему видеоуроку по Sparrow Wallet:
![Учебник по Stonewall - Sparrow Wallet](https://youtu.be/su89ljkV_OI?si=1jNaSJGvECUYe6Or)

**Внешние ресурсы:**
- https://docs.samourai.io/en/spend-tools#stonewall.