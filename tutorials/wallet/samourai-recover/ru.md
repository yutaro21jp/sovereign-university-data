---
name: Samourai Wallet - Восстановление
description: Как восстановить биткоины, застрявшие в Samourai Wallet?
---
![обложка](assets/cover.webp)

После ареста основателей Samourai Wallet и изъятия их серверов 24 апреля некоторые функции приложения теперь не работают, и пользователи, у которых нет собственного Dojo, больше не могут отправлять транзакции.

После помощи нескольким пользователям в восстановлении их биткоинов в последние дни, я считаю, что столкнулся с большинством проблем, которые могут возникнуть во время восстановления Samourai Wallet. Поэтому, этот учебник начнется с отчета о ситуации, чтобы определить, какие функции остаются работоспособными и какие больше не доступны в экосистеме Samourai Wallet и в программном обеспечении, затронутом этим инцидентом. Затем мы будем продвигаться шаг за шагом, чтобы восстановить Samourai Wallet с использованием программного обеспечения Sparrow Wallet. Мы рассмотрим все потенциальные препятствия, с которыми можно столкнуться в этом процессе, и увидим решения для их устранения. Наконец, в последней части вы узнаете о потенциальных рисках для вашей конфиденциальности после изъятия серверов.

*Большое спасибо [@Louferlou](https://twitter.com/Louferlou), который помог нескольким пользователям в их восстановлении и поделился со мной своим опытом, а также внес свой вклад в тестирование, чтобы определить, что все еще функционирует.*

## Samourai Wallet все еще работает?

Да, **приложение Samourai Wallet все еще работает**, но при определенных условиях.

Во-первых, необходимо, чтобы приложение было ранее установлено на вашем смартфоне. Google Play Store удалил приложение, а APK был размещен на изъятом веб-сайте. Поэтому установить Samourai в настоящее время сложно. Вы можете найти APK в сети, но я не советую их скачивать, если вы не уверены в источнике.

Учитывая, что страница Samourai Wallet больше не доступна в Google Play Store, невозможно отключить автоматические обновления. Если приложение вернется на платформы для скачивания, было бы разумно **отключить автоматические обновления**, пока не появится больше информации о развитии дела.

Если Samourai Wallet уже установлен на вашем смартфоне, вы все еще должны иметь доступ к приложению. Для использования функционала кошелька Samourai необходимо подключить Dojo. Ранее пользователи без личного Dojo зависели от серверов Samourai для доступа к информации блокчейна Bitcoin и для отправки транзакций. С изъятием этих серверов приложение больше не может получить доступ к этим данным.
Если у вас не было подключенного Dojo ранее, но он есть теперь, вы можете настроить его для повторного использования вашего приложения Samourai. Это включает проверку ваших резервных копий, удаление кошелька (кошелька, а не приложения) и восстановление кошелька путем подключения вашего Dojo к приложению. Для получения более подробной информации об этих шагах вы можете проконсультироваться с [этим учебником, в разделе "_Подготовка вашего Samourai Wallet_" : COINJOIN - DOJO](https://planb.network/tutorials/privacy/on-chain/coinjoin-dojo-c4b20263-5b30-4c74-ae59-dc8d0f8715c2).
Если ваше приложение Samourai уже было подключено к вашему собственному Dojo, то часть кошелька работает для вас идеально. Вы все еще можете видеть ваш баланс и отправлять транзакции. Несмотря на все происходящее, я считаю, что Samourai Wallet остается лучшим мобильным программным обеспечением для кошелька на данный момент. Лично я планирую продолжать его использовать.
Основная проблема, с которой вы можете столкнуться, заключается в невозможности доступа к аккаунтам Whirlpool из приложения. Обычно Samourai пытается установить соединение с вашим Whirlpool CLI и начать циклы coinjoin, прежде чем предоставить вам доступ к этим аккаунтам. Однако, поскольку это соединение больше не возможно, приложение продолжает бесконечно искать, так и не предоставляя вам доступ к аккаунтам Whirlpool. В этом случае вы можете восстановить эти аккаунты в другом программном обеспечении для кошелька, оставив только депозитный аккаунт в Samourai.
### Какие инструменты все еще доступны в Samourai?

С другой стороны, некоторые инструменты либо затронуты отключением сервера, либо полностью недоступны.

Что касается индивидуальных инструментов для трат, все работает нормально, при условии, конечно, что у вас есть собственный Dojo. Обычные транзакции Stonewall (а не Stonewall x2) работают без проблем.

Комментарии в Twitter подчеркнули, что конфиденциальность, предлагаемая транзакцией Stonewall, теперь может быть снижена. Добавленная ценность транзакции Stonewall заключается в том, что она неотличима от транзакции Stonewall x2 с точки зрения структуры. Когда аналитик сталкивается с этим конкретным шаблоном, он не может определить, является ли это стандартным Stonewall с одним пользователем или Stonewall x2 с участием двух пользователей. Однако, как мы увидим в следующих абзацах, проведение транзакций Stonewall x2 стало более сложным из-за недоступности Soroban. Некоторые поэтому думают, что аналитик теперь может предположить, что любая транзакция с этой структурой является обычным Stonewall. Лично я не разделяю это предположение. Хотя транзакции Stonewall x2 могут быть менее частыми (и я думаю, что они были таковыми и до этого инцидента), факт того, что они все еще возможны, может опровергнуть целый анализ, основанный на предположении, что их нет.
**[-> Узнать больше о транзакциях Stonewall.](https://planb.network/tutorials/privacy/on-chain/stonewall-033daa45-d42c-40e1-9511-cea89751c3d4)**
Что касается Ricochet, я не смог проверить, все ли еще работает этот сервис, так как не владею Dojo на Testnet, и предпочитаю не рисковать, отправляя `100 000 сатоши` на кошелек, который может контролироваться властями. Если у вас была возможность недавно протестировать этот инструмент, приглашаю вас связаться со мной, чтобы мы могли обновить эту статью.

Если вам нужно использовать Ricochet, имейте в виду, что вы всегда можете выполнить эту операцию вручную с любым программным обеспечением для кошелька. Чтобы узнать, как правильно выполнить различные прыжки вручную, рекомендую проконсультироваться с другой статьей: [**RICOCHET**](https://planb.network/tutorials/privacy/on-chain/ricochet-e0bb1afe-becd-44a6-a940-88a463756589).

Инструмент JoinBot больше не работает, так как он полностью зависел от участия кошелька, управляемого Samourai.

Что касается других типов совместных транзакций, часто называемых "cahoots", они остаются возможными, но только вручную. До отключения сервера у вас было два варианта для выполнения транзакций Stonewall x2 или Stowaway (PayJoin):
- Использовать сеть Soroban для автоматического и удаленного обмена PSBT;
- Или выполнить эти обмены вручную, сканируя несколько QR-кодов.

После нескольких тестов выяснилось, что Soroban больше не функционирует. Для выполнения этих совместных транзакций обмен данными должен, следовательно, производиться вручную. Вот два варианта для выполнения этого обмена:
- Если вы физически находитесь рядом с вашим сотрудником, вы можете последовательно сканировать QR-коды.
- Если вы находитесь далеко от своего сотрудника, вы можете обмениваться PSBT через внешний канал связи с приложением. Однако будьте осторожны, так как данные, содержащиеся в этих PSBT, являются чувствительными с точки зрения конфиденциальности. Я рекомендую использовать сервис зашифрованных сообщений, чтобы обеспечить конфиденциальность обмена.
**[-> Узнать больше о транзакциях Stonewall x2.](https://planb.network/tutorials/privacy/on-chain/stonewall-x2-05120280-f6f9-4e14-9fb8-c9e603f73e5b)**

**[-> Узнать больше о транзакциях Stowaway.](https://planb.network/tutorials/privacy/on-chain/payjoin-samourai-wallet-48a5c711-ee3d-44db-b812-c55913080eab)**

Что касается Whirlpool, протокол больше не функционирует, даже для пользователей, у которых есть собственный Dojo. Я наблюдал за моим RoninDojo в последние несколько дней и пытался выполнить некоторые базовые манипуляции, но CLI Whirlpool не смог подключиться с момента остановки сервера.

Тем не менее, я остаюсь в надежде, что этот протокол может быть реактивирован или возможно переосмыслен по-другому в ближайшие недели, в зависимости от того, как будет развиваться ситуация. Эта пауза может быть возможностью для изучения новых подходов или потенциальных улучшений этой системы.
### Какие внешние инструменты все еще доступны?
Что касается других инструментов, связанных с окружением Samourai, некоторые из них все еще доступны, а некоторые нет.

Бесплатный сайт анализа цепочек OXT.me, к сожалению, на данный момент недоступен.

Инструмент статистики Whirlpool больше не доступен для скачивания, так как он был размещен на GitLab Samourai. Даже если вы ранее скачали этот инструмент Python локально на свой компьютер или если он был установлен на вашем узле RoninDojo, WST не будет работать на данный момент. Действительно, его работа зависела от данных, предоставляемых сайтом OXT.me, и этот сайт больше не доступен. В настоящее время WST не особенно полезен, поскольку протокол Whirlpool неактивен.

Сайт KYCP.org в настоящее время также недоступен.

GitLab, который хостил код для инструмента Python Boltzmann Calculator, также был изъят. В настоящее время, поэтому, скачать этот инструмент больше невозможно. Но если у вас есть RoninDojo, вы можете продолжать использовать Boltzmann Calculator так же, как и раньше.

Что касается RoninDojo, этот программный комплекс "узел в коробке" продолжает работать корректно, несмотря на недоступность некоторых конкретных инструментов, таких как Whirlpool CLI и WST. Его все еще можно использовать для другого программного обеспечения кошелька благодаря Fulcrum или Electrs. Если вы хотите получить больше информации о RoninDojo или у вас есть конкретные вопросы, я призываю вас присоединиться к [их группе в Telegram](https://t.me/RoninDojoNode).

Однако исходный код для RoninDojo в настоящее время также недоступен, так как он был размещен на GitLab Samourai. Поэтому в данный момент невозможно вручную установить его на Raspberry Pi.

Что касается программного обеспечения для кошелька только для просмотра Sentinel, ситуация аналогична приложению Samourai. Если у вас есть собственный Dojo, вы можете продолжать использовать Sentinel без каких-либо проблем. Однако, если у вас нет Dojo, вы больше не сможете установить соединение. В отличие от Samourai, веб-сайт Sentinel все еще доступен в сети. Но будьте осторожны с этим сайтом и предлагаемым там APK, так как неясно, кто в настоящее время контролирует эти ресурсы.

### Подвержен ли Sparrow Wallet влиянию?
Кошелек Sparrow продолжает работать в обычном режиме, за исключением инструментов Samourai, которые больше не доступны. В настоящее время выполнение coinjoins через Sparrow больше невозможно. Аналогично, инструменты для совместных расходов также больше не доступны, поскольку Sparrow не предлагает возможность ручного обмена PSBT, в отличие от Samourai. Для всех остальных функций Sparrow работает без проблем. Вы также можете использовать это программное обеспечение для восстановления кошелька Samourai, если это необходимо.

## Как восстановить кошелек Samourai?
Как мы видели в предыдущих разделах, если у вас есть собственный Dojo, не обязательно переходить на другое программное обеспечение. **Samourai остается отличным выбором горячего кошелька** для ваших ежедневных расходов. Однако, если у вас нет Dojo или если вы предпочитаете выбрать другое программное обеспечение, я объясню полный процесс восстановления, подробно описывая любые потенциальные препятствия, с которыми вы можете столкнуться.

В любом случае, важно не спешить и убедиться, что вы не делаете ошибок. Помните, спешить некуда, так как вы владеете своими приватными ключами, и захват серверов Samourai никак на это не влияет. Что бы ни произошло, они очевидно не могут получить доступ к вашим приватным ключам.

### Проверьте парольную фразу

Для восстановления кошелька у вас должна быть ваша парольная фраза, даже если вы выбираете восстановление через файл резервной копии. Начните с проверки действительности этой парольной фразы. Откройте приложение Samourai Wallet, нажмите на ваш Paynym-иконку в верхнем левом углу, затем выберите `Настройки`.

![samourai](assets/1.webp)

Далее нажмите на `Устранение неполадок` и затем на `Тест парольной фразы/резервной копии`.

![samourai](assets/2.webp)

Введите вашу парольную фразу и нажмите `ОК`. Если она верна, Samourai подтвердит это. У вас также есть возможность проверить файл резервной копии, если вы планируете использовать его позже.

![samourai](assets/3.webp)

Этот шаг необязателен, но рекомендуется. Он подтверждает, что парольная фраза верна, устраняя потенциальный источник проблем на более позднем этапе. Если Samourai указывает, что парольная фраза неверна на этом этапе, восстановление будет невозможно. Убедитесь, что вы правильно ввели парольную фразу и проверьте ее снова.

### Вариант 1: Восстановление кошелька в Sparrow с помощью файла резервной копии

Начиная с версии 1.8.6 кошелька Sparrow, стало возможным напрямую импортировать ваш кошелек Samourai, используя текстовый файл резервной копии с именем `samourai.txt`, который автоматически генерируется вашим приложением. Этот файл содержит всю необходимую информацию для восстановления вашего кошелька и зашифрован вашей парольной фразой для безопасности.

Если вы выберете этот вариант, вам понадобится ваш актуальный файл `samourai.txt` и ваша парольная фраза. Чтобы сгенерировать этот файл в кошельке Samourai, нажмите на три маленькие точки в верхнем правом углу, затем выберите `Экспорт резервной копии кошелька`.

![samourai](assets/4.webp)
Затем выберите `Экспорт в буфер обмена`. После этого вам нужно будет безопасно передать этот файл на ваш ПК. Поскольку файл зашифрован, но парольная фраза сама по себе достаточна для его расшифровки, важно принять меры предосторожности во время его передачи. Если вы выберете прямую передачу в виде простого текста, вам нужно будет создать файл `samourai.txt` на вашем ПК и вставить содержимое буфера обмена в него. Альтернативой может быть прямое извлечение файла `samourai.txt` из файлов, хранящихся на вашем телефоне.
Как только у вас будет доступ к файлу на вашем ПК, откройте кошелек Sparrow, нажмите на вкладку `Файл` и выберите `Импорт кошелька`, чтобы начать импорт вашего кошелька.

![samourai](assets/5.webp)
Прокрутите вниз до `Samourai Backup`, нажмите на `Import File` и затем выберите ваш файл `samourai.txt`.
![samourai](assets/6.webp)

Затем Sparrow попросит вас ввести пароль для расшифровки файла. Этот пароль на самом деле является вашей кодовой фразой. Введите его в соответствующее поле и нажмите на `Import`.

![samourai](assets/7.webp)

Если на этом этапе ваш кошелек не появляется, возможно, вы допустили ошибку при копировании файла `samourai.txt` или при вводе кодовой фразы. Вы можете обратиться к разделу устранения неполадок за дополнительной помощью.

![samourai](assets/8.webp)

Что касается типа скрипта, если вы не настраивали другие скрипты в Samourai, вам обычно следует использовать только SegWit V0 (Native SegWit / P2WPKH). Оставьте этот скрипт по умолчанию и нажмите на `Import`.

![samourai](assets/9.webp)

Дайте имя вашему кошельку, например, "Samourai Recovery", и затем нажмите на `Create Wallet`.

![samourai](assets/10.webp)

Затем Sparrow попросит вас выбрать пароль. Этот пароль защищает только доступ к вашему кошельку на этом ПК и не относится к производным ключам вашего кошелька. Убедитесь, что вы выбрали надежный пароль, запишите его, чтобы помнить, и нажмите на `Set Password`.

![samourai](assets/11.webp)

Затем Sparrow произведет производные ключи вашего кошелька и начнет поиск соответствующих транзакций.

![samourai](assets/12.webp)

На данный момент доступен только ваш депозитный счет. Если вы использовали Samourai только для этого счета, вы должны увидеть все свои средства. Однако, если вы также использовали Whirlpool, вам нужно будет произвести производные для счетов `premix`, `postmix` и `badbank`. В Sparrow просто нажмите на вкладку `Settings`, затем на `Add Accounts...`.

![samourai](assets/13.webp)
В открывшемся окне выберите `Whirlpool Accounts` из выпадающего меню, затем нажмите на `OK`.
![samourai](assets/14.webp)

Затем вы увидите ваши различные счета Whirlpool, и Sparrow произведет необходимые ключи для использования связанных с ними биткойнов.

![samourai](assets/15.webp)

Если вы используете другое программное обеспечение, кроме Sparrow, например, Electrum, для восстановления вашего кошелька Samourai, вот индексы счетов Whirlpool для ручного восстановления:
- Deposit: `m/84'/0'/0'`
- Bad Bank: `m/84'/0'/2147483644'`
- Premix: `m/84'/0'/2147483645'`
- Postmix: `m/84'/0'/2147483646'`

Теперь у вас есть доступ к вашим биткойнам в Sparrow. Если вам нужна помощь в использовании Sparrow Wallet, вы также можете ознакомиться с [нашим специализированным учебником](https://planb.network/tutorials/wallet/desktop/sparrow-7e9a77c0-013d-4f8e-a811-408b71dc7607).

Я также рекомендую вручную импортировать метки, которые вы ассоциировали с вашими UTXO в Samourai. Это позволит вам эффективно контролировать монеты в Sparrow в дальнейшем.

### Вариант 2: Восстановление кошелька в Sparrow с помощью мнемонической фразы

Если вы не хотите выполнять восстановление с помощью файла резервной копии, вы можете выбрать более традиционный метод, просто используя вашу 12-словную мнемоническую фразу и кодовую фразу. Этот второй вариант часто проще.
Для начала убедитесь, что у вас под рукой есть ваша фраза восстановления и ваш парольная фраза. Затем откройте программное обеспечение Sparrow Wallet, нажмите на вкладку `File` и выберите `Import Wallet`, чтобы начать импорт вашего кошелька.
![samourai](assets/16.webp)

Выберите `Mnemonic Words (BIP39)` и в выпадающем меню кликните на `Use 12 Words`.

![samourai](assets/17.webp)

Введите 12 слов вашей фразы восстановления в правильном порядке.

![samourai](assets/18.webp)

Если Sparrow выдает сообщение `Invalid Checksum`, это указывает на то, что контрольная сумма фразы восстановления неверна, что, вероятно, означает ошибку при вводе слов.

![samourai](assets/19.webp)

Если ваша фраза верна, отметьте галочкой поле `Use Passphrase?` и введите вашу парольную фразу в соответствующее поле. Наконец, если все кажется корректным, нажмите на кнопку `Discover Wallet`.

![samourai](assets/20.webp)

Дайте имя вашему кошельку, например, "Samourai Recovery", затем нажмите на `Create Wallet`.

![samourai](assets/21.webp)
Затем Sparrow попросит вас выбрать пароль. Этот пароль защищает доступ к вашему кошельку на этом ПК и не связан с производными ключами вашего кошелька. Убедитесь, что выбрали надежный пароль, запишите его, чтобы запомнить, и нажмите на `Set Password`.
![samourai](assets/22.webp)

После этого Sparrow сгенерирует ключи для вашего кошелька и начнет поиск соответствующих транзакций.

![samourai](assets/23.webp)

Если на этом этапе ваш кошелек не появляется, возможно, вы допустили ошибку при вводе парольной фразы или фразы восстановления. Вы можете обратиться к специальному разделу по устранению неполадок за дополнительной помощью.

На данный момент доступен только ваш счет для депозитов. Если вы использовали Samourai только для этого счета, вы должны увидеть все свои средства. Однако, если вы также использовали Whirlpool, вам потребуется произвести вывод счетов `premix`, `postmix` и `badbank`. В Sparrow просто нажмите на вкладку `Settings`, затем на `Add Accounts...`.

![samourai](assets/24.webp)

В открывшемся окне выберите `Whirlpool Accounts` из выпадающего списка, затем нажмите на `OK`.

![samourai](assets/25.webp)

Затем вы увидите ваши различные счета Whirlpool, и Sparrow сгенерирует необходимые ключи для использования связанных с ними биткойнов.

![samourai](assets/26.webp)

Если вы используете другое программное обеспечение, например Electrum, для восстановления вашего кошелька Samourai, вот индексы счетов Whirlpool для ручного восстановления:
- Deposit: `m/84'/0'/0'`
- Bad Bank: `m/84'/0'/2147483644'`
- Premix: `m/84'/0'/2147483645'`
- Postmix: `m/84'/0'/2147483646'`

Теперь у вас есть доступ к вашим биткойнам в Sparrow. Если вам нужна помощь в использовании Sparrow Wallet, вы также можете проконсультироваться с [нашим специализированным руководством](https://planb.network/tutorials/wallet/desktop/sparrow-7e9a77c0-013d-4f8e-a811-408b71dc7607).

Я также рекомендую вручную импортировать метки, которые вы ассоциировали с вашими UTXO в Samourai. Это позволит вам в дальнейшем эффективно контролировать монеты в Sparrow.

### Какие общие проблемы возникают?
После помощи нескольким людям в последние дни, я считаю, что столкнулся с большинством проблем, которые могут помешать восстановлению вашего кошелька. Если вы все еще не можете получить доступ к своему кошельку, несмотря на предыдущие уроки, вот некоторые дополнительные рекомендации. Прежде всего, для успешного восстановления абсолютно необходимо, чтобы фраза восстановления была верной. Если вы не можете найти свою 12-словную фразу, вы можете использовать *вариант 1*, чтобы восстановиться из резервной копии Samourai. Вы также можете получить доступ к своей фразе восстановления напрямую в кошельке Samourai, перейдя в `Настройки`, затем `Кошелек`, и, наконец, выбрав `Показать 12-словную фразу восстановления`.

Далее, ошибка при вводе вашей парольной фразы во время восстановления приведет к неправильным производным ключам, что помешает восстановлению вашего кошелька в Sparrow. **Парольная фраза должна быть введена абсолютно точно!**

Для решения этой проблемы я сначала советую вам проверить правильность вашей парольной фразы в приложении Samourai, как описано в разделе "_Проверка парольной фразы_" этой статьи:
1. **Проверка в Samourai:** Если Samourai подтверждает, что парольная фраза верна, попробуйте восстановление снова с самого начала, убедившись, что вы точно вводите парольную фразу в Sparrow без ошибок;
2. **Ошибка парольной фразы:** Если Samourai указывает, что парольная фраза неверна, бессмысленно продолжать попытки в Sparrow. Пока не будет найдена правильная парольная фраза, восстановление вашего кошелька невозможно. Если вы навсегда потеряли свою парольную фразу, сохраните ваше приложение Samourai в безопасности. Все, что вы можете сделать, это надеяться, что серверы будут перезапущены, чтобы вы могли совершать расходы напрямую из приложения без необходимости восстановления. **Не пытайтесь подключить Dojo в этом случае**, так как это будет означать сброс вашего кошелька в Samourai, что требует доступа к парольной фразе.

Среди других встреченных ошибок многие связаны с настройкой сети в Sparrow.

Во-первых, убедитесь, что Sparrow правильно настроен в режиме `mainnet`, а не в режиме `testnet`. Действительно, если Sparrow ищет ваши транзакции в Testnet, он ничего не найдет, потому что ваш кошелек находится в Mainnet. Testnet - это альтернативная версия Bitcoin, используемая исключительно для тестирования и разработки, и работает в отдельной сети от основной сети (Mainnet), с собственными блоками и транзакциями. Чтобы проверить, в какой сети вы находитесь, нажмите на вкладку `Инструменты`, затем на `Перезапустить в`. Если отображается опция `Mainnet`, значит, вы не находитесь в основной сети. Выберите ее, чтобы перезапустить Sparrow в Mainnet, а затем начните процесс восстановления заново.

![samourai](assets/27.webp)
Некоторые также столкнулись с трудностями при подключении Sparrow к своему узлу. В нижнем правом углу Sparrow цветной переключатель указывает, правильно ли ваше программное обеспечение подключено к узлу Bitcoin. Для извлечения ваших транзакций Samourai крайне важно, чтобы программное обеспечение было хорошо подключено. Проверьте, активирован ли переключатель, как на моем изображении ниже (желтый для публичного узла, зеленый для Bitcoin Core и синий для сервера Electrum).
![samourai](assets/28.webp)

Если переключатель не активирован, нажмите на него, чтобы восстановить соединение.

![samourai](assets/29.webp)

Если проблема не устранена, вот некоторые возможные решения:
- Если вы пытаетесь подключиться к своему собственному серверу Electrum (синий) или вашему Bitcoin Core (зеленый) и Sparrow не может подключиться, проверьте информацию о подключении в `Файл > Настройки... > Сервер`;

![samourai](assets/30.webp)
- Если проблема с подключением не исчезает, это может быть связано с неполной синхронизацией вашего узла. Убедитесь, что ваш узел и ваш индексатор синхронизированы на 100%. В качестве крайней меры, если необходимо, отключите ваш узел от Sparrow и подключитесь к публичному узлу; - Если вы уже были подключены к публичному узлу и подключение не удаётся, попробуйте сменить узел, выбрав другой из выпадающего списка.

![samourai](assets/31.webp)

Если вам удалось успешно восстановить ваш кошелек, но он кажется неполным, проблема может быть связана с производными.

Проблема может возникнуть, если вы использовали ваш депозитный счет Samourai с другим типом скрипта, отличным от `P2WPKH`. По умолчанию Samourai использует этот тип скрипта, но если вы вручную его изменили, вам также необходимо скорректировать это при восстановлении в Sparrow.

Чтобы получить ветви для других типов скриптов, вам нужно повторить процесс восстановления для каждого использованного типа скрипта. Для этого перейдите в `File > New Wallet` в Sparrow, выберите другой тип скрипта из выпадающего списка, нажмите на `New or Imported Software Wallet` и следуйте тем же шагам, что и в первоначальном руководстве.

![samourai](assets/32.webp)

Ещё одна проблема с производными, с которой я столкнулся, связана со значением Gap Limit. Это значение указывает Sparrow, после скольких пустых адресов следует прекратить генерацию новых адресов. Если после восстановления вы заметили, что некоторые транзакции отсутствуют, это может быть связано с слишком низким значением Gap Limit. Чтобы решить эту проблему, перейдите к счету, который вызывает проблему, например, к счету после смешивания (если проблема касается нескольких счетов, повторите эту операцию для каждого).

![samourai](assets/33.webp)

Нажмите на вкладку `Settings` и затем на кнопку `Advanced...`.
![samourai](assets/34.webp)
Постепенно увеличивайте значение Gap Limit, например, я установил его на `400` здесь. Затем нажмите на кнопку `Close`.

![samourai](assets/35.webp)

Нажмите на `Apply`, чтобы завершить. Sparrow затем сгенерирует большее количество адресов и начнет поиск средств на них, что должно помочь восстановить все ваши транзакции.

![samourai](assets/36.webp)

Это охватывает различные проблемы восстановления, с которыми я столкнулся за последние несколько дней. Если после попытки всех этих решений у вас все еще возникают проблемы, я приглашаю вас присоединиться к [Discover Bitcoin Discord](https://discord.gg/xKKm29XGBb), чтобы попросить о помощи. Я регулярно посещаю этот Discord и буду рад помочь, если у меня есть решение. Другие биткойнеры также смогут поделиться своим опытом и предложить свою помощь. **В любом случае, крайне важно сохранять в тайне вашу фразу восстановления, файл резервной копии и парольную фразу**. Не делитесь ими ни с кем, так как это может позволить им украсть ваши биткойны.

После завершения восстановления у вас снова есть доступ к вашим биткойнам. Это хорошо, но этого может быть недостаточно. Действительно, изъятие серверов создает новые потенциальные риски для вашей конфиденциальности. В следующем разделе мы подробно рассмотрим эти риски и опишем меры предосторожности, которые следует предпринять для защиты вашей конфиденциальности.

## Каковы последствия для конфиденциальности ваших транзакций?

### Как пользователь Samourai без Dojo

Если вы использовали кошелек Samourai, не подключив свой собственный Dojo, ваши xpubs должны были быть переданы на серверы Samourai для функционирования приложения. С изъятием этих серверов возможно, что власти теперь имеют доступ к этим xpubs.
Этот сценарий остается гипотетическим. Мы не знаем, были ли записаны эти xpubs, было ли уничтожено какое-либо потенциальное хранилище, восстановили ли власти их и планируют ли они использовать их для анализа цепочек. Однако в такой ситуации разумно рассматривать худший сценарий, когда у властей есть xpubs пользователей, которые не подключили свой собственный Dojo. Для справки, xpub - это строка символов, содержащая все необходимые элементы для генерации дочерних публичных ключей (публичный ключ + код цепи). Он используется в иерархически детерминированных кошельках для генерации адресов получения и наблюдения за транзакциями аккаунта без раскрытия связанных с ними приватных ключей. Это позволяет, например, создать кошелек только для наблюдения. Однако раскрытие xpubs может нарушить конфиденциальность пользователя, так как они позволяют третьим лицам отслеживать транзакции и видеть балансы связанных аккаунтов.
Любой, кто знает ваши xpubs, может таким образом видеть все адреса получения вашего кошелька, те, которые использовались в прошлом, и те, которые будут сгенерированы в будущем.

Для пользователей без Dojo потенциальная утечка ваших xpubs имеет два основных последствия:
- Coinjoins, которые вы могли выполнить, становятся неэффективными с точки зрения конфиденциальности для любого, кто знает ваши xpubs, таким образом, ваши монеты теряют весь anonset;
- Этот человек также может отслеживать все адреса получения вашего кошелька Samourai.

Поэтому важно рассматривать худший сценарий и расстаться с этим кошельком, потенциально скомпрометированным с точки зрения конфиденциальности. Для этого создайте новый кошелек с нуля с использованием другого программного обеспечения, например Sparrow Wallet. После проверки валидности ваших резервных копий переведите все свои средства, совершая транзакции. Хотя эта операция не разрывает связь отслеживаемости ваших монет, она не позволит властям с уверенностью знать адреса вашего нового кошелька.

Во время этой операции перевода я рекомендую избегать консолидации ваших монет. Если мы предполагаем, что ваши xpubs скомпрометированы, консолидация не окажет влияния с точки зрения человека, имеющего доступ к этим xpubs, поскольку ваша конфиденциальность уже нарушена ими. Однако я советую вам не слишком сильно консолидировать ваши монеты в основном для защиты вашей конфиденциальности от других людей. В худшем случае только власти могут иметь доступ к вашим xpubs, но остальной мир о них не знает. Таким образом, с точки зрения других, консолидация ваших монет может значительно навредить вашей конфиденциальности из-за эвристики общего владения входом (CIOH).

Наконец, чтобы окончательно прервать отслеживание, также рассмотрите возможность выполнения coinjoins с этого нового кошелька.
**Внимание:** Простое восстановление вашего кошелька Samourai в Sparrow Wallet недостаточно. Необходимо создать совершенно новый кошелек с новой фразой восстановления, если вы хотите избежать использования xpubs, которые могли утекать. Если вы импортируете ваш существующий seed в Sparrow, вы только меняете программное обеспечение управления кошельком, но сам кошелек остается тем же.

### Как пользователь Sparrow или Samourai с Dojo

Если ваш кошелек управляется только в Sparrow Wallet, ваши xpubs не могли утекать, независимо от того, используете ли вы публичный узел или свой собственный узел Bitcoin. Аналогично, если вы используете приложение Samourai и всегда подключали это приложение к своему собственному Dojo с момента создания вашего кошелька, ваши xpubs также находятся в безопасности.
Однако, если вы использовали один и тот же кошелек в период **без собственного Dojo** и затем с вашим собственным Dojo, возможно, что серверы Samourai могли иметь доступ к вашим xpubs, и, следовательно, власти могли бы их знать. Если вы находитесь в этой конкретной ситуации, я советую вам следовать рекомендациям предыдущего раздела и считать ваши xpubs скомпрометированными.
Для тех, кто всегда использовал Sparrow или Samourai со своим собственным Dojo, основной риск заключается в том, что анонимные наборы ваших монет могут быть потенциально уменьшены. Предположим, в худшем случае, что все пользователи без Dojo имеют свои xpubs в руках у властей, тогда путь их монет через циклы coinjoin мог быть прослежен этими властями.

Чтобы проиллюстрировать это, давайте рассмотрим конкретный пример. Представьте, что вы участвовали в первом цикле coinjoin, за которым следовали два дополнительных последующих цикла coinjoin. Если xpubs пользователей без Dojo не утекли, то перспективный анонимный набор вашей монеты был бы 13.

![samourai](assets/37.webp)

Однако, если мы предположим, что xpubs утекли и что вы столкнулись с пользователем без dojo во время начального coinjoin, а затем с 2 во время первого последующего coinjoin, то ваш перспективный анонимный набор был бы только 10 вместо 13 с точки зрения властей.

![samourai](assets/38.webp)
Это потенциальное уменьшение анонимного набора сложно количественно оценить, поскольку оно зависит от множества факторов, и каждая монета затрагивается по-разному. Например, пользователь без Dojo, встреченный в ранних циклах, влияет на перспективный анонимный набор гораздо больше, чем тот, кто встречен в последующих циклах. Чтобы дать вам представление о ситуации, которая остается гипотетической, последняя статистика, предоставленная Samourai, указывала, что между 85% и 90% монет, участвующих в coinjoins, приходились на пользователей с Dojo, Sparrow или Bitcoin Keeper, то есть на пользователей, которые, даже в худшем случае, не увидели бы утечки своих xpubs.
Хотя эти цифры трудно проверить, они кажутся мне последовательными по двум причинам:
- Sparrow Wallet широко используется;
- Большинство программного обеспечения для узлов в коробке предлагает реализации Dojo, и эти основные программы, такие как Umbrel, сегодня очень популярны.

Таким образом, необходимо учитывать несколько аспектов. Если конфиденциальность ваших монет по отношению к властям крайне важна для вас, было бы разумно подготовиться к худшему сценарию, и сложно гарантировать на 100%, что ваши циклы coinjoin Whirlpool не могут быть прослежены из-за потенциальной утечки xpubs от пользователей без Dojo. Хотя это предположение крайне маловероятно, оно не невозможно.

С другой стороны, если конфиденциальность ваших монет по отношению к потенциально владеющей этими xpubs власти не критична для вас, то ситуацию можно рассматривать иначе.

Я уточняю "по отношению к власти", потому что важно помнить, что только власть, захватившая серверы, потенциально осведомлена об этих xpubs. Если ваша цель при использовании coinjoin заключалась в том, чтобы ваш банкир не мог следить за вашими средствами, то он не лучше осведомлен, чем до захвата сервера.
В заключение, крайне важно учитывать начальный анонимный набор (anonset) ваших монет до захвата сервера. Рассмотрим пример монеты, которая достигла потенциального анонимного набора в 40,000; вероятное уменьшение этого анонимного набора, вероятно, незначительно. Действительно, при уже очень высоком базовом анонимном наборе, маловероятно, что присутствие нескольких пользователей без Dojo могло бы радикально изменить ситуацию. Однако, если ваша монета имела анонимный набор в 40, то этот потенциальный утечка могла бы серьезно повлиять на ваши анонимные наборы и потенциально позволить отслеживание. С инструментом WST, который теперь не работает после закрытия OXT.me, вы можете только оценить эти анонимные наборы. Что касается ретроспективного анонимного набора, то особо беспокоиться не о чем, поскольку модель Whirlpool гарантирует, что он очень высок с первого coinjoin, благодаря наследию ваших пиров. Единственный случай, когда это могло бы стать проблемой, это если ваша монета не была перемешана на протяжении нескольких лет и была перемешана в начале запуска пула. Что касается перспективного анонимного набора, вы можете рассмотреть, как долго ваша монета была доступна для coinjoins. Если это было несколько месяцев, то, вероятно, у нее очень высокий перспективный анонимный набор. Напротив, если она была добавлена в пул всего несколько часов до захвата серверов, то ее перспективный анонимный набор, вероятно, очень низок.
[**-> Узнать больше об анонимных наборах и методе их расчета.**](https://planb.network/tutorials/privacy/analysis/wst-anonsets-0354b793-c301-48af-af75-f87569756375)

Еще один аспект, который следует учитывать, это влияние консолидаций на анонимные наборы монет, которые были перемешаны. Учитывая, что учетные записи Whirlpool больше не доступны через приложение Samourai, вероятно, многие пользователи перенесли свой кошелек на другое программное обеспечение и попытались вывести свои средства из Whirlpool. В частности, в прошлые выходные, когда комиссии за транзакции в сети Bitcoin были относительно высоки, существовал сильный технический и экономический стимул для консолидации постмиксовых монет. Это означает, что вероятно, многие пользователи совершили значительные консолидации.

Проблема с этими постмиксовыми консолидациями заключается в том, что они всегда уменьшают анонимные наборы, не только для пользователя, который их выполняет, но и для пользователей, с которыми они сталкивались во время своих циклов coinjoin. Хотя мне не удалось точно проверить или количественно оценить это явление, экономические стимулы, связанные с комиссиями за транзакции в то время, могут заставить нас предположить, что анонимные наборы потенциально ниже.

### Как пользователь Sentinel

Работа сети приложения для просмотра кошелька Sentinel аналогична работе Samourai. Для доступа к информации вашего кошелька приложение должно передать xpubs, публичные ключи и адреса, которые вы предоставили, в Dojo. Если вы всегда использовали свой собственный Dojo на Sentinel, то проблем нет, и вы можете продолжать использовать приложение без беспокойства. Однако, если вы зависели от серверов Samourai для вашего Sentinel, возможно, что ваши xpubs были раскрыты. В этом случае рекомендуется следовать тому же процессу смены кошелька, который рекомендован для Samourai Wallet при подключении к серверам Samourai.

В маловероятном случае, если вы использовали свой Dojo с Samourai, но не с Sentinel, было бы мудрее считать, что ваши xpubs скомпрометированы.

## Заключение
Спасибо, что прочитали эту статью до конца. Если вы считаете, что информация неполная или у вас есть предложения, пожалуйста, не стесняйтесь связаться со мной, чтобы поделиться своими мыслями. Кроме того, если вам нужна дополнительная помощь в восстановлении вашего кошелька Samourai, несмотря на это руководство, я приглашаю вас присоединиться к [Discover Bitcoin Discord](https://discord.gg/xKKm29XGBb), чтобы попросить помощи. Я регулярно посещаю этот Discord и буду рад помочь вам, если у меня будет решение. Другие биткоинеры также смогут поделиться своим опытом и предложить свою поддержку. **В любом случае, крайне важно сохранять в тайне вашу фразу восстановления, файл бэкапа и парольную фразу**. Не делитесь ими ни с кем, так как это может позволить им украсть ваши биткоины.

