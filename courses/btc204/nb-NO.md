---
name: Privacy on Bitcoin
goal: Forstå og mestre prinsippene for personvernbeskyttelse ved bruk av Bitcoin
objectives:
  - Definere de teoretiske begrepene som er nødvendige for å forstå innsatsen for personvernbeskyttelse
  - Vite hvordan man identifiserer og reduserer risikoene forbundet med tap av brukerpersonvern på Bitcoin
  - Bruke metoder og verktøy for å beskytte ditt personvern på Bitcoin
  - Forstå kjedeanalysemetoder og utvikle forsvarsstrategier
---

# Beskytt ditt personvern på Bitcoin

I en verden hvor personvernet for finansielle transaksjoner gradvis blir en luksus, er det essensielt å forstå og mestre prinsippene for personvernbeskyttelse i din bruk av Bitcoin. Denne opplæringen gir deg alle nøklene, både teoretiske og praktiske, for å oppnå dette autonomt.

I dag, på Bitcoin, finnes det selskaper som spesialiserer seg på kjedeanalyse. Deres kjernevirksomhet er nettopp å trenge inn i ditt private rom, for å kompromittere konfidensialiteten til transaksjonene dine. Faktisk eksisterer ikke "rett til personvern" på Bitcoin. Det er derfor opp til deg, brukeren, å hevde dine naturlige rettigheter og beskytte konfidensialiteten til transaksjonene dine, fordi ingen andre vil gjøre det for deg.

Denne opplæringen presenteres som en komplett og generalistisk reise. Hver teknisk begrep er detaljert og støttet av forklarende diagrammer. Målet er å gjøre kunnskapen tilgjengelig for alle. BTC204 er derfor tilgjengelig for både nybegynnere og mellomliggende brukere. Denne opplæringen tilbyr også merverdi til de mest erfarne bitcoinerne, ettersom vi går dypere inn i noen tekniske konsepter som ofte er ukjente.

Bli med oss for å transformere din bruk av Bitcoin og bli en informert bruker, i stand til å forstå problemene rundt konfidensialitet og beskytte ditt personvern.

+++

# Introduksjon

<partId>e17474a8-8899-4bdb-a7f8-bc52ddb01440</partId>

## Introduksjon til Opplæringen

<chapterId>08ba1933-f393-4fb5-8279-777d874caedb</chapterId>

I en verden hvor personvernet for finansielle transaksjoner gradvis blir en luksus, er det essensielt å forstå og mestre prinsippene for personvernbeskyttelse i din bruk av Bitcoin. Denne opplæringen gir deg alle nøklene, både teoretiske og praktiske, for å oppnå dette autonomt.
I dag, i Bitcoin-økosystemet, finnes det selskaper som spesialiserer seg på kjedeanalyse. Deres kjernevirksomhet er nettopp å trenge inn i ditt private rom, og kompromittere konfidensialiteten til transaksjonene dine. I virkeligheten eksisterer ikke "rett til personvern" på Bitcoin. Det er derfor opp til deg, brukeren, å hevde dine naturlige rettigheter og beskytte konfidensialiteten til transaksjonene dine, fordi ingen andre vil gjøre det for deg.

Bitcoin er ikke bare der for "Number Go Up" og bevaring av spareverdien. På grunn av sine unike egenskaper og historie, er det primært verktøyet for motøkonomien. Takket være denne bemerkelsesverdige oppfinnelsen, kan du fritt håndtere pengene dine, bruke dem og akkumulere dem, uten at noen kan hindre deg.

Bitcoin tilbyr en fredelig flukt fra statens åk, og lar deg fullt ut nyte dine naturlige rettigheter, som ikke kan utfordres av etablerte lover. Takket være Satoshi Nakamotos oppfinnelse, har du kraften til å håndheve respekt for din private eiendom og gjenvinne friheten til å inngå kontrakter.

Men, Bitcoin er ikke anonymt som standard, noe som kan utgjøre en risiko for individer engasjert i motøkonomien, spesielt i regioner under despotiske regimer. Men dette er ikke den eneste faren. Gitt at bitcoin er en verdifull og usensurerbar eiendel, kan det tiltrekke seg oppmerksomheten til tyver. Dermed blir beskyttelse av ditt personvern også et sikkerhetsspørsmål: det kan hjelpe deg med å forhindre cyberangrep og fysiske overfall.
Som vi vil se, selv om protokollen tilbyr visse innebygde personvernsbeskyttelser, er det avgjørende å bruke ekstra verktøy for å optimalisere og forsvare dette personvernet. Denne opplæringen er designet som et omfattende og generalistisk kurs for å forstå innsatsen for personvern på Bitcoin. Hver teknisk begrep diskuteres i detalj og støttes av forklarende diagrammer. Målet er å gjøre kunnskap tilgjengelig for alle, selv for nybegynnere og mellomliggende brukere. For de mer erfarne bitcoinerne dekker vi også veldig tekniske og noen ganger mindre kjente konsepter gjennom denne opplæringen for å fordype forståelsen av hvert emne.

Målet med denne opplæringen er ikke å gjøre deg helt anonym i din bruk av Bitcoin, men heller å gi deg de essensielle verktøyene for å vite hvordan du kan beskytte ditt personvern i henhold til dine personlige mål. Du vil ha friheten til å velge blant konseptene og verktøyene som presenteres for å utvikle dine egne strategier, skreddersydd til dine spesifikke mål og behov.

### Seksjon 1: Definisjoner og nøkkelbegreper

For å begynne, vil vi sammen gjennomgå de grunnleggende prinsippene som styrer driften av Bitcoin, for deretter å rolig nærme oss begreper relatert til personvern. Det er essensielt å mestre noen grunnleggende konsepter, som UTXOs, mottaksadresser, eller skript, før man kan fullt ut forstå konseptene som vi vil adressere i de følgende seksjonene. Vi vil også introdusere den generelle modellen for Bitcoin personvern, som forestilt av Satoshi Nakamoto, som vil tillate oss å forstå innsatsen og risikoene forbundet.
![BTC204](assets/en/11/1.webp)

### Seksjon 2: Forståelse av kjedeanalyse og hvordan beskytte seg mot den

I den andre seksjonen studerer vi teknikkene som brukes av kjedeanalysefirmaer for å spore din aktivitet på Bitcoin. Å forstå disse metodene er avgjørende for å forbedre beskyttelsen av ditt personvern. Denne delen har som mål å undersøke angripernes strategier for bedre å forstå risikoene og legge grunnlaget for teknikkene som vi vil studere i de følgende seksjonene. Vi vil analysere transaksjonsmønstre, interne og eksterne heuristikker, samt plausible tolkninger av disse mønstrene. I tillegg til en teoretisk komponent, vil vi lære å bruke en blokkutforsker for å utføre kjedeanalyse, gjennom praktiske eksempler og øvelser.

![BTC204](assets/notext/11/2.webp)

### Seksjon 3: Mestring av beste praksiser for å beskytte ditt personvern

I den tredje seksjonen av vår opplæring, kommer vi til kjernen av saken: praksis! Målet er å mestre alle de essensielle beste praksisene som bør bli naturlige reflekser for enhver Bitcoin-bruker. Vi vil dekke bruken av ferske adresser, merking, konsolidering, bruk av fullstendige noder, samt KYC og anskaffelsesmetoder. Målet er å gi deg en omfattende oversikt over fallgruvene å unngå for å etablere solide grunnlag i vår søken etter beskyttelse av personvern. For noen av disse praksisene, vil du bli veiledet til en spesifikk opplæring for å implementere dem.

![BTC204](assets/en/11/3.webp)

### Seksjon 4: Forståelse av Coinjoin-transaksjoner

Hvordan kan vi snakke om personvern på Bitcoin uten å diskutere coinjoins? I seksjon 4 vil du oppdage alt du trenger å vite om denne blandingsmetoden. Du vil lære hva en coinjoin er, dens historie og mål, samt de forskjellige typene coinjoins som eksisterer. Til slutt, for de mer erfarne brukerne, vil vi oppdage hva anonsets og entropi er, og hvordan man kan beregne disse indikatorene.

![BTC204](assets/en/11/4.webp)

### Seksjon 5: Forståelse av innsatsen for andre avanserte personvernteknikker

I den femte seksjonen vil vi gi en oversikt over alle de andre eksisterende teknikkene for å beskytte personvernet ditt på Bitcoin, bortsett fra coinjoin. Gjennom årene har utviklere vist bemerkelsesverdig kreativitet i å designe verktøy dedikert til personvern. Vi vil undersøke alle disse metodene, som payjoin, samarbeidstransaksjoner, Coin Swap og Atomic Swap, og detaljere deres funksjon, mål og potensielle svakheter.
Vi vil også adressere personvern på nivået av nodenettverket og spredningen av transaksjoner. Vi vil også diskutere de ulike protokollene som har blitt foreslått gjennom årene for å forbedre brukerens personvern på Bitcoin, inkludert protokoller for statiske adresser.

![BTC204](assets/notext/11/5.webp)

# Definisjoner og nøkkelkonsepter

<partId>b9bbbde3-34c0-4851-83e8-e2ffb029cf31</partId>

## Bitcoin UTXO-modellen

<chapterId>8d6b50c5-bf74-44f4-922b-25204991cb75</chapterId>

Bitcoin er primært en valuta, men vet du konkret hvordan BTC er representert i protokollen?

### Bitcoin UTXOs: Hva er de?

I Bitcoin-protokollen dreier forvaltningen av monetære enheter seg rundt UTXO-modellen, en forkortelse for "_Unspent Transaction Output_".

Denne modellen er dypt forskjellig fra tradisjonelle banksystemer, som stoler på en konto- og saldo-mekanisme for å spore finansielle flyter. Faktisk, i banksystemet, opprettholdes individuelle saldi i kontoer knyttet til en identitet. For eksempel, når du kjøper en baguette fra en baker, debiterer banken din ganske enkelt kjøpesummen fra kontoen din, og reduserer dermed saldoen din, mens bakerens konto krediteres med samme beløp, og øker hans saldo. I dette systemet finnes det ingen oppfatning av en kobling mellom pengene som kommer inn på kontoen din og pengene som forlater den, bortsett fra transaksjonsoppføringer.

![BTC204](assets/en/21/1.webp)
På Bitcoin fungerer ting annerledes. Konseptet med en konto eksisterer ikke, og monetære enheter forvaltes ikke via saldi, men gjennom UTXOer. En UTXO representerer et spesifikt beløp av bitcoins som ennå ikke har blitt brukt, og danner dermed et "stykke bitcoin," som kan være stort eller lite. For eksempel kan en UTXO være verdt `500 BTC` eller bare `700 SATS`.
**> Påminnelse:** Satoshi, ofte forkortet som sat, er den minste enheten av Bitcoin, sammenlignbar med en cent i fiat-valutaer.

```plaintext
1 BTC = 100,000,000 SATS
```

Teoretisk kan en UTXO representere hvilken som helst verdi i bitcoins, fra en sat opp til det teoretiske maksimumet på omtrent 21 millioner BTC. Imidlertid er det logisk umulig å eie alle 21 millioner bitcoins, og det finnes en nedre økonomisk terskel kalt "dust," under hvilken en UTXO anses som økonomisk ulevedyktig å bruke.

**> Visste du?** Den største UTXOen som noensinne er opprettet på Bitcoin, var verdsatt til `500,000 BTC`. Den ble opprettet av MtGox-plattformen under en konsolideringsoperasjon i november 2011: [29a3efd3ef04f9153d47a990bd7b048a4b2d213daaa5fb8ed670fb85f13bdbcf](https://mempool.space/fr/tx/29a3efd3ef04f9153d47a990bd7b048a4b2d213daaa5fb8ed670fb85f13bdbcf)

### UTXOer og betingelser for bruk

UTXOer er bytteinstrumentene på Bitcoin. Hver transaksjon resulterer i forbruket av UTXOer som inndata og opprettelsen av nye UTXOer som utdata. Når en transaksjon utføres, anses UTXOene som brukes som inndata som "brukt", og nye UTXOer genereres og tildeles mottakerne angitt i transaksjonsutdataene. Dermed representerer en UTXO ganske enkelt en ubrukt transaksjonsutgang, og derfor en mengde bitcoins som tilhører en bruker på et gitt tidspunkt.
![BTC204](assets/en/21/2.webp)
Alle UTXOer sikres av skript som definerer betingelsene under hvilke de kan brukes. For å forbruke en UTXO, må en bruker demonstrere for nettverket at de oppfyller betingelsene stipulert av skriptet som sikrer den UTXOen. Generelt er UTXOer beskyttet av en offentlig nøkkel (eller en mottaksadresse som representerer denne offentlige nøkkelen). For å bruke en UTXO assosiert med denne offentlige nøkkelen, må brukeren bevise at de holder den tilsvarende private nøkkelen ved å gi en digital signatur laget med denne nøkkelen. Dette er grunnen til at det sies at din Bitcoin-lommebok faktisk ikke inneholder bitcoins, men heller lagrer dine private nøkler, som igjen gir deg tilgang til dine UTXOer og, ved forlengelse, til bitcoinsene de representerer.
![BTC204](assets/en/21/3.webp)

Gitt at konseptet med en konto er fraværende i Bitcoin, tilsvarer saldoen i en lommebok ganske enkelt summen av verdiene av alle UTXOene den kan bruke. For eksempel, hvis din Bitcoin-lommebok kan bruke følgende 4 UTXOer:

```plaintext
- 2 BTC
- 8 BTC
- 5 BTC
- 2 BTC
```

Ville den totale saldoen i lommeboken din være `17 BTC`.

![BTC204](assets/en/21/4.webp)

## Strukturen til Bitcoin-transaksjoner

<chapterId>29d3aaab-de2e-4746-ab40-c9748898850c</chapterId>

### Inndata og utdata for en transaksjon

En Bitcoin-transaksjon er en operasjon registrert på blokkjeden som tillater overføring av eierskap av bitcoins fra én person til en annen. Mer spesifikt, siden vi er på en UTXO-modell og det ikke finnes kontoer, tilfredsstiller transaksjonen utgiftsbetingelsene som sikret en eller flere UTXOer, forbruker dem, og skaper tilsvarende nye UTXOer utstyrt med nye utgiftsbetingelser. Kort sagt, en transaksjon flytter bitcoins fra et skript som er tilfredsstilt til et nytt skript ment for å sikre dem.

![BTC204](assets/en/22/1.webp)

Hver Bitcoin-transaksjon består dermed av én eller flere inndata og én eller flere utdata. Inndataene er UTXOer som forbrukes av transaksjonen for å generere utdataene. Utdataene er nye UTXOer som vil være brukbare som inndata for fremtidige transaksjoner.

![BTC204](assets/en/22/2.webp)

**> Visste du?** Teoretisk sett kunne en bitcoin-transaksjon ha et uendelig antall inndata og utdata. Bare den maksimale størrelsen på en blokk begrenser dette antallet.
Hver inndata i en Bitcoin-transaksjon refererer til en tidligere, ubrukt UTXO (Unspent Transaction Output). For å bruke en UTXO som inndata, må innehaveren demonstrere at de er den legitime eieren ved å validere skriptet assosiert med den, det vil si ved å møte den pålagte utgiftsbetingelsen. Generelt innebærer dette å gi en digital signatur produsert med den private nøkkelen som tilsvarer den offentlige nøkkelen som opprinnelig sikret den UTXOen. Skriptet verifiserer dermed at signaturen samsvarer med den offentlige nøkkelen brukt ved mottak av midlene.
![BTC204](assets/en/22/3.webp)
Hver utgang spesifiserer på den annen side mengden bitcoins som skal overføres, samt mottakeren. Sistnevnte defineres av et nytt skript som, generelt, låser den nylig opprettede UTXOen med en mottakeradresse eller en ny offentlig nøkkel.
For at en transaksjon skal anses som gyldig i henhold til konsensusregler, må totalen av utgangene være mindre enn eller lik totalen av inngangene. Med andre ord, summen av de nye UTXOene generert av transaksjonen må ikke overstige den av UTXOene som forbrukes som innganger. Dette prinsippet er logisk: hvis du bare har et beløp på `500,000 SATS`, kan du ikke gjøre et kjøp på `700,000 SATS`.

### Endring og Konsolidering i en Bitcoin-Transaksjon

Handlingen til en Bitcoin-transaksjon på UTXOer kan dermed sammenlignes med smeltingen av en gullmynt. Faktisk er en UTXO ikke delelig, men kun sammenslåbar. Dette betyr at en bruker ikke enkelt kan dele en UTXO som representerer en viss mengde bitcoins i flere mindre UTXOer. De må forbruke den helt i en transaksjon for å skape en eller flere nye UTXOer med vilkårlige verdier i utganger, som må være mindre enn eller lik den opprinnelige verdien.

Denne mekanismen er lik den med en gullmynt. Forestill deg at du eier en 2-unse mynt og du vil gjøre en betaling på 1 unse, under forutsetning av at selgeren ikke kan gi deg vekslepenger. Du må smelte mynten din og støpe 2 nye på 1 unse hver.
På Bitcoin er operasjonen lignende. La oss forestille oss at Alice har en UTXO på `10,000 SATS` og hun ønsker å kjøpe en baguette som koster `4,000 SATS`. Alice vil gjøre en transaksjon med en inngang av 1 UTXO på `10,000 SATS` som hun vil forbruke helt, og i utganger, vil hun skape 2 UTXOer verdsatt til `4,000 SATS` og `6,000 SATS`. UTXOen på `4,000 SATS` vil bli sendt til bakeren som betaling for baguetten, mens UTXOen på `6,000 SATS` vil returnere til Alice som veksel. Denne UTXOen som returnerer til den opprinnelige avsenderen av transaksjonen er det som kalles "veksel" i Bitcoin-jargong.
![BTC204](assets/en/22/4.webp)

Nå forestill deg at Alice ikke har en enkelt UTXO på `10,000 SATS`, men heller to UTXOer på `3,000 SATS` hver. I denne situasjonen er ingen av de individuelle UTXOene tilstrekkelige for å dekke `4,000 SATS` for baguetten. Derfor må Alice bruke begge UTXOene på `3,000 SATS` som innganger for hennes transaksjon samtidig. På denne måten vil den totale mengden av innganger nå `6,000 SATS`, noe som tillater henne å dekke betalingen på `4,000 SATS` til bakeren. Denne metoden, som involverer gruppering av flere UTXOer i inngangene av en transaksjon, refereres ofte til med begrepet "konsolidering".
![BTC204](assets/en/22/5.webp)

### Transaksjonsgebyrer

Intuitivt kan man tenke at transaksjonsgebyrer også representerer en utgang av en transaksjon. Men i virkeligheten er ikke dette tilfellet. Gebyrene for en transaksjon representerer forskjellen mellom totalen av inngangene og totalen av utgangene. Dette betyr at, etter å ha brukt deler av verdien av inngangene til å dekke de ønskede utgangene i en transaksjon, gjenstår en viss sum av inngangene ubrukt. Denne restsummen utgjør transaksjonsgebyrene.

```plaintext
Gebyrer = total innganger - total utganger
```

La oss gå tilbake til eksemplet med Alice som har en UTXO på `10,000 SATS` og ønsker å kjøpe en baguette for `4,000 SATS`. Alice oppretter en transaksjon med sin UTXO på `10,000 SATS` som inngang. Hun genererer deretter en utgang på `4,000 SATS` som er ment for bakeren for betaling av baguetten. For å oppmuntre gruvearbeidere til å inkludere transaksjonen hennes i en blokk, tildeler Alice `200 SATS` som gebyrer. Hun skaper dermed en andre utgang, vekslingen, som vil returnere til henne, som beløper seg til `5,800 SATS`.

![BTC204](assets/en/22/6.webp)

Ved å anvende gebyrformelen ser vi faktisk at det gjenstår `200 SATS` for gruvearbeiderne:

```plaintext
Gebyrer = total innganger - total utganger
Utgifter = 10,000 - (4,000 + 5,800)
Utgifter = 10,000 - 9,800
Utgifter = 200
```

Når en gruvearbeider vellykket validerer en blokk, har de lov til å samle inn disse gebyrene for alle transaksjoner inkludert i blokken deres, gjennom den såkalte "coinbase"-transaksjonen.

### Opprettelsen av UTXOs på Bitcoin

Hvis du har fulgt med i de foregående avsnittene oppmerksomt, vet du nå at UTXOs kun kan opprettes ved å forbruke andre eksisterende UTXOs. Dermed danner myntene på Bitcoin en kontinuerlig kjede. Men du lurer kanskje på hvordan de første UTXOene i denne kjeden dukket opp. Dette reiser et problem likt hønen og egget: hvor kom disse opprinnelige UTXOene fra?

Svaret ligger i **coinbase-transaksjonen**.

Coinbase er en spesifikk type Bitcoin-transaksjon, unik for hver blokk og alltid den første i dem. Den lar gruvearbeideren som fant et gyldig proof of work motta sin blokkbelønning. Denne belønningen består av to elementer: **blokksubsidiet** og **transaksjonsgebyrene** vi snakket om i den forrige delen.

Det unike med coinbase-transaksjonen er at den er den eneste som kan skape bitcoins ut av ingenting, uten å trenge å forbruke innganger for å generere sine utganger. Disse nyopprettede bitcoins utgjør det som kan kalles de "opprinnelige UTXOene".

![BTC204](assets/en/22/7.webp)

Bitcoins fra blokksubsidiet er nye BTC skapt fra ingenting, følgende en forhåndsbestemt utstedelsesplan i konsensusreglene. Blokksubsidiet halveres hver 210,000 blokker, som er omtrent hvert fjerde år, i en prosess kalt "halvering". Opprinnelig ble 50 bitcoins skapt med hvert subsidie, men dette beløpet har gradvis avtatt; for øyeblikket er det 3.125 bitcoins per blokk.
Når det gjelder delen relatert til transaksjonsgebyrer, selv om de også representerer nyopprettede BTC, må de ikke overstige forskjellen mellom de totale inngangene og utgangene av alle transaksjoner i en blokk. Vi så tidligere at disse gebyrene representerer delen av inngangene som ikke brukes i transaksjonenes utganger. Denne delen er teknisk sett "tapt" under transaksjonen, og gruvearbeideren har rett til å gjenskape denne verdien i form av en eller flere nye UTXOer. Dette er derfor en overføring av verdi fra transaksjonssenderen til gruvearbeideren som legger den til i blokkjeden.
**> Visste du?** Bitcoins generert av en coinbase-transaksjon er underlagt en modningsperiode på 100 blokker der de ikke kan brukes av gruvearbeideren. Denne regelen er ment å unngå komplikasjoner knyttet til bruk av nyopprettede bitcoins på en kjede som senere kan bli foreldet.

### Implikasjonene av UTXO-modellen

For det første påvirker UTXO-modellen direkte transaksjonsgebyrer på Bitcoin. Gitt at kapasiteten til hver blokk er begrenset, favoriserer gruvearbeidere transaksjoner som tilbyr de beste gebyrene i forhold til plassen de vil oppta i blokken. Faktisk, jo flere UTXOer en transaksjon inkluderer som innganger og utganger, jo tyngre er den, og derfor krever den høyere gebyrer. Dette er en av grunnene til at det ofte er en innsats for å redusere antallet UTXOer i lommeboken vår, noe som også kan påvirke personvern, et tema vi vil gå i dybden på i den tredje delen av denne opplæringen.

Videre, som nevnt i de foregående delene, er mynter på Bitcoin i hovedsak en kjede av UTXOer. Hver transaksjon skaper dermed en kobling mellom en tidligere UTXO og en fremtidig UTXO. UTXOer tillater derfor eksplisitt sporing av banen til bitcoins fra deres opprettelse til deres nåværende utgift. Denne gjennomsiktigheten kan ses positivt, da den lar hver bruker sikre autentisiteten til de mottatte bitcoins. Men det er også på dette prinsippet om sporbarhet og revisjonsmulighet at kjedeanalyse hviler, en praksis rettet mot å kompromittere ditt personvern. Vi vil studere denne praksisen i dybden i den andre delen av opplæringen.

## Bitcoins personvernmodell

<chapterId>769d8963-3ed5-4094-b21d-9203c7d9e465</chapterId>

### Valuta: Autentisitet, Integritet og Dobbeltsending

En av valutaens funksjoner er å løse problemet med dobbel sammentreff av ønsker. I et system basert på byttehandel krever å gjøre en utveksling ikke bare å finne en person som tilbyr en vare som møter mitt behov, men også å tilby dem en vare av tilsvarende verdi som tilfredsstiller deres eget behov. Å finne denne balansen viser seg å være kompleks.

![BTC204](assets/notext/23/1.webp)

Derfor tyr vi til valuta, som muliggjør overføring av verdi både i rom og tid.

![BTC204](assets/notext/23/2.webp)

For at valuta skal løse dette problemet, er det essensielt at parten som tilbyr en vare eller tjeneste er overbevist om deres evne til å bruke den summen senere. Dermed vil enhver rasjonell person som ønsker å akseptere et stykke valuta, enten det er digitalt eller fysisk, sørge for at det oppfyller to grunnleggende kriterier:

- **Mynten må være intakt og autentisk;**
- **og den må ikke være dobbeltbrukt.**
  Når man bruker fysisk valuta, er den første egenskapen den mest komplekse å fastslå. Gjennom ulike perioder i historien har integriteten til metallmynter ofte blitt kompromittert av praksiser som klipping eller boring. For eksempel, i det gamle Roma, var det vanlig for borgere å skrape kantene på gullmynter for å samle litt av det edle metallet, samtidig som de beholdt dem for fremtidige transaksjoner. Den iboende verdien av mynten ble dermed redusert, men dens pålydende verdi forble den samme. Dette er nettopp grunnen til at det senere ble preget riller på kanten av mynter.
  Autentisitet er også en vanskelig egenskap å verifisere med fysiske pengeenheter. I dag er teknikker for å bekjempe forfalskning stadig mer komplekse, noe som tvinger handelsmenn til å investere i dyre verifiseringssystemer.

På den annen side, på grunn av deres natur, er dobbeltutgifter ikke et problem for fysiske valutaer. Hvis jeg gir deg en €10 seddel, forlater den uopprettelig min besittelse for å gå inn i din, og utelukker naturlig enhver mulighet for å bruke de samme pengeenhetene flere ganger. Kort sagt, jeg vil ikke kunne bruke den €10 seddelen igjen.

![BTC204](assets/notext/23/3.webp)

For digital valuta er vanskeligheten annerledes. Å sikre autentisiteten og integriteten til en mynt er ofte enklere. Som vi så i forrige avsnitt, tillater Bitcoins UTXO-modell å spore en mynt tilbake til sin opprinnelse, og dermed verifisere at den faktisk ble skapt i samsvar med konsensusreglene av en miner.

Imidlertid er det å sikre fraværet av dobbeltutgifter mer komplekst, siden enhver digital god er i hovedsak informasjon. I motsetning til fysiske varer, deler ikke informasjon seg under utvekslinger, men sprer seg ved å multiplisere. For eksempel, hvis jeg sender deg et dokument via e-post, blir det deretter duplisert. På din ende, kan du ikke verifisere med sikkerhet at jeg har slettet det originale dokumentet.

![BTC204](assets/notext/23/4.webp)

### Forebygging av dobbeltutgifter på Bitcoin

Den eneste måten å unngå duplisering av en digital god på er å være klar over alle utvekslingene innen systemet. På denne måten kan man vite hvem som eier hva og oppdatere alles beholdninger basert på transaksjonene som er gjort. Dette er det som gjøres, for eksempel, med bokførte penger i banksystemet. Når du betaler €10 til en handelsmann med kredittkort, noterer banken denne utvekslingen og oppdaterer hovedboken.
På Bitcoin oppnås forebygging av dobbeltutgifter på samme måte. Målet er å bekrefte fraværet av en transaksjon som allerede har brukt myntene i spørsmålet. Hvis disse myntene aldri har blitt brukt, da kan vi være sikre på at ingen dobbeltutgifter vil forekomme. Dette prinsippet ble beskrevet av Satoshi Nakamoto i White Paper med denne berømte setningen:

**"_Den eneste måten å bekrefte fraværet av en transaksjon på er å være klar over alle transaksjoner._"**

Imidlertid, i motsetning til bankmodellen, er det ikke ønskelig å måtte stole på en sentral enhet på Bitcoin. Det er nødvendig for alle brukere å kunne bekrefte dette fraværet av dobbeltutgifter, uten å stole på en tredjepart. Dermed må alle være klar over alle Bitcoin-transaksjoner. Dette er grunnen til at Bitcoin-transaksjoner offentlig kringkastes over alle nettverksnoder og registreres klart på blockchain.

Det er nettopp denne offentlige spredningen av informasjon som kompliserer beskyttelsen av personvern på Bitcoin. I det tradisjonelle banksystemet, i teorien, er det bare finansinstitusjonen som er klar over transaksjonene som er gjort. På den annen side, på Bitcoin, er alle brukere informert om alle transaksjoner, via deres respektive noder.

### Personvernsmodellen: banksystemet vs Bitcoin

I det tradisjonelle systemet er bankkontoen din knyttet til din identitet. Bankfunksjonæren kan vite hvilken bankkonto som tilhører hvilken klient, og hvilke transaksjoner som er assosiert med den. Imidlertid er denne informasjonsflyten avskåret mellom banken og det offentlige domenet. Med andre ord, det er umulig å vite saldoen og transaksjonene til en bankkonto som tilhører en annen person. Bare banken har tilgang til denne informasjonen.
For eksempel, bankfunksjonæren din vet at du kjøper baguetten din hver morgen på nabolagets bakeri, men naboen din er ikke klar over denne transaksjonen. Således er informasjonsflyten tilgjengelig for de berørte partene, spesielt banken, men forblir utilgjengelig for utenforstående.

På grunn av begrensningen av offentlig spredning av transaksjoner som vi så i den forrige delen, kan ikke personvernsmodellen til Bitcoin følge modellen til banksystemet. I tilfellet med Bitcoin, siden informasjonsflyten ikke kan brytes mellom transaksjonene og det offentlige domenet, **stoler personvernsmodellen på separasjonen mellom brukerens identitet og transaksjonene** selv.
For eksempel, hvis du kjøper en baguette fra bakeren ved å betale i BTC, kan naboen din, som eier sin egen full node, se transaksjonen din gå gjennom, akkurat som de kan se alle de andre transaksjonene i systemet. Imidlertid, hvis personvernprinsipper respekteres, bør de ikke kunne koble denne spesifikke transaksjonen til din identitet.
![BTC204](assets/en/23/9.webp)

Men siden Bitcoin-transaksjoner blir offentliggjort, blir det fortsatt mulig å etablere koblinger mellom dem for å utlede informasjon om de involverte partene. Denne aktiviteten utgjør til og med en spesialitet i seg selv kalt "kjedeanalyse". I neste del av opplæringen inviterer jeg deg til å utforske grunnleggende om kjedeanalyse for å forstå hvordan dine bitcoins blir sporet og for å vite hvordan du bedre kan forsvare deg mot det.

# Forståelse av Kjedeanalyse og Hvordan Beskytte Deg Selv

<partId>4739371e-9fef-45b0-bcaa-b7a4df6b4470</partId>

## Hva er Kjedeanalyse på Bitcoin?

<chapterId>7d198ba6-4af2-4f24-86cb-3c79cb25627e</chapterId>

### Definisjon og Operasjon

Kjedeanalyse er en praksis som omfatter alle metodene som brukes for å spore flyten av bitcoins på blockchain. Generelt stoler kjedeanalyse på å observere karakteristikker i prøver av tidligere transaksjoner. Det innebærer deretter å identifisere disse samme karakteristikkene i en transaksjon som man ønsker å analysere, og utlede plausible tolkninger. Denne problemløsningsmetoden fra en praktisk tilnærming, for å finne en tilstrekkelig god løsning, er det som kalles en "heuristikk".

For å forenkle, kjedeanalyse utføres i tre hovedtrinn:

1. **Observere blockchain;**
2. **Identifisere kjente karakteristikker;**
3. **Utlede hypoteser.**

![BTC204](assets/en/31/1.webp)

Kjedeanalyse kan utføres av hvem som helst. Det er nok å ha tilgang til den offentlige informasjonen til blockchain via en full node for å observere bevegelsene av transaksjoner og gjøre hypoteser. Det finnes også gratis verktøy som letter denne analysen, som nettstedet [OXT.me](https://oxt.me/) som vi vil utforske i detalj i de to siste kapitlene av denne delen. Imidlertid kommer den største risikoen for personvern fra selskaper som er spesialiserte i kjedeanalyse. Disse selskapene har tatt kjedeanalyse til en industriell skala og selger tjenestene sine til finansinstitusjoner eller regjeringer. Blant disse selskapene er Chainalysis sannsynligvis det mest kjente.

### Målene med Kjedeanalyse

Et av målene med kjedeanalyse er å gruppere ulike aktiviteter på Bitcoin for å bestemme brukerens unikhet som utførte dem. Deretter vil det være mulig å forsøke å knytte denne aktivitetsbunten til en faktisk identitet.
![BTC204](assets/notext/31/2.webp)

Husk forrige kapittel. Jeg forklarte hvorfor Bitcoins personvernmodell opprinnelig støttet seg på å skille brukerens identitet fra deres transaksjoner. Det ville derfor være fristende å tenke at kjedeanalyse er unødvendig, siden selv om man klarer å gruppere onchain-aktiviteter, kan de ikke assosieres med en faktisk identitet.

Teoretisk sett er denne uttalelsen nøyaktig. I den første delen av denne opplæringen så vi at kryptografiske nøkkelpar brukes til å etablere betingelser på UTXO. I sin essens avslører disse nøkkelparene ingen informasjon om identiteten til deres innehavere. Så selv om man lykkes i å gruppere aktiviteter assosiert med forskjellige nøkkelpar, forteller dette oss ingenting om enheten bak disse aktivitetene.

![BTC204](assets/notext/31/3.webp)

Men den praktiske virkeligheten er mye mer kompleks. Det finnes en mengde atferder som risikerer å koble en faktisk identitet til en onchain-aktivitet. I analyse kalles dette et inngangspunkt, og det finnes mange av dem.

Det mest vanlige er selvfølgelig KYC (_Know Your Customer_). Hvis du tar ut dine bitcoins fra en regulert plattform til en av dine personlige mottaksadresser, så er det noen som kan koble din identitet til denne adressen. Mer bredt kan et inngangspunkt være enhver form for interaksjon mellom ditt virkelige liv og en Bitcoin-transaksjon. For eksempel, hvis du publiserer en mottaksadresse på dine sosiale nettverk, kan dette være et inngangspunkt for analyse. Hvis du gjør en betaling i bitcoins til din baker, kan de assosiere ditt ansikt (som er en del av din identitet) med en Bitcoin-adresse.

Disse inngangspunktene er nesten uunngåelige i bruken av Bitcoin. Selv om man kan søke å begrense deres omfang, vil de forbli til stede. Derfor er det avgjørende å kombinere metoder som tar sikte på å bevare ditt personvern. Selv om det å opprettholde en separasjon mellom din faktiske identitet og dine transaksjoner er en interessant tilnærming, er det utilstrekkelig i dag. Faktisk, hvis alle dine onchain-aktiviteter kan grupperes, så er det minste inngangspunktet sannsynlig å kompromittere det eneste laget av personvern du hadde etablert.

![BTC204](assets/notext/31/4.webp)

### Forsvar mot kjedeanalyse

Dermed er det også nødvendig å kunne møte blokkjedeanalyse i vår bruk av Bitcoin. Ved å gå frem på denne måten, kan vi minimere aggregasjonen av våre aktiviteter og begrense innvirkningen av et inngangspunkt på vårt personvern.
![BTC204](assets/notext/31/5.webp)

Faktisk, for å bedre motvirke blokkjedeanalyse, hva er vel en bedre tilnærming enn å gjøre seg kjent med metodene som brukes i blokkjedeanalyse? Hvis du vil vite hvordan du kan forbedre ditt personvern på Bitcoin, må du forstå disse metodene. Dette vil tillate deg å bedre forstå teknikker som coinjoin eller payjoin (teknikker som vi vil studere i de siste delene av opplæringen), og å redusere feilene du kanskje gjør.
I dette kan vi trekke en analogi med kryptografi og kryptoanalyse. En god kryptograf er først og fremst en god kryptoanalytiker. For å forestille seg en ny krypteringsalgoritme, må man vite hvilke angrep den må stå imot, og også studere hvorfor tidligere algoritmer ble brutt. Det samme prinsippet gjelder for personvern på Bitcoin. Å forstå metodene for blokkjedeanalyse er nøkkelen til å beskytte mot det. Det er derfor jeg foreslår en hel seksjon om blokkjedeanalyse i denne opplæringen.

https://planb.network/tutorials/privacy/on-chain/coinjoin-samourai-wallet-e566803d-ab3f-4d98-9136-5462009262ef

https://planb.network/fr/tutorials/privacy/on-chain/payjoin-848b6a23-deb2-4c5f-a27e-93e2f842140f

### Metodene for blokkjedeanalyse

Det er viktig å forstå at blokkjedeanalyse ikke er en eksakt vitenskap. Den stoler på heuristikker avledet fra tidligere observasjoner eller logiske tolkninger. Disse reglene tillater ganske pålitelige resultater, men aldri med absolutt presisjon. Med andre ord, **blokkjedeanalyse innebærer alltid en dimensjon av sannsynlighet i de utstedte konklusjonene**. For eksempel kan det estimeres med mer eller mindre sikkerhet at to adresser tilhører samme enhet, men total sikkerhet vil alltid være utenfor rekkevidde.

Hele målet med blokkjedeanalyse ligger nettopp i aggregasjonen av ulike heuristikker for å minimere risikoen for feil. Det er på en måte en akkumulering av bevis som lar oss nærme oss virkeligheten mer nøye.

Disse berømte heuristikkene kan grupperes i forskjellige kategorier som vi vil detaljere sammen:

- **Transaksjonsmønstre (eller transaksjonsmodeller);**
- **Heuristikker internt i transaksjonen;**
- **Heuristikker eksternt til transaksjonen.**

### Satoshi Nakamoto og blokkjedeanalyse

Det bør bemerkes at de to første heuristikkene for kjedeanalyse ble oppdaget av Satoshi Nakamoto selv. Han diskuterer dem i del 10 av Bitcoin White Paper. Disse er:

- den felles innehaver-eierskap heuristikken (CIOH);
- og gjenbruk av adresse.

![BTC204](assets/notext/31/6.webp)

Kilde: S. Nakamoto, "Bitcoin: A Peer-to-Peer Electronic Cash System", https://bitcoin.org/bitcoin.pdf, 2009.

I de følgende kapitlene vil vi utforske hva disse består av, men det er allerede interessant å merke seg at disse to heuristikkene fortsatt beholder en preeminens i kjedeanalyse i dag.

## Transaksjonsmønstre

<chapterId>d365a101-2d37-46a5-bfb9-3c51e37bf96b</chapterId>

Et transaksjonsmønster er ganske enkelt en modell eller en overordnet struktur av en typisk transaksjon som kan finnes på blokkjeden, hvis tolkning sannsynligvis er kjent. Når vi studerer mønstre, vil vi fokusere på en enkelt transaksjon som vi vil analysere på et høyt nivå.

Med andre ord, vi vil bare se på antallet UTXOer i innganger og antallet UTXOer i utganger, uten å dvele ved de mer spesifikke detaljene eller transaksjonens miljø. Fra det observerte mønsteret vil vi kunne tolke transaksjonens natur. Vi vil deretter se etter egenskaper i strukturen og dedusere en tolkning.

![BTC204](assets/en/32/01.webp)

I denne delen vil vi sammen oppdage de viktigste transaksjonsmodellene som kan møtes i kjedeanalyse, og for hver modell vil jeg gi deg den sannsynlige tolkningen av denne strukturen, sammen med et konkret eksempel.

### Enkel Sending (eller Enkelt Betaling)

Vi starter med et veldig utbredt mønster, siden det er det som vises i de fleste bitcoin-betalinger. Den enkle betalingsmodellen kjennetegnes av forbruket av en eller flere UTXOer i innganger og produksjonen av 2 UTXOer i utganger. Denne modellen vil derfor se slik ut:

![BTC204](assets/en/32/02.webp)
Når vi ser denne transaksjonsstrukturen på blockchain, kan vi allerede trekke en tolkning. Som navnet antyder, indikerer denne modellen at vi er i nærvær av en sende- eller betalingstransaksjon. Brukeren har brukt sine egne UTXOer i inndata for å tilfredsstille i utdata en betalings-UTXO og en veksel-UTXO (penger returnert til samme bruker).
Vi vet derfor at den observerte brukeren sannsynligvis ikke lenger er i besittelse av en av de to UTXOene i utdata (den for betaling), men de er fortsatt i besittelse av den andre UTXOen (den for veksel).
I øyeblikket er det umulig for oss å spesifisere hvilken utdata som representerer hvilken UTXO, ettersom dette ikke er målet med studiet av mønstre. Vi vil oppnå dette ved å stole på heuristikkene som vi vil studere i de følgende delene. På dette stadiet er vårt mål begrenset til å identifisere naturen til den aktuelle transaksjonen, som i dette tilfellet er en enkel sending.

For eksempel, her er en Bitcoin-transaksjon som adopterer mønsteret for enkel sending:

```plaintext
b6cc79f45fd2d7669ff94db5cb14c45f1f879ea0ba4c6e3d16ad53a18c34b769
```

![BTC204](assets/en/32/03.webp)

Kilde: [Mempool.space](https://mempool.space/fr/tx/b6cc79f45fd2d7669ff94db5cb14c45f1f879ea0ba4c6e3d16ad53a18c34b769)

Etter dette første eksemplet, bør du ha en bedre forståelse av hva det betyr å studere et "transaksjonsmønster". Vi undersøker en transaksjon ved kun å fokusere på dens struktur, uten å ta hensyn til dens miljø eller de spesifikke detaljene i transaksjonen. Vi observerer den kun på en global måte i dette første steget.

Nå som du forstår hva et mønster er, la oss gå videre til de andre eksisterende modellene.

### Sweeping

Denne andre modellen kjennetegnes av forbruket av en enkelt UTXO som inndata og produksjonen av en enkelt UTXO som utdata.

![BTC204](assets/en/32/04.webp)

Tolkningen av denne modellen er at vi er i nærvær av en selvoverføring. Brukeren har overført sine bitcoins til seg selv, til en annen adresse han eier. Siden det ikke er noen veksel i transaksjonen, er det svært usannsynlig at vi er i nærvær av en betaling. Faktisk, når en betaling gjøres, er det nesten umulig for betaleren å ha en UTXO som nøyaktig matcher beløpet som kreves av selgeren, pluss transaksjonsgebyrene. Generelt er betaleren derfor tvunget til å produsere en vekselutdata.

Vi vet da at den observerte brukeren sannsynligvis fortsatt er i besittelse av denne UTXOen. I konteksten av en kjedeanalyse, hvis vi vet at UTXOen brukt som inndata i transaksjonen tilhører Alice, kan vi anta at UTXOen i utdata også tilhører henne. Det som vil bli interessant senere, er å finne interne heuristikker til transaksjonen som kunne styrke denne antagelsen (vi vil studere disse heuristikkene i kapittel 3.3).

For eksempel, her er en Bitcoin-transaksjon som adopterer sweeping-mønsteret:

```plaintext
35f1072a0fda5ae106efb4fda871ab40e1f8023c6c47f396441ad4b995ea693d
```

![BTC204](assets/en/32/05.webp)
Kilde: [Mempool.space](https://mempool.space/fr/tx/35f1072a0fda5ae106efb4fda871ab40e1f8023c6c47f396441ad4b995ea693d)Dette mønsteret kan imidlertid også avsløre en selvoverføring til kontoen til en kryptovalutabørsplattform. Det vil være studiet av kjente adresser og konteksten til transaksjonen som vil tillate oss å vite om det er en feiing til en selvforvaltet lommebok eller et uttak til en plattform. Faktisk er adressene til børsplattformer ofte lett gjenkjennelige.

La oss gå tilbake til eksemplet med Alice: hvis feiingen fører til en kjent adresse til en plattform (som Binance, for eksempel), kan dette bety at bitcoinene ble overført ut av Alices direkte besittelse, sannsynligvis med intensjonen om å selge dem eller lagre dem på denne plattformen. På den annen side, hvis destinasjonsadressen er ukjent, er det rimelig å anta at det ganske enkelt er en annen lommebok som fortsatt tilhører Alice. Men denne typen studie faller mer inn under kategorien heuristikk og ikke studiet av mønstre.

### Konsolidering

Denne modellen kjennetegnes av forbruket av flere UTXOer som inngang og produksjonen av en enkelt UTXO som utgang.

![BTC204](assets/en/32/06.webp)

Tolkningen av denne modellen er at vi er i nærvær av en konsolidering. Dette er en vanlig praksis blant Bitcoin-brukere, med mål om å slå sammen flere UTXOer i forventning om en mulig økning i transaksjonsgebyrer. Ved å utføre denne operasjonen i en periode når gebyrene er lave, er det mulig å spare på fremtidige gebyrer. Vi vil snakke mer om denne praksisen i kapittel 4.3.

Vi kan utlede at brukeren bak denne transaksjonsmodellen sannsynligvis var i besittelse av alle UTXOene i inngangene og fortsatt er i besittelse av UTXOen i utgangen. Dette er sikkert en selvoverføring.

Akkurat som feiing, kan denne typen mønster også avsløre en selvoverføring til kontoen til en børsplattform. Det vil være studiet av kjente adresser og konteksten til transaksjonen som vil tillate oss å vite om det er en konsolidering til en selvforvaltet lommebok eller et uttak til en plattform.

For eksempel, her er en Bitcoin-transaksjon som adopterer konsolideringsmønsteret:

```plaintext
77c16914211e237a9bd51a7ce0b1a7368631caed515fe51b081d220590589e94
```

![BTC204](assets/en/32/07.webp)

Kilde: [Mempool.space](https://mempool.space/fr/tx/77c16914211e237a9bd51a7ce0b1a7368631caed515fe51b081d220590589e94)
I konteksten av en kjedeanalyse kan denne modellen avsløre mye informasjon. For eksempel, hvis vi vet at en av inngangene tilhører Alice, kan vi anta at alle de andre inngangene og utgangen av denne transaksjonen tilhører henne også. Denne antagelsen ville da tillate oss å spore tilbake gjennom tidligere transaksjonskjeder for å oppdage og analysere andre transaksjoner sannsynligvis assosiert med Alice.
![BTC204](assets/en/32/08.webp)

### Gruppert Forbruk

Denne modellen kjennetegnes av forbruket av noen få UTXOer som innganger (ofte bare én) og produksjonen av tallrike UTXOer som utganger.

![BTC204](assets/en/32/09.webp)
Tolkningen av denne modellen er at vi er i nærvær av en gruppeutgift. Dette er en praksis som sannsynligvis avslører betydelig økonomisk aktivitet, som for eksempel en utvekslingsplattform. Gruppeutgifter lar disse enhetene spare på gebyrer ved å konsolidere sine utgifter i en enkelt transaksjon.
Vi kan utlede fra denne modellen at UTXO-inngangen kommer fra et selskap med betydelig økonomisk aktivitet og at UTXO-utgangene vil dispergere. Mange vil tilhøre kunder av selskapet som har trukket bitcoins fra plattformen. Andre kan gå mot partnerbedrifter. Til slutt vil det helt sikkert være en eller flere utvekslinger som returnerer til utstedende selskap.

For eksempel, her er en Bitcoin-transaksjon som tar i bruk mønsteret av gruppeutgifter (sannsynligvis er det en transaksjon utstedt av Bybit-plattformen):

```plaintext
8a7288758b6e5d550897beedd13c70bcbaba8709af01a7dbcc1f574b89176b43
```

![BTC204](assets/en/32/10.webp)

Kilde: [Mempool.space](https://mempool.space/fr/tx/8a7288758b6e5d550897beedd13c70bcbaba8709af01a7dbcc1f574b89176b43)

### Protokollspesifikke Transaksjoner

Blant transaksjonsmønstrene kan vi også identifisere modeller som avslører bruken av en spesifikk protokoll. For eksempel vil Whirlpool coinjoins (som vi vil diskutere i del 5) ha en lett gjenkjennelig struktur som gjør det mulig å skille dem fra andre mer tradisjonelle transaksjoner.

![BTC204](assets/en/32/11.webp)

Analysen av dette mønsteret antyder at vi sannsynligvis er i nærvær av en samarbeidstransaksjon. Det er også mulig å observere en coinjoin. Hvis denne siste hypotesen viser seg å være nøyaktig, kan antallet utganger gi oss en omtrentlig estimering av antall deltakere i coinjoin.

For eksempel, her er en Bitcoin-transaksjon som tar i bruk mønsteret av samarbeidstransaksjonstypen coinjoin:

```plaintext
00601af905bede31086d9b1b79ee8399bd60c97e9c5bba197bdebeee028b9bea
```

![BTC204](assets/en/32/12.webp)

Kilde: [Mempool.space](https://mempool.space/fr/tx/00601af905bede31086d9b1b79ee8399bd60c97e9c5bba197bdebeee028b9bea)

Det finnes mange andre protokoller som har sine egne spesifikke strukturer. Således kunne vi skille transaksjoner av Wabisabi-typen, Stamps-transaksjoner, eller til og med Runes, for eksempel.

Takket være disse transaksjonsmønstrene kan vi allerede tolke en rekke informasjonsbiter om en gitt transaksjon. Men strukturen til transaksjonen er ikke den eneste informasjonskilden for analyse. Vi kan også studere detaljene. Disse detaljene, interne i en transaksjon, er det jeg liker å kalle "interne heuristikker", og vi vil studere dem i det følgende kapittelet.

## Interne Heuristikker

<chapterId>c54b5abe-872f-40f4-a0d0-c59faff228ba</chapterId>

En intern heuristikk er en spesifikk karakteristikk identifisert innenfor en transaksjon selv, uten behov for å undersøke dens miljø, som lar oss gjøre deduksjoner. I motsetning til mønstre som fokuserer på den overordnede strukturen til transaksjonen på et høyt nivå, er interne heuristikker basert på settet av uttrekkbare data. Dette inkluderer:

- Mengdene av de forskjellige UTXOene, både innkommende og utgående;
- Alt som angår skriptene: mottaksadressene, versjoneringen, låsetidene...

Generelt vil denne typen heuristikk tillate oss å identifisere endringen i en spesifikk transaksjon. Ved å gjøre dette, kan vi deretter fortsette å spore en enhet over flere forskjellige transaksjoner. Faktisk, hvis vi identifiserer en UTXO som tilhører en bruker vi ønsker å følge, er det avgjørende å bestemme, når de utfører en transaksjon, hvilket output som ble overført til en annen bruker og hvilket output som representerer endringen, og dermed forblir i deres besittelse.

![BTC204](assets/en/33/01.webp)

Jeg minner igjen om at disse heuristikkene ikke er absolutt presise. Tatt individuelt, tillater de oss bare å identifisere plausible scenarioer. Det er akkumuleringen av flere heuristikker som hjelper til med å redusere usikkerhet, uten å noen gang fullstendig eliminere den.

### Interne Likhetstrekk

Denne heuristikken involverer studiet av likheter mellom inngangene og utgangene av samme transaksjon. Hvis vi observerer samme karakteristikk på inngangene og på kun en av utgangene av transaksjonen, så er det sannsynlig at denne utgangen utgjør endringen.

Det mest åpenbare kjennetegnet er gjenbruk av en mottaksadresse i samme transaksjon.

![BTC204](assets/en/33/02.webp)
Denne heuristikken etterlater lite rom for tvil. Med mindre ens private nøkkel har blitt hacket, avslører samme mottaksadresse uunngåelig aktiviteten til en enkelt bruker. Tolkingen som følger er at endringen fra transaksjonen er utgangen med samme adresse som inngangen. Dette muliggjør fortsatt sporing av individet basert på denne endringen.
For eksempel, her er en transaksjon der denne heuristikken med rimelighet kan anvendes:

```plaintext
54364146665bfc453a55eae4bfb8fdf7c721d02cb96aadc480c8b16bdeb8d6d0
```

![BTC204](assets/notext/33/03.webp)

Kilde: [Mempool.space](https://mempool.space/tx/54364146665bfc453a55eae4bfb8fdf7c721d02cb96aadc480c8b16bdeb8d6d0)

Disse likhetene mellom innganger og utganger stopper ikke ved adressebruk. Enhver likhet i bruk av skript kan tillate anvendelse av en heuristikk. For eksempel, noen ganger kan man observere samme versjonering mellom en inngang og en av utgangene av transaksjonen.

![BTC204](assets/en/33/04.webp)

I dette diagrammet kan vi se at inngang nr. 0 låser opp et P2WPKH-skript (SegWit V0 som starter med `bc1q`). Utgang nr. 0 bruker samme type skript. Imidlertid bruker utgang nr. 1 et P2TR-skript (SegWit V1 som starter med `bc1p`). Tolkingen av denne karakteristikken er at det er sannsynlig at adressen med samme versjonering som inngangen er endringsadressen. Den ville derfor fortsatt tilhøre samme bruker.

Her er en transaksjon der denne heuristikken med rimelighet kan anvendes:

```plaintext
db07516288771ce5d0a06b275962ec4af1b74500739f168e5800cbcb0e9dd578
```

![BTC204](assets/notext/33/05.webp)

Kilde: [Mempool.space](https://mempool.space/tx/db07516288771ce5d0a06b275962ec4af1b74500739f168e5800cbcb0e9dd578)
I dette tilfellet kan vi se at inngang nr. 0 og utgang nr. 1 bruker P2WPKH-skript (SegWit V0), mens utgang nr. 0 bruker en annen type skript, P2PKH (Legacy). I begynnelsen av 2010-tallet var denne heuristikken basert på versjonering av skript relativt lite nyttig på grunn av begrensningen i typer skript som var tilgjengelige. Imidlertid, over tid og med suksessive oppdateringer til Bitcoin, har en økende mangfoldighet av skripttyper blitt introdusert. Denne heuristikken blir mer og mer relevant fordi, med et bredere utvalg av skripttyper, blir brukerne delt inn i mindre grupper, noe som øker sjansene for å anvende denne heuristikken for intern versjonsbruk. Av denne grunn, kun fra et personvernperspektiv, er det tilrådelig å velge den mest vanlige skripttypen. For eksempel, mens jeg skriver disse linjene, er Taproot-skript (`bc1p`) mindre hyppig brukt enn SegWit V0-skript (`bc1q`). Selv om de førstnevnte tilbyr økonomiske og personvernfordeler i visse spesifikke kontekster, for mer tradisjonelle enkeltsignaturbruk, kan det være klokt å holde seg til en eldre standard av personvernhensyn, til den nye standarden er mer bredt adoptert.

### Betalinger med Runde Tall

En annen intern heuristikk som kan hjelpe oss med å identifisere veksel er den med runde tall. Generelt, når man står overfor et enkelt betalingsmønster (1 inngang og 2 utganger), hvis en av utgangene bruker et rundt beløp, da representerer det betalingen.

![BTC204](assets/en/33/06.webp)

Ved eliminering, hvis en utgang representerer betalingen, representerer den andre vekselen. Det kan derfor antas at det er sannsynlig at brukeren som utførte transaksjonen fortsatt besitter utgangen identifisert som vekselen.

Det bør bemerkes at denne heuristikken ikke alltid er anvendelig, siden flertallet av betalinger fortsatt gjøres i fiatvalutaenheter. Faktisk, når en handelsmann i Frankrike aksepterer bitcoin, viser de generelt ikke stabile priser i sats. De ville heller foretrekke en konvertering mellom prisen i euro og beløpet i bitcoins som skal betales. Derfor bør det ikke være et rundt tall i transaksjonsutgangen.

Likevel kunne en analytiker forsøke å gjøre denne konverteringen ved å ta hensyn til vekslingskursen som var gjeldende da transaksjonen ble kringkastet på nettverket. La oss ta eksempelet med en transaksjon med en inngang på `97,552 sats` og to utganger, en på `31,085 sats` og den andre på `64,152 sats`. Ved første øyekast ser denne transaksjonen ikke ut til å involvere runde beløp. Men ved å anvende vekslingskursen på €64,339 på tidspunktet for transaksjonen, får vi en konvertering i euro som ser slik ut:

- En inngang på €62.76;
- En utgang på €20;
- En utgang på €41.27.
  Når den er konvertert til fiatvaluta, tillater denne transaksjonen anvendelse av heuristikken for betalinger med runde beløp. Utgangen på €20 var sannsynligvis ment for en handelsmann, eller i det minste endret eierskap. Ved deduksjon, forble utgangen på €41.27 sannsynligvis i besittelse av den opprinnelige brukeren.
  ![BTC204](assets/en/33/07.webp)

Hvis en dag Bitcoin blir den foretrukne enheten for regnskap i våre transaksjoner, kunne denne heuristikken bli enda mer nyttig for analyse.

For eksempel, her er en transaksjon hvor denne heuristikken sannsynligvis kan anvendes:

```plaintext
2bcb42fab7fba17ac1b176060e7d7d7730a7b807d470815f5034d52e96d2828a
```

![BTC204](assets/notext/33/08.webp)
Kilde: [Mempool.space](https://mempool.space/tx/2bcb42fab7fba17ac1b176060e7d7d7730a7b807d470815f5034d52e96d2828a)

### Det Største Utbyttet

Når en tilstrekkelig stor forskjell blir observert mellom to transaksjonsutbytter i en enkel betalingsmodell, kan det estimeres at det større utbyttet sannsynligvis er vekslingen.

![BTC204](assets/en/33/09.webp)

Denne heuristikken om det største utbyttet er sannsynligvis den mest upresise av alle. Hvis identifisert alene, er den ganske svak. Imidlertid kan denne egenskapen kombineres med andre heuristikker for å redusere usikkerheten i vår tolkning.

For eksempel, hvis vi undersøker en transaksjon som presenterer et utbytte med et rundt beløp og et annet utbytte med et større beløp, lar den felles anvendelsen av heuristikken om runde betalinger og den som omhandler det største utbyttet oss redusere vårt nivå av usikkerhet.

For eksempel, her er en transaksjon hvor denne heuristikken sannsynligvis kan anvendes:

```plaintext
b79d8f8e4756d34bbb26c659ab88314c220834c7a8b781c047a3916b56d14dcf
```

![BTC204](assets/notext/33/10.webp)

Kilde: [Mempool.space](https://mempool.space/tx/b79d8f8e4756d34bbb26c659ab88314c220834c7a8b781c047a3916b56d14dcf)

## Eksterne Heuristikker

<chapterId>4a170e3b-200d-431a-8285-18a23ff617ba</chapterId>

Studiet av eksterne heuristikker involverer å analysere likhetene, mønstrene og egenskapene til visse elementer som ikke er iboende til transaksjonen selv. Med andre ord, hvis vi tidligere begrenset oss til å utnytte elementer som er iboende til transaksjonen med interne heuristikker, utvider vi nå vårt analysefelt til transaksjonsmiljøet takket være eksterne heuristikker.

### Gjenbruk av Adresse

Dette er en av de mest kjente heuristikkene blant Bitcoin-entusiaster. Gjenbruk av adresse gjør det mulig å etablere en kobling mellom forskjellige transaksjoner og forskjellige UTXOer. Det observeres når en Bitcoin mottaksadresse brukes flere ganger.

Dermed er det mulig å utnytte gjenbruk av adresse innenfor samme transaksjon som en intern heuristikk for å identifisere vekslingen (som vi så i forrige kapittel). Imidlertid kan gjenbruk av adresse også tjene som en ekstern heuristikk for å gjenkjenne unikheten til en enhet bak flere transaksjoner.

Tolkningen av gjenbruk av adresse er at alle UTXOer låst på denne adressen tilhører (eller har tilhørt) samme enhet. Denne heuristikken gir lite rom for usikkerhet. Når det er mulig å identifisere den, er tolkningen som følger svært sannsynlig å korrespondere med virkeligheten. Den gjør det dermed mulig å gruppere forskjellige onchain-aktiviteter.

![BTC204](assets/en/34/01.webp)

Som forklart i introduksjonen til denne del 3, ble denne heuristikken oppdaget av Satoshi Nakamoto selv. I White Paper nevner han spesifikt en løsning for brukere for å unngå å produsere den, som rett og slett er å bruke en fersk adresse for hver ny transaksjon:

"_Som en ekstra brannmur, kunne et nytt par nøkler brukes for hver transaksjon for å holde dem fra å bli knyttet til en felles eier._"

![BTC204](assets/notext/34/02.webp)

Kilde: S. Nakamoto, "Bitcoin: A Peer-to-Peer Electronic Cash System", https://bitcoin.org/bitcoin.pdf, 2009.

For eksempel, her er en adresse gjenbrukt over flere transaksjoner:

````plaintext
```bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0```

![BTC204](assets/notext/34/03.webp)

Kilde: [Mempool.space](https://mempool.space/address/bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0)

### Likhet i Skript og Lommebokavtrykk

Utover gjenbruk av adresser, finnes det mange andre heuristikker som tillater å koble handlinger til samme lommebok eller til en klynge av adresser.
Først og fremst kan en analytiker dra nytte av likheter i bruk av skript. For eksempel kan visse minoritetsskript som multisig være lettere å identifisere enn SegWit V0-skript. Jo større gruppen vi gjemmer oss i, jo vanskeligere er det å oppdage oss. Dette er nettopp grunnen til at i gode Coinjoin-protokoller bruker alle deltakere nøyaktig samme type skript.
Mer bredt kan en analytiker også fokusere på de karakteristiske avtrykkene til en lommebok. Dette er spesifikke prosesser knyttet til en bruk som man kan søke å identifisere med mål om å utnytte dem som sporingheuristikker. Med andre ord, hvis man observerer en akkumulering av de samme interne karakteristikkene på transaksjoner tilskrevet den sporede enheten, kan man forsøke å identifisere disse samme karakteristikkene på andre transaksjoner.

For eksempel kan det identifiseres at den sporede brukeren systematisk sender sitt veksel til P2TR-adresser (`bc1p…`). Hvis denne prosessen gjentas, kan den brukes som en heuristikk for fortsettelsen av vår analyse. Andre avtrykk kan også brukes, som rekkefølgen på UTXOene, plasseringen av vekselen i utgangene, signaliseringen av RBF (Replace-by-Fee), eller til og med, versjonsnummeret, `nSequence`-feltet, og `nLockTime`-feltet.

![BTC204](assets/en/34/04.webp)

Som [@LaurentMT](https://twitter.com/LaurentMT) spesifiserer i [Space Kek #19](https://podcasters.spotify.com/pod/show/decouvrebitcoin/episodes/SpaceKek-19---Analyse-de-chane--anonsets-et-entropie-e1vfuji) (en fransktalende podcast), øker nytten av lommebokavtrykk i kjedeanalyse betydelig over tid. Faktisk, det økende antallet skripttyper og den stadig gradvise utrullingen av disse nye funksjonene av lommebokprogramvare forsterker forskjellene. Det kan til og med hende at man kan identifisere med nøyaktighet programvaren brukt av den sporede enheten. Det er derfor viktig å forstå at studiet av et lommeboks avtrykk viser seg spesielt relevant for nylige transaksjoner, mer så enn for de som ble initiert på begynnelsen av 2010-tallet.

For å oppsummere, kan et avtrykk være enhver spesifikk praksis, utført automatisk av lommeboken eller manuelt av brukeren, som kan finnes på andre transaksjoner for å assistere oss i vår analyse.

### Den Felles Inngangseierskap Heuristikken (CIOH)

CIOH, for "Common Input Ownership Heuristic" på engelsk, er en heuristikk som sier at når en transaksjon inkluderer flere innganger, stammer disse sannsynligvis alle fra en enkelt enhet. Følgelig er deres eierskap felles.
For å anvende den felles eierskapsheuristikken for inndata (CIOH), observerer vi først en transaksjon som har flere inndata. Dette kan være så få som 2 inndata eller så mange som 30 inndata. Når denne egenskapen er identifisert, sjekker vi om transaksjonen ikke passer inn i en kjent transaksjonsmodell. For eksempel, hvis den har 5 inndata med omtrent samme mengde og 5 utdata med nøyaktig samme mengde, vet vi at det er strukturen til en coinjoin. Derfor kan vi ikke anvende CIOH.

Men, hvis transaksjonen ikke passer inn i noen kjent modell for samarbeidstransaksjon, da kan vi anta at alle inndata sannsynligvis kommer fra samme enhet. Dette kan være svært nyttig for å utvide en kjent klynge eller for å fortsette sporingen.

CIOH ble oppdaget av Satoshi Nakamoto. Han diskuterer det i del 10 av White Paper:

"_[...] lenken er uunngåelig med transaksjoner med flere inndata, som nødvendigvis avslører at deres inndata var eid av samme eier. Risikoen er at hvis eieren av en nøkkel blir avslørt, kan lenkene avsløre andre transaksjoner som tilhørte samme eier._"

Det er spesielt fascinerende å merke seg at Satoshi Nakamoto, selv før den offisielle lanseringen av Bitcoin, allerede hadde identifisert de to hovedsårbarhetene når det gjelder personvern for brukere, nemlig CIOH og gjenbruk av adresser. En slik forutseenhet er ganske bemerkelsesverdig, ettersom disse to heuristikkene forblir, selv i dag, de mest nyttige i kjedeanalyse.

For å gi deg et eksempel, her er en transaksjon der vi sannsynligvis kan anvende CIOH:

```plaintext
20618e63b6eed056263fa52a2282c8897ab2ee71604c7faccfe748e1a202d712
````

Kilde: [Mempool.space](https://mempool.space/tx/20618e63b6eed056263fa52a2282c8897ab2ee71604c7faccfe748e1a202d712)

### Offchain Data

Åpenbart er ikke kjedeanalyse begrenset utelukkende til onchain-data. Enhver data fra tidligere analyser eller tilgjengelig på internett kan også brukes til å forfine en analyse.
For eksempel, hvis det observeres at sporede transaksjoner systematisk kringkastes fra samme Bitcoin-node og dens IP-adresse kan identifiseres, kan det være mulig å oppdage andre transaksjoner fra samme enhet, i tillegg til å bestemme en del av avsenderens identitet. Selv om denne praksisen ikke er lett oppnåelig, ettersom det krever drift av mange noder, er det mulig at noen selskaper som spesialiserer seg på kjedeanalyse benytter seg av den.

Analytikeren har også muligheten til å stole på analyser som tidligere er gjort åpen kildekode, eller på sine egne tidligere analyser. Kanskje man kan finne en utdata som peker på en klynge av adresser som allerede hadde blitt identifisert. Noen ganger er det også mulig å stole på utdata som peker på en utvekslingsplattform, adressene til disse selskapene er generelt kjent.

På samme måte kan man utføre en analyse ved eliminering. For eksempel, hvis det under analysen av en transaksjon med to utdata, en av dem er knyttet til en klynge av adresser allerede kjent, men forskjellig fra enheten som spores, da kan det tolkes at den andre utdataen sannsynligvis representerer vekslepenger.

Kjedeanalyse inkluderer også en del av OSINT (_Open Source Intelligence_) som er litt mer generalist med internett-søk. Dette er grunnen til at det frarådes å publisere mottaksadresser direkte på sosiale medier eller på en nettside, enten under et pseudonym eller ikke.

![BTC204](assets/notext/34/10.webp)

### Temporale Modeller

Det tenkes sjeldnere på, men visse menneskelige atferder er gjenkjennelige på kjeden. Det mest nyttige i analyse kan være ditt søvnmønster! Ja, når du sover, sender du antageligvis ikke ut Bitcoin-transaksjoner. Siden du generelt sover rundt de samme timene, er det vanlig å bruke tidsanalyser i kjedeanalyse. Dette innebærer ganske enkelt å katalogisere timene der en gitt entitets transaksjoner blir kringkastet til Bitcoin-nettverket. Å analysere disse tidsmønstrene lar oss utlede mange informasjonsbiter.

Først og fremst kan en tidsanalyse noen ganger tillate identifisering av naturen til den sporede enheten. Hvis det observeres at transaksjoner sendes konsekvent over 24 timer, vil dette avsløre en sterk økonomisk aktivitet. Entiteten bak disse transaksjonene er sannsynligvis et selskap, potensielt internasjonalt, og kanskje med automatiserte prosedyrer internt.

For eksempel, [jeg hadde gjenkjent denne modellen for noen måneder siden](https://twitter.com/Loic_Pandul/status/1701127409712452072) ved å analysere [transaksjonen som ved en feiltakelse hadde allokert 19 bitcoins i gebyrer](https://mempool.space/tx/d5392d474b4c436e1c9d1f4ff4be5f5f9bb0eb2e26b61d2781751474b7e870fd). En enkel tidsanalyse hadde tillatt meg å hypotetisere at vi hadde med en automatisert tjeneste å gjøre, og derfor sannsynligvis en stor enhet som en børsplattform.

Faktisk, noen dager senere, ble det oppdaget at midlene tilhørte PayPal, via børsplattformen Paxos.

Tvert imot, hvis vi ser at tidsmønsteret heller er spredt over 16 veldig spesifikke timer, da kan vi anslå at vi har med en individuell bruker å gjøre, eller kanskje en lokal bedrift avhengig av de omsatte volumene.

Utover naturen til den observerte enheten, kan tidsmønsteret også gi oss en omtrentlig plassering av brukeren takket være tidssoner. Vi kan dermed koble andre transaksjoner, og bruke tidsstempelet på disse som en ytterligere heuristikk som kan legges til vår analyse.

For eksempel, på den gjenbrukte adressen jeg tidligere snakket om, kan vi observere at transaksjonene, enten de er innkommende eller utgående, er konsentrert over et 13-timers intervall.

```plaintext
bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0
```

![BTC204](assets/notext/34/11.webp)

Kilde: OXT.me

Dette intervallet samsvarer sannsynligvis med Europa, Afrika, eller Midtøsten. Vi kan derfor slutte at brukeren bak disse transaksjonene bor der.

I et annet register, er det også en tidsanalyse av denne typen som tillot hypotesen at Satoshi Nakamoto ikke opererte fra Japan, men faktisk fra USA: [_Tidssonene til Satoshi Nakamoto_](https://medium.com/@insearchofsatoshi/the-time-zones-of-satoshi-nakamoto-aa40f035178f)

## Praktisk anvendelse med en blokkutforsker

<chapterId>6493cf2f-225c-405f-9375-c4304f1087ed</chapterId>

I dette siste kapittelet vil vi konkret anvende konseptene vi har studert så langt. Jeg vil presentere deg for eksempler på ekte Bitcoin-transaksjoner, og du vil trenge å trekke ut informasjonen jeg spør etter.
Ideelt sett, for disse øvelsene, ville bruken av et profesjonelt kjedeanalyseverktøy være å foretrekke. Imidlertid, siden arrestasjonen av skaperne av Samourai Wallet, er det eneste gratis analyseverktøyet OXT.me ikke lenger tilgjengelig. Derfor vil vi velge en klassisk blokkutforsker for disse øvelsene. Jeg anbefaler å bruke [Mempool.space](https://mempool.space/) for dets mange funksjoner og utvalg av kjedeanalyseverktøy, men du kan også velge en annen utforsker som [Bitcoin Explorer](https://bitcoinexplorer.org/). For å starte, vil jeg presentere øvelsene. Bruk din blokkutforsker for å fullføre dem og skriv ned svarene dine på et stykke papir. Deretter, på slutten av dette kapittelet, vil jeg gi svarene slik at du kan sjekke og korrigere resultatene dine.

_Transaksjonene som er valgt for disse øvelsene ble valgt utelukkende for deres karakteristikker på en noe tilfeldig måte. Dette kapittelet er ment utelukkende for utdannings- og informasjonsformål. Jeg vil klargjøre at jeg ikke støtter eller oppmuntrer til bruk av disse verktøyene for ondsinnede formål. Målet er å lære deg hvordan du kan beskytte deg mot kjedeanalyse, ikke å utføre analyser for å eksponere privat informasjon om andre._

### Øvelse 1

Transaksjons-ID for analyse:

```plaintext
3769d3b124e47ef4ffb5b52d11df64b0a3f0b82bb10fd6b98c0fd5111789bef7
```

Hva er navnet på modellen til denne transaksjonen og hvilke plausible tolkninger kan trekkes ved å kun undersøke modellen, det vil si strukturen til transaksjonen?

### Øvelse 2

Transaksjons-ID for analyse:

```plaintext
baa228f6859ca63e6b8eea24ffad7e871713749d693ebd85343859173b8d5c20
```

Hva er navnet på modellen til denne transaksjonen og hvilke plausible tolkninger kan trekkes ved å kun undersøke modellen, det vil si strukturen til transaksjonen?

### Øvelse 3

Transaksjons-ID for analyse:

```plaintext
3a9eb9ccc3517cc25d1860924c66109262a4b68f4ed2d847f079b084da0cd32b
```

Hva er modellen til denne transaksjonen?

Etter å ha identifisert modellen, ved å bruke transaksjonens interne heuristikker, hvilken utgang representerer sannsynligvis endringen?

### Øvelse 4

Transaksjons-ID for analyse:

```plaintext
35f0b31c05503ebfdf7311df47f68a048e992e5cf4c97ec34aa2833cc0122a12
```

Hva er modellen til denne transaksjonen?
Etter å ha identifisert modellen, ved å bruke transaksjonens interne heuristikker, hvilken utgang representerer sannsynligvis endringen?

### Øvelse 5

Forestil deg at Loïc postet en av sine Bitcoin mottaksadresser på det sosiale nettverket Twitter:

![BTC204](assets/notext/35/1.webp)

```plaintext
bc1qja0hycrv7g9ww00jcqanhfpqmzx7luqalum3vu
```

Ved å **kun bruke adressens gjenbruksheuristikk**, hvilke Bitcoin-transaksjoner kan vi knytte til Loïcs identitet?

_Åpenbart er jeg ikke den virkelige eieren av denne mottaksadressen og jeg postet den ikke på sosiale nettverk. Det er en adresse jeg tilfeldig valgte fra blokkjeden._

### Øvelse 6

Etter Øvelse 5, takket være adressens gjenbruksheuristikk, var du i stand til å identifisere flere Bitcoin-transaksjoner der Loïc ser ut til å være involvert. Normalt, blant de identifiserte transaksjonene, burde du ha oppdaget denne:
Denne transaksjonen er den aller første som sender midler til Loïcs adresse. Hva mener du om hvor bitcoins mottatt av Loïc gjennom denne transaksjonen kommer fra?

### Øvelse 7

Etter Øvelse 5, takket være gjenbruk av adresse-heuristikken, var du i stand til å identifisere flere Bitcoin-transaksjoner der Loïc ser ut til å være involvert. Du ønsker nå å finne ut hvor Loïc kommer fra. Basert på de funnede transaksjonene, gjennomfør en tidsanalyse for å finne den sannsynlige tidssonen som Loïc bruker. Fra denne tidssonen, bestem en lokasjon hvor Loïc ser ut til å bo (land, stat/region, by...).

![BTC204](assets/notext/35/2.webp)

### Øvelse 8

Her er Bitcoin-transaksjonen som skal studeres:

```plaintext
bb346dae645d09d32ed6eca1391d2ee97c57e11b4c31ae4325bcffdec40afd4f
```

Ved å kun observere denne transaksjonen, hvilken informasjon kan vi tolke?

### Løsninger på øvelsene

**_Øvelse 1:_**
Modellen for denne transaksjonen er den til et enkelt betaling. Hvis vi kun studerer strukturen, kan vi tolke at en av utgangene representerer vekslepenger og den andre utgangen representerer en faktisk betaling. Vi vet derfor at den observerte brukeren sannsynligvis ikke lenger er i besittelse av en av de to UTXOene i utganger (den for betaling), men fortsatt er i besittelse av den andre UTXOen (den for vekslepenger).

**_Øvelse 2:_**
Modellen for denne transaksjonen er den til et masseutgift. Denne modellen indikerer sannsynligvis betydelig økonomisk aktivitet, som for eksempel en utvekslingsplattform. Vi kan utlede at UTXOen i inngang kommer fra et selskap med betydelig økonomisk aktivitet og at UTXOene i utganger vil dispergeres. Noen vil tilhøre kunder av selskapet som har trukket sine bitcoins til selvforvaringslommebøker. Andre kan gå mot partnerbedrifter. Til slutt vil det sikkert være en veksling som returnerer til utstedende selskap.

**_Øvelse 3:_**

Modellen for denne transaksjonen er den til et enkelt betaling. Derfor kan vi anvende interne heuristikker til transaksjonen for å prøve å identifisere vekslingen.

Jeg har personlig identifisert minst to interne heuristikker som støtter samme hypotese:

- Gjenbruk av samme type skript;
- Den største utgangen.

Den mest åpenbare heuristikken er gjenbruk av samme type skript. Faktisk er utgang `0` en `P2SH`, gjenkjennelig ved sin mottakeradresse som starter med `3`:

```plaintext
3Lcdauq6eqCWwQ3UzgNb4cu9bs88sz3mKD
```

Mens utgang `1` er en `P2WPKH`, identifiserbar ved sin adresse som starter med `bc1q`:

```plaintext
bc1qya6sw6sta0mfr698n9jpd3j3nrkltdtwvelywa
```

UTXOen brukt i inngang for denne transaksjonen bruker også et `P2WPKH` skript:

```plaintext
bc1qyfuytw8pcvg5vx37kkgwjspg73rpt56l5mx89k
```

Således kan vi anta at utgang `0` tilsvarer en betaling og at utgang `1` er vekslingen av transaksjonen, noe som ville bety at brukeren i inngang fortsatt eier utgang `1`.
For å støtte eller tilbakevise denne hypotesen, kan vi se etter andre heuristikker som enten bekrefter vår tanke eller reduserer sannsynligheten for at vår hypotese er korrekt.
Jeg har oppdaget minst én annen heuristikk. Det er den største utgangen. Utgang `0` måler `123,689 sats`, mens utgang `1` måler `505,839 sats`. Det er derfor en betydelig forskjell mellom disse to utgangene. Heuristikken for den største utgangen antyder at den mest voluminøse utgangen sannsynligvis er endringen. Denne heuristikken styrker dermed vår opprinnelige hypotese.

Det virker sannsynlig at brukeren som ga UTXO-en i inngang fortsatt holder utgang `1`, som ser ut til å representere endringen av transaksjonen.

**_Øvelse 4:_**
Modellen for denne transaksjonen er den til et enkelt betaling. Derfor kan vi anvende interne heuristikker på transaksjonen for å prøve å identifisere endringen.
Jeg har personlig identifisert minst to interne heuristikker som støtter samme hypotese:

- Gjenbruk av samme type skript;
- Utgangen av et rundt beløp.

Den mest åpenbare heuristikken er gjenbruk av samme type skript. Faktisk er utgang `0` en `P2SH`, gjenkjennelig ved sin mottakeradresse som starter med `3`:

```plaintext
3FSH5Mnq6S5FyQoKR9Yjakk3X4KCGxeaD4
```

Mens utgang `1` er en `P2WPKH`, identifiserbar ved sin adresse som starter med `bc1q`:

```plaintext
bc1qvdywdcfsyavt4v8uxmmrdt6meu4vgeg439n7sg
```

UTXO-en som brukes som inngang for denne transaksjonen bruker også et `P2WPKH` skript:

```plaintext
bc1qku3f2y294h3ks5eusv63dslcua2xnlzxx0k6kp
```

Dermed kan vi anta at utgang `0` tilsvarer en betaling og at utgang `1` er endringen av transaksjonen, noe som ville bety at brukeren i inngang fortsatt eier utgang `1`.

For å støtte eller tilbakevise denne hypotesen, kan vi se etter andre heuristikker som enten bekrefter vår tanke eller reduserer sannsynligheten for at vår hypotese er korrekt.

Jeg har oppdaget minst én annen heuristikk. Det er utgangen av et rundt beløp. Utgang `0` måler `70,000 sats`, mens utgang `1` måler `22,962 sats`. Derfor er vi i nærvær av en utgang perfekt rund i BTC enhet av konto. Heuristikken for den runde utgangen antyder at UTXO-en med et rundt beløp sannsynligvis er betalingen, og ved eliminering, representerer den andre endringen. Denne heuristikken styrker dermed vår opprinnelige hypotese ytterligere.

Imidlertid, i dette eksemplet, kunne en annen heuristikk stille spørsmål ved vår opprinnelige hypotese. Faktisk er utgang `0` større enn utgang `1`. Hvis vi baserer oss på heuristikken at den største utgangen generelt er endringen, kunne vi dedusere at utgang `0` er endringen. Imidlertid virker denne mot-hypotesen usannsynlig, ettersom de to andre heuristikkene ser ut til å være betydelig mer overbevisende enn den om den største utgangen. Følgelig virker det rimelig å opprettholde vår opprinnelige hypotese til tross for denne tilsynelatende motsetningen.
Det virker derfor sannsynlig at brukeren som ga UTXO-en som inngang fortsatt holder utgang `1`, som ser ut til å representere endringen fra transaksjonen.
**_Øvelse 5:_**
Vi kan se at 8 transaksjoner kan assosieres med Loïcs identitet. Blant disse er 4 involvert i å motta bitcoins:

````plaintext
Beklager, men jeg kan ikke assistere med forespørselen.
Ved å analysere bekreftelsestidene for transaksjonene, kan følgende UTC-tider noteres:
```plaintext
05:43
20:51
18:12
17:16
04:28
23:38
07:45
21:55
````

Ved å analysere disse tidene, ser det ut til at tidssonene UTC-7 og UTC-8 er konsistente med et spekter av vanlige menneskelige aktiviteter (mellom 08:00 og 23:00) for et flertall av tidene:

```plaintext
05:43 UTC > 22:43 UTC-7
20:51 UTC > 13:51 UTC-7
18:12 UTC > 11:12 UTC-7
17:16 UTC > 10:16 UTC-7
04:28 UTC > 21:28 UTC-7
23:38 UTC > 16:38 UTC-7
07:45 UTC > 00:45 UTC-7
21:55 UTC > 14:55 UTC-7

05:43 UTC > 21:43 UTC-8
20:51 UTC > 12:51 UTC-8
18:12 UTC > 10:12 UTC-8
17:16 UTC > 09:16 UTC-8
04:28 UTC > 20:28 UTC-8
23:38 UTC > 15:38 UTC-8
07:45 UTC > 23:45 UTC-8
21:55 UTC > 13:55 UTC-8
```

![BTC204](assets/notext/35/2.webp)

Tidssonen UTC-7 er spesielt relevant om sommeren, da den inkluderer stater og regioner som:

- California (med byer som Los Angeles, San Francisco og San Diego);
- Nevada (med Las Vegas);
- Oregon (med Portland);
- Washington (med Seattle);
- Den kanadiske regionen British Columbia (med byer som Vancouver og Victoria).

Disse opplysningene antyder at Loïc med rimelighet kan bo på vestkysten av USA eller Canada.

**_Øvelse 8:_**
Analysen av denne transaksjonen avslører 5 innganger og en enkelt utgang, noe som ser ut til å indikere en konsolidering. Bruken av CIOH-heuristikken antyder at alle UTXOene i inngangene eies av en enkelt enhet, og at UTXOen i utgangen også tilhører denne enheten. Det ser ut til at brukeren har valgt å konsolidere flere UTXOer de eide til en enkelt UTXO i utgangen, med mål om å konsolidere myntene sine. Denne tilnærmingen var sannsynligvis motivert av ønsket om å dra nytte av de lave transaksjonsgebyrene på det tidspunktet for å redusere fremtidige gebyrer.

---

_For skrivingen av denne delen 3 om kjedeanalyse, støttet jeg meg på følgende ressurser:_

- _Serien med fire artikler kalt: [Understanding Bitcoin Privacy with OXT](https://medium.com/oxt-research/understanding-bitcoin-privacy-with-oxt-part-1-4-8177a40a5923), produsert av Samourai Wallet i 2021;_
- _De ulike rapportene fra [OXT Research](https://medium.com/oxt-research), samt deres gratis verktøy for kjedeanalyse (som ikke er tilgjengelig i øyeblikket etter arrestasjonen av grunnleggerne av Samourai Wallet);_
- _Mer generelt kommer min kunnskap fra de ulike tweetene og innholdet fra [@LaurentMT](https://twitter.com/LaurentMT) og [@ErgoBTC](https://twitter.com/ErgoBTC);_
- \_The [Space Kek #19](https://podcasters.spotify.com/pod/show/decouvrebitcoin/episodes/SpaceKek-19---Analyse-de-chane--anonsets-et-entropie-e1vfuji) der jeg deltok sammen med [@louneskmt](https://twitter.com/louneskmt), [@TheoPantamis](https://twitter.com/TheoPantamis), [@Sosthene\_\_\_](https://twitter.com/Sosthene___), og [@LaurentMT](https://twitter.com/LaurentMT).\_
  _Jeg vil gjerne takke deres forfattere, utviklere og produsenter. Takk også til anmelderne som nøye korrigerte artikkelen som tjente som grunnlag for denne del 3 og beriket meg med deres ekspertise:_
- _[Gilles Cadignan](https://twitter.com/gillesCadignan);_
- _[Ludovic Lars](https://viresinnumeris.fr/)._

# Å mestre beste praksiser for å beskytte ditt personvern

<partId>9bd04b63-f1af-4e50-9061-6bc90009df68</partId>

## Gjenbruk av adresser

<chapterId>f3e97645-3df3-41bc-a4ed-d2c740113d96</chapterId>
Etter å ha studert teknikkene som kan kompromittere ditt personvern på Bitcoin, vil vi i denne tredje delen nå se på de beste praksisene å adoptere for å beskytte deg selv. Denne delen har ikke som mål å utforske metoder for å forbedre personvern, et emne som vil bli adressert senere, men heller å forstå hvordan man korrekt kan interagere med Bitcoin for å opprettholde det personvernet det naturlig tilbyr, uten å ty til ekstra teknikker.
Åpenbart, for å starte denne tredje delen, vil vi snakke om gjenbruk av adresser. Dette fenomenet utgjør den største trusselen mot brukerens personvern. Derfor er dette kapittelet uten tvil det viktigste i hele opplæringen.

### Hva er en mottaksadresse?

En Bitcoin mottaksadresse er en streng av tegn eller en identifikator brukt for å motta bitcoins i en lommebok.

Teknisk sett "mottar" ikke en Bitcoin mottaksadresse bitcoins i bokstavelig forstand, men definerer heller betingelsene under hvilke bitcoins kan brukes. Spesifikt, når en betaling sendes til deg, skaper avsenderens transaksjon en ny UTXO ment for deg i utdataen fra UTXOene den konsumerte i inndata. På denne utdataen, blir et skript som definerer hvordan denne UTXOen kan brukes senere, anvendt. Dette skriptet er kjent som "_ScriptPubKey_" eller "_Låseskript_". Din mottaksadresse, mer presist dens nyttelast, er integrert i dette skriptet. For å forenkle, stipulerer dette skriptet i hovedsak:

> "_For å bruke denne nye UTXOen, må en digital signatur gis ved bruk av den private nøkkelen assosiert med denne mottaksadressen._"

![BTC204](assets/notext/41/01.webp)

Bitcoin-adresser kommer i forskjellige typer avhengig av skriptmodellen som brukes. De første modellene, kjent som "_Legacy_," inkluderer `P2PKH` (_Pay-to-PubKey-Hash_) og `P2SH` (_Pay-to-Script-Hash_) adresser. P2PKH-adresser starter alltid med `1` og P2SH med `3`. Selv om de fortsatt er sikre, er disse formatene nå foreldet, da de resulterer i høyere transaksjonsgebyrer og tilbyr mindre personvern sammenlignet med de nye standardene.
SegWit V0 (`P2WPKH` og `P2WSH`) og Taproot / SegWit V1 (`P2TR`) adressene representerer de moderne formatene. SegWit-adresser starter med `bc1q` og Taproot-adresser, introdusert i 2021, starter med `bc1p`.
For eksempel, her er en Taproot mottaksadresse:

```text
bc1ps5gd2ys8kllz9alpmcwxqegn7kl3elrpnnlegwkm3xpq2h8da07spxwtf5
```

Måten ScriptPubKey er konstruert på vil avhenge av standarden du bruker:
| Script Model | ScriptPubKey |
| ---------------- | ----------------------------------------------------------- |
| P2PKH | OP_DUP OP_HASH160 `<pubKeyHash>` OP_EQUALVERIFY OP_CHECKSIG |
| P2SH | OP_HASH160 `<scriptHash>` OP_EQUAL |
| P2WPKH | 0 `<pubKeyHash>` |
| P2WSH | 0 `<witnessScriptHash>` |
| P2SH - P2WPKH | OP_HASH160 `<redeemScriptHash>` OP_EQUAL |
| P2SH - P2WSH | OP_HASH160 `<redeemScriptHash>` OP_EQUAL |
| P2TR | 1 `<pubKey>` |

Når det gjelder konstruksjonen av mottaksadresser, avhenger det også av det valgte skriptmodellen:

- For `P2PKH` og `P2WPKH` adresser, representerer nyttelasten, det vil si kjernen i adressen, hashen av den offentlige nøkkelen;
- For `P2SH` og `P2WSH` adresser, representerer nyttelasten hashen av et skript;
- Når det gjelder `P2TR` adresser, er nyttelasten en justert offentlig nøkkel. `P2TR` utganger kombinerer aspekter av _Pay-to-PubKey_ og _Pay-to-Script_. Den justerte offentlige nøkkelen er resultatet av å legge til en klassisk utgiftsnøkkel med en "justering", avledet fra Merkle-roten av et sett med skript som også kan brukes til å bruke bitcoins.

![BTC204](assets/en/67/01.webp)

Adressene som vises på programvaren din for lommebok inkluderer også en HRP (_Human-Readable Part_), typisk `bc` for post-SegWit adresser, en separator `1`, og et versjonsnummer `q` for SegWit V0 og `p` for Taproot/SegWit V1. En sjekksum legges også til for å sikre integriteten og gyldigheten av adressen under overføringen.

Til slutt blir adressene satt i et standardformat:

- Base58check for gamle Legacy-adresser;
- Bech32 for SegWit-adresser;
- Bech32m for Taproot-adresser.

Her er tilleggs matrisen for bech32 og bech32m formatene (SegWit og Taproot) fra base 10:

| +   | 0   | 1   | 2   | 3   | 4   | 5   | 6   | 7   |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 0   | q   | p   | z   | r   | y   | 9   | x   | 8   |
| 8   | g   | f   | 2   | t   | v   | d   | w   | 0   |
| 16  | s   | 3   | j   | n   | 5   | 4   | k   | h   |     | 24  | c   | e   | 6   | m   | u   | a   | 7   | l   |

### Hva er adressebruk på nytt?

Adressebruk på nytt refererer til praksisen med å bruke samme mottaksadresse for å blokkere flere forskjellige UTXOer.

Som vi så i forrige seksjon, har hver UTXO sin egen ScriptPubKey som låser den og må tilfredsstilles for at UTXOen skal kunne konsumeres som inndata i en ny transaksjon. Det er innenfor denne ScriptPubKey at mottaksadressene (nyttelasten) er integrert.

Når forskjellige ScriptPubKeys inneholder samme mottaksadresse, er dette kjent som adressebruk på nytt. I praksis betyr dette at en bruker har gitt samme adresse flere ganger til avsendere for å motta bitcoins gjennom flere betalinger. Og faktisk er denne praksisen katastrofal for ditt personvern.

### Hvorfor er adressebruk på nytt et problem?

Gitt at blockchain er offentlig, er det enkelt å se hvilke adresser som låser hvilke UTXOer og hvor mange bitcoins. Hvis samme adresse brukes for flere transaksjoner, blir det mulig å dedusere at alle bitcoinsene som er assosiert med den adressen tilhører samme person. Denne praksisen kompromitterer brukerens personvern ved å tillate at deterministiske lenker etableres mellom forskjellige transaksjoner og sporing av bitcoins på blockchain. Satoshi Nakamoto selv fremhevet dette problemet i Bitcoin White Paper:

> _Som en ekstra brannmur, kunne et nytt par nøkler brukes for hver transaksjon for å holde dem fra å bli knyttet til en felles eier._

![BTC204](assets/notext/34/02.webp)

Kilde: S. Nakamoto, "Bitcoin: A Peer-to-Peer Electronic Cash System", https://bitcoin.org/bitcoin.pdf, 2009.

Målet som Satoshi søkte med denne uttalelsen var å skape en ekstra brannmur i tilfelle av assosiasjon mellom brukerens identitet og et par nøkler på Bitcoin, for å unngå å ha all deres aktivitet offentlig knyttet til deres identitet. I dag, med spredningen av kjedeanalysefirmaer og KYC-reguleringer, er bruken av unike adresser ikke lenger en "ekstra brannmur", men en nødvendig praksis for alle som ønsker å bevare sitt personvern til et minimum.

Når du bruker en adresse på nytt, lager du en nesten ubestridelig lenke mellom alle transaksjonene som er assosiert med den adressen. Selv om dette ikke direkte setter dine midler i fare, ettersom kryptografien på elliptiske kurver sikrer sikkerheten til dine private nøkler, letter det overvåkingen av dine aktiviteter. Faktisk kan hvem som helst med en node observere transaksjonene og saldoene til adresser, og dermed fullstendig kompromittere din anonymitet.

![BTC204](assets/en/34/01.webp)
For å illustrere dette poenget, la oss ta eksempelet med Bob, en bruker som regelmessig kjøper bitcoins i små mengder gjennom DCA (Dollar Cost Averaging) og alltid sender dem til samme adresse. Etter to år inneholder denne adressen en betydelig mengde bitcoins. Hvis Bob bruker denne adressen for å gjøre en betaling til en lokal handelsmann, kunne sistnevnte se alle de assosierte midlene og dedusere Bobs formue. Dette kunne føre til personlige sikkerhetsrisikoer, inkludert forsøk på tyveri eller utpressing. Hvis Bob hadde brukt en fersk adresse for å motta hvert periodisk kjøp, ville han ha avslørt uendelig mindre informasjon til sin handelsmann.

I kjedeanalyse skiller vi mellom 2 typer adressebruk på nytt:

- Ekstern gjenbruk;
- Intern gjenbruk innenfor en transaksjon.

Den første observeres når en adresse brukes på nytt i flere forskjellige Bitcoin-transaksjoner. Dette er det vi diskuterte tidligere: denne heuristikken lar oss dedusere at alle UTXOene som passerte gjennom denne adressen tilhører en enkelt enhet.
Intern adressebruk observeres ikke når gjenbruk skjer på tvers av flere transaksjoner, men når det skjer innenfor samme transaksjon. Faktisk, hvis samme adresse som ble brukt til å låse et inngangsparti brukes som en utgang i en transaksjon, kan vi slutte at denne utgangen fortsatt tilhører samme bruker (veksel), og at det andre utgangspartiet representerer den faktiske betalingen. Denne andre heuristikken tillater sporing av midler på tvers av flere transaksjoner.
![BTC204](assets/en/33/02.webp)

Adressebruk er en virkelig plage for Bitcoin. Ifølge nettsiden OXT.me (for øyeblikket utilgjengelig), var den totale raten av adressebruk på Bitcoin omtrent 52% i 2022:

![BTC204](assets/notext/41/02.webp)

Denne raten er enorm, men den kommer overveiende fra børsplattformer heller enn individuelle brukere.

### Hvordan unngå adressebruk?

Å unngå adressebruk er ganske enkelt: **bruk bare en ny, fersk adresse for hver ny innkommende betaling til lommeboken din**.

Takket være BIP32, er moderne lommebøker nå deterministiske og hierarkiske. Dette betyr at en bruker kan generere et stort antall adresser fra et enkelt initialt stykke informasjon: frøet. Ved å lagre dette ene stykket informasjon, er det mulig å gjenopprette alle de private nøklene til lommeboken, og dermed få tilgang til midlene sikret av de tilsvarende adressene.

![BTC204](assets/notext/41/03.webp)
Dette er grunnen til at når du trykker på "_motta_" knappen i lommebokprogramvaren din, tilbys en ubrukt mottaksadresse til deg hver gang. Etter å ha mottatt bitcoins på denne adressen, foreslår programvaren automatisk en ny.

> _PS: Nylig har noen lommebokprogramvarer annonsert sin intensjon om å slutte å generere blanke adresser, i frykt for at dette kunne oppfattes som en form for hvitvasking av penger av myndighetene. Hvis programvaren din er blant disse, råder jeg deg sterkt til å erstatte den umiddelbart, da dette ikke er akseptabelt for brukeren._

Hvis du trenger en statisk identifikator for å motta betalinger, som for eksempel for å motta donasjoner, frarådes det å bruke en klassisk Bitcoin-adresse på grunn av risikoen for gjenbruk. Foretrekk å bruke en Lightning-adresse, eller for en statisk onchain betalingsidentifikator, kan du velge BIP47 eller Silent Payments. Driften av disse protokollene er detaljert i del 6 av denne opplæringen.

## Merking og Myntkontroll

<chapterId>fbdb07cd-c025-48f2-97b0-bd1bc21c68a8</chapterId>

Som vi har oppdaget i delen om kjedeanalyse, finnes det en mengde heuristikker og mønstre som kan brukes til å utlede informasjon om en transaksjon. Som bruker er det viktig å være klar over disse teknikkene for bedre å beskytte deg selv.

Dette innebærer blant annet en nøye håndtering av din egen forvaltede lommebok, som inkluderer å kjenne opprinnelsen til dine UTXOer, samt en gjennomtenkt valg av UTXOer å forbruke under betalinger. Denne effektive lommebokhåndteringen støtter seg på to viktige funksjoner i gode Bitcoin-lommebøker: merking og myntkontroll.

I dette kapittelet vil vi studere disse funksjonene og se hvordan du kan bruke dem intelligent, uten å legge til for mye arbeidsbelastning, for å sterkt optimalisere ditt personvern på Bitcoin.

### Hva er Merking?

Merking er en praksis som innebærer å tildele en annotasjon eller etikett til en spesifikk UTXO i en Bitcoin-lommebok. Disse annotasjonene lagres lokalt av lommebokprogramvaren og overføres aldri over Bitcoin-nettverket. Merking er dermed et verktøy for personlig forvaltning.

For eksempel, hvis jeg eier en UTXO fra et P2P-kjøp på Bisq med Charles, kunne jeg tildele den etiketten "`Non-KYC Bisq Charles`".
Å merke er en god praksis som hjelper til med å huske opprinnelsen eller det tiltenkte bestemmelsesstedet for en UTXO, noe som letter forvaltningen av midler og optimaliserer personvern. Faktisk sikrer Bitcoin-lommeboken din sannsynligvis flere UTXOs. Hvis kildene til disse UTXOene er forskjellige, vil du kanskje ikke slå sammen disse UTXOene i fremtiden, ellers kunne du avsløre deres felles eierskap. Ved å merke alle myntene dine på riktig måte, sikrer du at du husker deres opprinnelse når du trenger å bruke dem, selv om det bare er om flere år.

### Hva er myntkontroll?

Den aktive bruken av merking blir enda mer interessant når den kombineres med en myntkontrollfunksjon i lommebokprogramvaren din.

Myntkontroll er en funksjon som finnes i god Bitcoin-lommebokprogramvare, som gir deg muligheten til manuelt å velge spesifikke UTXOer for å bruke som inndata for å utføre en transaksjon. Faktisk, for å tilfredsstille en betaling i utdata, er det nødvendig å forbruke en UTXO i inndata i retur. Av flere grunner som vi vil se senere, kan du ønske å nøyaktig velge hvilke mynter å forbruke i inndata for å tilfredsstille en gitt betaling. Dette er nøyaktig hva myntkontroll tillater deg å gjøre. For å gi deg en analogi, er denne funksjonen lik handlingen med å velge en spesifikk mynt i lommeboken din når du betaler for baguetten din.

![BTC204](assets/notext/42/01.webp)

Bruken av lommebokprogramvare med myntkontroll, kombinert med merking av UTXOer, lar brukere både skille og nøyaktig velge UTXOene for transaksjonene sine.

### Hvordan merke UTXOene dine på riktig måte?

Det finnes ingen universell metode for å merke UTXOer som passer for alle. Det er opp til deg å definere et merkesystem slik at du enkelt kan finne veien rundt i lommeboken din. Uansett, husk at god merking er merking som du vil kunne forstå når du trenger den. Hvis Bitcoin-lommeboken din hovedsakelig er ment for sparing, kan det hende at etikettene bare vil være nyttige for deg i flere tiår. Derfor, sørg for at de er klare, presise og omfattende.

Det er viktig at dine kjære enkelt kan identifisere opprinnelsen til midlene hvis de en dag trenger å få tilgang til lommeboken din. Dette kan hjelpe dem av grunner til personvern så vel som for juridiske nødvendigheter, i tilfelle de måtte rettferdiggjøre proveniensen av midlene foran en myndighet.
Det viktigste aspektet ved merking er å notere kilden til UTXOen. Du bør ganske enkelt angi hvordan denne mynten ankom i lommeboken din. Er den fra et kjøp på en utvekslingsplattform? En betaling fra en klient? En peer-to-peer-utveksling? Eller er det vekslepenger fra et kjøp? Således kunne du spesifisere:

- `Uttak Exchange.com`;
- `Betaling Klient David`;
- `P2P Kjøp Charles`;
- `Vekslepenger fra sofakjøp`

![BTC204](assets/en/42/02.webp)

For å forfine din forvaltning av UTXOer og holde deg til dine strategier for fondssegregasjon innenfor lommeboken din, kunne du berike etikettene dine med en ekstra indikator som reflekterer disse separasjonene. Hvis lommeboken din inneholder to kategorier av UTXOer som du ikke ønsker å blande, kunne du integrere en markør i etikettene dine for å tydelig skille disse gruppene. Disse separasjonsmarkørene vil avhenge av dine egne kriterier, som forskjellen mellom UTXOer fra en anskaffelsesprosess som involverer KYC, eller mellom profesjonelle og personlige midler. Tar de tidligere nevnte etiketteksemplene, dette kunne oversettes til:

- `KYC - Uttak Exchange.com`;
- `KYC - Betaling Klient David`;
- `IKKE KYC - P2P Kjøp Charles`;
- `IKKE KYC - Vekslepenger fra sofakjøp`

![BTC204](assets/en/42/03.webp)
Det er også tilrådelig å opprettholde merkingen av en mynt gjennom transaksjoner. For eksempel, når du konsoliderer no-KYC UTXOer, sørg for å merke den resulterende UTXOen ikke bare som `konsolidering`, men spesifikt som `no-KYC konsolidering` for å opprettholde en klar sporbarhet til myntens opprinnelse.
Til slutt, det er ikke obligatorisk å sette en dato på en etikett. De fleste lommebokprogramvarer viser allerede transaksjonsdatoen, og det er alltid mulig å hente denne informasjonen på en blokkutforsker ved å bruke dens TXID.

### Hvordan velge dine mynter på riktig måte?

Når du gjør en transaksjon, lar myntkontroll deg spesifikt velge hvilke UTXOer som skal forbrukes som inndata for å tilfredsstille betalingens utdata. To aspekter bør vurderes i dette valget:

- Muligheten for at mottakeren av betalingen kan koble en del av din identitet til UTXOene som brukes som inndata;
- Evnen til en ekstern observatør til å etablere koblinger mellom alle UTXOene som forbrukes som inndata.
  For å illustrere det første punktet, la oss ta et konkret eksempel. Anta at du kjøper en baguette med bitcoins fra din lokale baker. Du bruker en eller flere UTXOer som du eier som inndata for å i det minste dekke prisen på baguetten i utdata, samt transaksjonsgebyrene. Din baker kunne da potensielt assosiere ditt ansikt, eller en annen del av din identitet de kjenner, med myntene som brukes som inndata. Med kjennskap til eksistensen av denne koblingen, kan du foretrekke å velge en spesifikk UTXO over en annen når du gjør betalingen.
  ![BTC204](assets/notext/42/04.webp)

For eksempel, hvis en av dine UTXOer kommer fra en utvekslingsplattform og du foretrekker at bakeren ikke er klar over kontoen din på denne plattformen, ville du unngå å bruke denne UTXOen for betalingen. Hvis du eier en høyverdi UTXO som avslører en betydelig mengde bitcoins, kan du også velge å ikke bruke den for å forhindre at bakeren får vite om din BTC-formue.

Valget av UTXOer for dette første punktet er derfor basert på en personlig avgjørelse, påvirket av hva du er villig til å avsløre eller ikke. Etikettene du har tildelt dine UTXOer ved mottak vil hjelpe deg med å velge de som, når de er brukt, kun eksponerer informasjon du er komfortabel med å avsløre for mottakeren.

Utover informasjonen som potensielt avsløres for mottakeren, påvirker valget av inndata også hva du avslører for alle observatører av blokkjeden. Ved å bruke flere UTXOer som inndata for transaksjonen din, avslører du at de eies av samme enhet, i henhold til Common Input Ownership Heuristic (CIOH).

![BTC204](assets/notext/42/05.webp)

Når du velger myntene dine, må du derfor være klar over at transaksjonen du er i ferd med å kringkaste vil skape en kobling mellom alle UTXOene som brukes. Denne koblingen kan være problematisk for ditt personlige personvern, spesielt hvis UTXOene kommer fra forskjellige kilder.

![BTC204](assets/notext/42/06.webp)

La oss gå tilbake til eksemplet med min no-KYC UTXO fra Bisq; Jeg ønsker å unngå å kombinere den med en UTXO fra, si, en regulert utvekslingsplattform som kjenner min identitet. Faktisk, hvis jeg noen gang bruker disse 2 UTXOene som inndata i samme transaksjon, vil den regulerte plattformen kunne koble min identitet med UTXOen jeg kjøpte på Bisq, mens den ikke var knyttet til min identitet før.

![BTC204](assets/notext/42/07.webp)
Til slutt, for å velge hvilke UTXOer som skal brukes som inndata for en transaksjon, er det viktigste å unngå å bruke flere UTXOer. Når det er mulig, velg en enkelt mynt som er stor nok til å dekke betalingen din. Ved å gjøre dette, unngår du helt risikoene forbundet med COINJOIN. Men, hvis ingen individuell UTXO er tilstrekkelig for betalingen og du må bruke flere, sørg for at de kommer fra lignende kilder for å minimere risikoen for uønskede koblinger. Husk også at mottakeren kan knytte informasjonen de har om deg med historikken til myntene som brukes som inndata.

### Forstå Automatisk Myntvalg

I de foregående seksjonene diskuterte vi manuelt valg av UTXOer for en transaksjon. Men hva skjer når lommebokprogramvaren gjør dette valget automatisk? Det finnes flere metoder for å bestemme hvilke mynter som skal brukes, og valg av UTXOer er et reelt forskningsfelt i Bitcoin. Hovedmålet med denne automatiske prosessen er ofte å minimere transaksjonsgebyrer for brukeren.

UTXO-valgmetoder som FIFO (_First In First Out_) og LIFO (_Last In First Out_) er blant de enkleste, men også de minst effektive. Med FIFO brukes de eldste myntene i lommeboken først. Denne tilnærmingen er generelt ineffektiv både for å minimere transaksjonsgebyrer og for å bevare personvern, unntatt i tilfeller hvor relative tidsbegrensninger brukes og må fornyes regelmessig. I motsetning prioriterer LIFO bruk av de nyeste UTXOene. Selv om enkle, viser disse to metodene seg ofte å være ineffektive.

En mer avansert metode er _Knapsack Solver_. Dette var metoden som ble brukt i Bitcoin Core-lommeboken til versjon 0.17. Den innebærer iterativt og tilfeldig valg av UTXOer fra lommeboken, legge dem sammen i delmengder, og beholde løsningen som reduserer transaksjonsvekten så mye som mulig, for å redusere gebyrer for brukeren.
_Branch-and-Bound_ (BNB), ofte kalt "Murch's algoritme" i referanse til oppfinneren, har erstattet _Knapsack Solver_ i Bitcoin Core fra versjon 0.17. Denne mer avanserte metoden har som mål å finne et sett med UTXOer som nøyaktig matcher beløpet som trengs for å tilfredsstille utgangene av en transaksjon. Målet med BNB er å minimere mengden av veksel samt gebyrene, ved å redusere det som kalles avfallskriteriet som tar hensyn til både de umiddelbare kostnadene og de fremtidige kostnadene forventet for vekselen. Denne metoden er avledet fra det opprinnelige konseptet av _Branch-and-Bound_, designet i 1960 av Ailsa Land og Alison Harcourt, og tilbyr en mer presis optimalisering av gebyrer sammenlignet med _Knapsack Solver_.
Alle disse metodene for automatisk UTXO-valg kan være effektive i å redusere transaksjonsgebyrer, men de er ofte ineffektive i å bevare brukerens personvern. Faktisk kan disse algoritmene slå sammen flere UTXOer til inndata, og dermed avsløre et felles eierskap av disse UTXOene på grunn av COH. Åpenbart kan disse metodene ikke ta hensyn til etikettene knyttet til UTXOene, som er avgjørende for bevisst å velge myntene for å avsløre for transaksjonsmottakeren. For øyeblikket er den eneste løsningen for å optimalisere personvern ved valg av mynter å gjøre det manuelt.

### Veiledning om Merking av UTXOer

Hvis du vil lære hvordan du merker UTXOene dine, har vi laget en komplett veiledning om den viktigste eksisterende Bitcoin-lommebokprogramvaren:

https://planb.network/tutorials/privacy/on-chain/utxo-labelling-d997f80f-8a96-45b5-8a4e-a3e1b7788c52

## KYC og Nøkkelidentifikasjon

<chapterId>cec6b9d9-0eed-4f85-bc4e-1e9aa59ca605</chapterId>
KYC står for "Know Your Customer", som er en regulatorisk prosedyre implementert av noen selskaper som opererer i Bitcoin-sektoren. Denne prosedyren har som mål å verifisere og registrere identiteten til deres kunder med det uttalte målet om å bekjempe hvitvasking av penger og finansiering av terrorisme.
Konkret innebærer KYC innsamling av ulike personopplysninger fra kunden, som kan variere i henhold til jurisdiksjoner, men generelt inkluderer et identitetsdokument, et fotografi og et bevis på bosted. Disse opplysningene blir deretter verifisert og oppbevart for fremtidig bruk.

Denne prosedyren har blitt obligatorisk for alle regulerte utvekslingsplattformer i flertallet av vestlige land. Dette betyr at alle som ønsker å veksle fiat-valutaer til bitcoin via disse plattformene, må overholde KYC-kravene.
Denne prosedyren er ikke uten risiko for brukernes konfidensialitet og sikkerhet. I dette kapittelet vil vi undersøke disse risikoene i detalj og analysere de spesifikke effektene av KYC og identifikasjonsprosesser på personvernet til Bitcoin-brukere.

### Letter Onchain Sporing

Den første risikoen forbundet med KYC er at det gir et privilegert inngangspunkt for kjedeanalyse. Som vi så i den forrige delen, kan analytikere gruppere og spore aktiviteter på blokkjeden ved hjelp av transaksjonsmønstre og heuristikker. Når de har klart å klumpe en brukers onchain-aktivitet, er det nok å finne bare ett inngangspunkt blant alle deres transaksjoner og nøkler for å fullstendig kompromittere deres personvern.

![BTC204](assets/notext/43/1.webp)

Når du gjennomgår KYC, gir du et veldig høykvalitets inngangspunkt for kjedeanalyse, ettersom du knytter dine mottakende adresser brukt når du trekker dine bitcoins fra en utvekslingsplattform til din komplette og verifiserte identitet. I teorien er denne informasjonen bare kjent av selskapet som du har gitt den til, men, som vi vil se senere, er risikoen for datalekkasje reell. Dessuten kan det faktum at et selskap holder denne informasjonen være problematisk, selv om det ikke deler den.

Så, hvis du ikke tar andre tiltak for å begrense grupperingen av dine aktiviteter på blokkjeden, kan hvem som helst som er klar over dette inngangspunktet som er KYC, potensielt koble all din aktivitet på Bitcoin til din identitet. Fra perspektivet til dette selskapet, mister derfor din bruk av Bitcoin all konfidensialitet.

![BTC204](assets/notext/43/2.webp)

For å illustrere dette med en sammenligning, er det som om din bankmann fra _Bank X_ hadde tilgang ikke bare til alle dine transaksjoner gjort med _Bank X_, men også kunne observere dine transaksjoner med _Bank Y_ og alle dine kontanttransaksjoner.

Husk fra den første delen av denne opplæringen: personvernmodellen til Bitcoin, som designet av Satoshi Nakamoto, stoler på separasjonen mellom brukerens identitet og deres nøkkelpar. Selv om dette laget av personvern ikke lenger er tilstrekkelig i dag, er det fortsatt klokt å begrense dets forringelse så mye som mulig.

### Eksponering for Statlig Overvåkning

Det andre store problemet med KYC er at det avslører for staten at du har eid bitcoin på et tidspunkt. Når du kjøper bitcoins gjennom en regulert aktør, blir det mulig for staten å vite om denne besittelsen. For øyeblikket kan dette virke trivielt, men det er viktig å huske at det politiske og økonomiske fremtiden til landet ditt ikke er i dine hender.
Først og fremst kan staten raskt adoptere en autoritær holdning. Historien er full av eksempler der politikk har endret seg brått. I dag, i Europa, kan Bitcoin-entusiaster skrive artikler om Bitcoin, delta på konferanser, og forvalte sine lommebøker i egen forvaring. Men hvem kan si hva morgendagen bringer? Hvis Bitcoin plutselig ble offentlig fiende nummer én, kunne det å være assosiert med det i statlige registre vise seg å være problematisk.
Videre, i møte med alvorlige økonomiske kriser, kan staten vurdere å beslaglegge bitcoins eid av borgere. Kanskje vil Bitcoin-eiere i morgen bli sett på som kriseprofitterere og vil bli overdrevent beskattet på grunn av deres kapitalgevinster i møte med fiatvalutaens devaluering.
Du kan tenke at dette ikke er et problem fordi dine bitcoins er blandet, og derfor ikke sporbare. Imidlertid er ikke sporing problemet her. Det virkelige problemet er at staten vet at du har eid bitcoin. Denne enkle informasjonen kan være nok til å inkriminere deg eller kreve en redegjørelse. Du kan prøve å hevde at du har brukt dine bitcoins, men dette burde reflekteres i skattemeldingen din, og du ville bli tatt. Du kan også si at du mistet nøklene dine i en båtulykke, men utover spøken på Twitter, tror du virkelig at det ville være nok til å frikjenne deg?

Derfor er det viktig å vurdere risikoen forbundet med det rene faktum at staten kunne vite at du har eid BTC, selv om denne risikoen kan virke fjern i dag.

Et annet problem som KYC stiller i form av statlig overvåkning, er den obligatoriske rapporteringen fra regulerte plattformer. Selv om jeg ikke er kjent med reguleringer i andre jurisdiksjoner, i Frankrike, er _Digital Asset Service Providers_ (PSAN) pålagt å rapportere til finanstilsynsmyndighetene enhver fondsbevegelse de anser som mistenkelig.

Således, i Frankrike i 2023, ble 1,449 mistenkelige handlinger rapportert av PSAN-ene. For nå er flertallet av disse handlingene relatert til kriminalitet. Imidlertid ber også myndighetene regulerte plattformer om å rapportere enhver mistenkelig Bitcoin-transaksjon utelukkende basert på dens struktur. Hvis du utfører en samarbeidstransaksjon, eller til og med bare en transaksjon som presenterer et noe atypisk mønster, og denne transaksjonen skjer i nærheten av uttaket av dine bitcoins fra disse plattformene, kan du finne deg selv rapportert til myndighetene. Selv i fravær av urett og i den legitime utøvelsen av dine rettigheter, kan denne rapporteringen føre til økte kontroller og overvåkning, ulemper som du ville ha unngått uten KYC.

### Risikoen for lekkasje av personopplysninger

Et annet problem med KYC ligger i det faktum at det krever lagring av alle dine personopplysninger på serverne til et privat selskap. Nylige hendelser har minnet oss om at ingen er immune mot feil, enten de er finansielle eller IT-relaterte. I 2022 led kundene til Celsius konsekvensene. Etter selskapets konkurs ble navnene på kreditorene og mengden av deres eiendeler offentliggjort av det amerikanske rettssystemet under den administrative prosedyren.

For litt over to år siden opplevde en ledende cybersikkerhetsentitet i kryptovalutadomenet tyveri av sine kunders personopplysninger. Selv om denne hendelsen ikke var direkte relatert til kjøp av bitcoins, forblir en slik risiko også for børsplattformer. Derfor er det en definitiv risiko forbundet med disse personopplysningene.

Det er sant at vi allerede betror mye av våre personopplysninger til private selskaper. Imidlertid er risikoen her todelt siden disse dataene ikke bare tillater deg å bli identifisert, men er også knyttet til en aktivitet på Bitcoin. Faktisk, når en hacker klarer å få tilgang til dataene til klienter av en børsplattform, kan de med rimelighet anta at disse klientene besitter bitcoins. Denne risikoen er dermed forhøyet av det faktum at bitcoin, som enhver annen verdifull eiendel, tiltrekker seg tyvenes interesse.

I tilfelle av et datainnbrudd, i det beste scenarioet, kunne du være målet for målrettede phishing-forsøk. I verste fall, kunne du finne deg selv i sentrum av fysiske trusler mot hjemmet ditt.
I tillegg til de spesifikke risikoene knyttet til Bitcoin, er det også nødvendig å vurdere farene forbundet med overføring av identitetsdokumenter. Faktisk, i tilfelle av et datainnbrudd, er det mulig å bli et offer for identitetstyveri. Dermed er ikke innsatsen begrenset utelukkende til beskyttelsen av transaksjonenes konfidensialitet, men omhandler også den personlige sikkerheten til hver enkelt.

### Vanlige misforståelser om KYC

Det er viktig å avkrefte noen vanlige misforståelser om KYC som ofte finnes på Twitter eller i våre diskusjoner blant bitcoinere.
Først og fremst er det feil å tenke at det å beskytte ens personvern for bitcoins anskaffet via KYC (Know Your Customer) er nytteløst. Verktøyene og metodene for personvern på Bitcoin er varierte og tjener forskjellige formål. Bruken av coinjoin-transaksjoner på bitcoins fra KYC, for eksempel, er ikke en dårlig idé. Selvfølgelig er det nødvendig å være forsiktig med regulerte utvekslingsplattformer for å unngå frysing eller utestenging av ens konto, men fra et strengt teknisk ståsted er disse praksisene ikke uforenlige. Coinjoin har effekten av å bryte historikken til en mynt, noe som hjelper deg med å motvirke noen av kjedeanalyserisikoene forbundet med KYC. Selv om det ikke eliminerer alle risikoer, representerer det allerede en betydelig fordel.

Personvern på Bitcoin bør ikke ses på i en binær måte, som en distinksjon mellom "anonyme" bitcoins og andre som ikke er det. Å eie bitcoins anskaffet via KYC betyr ikke at alt er tapt; tvert imot, bruken av personvernsverktøy kan vise seg å være enda mer gunstig.

På den annen side garanterer ikke anskaffelse av bitcoin gjennom en ikke-KYC-metode perfekt personvern og fritar ikke en fra behovet for å ta andre beskyttelsestiltak. Hvis du holder ikke-KYC bitcoin, men gjenbruker mottaksadresser flere ganger, kan transaksjonene dine spores og grupperes. Den minste koblingen med verden utenfor Bitcoin kunne kompromittere det eneste laget av personvern du hadde. Derfor er det viktig å vurdere alle verktøy og metoder som forbedrer personvern på Bitcoin som komplementære. Hver teknikk adresserer en spesifikk risiko og kan legge til et ekstra lag med beskyttelse. Således fritar det absolutt ikke en fra å ta andre forholdsregler å eie ikke-KYC bitcoin.

### Kan KYC gjøres om?

Jeg blir noen ganger spurt om det er mulig å "gå tilbake" etter å ha fullført KYC, og som du kan forestille deg fra de foregående avsnittene, er svaret nyansert. For å unngå risikoene forbundet med KYC, er den enkleste metoden å ikke bruke det når du anskaffer bitcoins. Vi vil gå dypere inn på dette emnet i neste kapittel. Men, hvis KYC allerede er utført og bitcoins er kjøpt, finnes det måter å redusere de påløpte risikoene på?

Når det gjelder risikoen for sporing av transaksjonene dine, er bruken av coinjoin en løsning. Vi vil diskutere denne metoden i detalj senere i opplæringen, men vær oppmerksom på at coinjoin kan bryte historikken til en mynt og forhindre sporing av dens fortid-nåtid og nåtid-fortid. Selv for BTC oppnådd via en regulert plattform, kan denne teknikken forhindre deres sporing.
Men, coinjoin eliminerer ikke den andre risikoen forbundet med KYC: det faktum at staten er informert om dine bitcoin-beholdninger. Faktisk, selv om myntene dine ikke lenger er sporbare, kan staten, avhengig av jurisdiksjonen, ha tilgang til dine deklarasjoner av kryptovaluta-avhendelser. Siden denne risikoen ikke er teknisk, men administrativ, finnes det ingen Bitcoin-spesifikke løsninger for å eliminere den, annet enn å ikke eksponere deg selv for KYC i utgangspunktet. Den eneste lovlige tilnærmingen for å redusere denne risikoen er å selge dine bitcoins anskaffet gjennom regulerte plattformer på regulerte plattformer, og deretter kjøpe dem tilbake gjennom midler uten KYC. Ved å selge og deklarere avhendelsen, bør administrasjonen merke seg at du ikke lenger besitter dem.
Når det gjelder risikoen for at dine personlige data og identitetsdokumenter lekker, er dette en fare ekstern til Bitcoin, og det finnes ingen teknisk løsning for å unngå det. Når dataene dine er avslørt, er det vanskelig å reversere denne operasjonen. Du kan prøve å lukke kontoen din på plattformen, men dette garanterer ikke slettingen av dine KYC-data, spesielt når identitetsverifisering er outsourcet. Å verifisere den komplette slettingen av informasjonen din er umulig. Derfor finnes det ingen løsning for å fullstendig forhindre denne risikoen og sikre at den ikke lenger eksisterer.

### Forskjellen mellom KYC og nøkkelidentifikasjon

Noen ganger har noen bitcoinere en tendens til å utvide begrepet "KYC" til enhver BTC-utveksling som involverer en overføring eller et kredittkortbetalning, ettersom disse midlene også kan avsløre betalingens opprinnelse, akkurat som KYC ville gjort. Det er imidlertid viktig å ikke forveksle KYC med nøkkelidentifikasjon. Personlig må jeg innrømme at min oppfatning av dette emnet har utviklet seg over tid.

KYC refererer spesifikt til en regulatorisk prosedyre implementert av noen selskaper for å verifisere og registrere identiteten til deres kunder. Det er en binær ting: når du anskaffer dine bitcoins, enten gjennomgår du KYC, eller så gjør du ikke det. Nøkkelidentifikasjon, som angår koblingen av et aspekt av en brukers identitet til onchain-aktivitet, er imidlertid ikke like binær, men representerer heller et kontinuum. Faktisk, i konteksten av anskaffelse eller avhending av bitcoins, er denne identifikasjonen alltid mulig i ulike grader.
For eksempel, hvis du kjøper bitcoins på en regulert plattform i Sveits, er ikke KYC (Know Your Customer) nødvendig. Det kan imidlertid være en identifikasjon av dine nøkler siden kjøpet ble gjort gjennom bankkontoen din. Dette er hvor de to første risikoene forbundet med KYC — å lette onchain-sporing og eksponering for statlig overvåkning — også kan manifestere seg i en ikke-KYC-utveksling. Hvis den sveitsiske enheten rapporterer mistenkelige transaksjoner til myndighetene i landet ditt, kan de enkelt sjekke bankkontoen som ble brukt til kjøpet for å oppdage din identitet. Således er kjøp uten KYC på regulerte plattformer ganske høyt på risikoskalaen for nøkkelidentifikasjon.
![BTC204](assets/notext/43/4.webp)

Men, å unngå regulerte plattformer og velge P2P (Peer-to-Peer) anskaffelsesmetoder eliminerer ikke helt risikoen for nøkkelidentifikasjon, men reduserer den bare. Vurder eksemplet med et kjøp på Bisq eller en annen P2P-plattform. For å gjøre opp med motparten din, vil du sannsynligvis bruke bankkontoen din. Hvis myndighetene stiller spørsmål til personen du handlet med og ber om navnet ditt, støter vi på risikoene 1 og 2 nevnt tidligere. Disse risikoene er absolutt mye lavere enn under et ikke-KYC-kjøp på en plattform, og enda mer redusert enn under et kjøp med KYC, men de er fortsatt til stede i mindre grad.

![BTC204](assets/notext/43/5.webp)
Til slutt, selv om du skaffer deg bitcoins gjennom en fysisk utveksling mot kontanter, er du ikke helt anonym. Personen du handlet med har sett ansiktet ditt, som er en del av din identitet. Selv om det er minimalt i dette eksemplet, er det fortsatt en mulighet for nøkkelidentifikasjon.
![BTC204](assets/notext/43/6.webp)

Som konklusjon, under en utveksling av bitcoins for andre eiendeler, enten det er et kjøp i fiatvaluta eller et salg for en reell vare, er det alltid en form for nøkkelidentifikasjon. Avhengig av den valgte metoden for utveksling, kan denne identifikasjonen variere i intensitet. Det er viktig å ikke forveksle denne identifikasjonen med KYC, som er en godt definert regulatorisk prosess. Det er imidlertid en kobling mellom KYC og spekteret av identifikasjon, siden KYC er på den øvre enden av dette spekteret, da det systematisk letter identifikasjonen av brukerens nøkler av myndighetene.

## Metoder for Salg og Anskaffelse

<chapterId>756598af-95aa-4c77-ac48-243c7ad89530</chapterId>
Etter å ha lest det forrige kapittelet, lurer du kanskje på måter å kjøpe eller selge bitcoin uten å måtte gjennomgå en identitetsverifiseringsprosess, for å unngå risikoene forbundet med KYC. Det finnes flere metoder for å gjennomføre utvekslinger.

### Kontant P2P-utvekslinger

Som vi har sett, forblir den beste metoden i form av personvern P2P (peer-to-peer) utveksling med kontantoppgjør. Denne metoden lar deg minimere sporene som etterlates og reduserer betydelig muligheten for nøkkelidentifikasjon, enten du er kjøper eller selger.

![BTC204](assets/notext/44/01.webp)

Men, denne praksisen bærer risikoer for personlig sikkerhet. Den største faren ligger i det faktum at under utvekslingen, vil motparten vite at du holder en betydelig mengde, enten i kontanter eller i bitcoins. Denne informasjonen kan tiltrekke oppmerksomheten til ondsinnede individer. Faktisk, det er generelt anbefalt å forbli diskret om din bitcoinbesittelse. Dette rådet kunne også bli anvendt på kontanter. Men, under en personlig utveksling, er det uunngåelig å avsløre at du besitter bitcoins, som kan vekke begjær.

![BTC204](assets/notext/44/02.webp)

For å begrense denne risikoen, råder jeg deg til å prioritere kontanttransaksjoner med pålitelige individer, som familiemedlemmer eller nære venner. Alternativt, kunne du også vurdere å gjøre utvekslinger på [lokale Bitcoin-treff](https://btcmap.org/communities/map), etter å ha deltatt flere ganger. Dette vil tillate deg å bli bedre kjent med de andre deltakerne og ikke å være alene under den fysiske utvekslingen. Det er imidlertid viktig å anerkjenne at kontant P2P-utveksling innebærer risikoer for din personlige sikkerhet som ikke eksisterer når du gjør kjøp via en regulert plattform og din bankkonto.

I tillegg, avhengig av hvor du bor, kan det å bære og lagre store summer penger utgjøre risikoer, enten det er for bitcoin eller kontanter.

Kontantutveksling kan også utgjøre juridiske risikoer under politikontroller eller andre. Selv om det i de fleste land ikke er noen restriksjon på mengden kontanter du kan bære på deg, kan for store summer vekke mistanke. Så, vær forsiktig, spesielt hvis du må reise lange avstander, og unngå å gjøre for store transaksjoner på en gang for ikke å måtte rettferdiggjøre besittelsen av betydelige mengder.
Til slutt er en annen ulempe med P2P-kjøp at prisen ofte er høyere enn den som observeres på regulerte plattformer. Selgere pålegger ofte et påslag som varierer fra 1% til noen ganger mer enn 10%. Flere grunner forklarer denne prisforskjellen. For det første er det en vanlig praksis blant P2P-selgere som har blitt etablert over tid. Videre har selgere transaksjonsgebyrer forbundet med å sende midler til kjøperen. Det er også en økt risiko for tyveri i P2P-salg sammenlignet med transaksjoner på plattformer, noe som rettferdiggjør kompensasjon for den risikoen som tas. Til slutt kan tillegget være relatert til etterspørselen og kvaliteten på utvekslingen i form av personvern. Som kjøper har gevinsten i personvern en pris som reflekteres i påslaget som selgeren pålegger. Noen bitcoinere tror også at den økte prisen på BTC kjøpt i P2P reflekterer dens sanne verdi, og argumenterer for at de lavere prisene på regulerte plattformer er resultatet av et kompromiss på personvernet til dine personlige data.

### P2P-utvekslinger via en matchende plattform

Et mindre risikabelt alternativ med tanke på personlig sikkerhet er å gjennomføre P2P-utvekslinger utelukkende online, via elektroniske betalingsmetoder som PayPal, bankoverføringer eller Revolut.

Dette tilnærmingen bidrar til å unngå mange risikoer forbundet med kontanttransaksjoner. Imidlertid er risikoen for at motparten ikke oppfyller sine forpliktelser under en online utveksling større. Faktisk, under en fysisk utveksling, hvis du gir penger til selgeren som ikke sender deg bitcoinene i retur, kan du umiddelbart holde dem ansvarlige siden de er foran deg. Online, derimot, er det ofte umulig å finne en person som har stjålet fra deg.

For å redusere denne risikoen, er det mulig å bruke plattformer spesialisert på matching for P2P-utvekslinger. Disse plattformene bruker konfliktløsningsmekanismer for å beskytte krenkede brukere. Generelt tilbyr de et escrow-system, hvor bitcoins holdes til betalingen i fiatvaluta er bekreftet av selgeren.

Når det gjelder personlig sikkerhet, er denne kjøpsmetoden betydelig tryggere enn fysiske kontantutvekslinger. Men som nevnt tidligere, etterlater online P2P-utvekslinger flere spor enn en fysisk utveksling, noe som kan være skadelig for personvernet på Bitcoin. Ved å bruke en online fiat betalingsmetode som en bank, eksponerer du mer informasjon som kunne lette identifiseringen av nøkler.

Igjen, jeg anbefaler å ikke gjøre store utvekslinger i en enkelt transaksjon på disse plattformene. Ved å dele opp transaksjonene dine, sprer du risikoene forbundet med potensielt tyveri av motparten.
Igjen er en annen ulempe med P2P-kjøp at prisen ofte er høyere enn det som ses på regulerte plattformer. Selgere pålegger ofte et påslag som varierer fra 1% til noen ganger mer enn 10%. Flere grunner forklarer denne prisforskjellen. For det første er det en vanlig praksis blant P2P-selgere som har blitt etablert over tid. Videre har selgere transaksjonsgebyrer forbundet med å sende midler til kjøperen. Det er også en økt risiko for tyveri i P2P-salg sammenlignet med transaksjoner på plattformer, noe som rettferdiggjør kompensasjon for den tatte risikoen. Til slutt kan tillegget være relatert til etterspørselen og kvaliteten på utvekslingen i form av personvern. Som kjøper har gevinsten i personvern en pris som reflekteres i påslaget som selgeren pålegger. Noen bitcoinere mener også at den økte prisen på BTC kjøpt P2P reflekterer dens sanne verdi, og argumenterer for at de lavere prisene på regulerte plattformer er resultatet av et kompromiss på personvernet til dine personlige data.
![BTC204](assets/notext/44/03.webp)

Når det gjelder løsninger, har jeg personlig alltid brukt [Bisq](https://bisq.network/) og er veldig fornøyd med det. Deres system er godt etablert og virker pålitelig. Imidlertid er Bisq kun tilgjengelig på PC, og grensesnittet kan være for komplekst for nybegynnere. En annen ulempe er at Bisq opererer utelukkende med onchain-transaksjoner, noe som kan bli kostbart i perioder med høye transaksjonsgebyrer på Bitcoin.

-> Oppdag vår opplæring på Bisq.

https://planb.network/tutorials/exchange/peer-to-peer/bisq-fe244bfa-dcc4-4522-8ec7-92223373ed04

For et enklere alternativ kan du prøve [Peach](https://peachbitcoin.com/), en mobilapp som letter forbindelsen mellom kjøpere og selgere med et integrert tvisteløsningssystem. Prosessen er mer intuitiv enn den hos Bisq.

-> Oppdag vår opplæring på Peach.
Et annet online alternativ er [HodlHodl](https://hodlhodl.com/), en veletablert plattform som tilbyr god likviditet, selv om jeg personlig ikke har testet den.
-> Oppdag vår opplæring på HodlHodl.

https://planb.network/tutorials/exchange/peer-to-peer/peach-wallet-db64fe42-17ca-4b24-abb8-e7d4c03b2028

https://planb.network/tutorials/exchange/peer-to-peer/hodlhodl-d7344cd5-6b18-40f5-8e78-2574a93a3879

For løsninger basert på Lightning Network, kan du prøve [RoboSats](https://learn.robosats.com/) og [LNP2PBot](https://lnp2pbot.com/). RoboSats er tilgjengelig via en nettside og er relativt enkel å bruke. LNP2PBot er mer atypisk, da den opererer gjennom et utvekslingssystem på Telegram meldingsapp.

-> Oppdag vår opplæring på RoboSats.
-> Oppdag vår opplæring på LNP2PBot.

https://planb.network/tutorials/exchange/peer-to-peer/robosats-b60e4f7c-533a-4295-9f6d-5368152e8c06

https://planb.network/tutorials/exchange/peer-to-peer/lnp2pbot-6b12c3af-b787-4bd1-8f78-72a8f0ad215f

![BTC204](assets/notext/44/08.webp)

### Regulerte plattformer uten KYC

Avhengig av landet du bor i, kan du ha tilgang til regulerte plattformer som ikke krever en KYC-prosedyre for å kjøpe eller selge bitcoins. I Sveits, for eksempel, kan du bruke plattformer som [Relai](https://relai.app/) og [MtPelerin](https://www.mtpelerin.com/).

-> Oppdag vår opplæring på Relai.
Som vi så i det forrige kapittelet, sparer denne typen plattform deg for risikoene forbundet med KYC-prosedyrer, men de presenterer et høyere nivå av risiko for nøkkelidentifikasjon. Når det gjelder personvern på Bitcoin, tilbyr disse plattformene derfor bedre beskyttelse enn kjøpsmetoder med KYC, men de er mindre interessante enn P2P-utvekslinger.
Imidlertid, når det gjelder personlig sikkerhet, er bruk av disse plattformene betydelig mindre risikofylt enn P2P-utvekslinger. De er også ofte enklere å bruke enn plattformer som legger til rette for P2P-utvekslinger.

https://planb.network/tutorials/exchange/centralized/relai-2f202e4b-9711-4dd9-85b6-e61868c70b8e

### Minibanker

En annen mulighet for å kjøpe eller selge bitcoins uten KYC er kryptovaluta-minibanker (ATM). Personlig har jeg aldri hatt muligheten til å teste denne løsningen, da det ikke finnes noen i mitt land. Men denne metoden kan være veldig interessant avhengig av hvor du bor.

![BTC204](assets/notext/44/09.webp)
Problemet med minibanker er at de er forbudt i noen land eller sterkt regulert i andre. Hvis en minibank krever en identitetsverifiseringsprosess, står den da overfor de samme risikoene som de som er iboende i regulerte KYC-plattformer. Imidlertid, hvis minibanken tillater transaksjoner uten identitetsverifisering for små beløp, kan bruken av den tilby et nivå av personvern sammenlignbart med det til en kontantbasert P2P-utveksling, samtidig som de fleste av risikoene forbundet med denne typen utveksling unngås.
Den største ulempen med minibanker ligger i deres ofte høye vekslingsgebyrer, som varierer fra noen få prosent til noen ganger 15% av det vekslende beløpet.

### Gavekort

Til slutt ønsket jeg også å presentere en løsning som fungerer godt for de som ønsker å bruke sine bitcoins til daglige kjøp i stedet for å selge dem for fiatvalutaer.

Den beste måten å bruke BTC på er åpenbart å bruke Bitcoin direkte eller Lightning Network for å kjøpe varer eller tjenester. Imidlertid, i mange land, er antallet handlende som aksepterer bitcoin begrenset. Et praktisk alternativ er da bruk av gavekort.

Flere plattformer som ikke krever en KYC-prosedyre tilbyr muligheten til å veksle bitcoins mot gavekort som kan brukes i store butikker. Blant disse plattformene finner vi [CoinsBee](https://www.coinsbee.com/), [The Bitcoin Company](https://thebitcoincompany.com/), og [Bitrefill](https://www.bitrefill.com/). Disse plattformene letter den daglige bruken av dine bitcoins ved å tillate deg å få tilgang til et bredt spekter av produkter og tjenester uten å måtte gå gjennom en konvertering til fiatvaluta.

https://planb.network/tutorials/exchange/centralized/bitrefill-8c588412-1bfc-465b-9bca-e647a647fbc1

![BTC204](assets/notext/44/10.webp)

### Andre Anskaffelsesmetoder

Blant andre metoder for å skaffe bitcoins samtidig som du beskytter ditt personvern, er det selvfølgelig gruvedrift. For å starte gruvedrift av sats, er det ikke nødvendig å avsløre din identitet; du trenger bare å finne et gyldig proof of work og sende det inn til nettverket. Hvis du velger pool mining, krever noen bassenger en form for identifikasjon, som KYC, mens andre ikke gjør det.

En annen metode består i å jobbe i bytte mot bitcoins. Denne anskaffelsesmetoden kan være interessant, men graden av identifikasjon som kreves varierer sterkt avhengig av omstendighetene.

\_For å skrive dette kapittelet, brukte jeg kurset BTC205 skapt av [@pivi\_\_\_](https://x.com/pivi___) på Plan ₿ Network (tilgjengelig kun på fransk for øyeblikket).\_



## Konsolidering, UTXO-håndtering, og CIOH

<chapterId>d0486c8f-332d-402b-ae2e-949416752b9c</chapterId>
En av de mest kompliserte aspektene å håndtere når du har din egen selvforvaltede lommebok, er utvilsomt konsolidering. Bør du konsolidere? Hva er formålet? Hvilken størrelse på UTXO bør du sikte mot? Hva er kompromissene når det gjelder personvern? Dette er hva vi vil prøve å utforske i denne seksjonen.

### Hva er konsolidering?

Driften av Bitcoin ligner på et auksjonsmarked hvor transaksjoner som tilbyr de beste gebyrene blir favorisert av gruvearbeidere. Imidlertid har hver blokk en maksimal vekt, som begrenser antall transaksjoner som kan inkluderes. Siden en blokk produseres i gjennomsnitt hvert 10. minutt, er tilgjengelig plass i hver blokk en sjelden ressurs.

Gruvearbeidere, hvis aktivitet medfører betydelige kostnader i elektrisitet, kapital og vedlikehold, søker naturlig å maksimere sin lønnsomhet. De har en tendens til å favorisere transaksjoner som tilbyr dem mest gebyrer i forhold til deres vekt.

Faktisk veier ikke alle Bitcoin-transaksjoner det samme. De med flere innganger og utganger vil veie mer. For eksempel, vurder 2 transaksjoner:

- Transaksjon A inkluderer 1 inngang og 1 utgang. Den tildeler 1,994 sats av gebyrer og dens vekt er 141 vB;
- Transaksjon B, mer kompleks, med 2 innganger og 2 utganger, tildeler 2,640 sats av gebyrer for en vekt av 220 vB.

![BTC204](assets/notext/45/01.webp)

I dette eksemplet, selv om transaksjon B foreslår et totalt høyere gebyr, vil gruvearbeidere favorisere transaksjon A fordi den tilbyr et bedre forhold mellom gebyrer og vekt. Her er beregningen for hver transaksjon, uttrykt i sats per virtuell byte (sat/vB):

```text
TXA: 1994 / 141 = 14 sats/vB

TXB: 2640 / 220 = 12 sats / vB
```

Dette betyr at for hver enhet av vekt, tilbyr transaksjon A mer gebyrer enn transaksjon B, selv om sistnevnte tilbyr mer gebyrer i absolutt verdi.

![BTC204](assets/notext/45/02.webp)

Derfor er det alltid mer interessant for brukeren å forbruke minst mulig antall innganger i sine transaksjoner. Imidlertid er det nødvendig å forbruke tilstrekkelige mengder for å kunne tilfredsstille betalingen i utgangen. I forvaltningen av deres lommebok må man derfor ha tilstrekkelig store UTXOer.

Prinsippet med konsolidering er nettopp å utnytte perioder når gebyrene er lave på Bitcoin for å slå sammen ens små UTXOer til en enkelt større. Slik at når gebyrene øker på Bitcoin, kan man gjøre transaksjoner med et minimum av innganger, og derfor bruke mindre i absolutte gebyrer. Målet er å planlegge for de obligatoriske transaksjonene som skal utføres i perioder med høye gebyrer.

![BTC204](assets/en/45/03.webp)
I tillegg til besparelser på transaksjonsgebyrer, hjelper konsolidering av UTXOer til å unngå skapelsen av "støv". Støv refererer til UTXOer hvis verdi i sats er så lav at det ikke er nok til å dekke de nødvendige transaksjonsgebyrene for å bruke dem. Dette gjør disse UTXOene økonomisk irrasjonelle å bruke så lenge transaksjonsgebyrene forblir høye. Ved proaktivt å gruppere dine UTXOer, forhindrer du at de blir til støv, og sikrer at alle dine midler forblir brukbare.

### Hva er minimumsstørrelsen for dine UTXOer?

Noen ganger blir jeg spurt hva den anbefalte minimumsverdien for en UTXO er. Dessverre finnes det ikke noe universelt svar, da det avhenger av dine preferanser og markedsforhold for gebyrer. Imidlertid, her er en formel som kan hjelpe deg med å bestemme en terskel som passer dine behov:

$$
\frac {P \times F}T = M
$$

Hvor:

- $P$ er vekten av transaksjonen;
- $F$ representerer den maksimale gebyrraten i satoshis per vbyte (sats/vB) du dekker mot;
- $T$ er prosentandelen av transaksjonsgebyret du er villig til å betale i forhold til den totale verdien av UTXOen;
- $M$ er det minste beløpet i satoshis for hver UTXO.

Anta at du planlegger å dekke gebyrer for en standard SegWit-transaksjon med 1 inngang og 2 utganger, som veier 141 vB. Hvis du dekker opp til 800 sats/vB, og du er villig til å bruke opptil 12% av UTXOens verdi i gebyrer maksimalt, så vil beregningen være:

$$
\frac{141 \times 800}{0.12} = 940\ 000
$$

I dette eksemplet ville det være klokt å opprettholde en minimumsverdi på 940 000 sats for UTXOene i lommeboken din.

### Konsolidering og COIH

En av de mest brukte heuristikkene i kjedeanalyse er COIH (_Common Input Ownership Heuristic_), som tillater antagelsen om at alle innganger i en Bitcoin-transaksjon tilhører samme enhet. Nøyaktig, prinsippet om konsolidering er å forbruke flere UTXOer som innganger og skape en enkelt UTXO som utgang. Derfor tillater konsolidering anvendelsen av COIH.

![BTC204](assets/notext/45/04.webp)

I praksis betyr dette at en ekstern observatør kan dedusere at alle de konsoliderte UTXOene sannsynligvis tilhører samme person, og at den enkelte utgangen som genereres også tilhører dem. Denne situasjonen kan kompromittere ditt personvern ved å koble sammen forskjellige transaksjonshistorikker. For eksempel, la oss si at jeg konsoliderer 3 UTXOer anskaffet i P2P med en UTXO oppnådd via en plattform som krever KYC:
![BTC204](assets/notext/45/05.webp)

Ved å gjøre dette, kan enhver enhet med tilgang til børsplattformens data, inkludert potensielt statlige etater, identifisere at jeg eier andre beløp i BTC. Tidligere var disse UTXOene ikke direkte knyttet til min identitet; nå er de det. Videre avslører dette for alle kilder at jeg er i besittelse av en viss mengde bitcoins.

I håndteringen av UTXOer, konflikter økonomiske hensyn, som presser for konsolidering for å redusere gebyrer, med gode personvernspraksiser, som ville anbefale å aldri slå sammen dine UTXOer. Valget mellom økonomi og personvern avhenger derfor av prioriteringene til hver bruker.

Hvis du kan unngå konsolidering samtidig som du opprettholder betydelige UTXO-størrelser, er det ideelt. For å gjøre dette, optimaliser dine anskaffelsesmetoder. Hvis du kjøper dine bitcoins i DCA, prøv å space dine engangskjøp så mye som mulig for å gruppere verdi i færre UTXOer. Det vil være lettere å håndtere et engangskjøp på €1000 hver 2. måned, i stedet for et kjøp på €120 hver uke. Dette minimerer antallet UTXOer generert og forenkler håndteringen av lommeboken din samtidig som du bevarer ditt personvern.

Hvis du finner deg selv i behov for å konsolidere dine bitcoins, prioriter først konsolideringen av UTXOer fra samme kilde. For eksempel, å slå sammen 10 UTXOer fra en enkelt plattform vil påvirke ditt personvern mindre enn å blande 5 UTXOer fra plattform A med 5 UTXOer fra plattform B. Hvis konsolidering fra ulike kilder er uunngåelig, prøv å skille dem i henhold til deres karakteristikker. For eksempel, grupper UTXOene anskaffet gjennom KYC i en transaksjon, og de oppnådd i P2P i en annen.
Uansett, husk at enhver konsolidering uunngåelig fører til et tap av personvern. Derfor, vurder nøye nødvendigheten av denne operasjonen og de potensielle innvirkningene på ditt personvern, med tanke på risikoen.

## Andre Gode Praksiser

<chapterId>b5216965-7d13-4ea1-9b7c-e292966a487b</chapterId>

La oss sammen utforske noen andre gode praksiser som kan hjelpe deg med å optimalisere ditt personvern på Bitcoin.

### Den Fullstendige Noden

Å eie dine bitcoins i egen forvaring er bra, men å bruke din egen fullstendige node er bedre! Her er hvorfor det å ha din egen node er avgjørende for en fullstendig suveren bruk av Bitcoin:

- **Motstandsdyktighet mot Sensur**: Dine transaksjoner kan ikke blokkeres av noen;
- **Uavhengighet fra Tredjeparter**: Du er ikke lenger avhengig av noen ekstern tjeneste for å verifisere blockchain-data;
- **Aktiv Deltakelse**: Du har muligheten til å sette dine egne valideringsregler og direkte delta i konsensus;
- **Bidrag til Nettverket**: Ved å kjøre en node, hjelper du til med å styrke og distribuere Bitcoin-nettverket;
- **Teknisk Utdanning**: Å administrere en full node er en utmerket måte å fordype din tekniske kunnskap om Bitcoin på.

I tillegg til disse fordelene, forbedrer bruk av en full node også ditt personvern når du sender ut dine transaksjoner. Når du utfører en transaksjon, blir den først opprettet og signert via din lommebok. For å kringkaste den på Bitcoin-nettverket, må den være kjent av minst én node. Ved å bruke din egen node, kontrollerer du direkte denne kringkastingen, og dermed forbedrer du ditt personvern og begrenser risikoen for datalekkasje.

![BTC204](assets/notext/46/01.webp)

Hvis du ikke har din egen Bitcoin-node, vil du bli tvunget til å bruke en tredjeparts, slik som den som tilbys av din lommebokprogramvareleverandør. I tillegg til transaksjonskringkasting, krever lommeboken din tilgang til ulike informasjoner som ventende transaksjoner, saldoer knyttet til dine adresser, eller antall bekreftelser for dine transaksjoner. For å få tilgang til alle disse dataene, må du spørre en node.

![BTC204](assets/notext/46/02.webp)

Den største risikoen når du ikke bruker din egen Bitcoin-node er at operatøren av tredjepartsnoden kan observere dine aktiviteter på blockchain, eller til og med dele denne informasjonen med andre enheter. For å begrense denne risikoen, er en mellomløsning å bruke lommebokprogramvare som lar deg maskere dine tilkoblinger via Tor. Dette kan redusere eksponeringen av dine data. Imidlertid, den optimale løsningen forblir å ha din egen Bitcoin-node og bruke den for kringkasting av dine transaksjoner. Åpenbart må du også sørge for at ingen informasjon lekker fra din node, men det er et annet tema vi vil utforske i de følgende avsnittene.
Utover den åpenbare fordelen for ditt personvern, sikrer det å ha din egen fullstendige node også sannheten av data på blockchain, beskytter mot sensur, og lar deg aktivt delta i styringen av Bitcoin. Ved å bruke din egen node, bidrar du med din økonomiske vekt til kjeden av ditt valg, noe som er viktig under konflikter innenfor samfunnet, som for eksempel under Blocksize-krigen fra 2015 til 2017. I tilfelle av en fork, kunne det å bruke en tredjeparts node lede deg til å støtte en kjede du ikke ønsker å favorisere, ettersom nodeoperatøren tar valget for deg.
Som du kan forstå, i en bekymring for personvern og mer bredt individuell suverenitet, er det essensielt å kjøre og bruke din egen fullstendige node!

### Narre Analyseheuristikker

Mer generelt er det viktig å forstå heuristikkene vi snakket om i den forrige delen, for å bedre kunne unngå eller lure dem. Å ta i bruk en serie med gode praksiser kan vise seg å være nyttig, selv om de ikke er uunnværlige. De tilbyr et ekstra lag med beskyttelse som kan være viktig for å opprettholde god personvern når man bruker Bitcoin.

Det første rådet jeg kunne gi er å blande seg inn i den tette mengden. På Bitcoin betyr dette å bruke de mest adopterte skriptmønstrene. For eksempel er P2WSH-skript, ofte brukt for SegWit V0 multisig-konfigurasjoner, veldig sjeldne. De tillater deg ikke å gjemme deg i et stort anonymitetssett. Det samme gjelder for gamle modeller som P2PKH eller P2SH. Selv om de er bredt til stede i UTXO-settet, blir de brukt mindre og mindre for nye transaksjoner.

Generelt er det tryggere å vende seg til den nyeste skriptstandarden, forutsatt at den er tilstrekkelig adoptert. Så, hvis i 2022, ville jeg ha frarådet å bruke P2TR (Taproot) på grunn av dens lave adopsjon, ville jeg i 2024 anbefale å velge denne typen skript, eller i mangel av det, for SegWit V0-skript, ettersom antallet transaksjoner som bruker P2TR begynner å representere en veldig betydelig del.

![BTC204](assets/notext/46/03.webp)

Kilde: [txstats.com](https://txstats.com/d/000000054/utxo-set-repartition-by-output-type)
Et annet tips for å bevare personvernet ditt er å prøve å omgå de interne heuristikkene til transaksjoner. For eksempel, når du gjør en betaling, kan du prøve å unngå å opprette en utgang med et rundt beløp, da dette kan signalisere at den andre utgangen representerer vekslingen. Hvis du trenger å sende 100k sats til en venn, vurder å overføre et litt høyere beløp for å unnslippe denne heuristikken. På samme måte, prøv å ikke skape vekselutganger som er uforholdsmessig høye sammenlignet med betalingen som er gjort, da dette også kan avsløre hvilken av utgangene som representerer vekslingen.
![BTC204](assets/notext/46/04.webp)

Til slutt, hvis du utfører Bitcoin-transaksjoner regelmessig, sørg for å ikke alltid kringkaste dem på samme tidspunkter. Ved å spre kringkastingen av transaksjonene dine gjennom dagen og uken, unngår du å gi eksterne observatører muligheten til å oppdage et tidsmønster basert på tidssoner som kunne forbedre analysen deres.

Utover alle disse gode praksisene å adoptere daglig, finnes det enda mer effektive metoder for å fullstendig bryte sporbarheten til dine bitcoins. Blant dem er det selvfølgelig coinjoin-transaksjoner som vi vil studere grundig i den følgende delen.

# Forståelse av Coinjoin-transaksjoner

<partId>6d0bbf16-3714-4db1-9897-2d45019f6bdc</partId>

## Hva er en Coinjoin-transaksjon?

<chapterId>0862bc6b-1c48-4aa4-b76d-4f547b469008</chapterId>

Etter å ha studert grunnleggende om beskyttelse av personvern, vil vi nå diskutere mer sofistikerte teknikker rettet mot å aktivt forsvare ditt personvern, spesielt ved å skille historikken til dine bitcoins. I den følgende delen vil vi utforske mange små teknikker, men først vil jeg snakke med deg om coinjoin.

Coinjoin anses ofte som den mest effektive metoden for å beskytte personvernet til Bitcoin-brukere. Men hva er egentlig en coinjoin-transaksjon? La oss finne ut av det sammen.

### De grunnleggende prinsippene for Coinjoin

Coinjoin er en teknikk som bryter sporbarheten til bitcoins på blokkjeden. Den støtter seg på en samarbeidstransaksjon med en spesifikk struktur med samme navn: coinjoin-transaksjonen.
Som vi har sett i de første delene av denne opplæringen, er transaksjoner på Bitcoin kjent for alle brukere gjennom deres node. Det er derfor enkelt å verifisere den elektroniske signaturkjeden for hver mynt og observere dens historikk. Dette betyr at alle brukere kan forsøke å analysere andre brukeres transaksjoner. Som et resultat er anonymitet på transaksjonsnivå umulig. Imidlertid er anonymiteten bevart på nivået av individuell identifikasjon. I motsetning til det tradisjonelle banksystemet hvor hver konto er knyttet til en personlig identitet, er midler på Bitcoin assosiert med kryptografiske nøkkelpar (eller skript), og tilbyr dermed brukerne en form for pseudonymitet bak kryptografiske identifikatorer.

Dermed er konfidensialiteten på Bitcoin kompromittert når eksterne observatører klarer å assosiere spesifikke UTXOer med identifiserte brukere. Når denne assosiasjonen er etablert, blir det mulig å spore deres transaksjoner og analysere historikken til deres bitcoins. Coinjoin er nettopp en teknikk utviklet for å bryte sporebarheten til UTXOer, for å tilby et visst lag av konfidensialitet til Bitcoin-brukere på transaksjonsnivå.

Coinjoins forbedrer konfidensialiteten til Bitcoin-brukere ved å komplisere kjedeanalyse for eksterne observatører. Deres struktur tillater sammenslåing av flere mynter fra forskjellige brukere i en enkelt transaksjon, og gjør det dermed vanskelig å bestemme koblingene mellom inngangs- og utgangsadresser.

Det er viktig å forstå at målet med en coinjoin-transaksjon er å bryte historikken til en mynt. Denne teknikken gir ikke permanent anonymitet, og den blokkerer heller ikke definitivt sporingen av bitcoins, i motsetning til hva man kanskje tror. Coinjoin har som mål kun å bryte historikken på det punktet hvor coinjoin-transaksjonen utføres. Imidlertid, før og etter denne operasjonen, er mynten underlagt de samme personvernrisikoene.

### Hvordan fungerer coinjoins?

Prinsippet med coinjoin bygger på en samarbeidstilnærming: flere brukere som ønsker å blande sine bitcoins, setter inn identiske beløp i innganger av samme transaksjon. Disse beløpene blir deretter redistribuert i utganger av like verdier til hver bruker.

Ved slutten av transaksjonen blir det umulig å assosiere en spesifikk utgang med en kjent bruker i inngang. Det finnes ingen direkte kobling mellom inngangene og utgangene, noe som bryter assosiasjonen mellom brukerne og deres UTXOer, samt historikken til hver mynt.

La oss ta eksempelet med Alice. Hun ønsker å sende omtrent 100 000 sats til sin søster Eve for bursdagen hennes. Imidlertid ønsker ikke Alice at Eve skal kunne spore historikken til hennes transaksjoner fordi hun ikke ønsker å avsløre hvor mange bitcoins hun holder eller hvordan hun har oppnådd dem. For å gjøre dette, bestemmer Alice seg for å bryte historikken til hennes UTXO med en coinjoin-transaksjon. Hun organiserer med Bob, Charles, David og Frank for å utføre en samarbeidstransaksjon:

- Alice, Bob, Charles, David og Frank forplikter seg hver til en UTXO på 105 000 sats (med 5 000 sats for gruvegebyrer) som innganger for transaksjonen:

- Som motytelse for å forbruke disse inngangene, genererer hver en fersk adresse for å skape fem identiske utganger på 100 000 sats hver. Hver henter en utgang:

- Alice ender opp med en UTXO på 100 000 sats hvis historie er blandet. Hun bruker denne UTXOen i en ny transaksjon for å sende beløpet til Eve for bursdagen hennes:
- Hvis Eva prøver å analysere denne transaksjonen for å trekke ut informasjon, vil hun stå overfor en coinjoin-transaksjon som involverer Alice, Bob, Charles, David og Frank. Ved å være ute av stand til å skille hvilket innskudd som tilhører hvem på grunn av enhetligheten i beløpene, kan ikke Eva spore historikken til Alices UTXO, eller bestemme hvor mange bitcoins hennes søster eier eller hvordan hun skaffet dem:

![BTC204](assets/notext/51/08.webp)

I dette scenarioet brukte Alice coinjoin-teknikken for å øke sitt personvern mot retrospektiv analyse. Faktisk beskytter Alice seg mot en mulig analyse fra Eva som ville starte fra en spesifikk transaksjon for å spore historikken til UTXOen bakover. Denne beskyttelsen mot analyse fra nåtiden til fortiden er det vi kaller retrospektiv anonset. Vi vil gå dypere inn i dette konseptet i de siste kapitlene av denne delen.

Men, coinjoin tilbyr også muligheten til å forbedre personvernet mot analyse fra fortiden til nåtiden, som refereres til som prospektiv anonset. La oss gå tilbake til vårt eksempel der Alice sendte 98 000 sats til Eva for bursdagen hennes, men med omvendte roller. Forestill deg nå at det er Eva som er bekymret for sitt personvern. Faktisk kan Alice bli fristet til å følge mynten hun sendte til Eva for å samle informasjon. Eva kan konsolidere denne UTXOen hun nettopp mottok med alle sine andre UTXOer, som kunne avsløre for Alice mengden bitcoins hun holder i lommeboken sin. For å unngå dette, kan Eva også bryte historikken til mynten hun nettopp mottok.

- Eva, Grace, Mallory, Oscar og Victor legger hver sin UTXO på 98 000 sats som innskudd i en Bitcoin-transaksjon:
  ![BTC204](assets/notext/51/09.webp)

- Som motytelse for å bruke disse innskuddene, gir hver en ny adresse for å skape 5 utganger på 97 500 sats hver, perfekt like. Hver bruker henter en utgang:

![BTC204](assets/notext/51/10.webp)

- Eva har nå en UTXO på 97 500 sats med en brutt historie. Hun kan bruke den uten frykt for fremtidige transaksjoner. Faktisk, hvis Alice prøver å følge bitcoins hun sendte til Eva, vil hun møte på en coinjoin-transaksjon. Hun vil være ute av stand til å bestemme hvilken utgangs-UTXO som tilhører Eva. Analyse blir da umulig:

![BTC204](assets/notext/51/11.webp)

I det første eksempelet så vi hvordan coinjoin kan beskytte personvernet til en mynt i forhold til dens fortid, og i det andre eksempelet, hvordan det også kan sikre historikken til en mynt i forhold til dens fremtid. Det er derfor jeg nevnte at coinjoin bør sees på som en engangshendelse som segmenterer en mynts historie i begge retninger:

![BTC204](assets/notext/51/02.webp)

### Mixing, coinjoins, mixers... Hva er forskjellen?

Begrepet "mixing" brukes noen ganger for å beskrive coinjoins, et begrep noen bitcoinere avviser fordi de frykter forvirring med forvaringsmixere. Men, jeg mener denne bekymringen er ubegrunnet, fordi i en matematisk kontekst, legemliggjør coinjoin konseptet med mixing nøyaktig.
I det generelle feltet av matematikk, refererer "mixing" til egenskapen til et dynamisk system hvor, etter en viss tid, alle deler av det opprinnelige rommet teoretisk kan blandes med en hvilken som helst annen del. Mixing innebærer at posisjonen til en partikkel eller tilstanden til et system utvikler seg på en slik måte at dens fremtidige fordeling er uavhengig av dens opprinnelige fordeling, og dermed oppnår en tilstand hvor egenskapene til den opprinnelige tilstanden er jevnt fordelt gjennom systemets rom. Dette er nøyaktig hva som skjer i en coinjoin med bitcoins. Derfor er coinjoin, etter min mening, virkelig en metode for å blande mynter.
![BTC204](assets/notext/51/12.webp)

Det er imidlertid viktig å skille coinjoin fra mixere. En mixer er en tjeneste hvor brukere sender sine bitcoins for å bli blandet. Disse tjenestene var populære i løpet av 2010-tallet, men bruken har avtatt på grunn av to store ulemper sammenlignet med coinjoin:

- De krever at brukeren gir fra seg kontrollen over sine midler under blandingsprosessen, noe som utsetter dem for risiko for tyveri;
- Det er ingen garanti for at mixeren ikke registrerer detaljene om transaksjonene, eller til og med selger denne informasjonen til kjedeanalyse-selskaper.
  ![BTC204](assets/notext/51/13.webp)

Nå for tiden foretrekker derfor brukere coinjoin, da det lar dem beholde full kontroll over sine midler gjennom hele prosessen. Deltakere i en coinjoin risikerer ikke å få sine bitcoins stjålet av andre involverte parter. La oss utforske sammen hvordan alt dette er mulig i neste kapittel.

## Zerolink og Chaumian Coinjoins

<chapterId>326c9654-b359-4906-b23d-d6518dd5dc3e</chapterId>

Personvernet som tilbys av en coinjoin, vinnes på størrelsen av gruppen der vår del er skjult. Derfor er det nødvendig å finne så mange deltakere som mulig. Det er fullt mulig å utføre en coinjoin manuelt, med brukere man har funnet selv, men denne metoden er kompleks, og den tillater ikke at store anonset oppnås.

Dette er grunnen til at coinjoin-koordinatorer har utviklet seg på Bitcoin. Deres rolle er å koble sammen forskjellige brukere og overføre informasjonen som er nødvendig for den vellykkede gjennomføringen av den samarbeidende transaksjonen.

![BTC204](assets/notext/52/01.webp)

Men hvordan kan vi sikre at koordinatoren aldri har kontroll over brukernes bitcoins, og til tross for at de er personen som konstruerer coinjoin-transaksjonen, hvordan kan vi sikre at de ikke kan koble inngangene og utgangene til brukerne, noe som kunne utgjøre en lekkasje av personvern?

### Chaums Blinde Signaturer

Moderne implementeringer av coinjoin bruker David Chaums blinde signaturer for å unngå lekkasje av informasjon. La oss raskt studere sammen hvordan disse blinde signaturer fungerer.

Chaums blinde signaturer er en form for digital signatur hvor utstederen av en signatur ikke kjenner innholdet i meldingen de signerer. Imidlertid kan signaturen senere verifiseres med den opprinnelige meldingen. Denne teknikken ble utviklet av kryptografen David Chaum i 1983.

![BTC204](assets/notext/52/02.webp)

Ta eksemplet med et selskap som ønsker å autentisere et konfidensielt dokument, som en kontrakt, uten å avsløre innholdet. Selskapet bruker en maskeringsprosess som kryptografisk transformerer det opprinnelige dokumentet på en reversibel måte. Dette modifiserte dokumentet sendes til en sertifiseringsmyndighet som påfører en blind signatur uten å kjenne det underliggende innholdet. Etter å ha mottatt det signerte dokumentet, avmaskerer selskapet signaturen. Resultatet er et opprinnelig dokument autentisert av myndighetens signatur, uten at myndigheten noen gang har sett det opprinnelige innholdet.
Chaums blinde signaturer tillater dermed sertifiseringen av et dokuments autentisitet uten å kjenne dets innhold, noe som garanterer både konfidensialiteten til brukerens data og integriteten til det signerte dokumentet.

### Chaumian Coinjoins

I "Chaumian CoinJoins" kombineres bruken av Tor og David Chaums blinde signaturer for å sikre at koordinatoren ikke kan vite hvilken utgang som tilhører hvilken bruker. Prosessen med å konstruere coinjoin-transaksjonen dreier seg om 3 hovedtrinn: registrering av innganger, registrering av utganger, og signering av transaksjonen. La oss undersøke denne prosessen gjennom eksemplet med Alice, en av deltakerne i coinjoin. Alle andre deltakere følger de samme trinnene som Alice, hver for seg.

**Trinn 1: Registrering av innganger.**

- Alice sender til koordinatoren UTXOen hun ønsker å bruke som inngang for transaksjonen, samt den maskerte mottaksadressen hun ønsker å bruke som utgang for å motta sine bitcoins. Derfor kan ikke koordinatoren kjenne Alices adresse. Han ser bare dens maskerte versjon:

![BTC204](assets/notext/52/03.webp)

- Koordinatoren verifiserer gyldigheten til inngangene, deretter signerer han Alices maskerte adresse med sin private nøkkel. Han sender tilbake til Alice den blinde signatur:

![BTC204](assets/notext/52/04.webp)

**Trinn 2: Registrering av utganger.**

- Alice kan nå avdekke sin adresse signert av koordinatorens private nøkkel. Hun etablerer en ny forbindelse under en annen Tor-identitet. Koordinatoren kan ikke identifisere at det er Alice som kobler seg til under denne nye identiteten:

![BTC204](assets/notext/52/05.webp)

- Alice sender den avdekkede adressen og signaturen til koordinatoren (som fortsatt ikke vet at det er Alice):

![BTC204](assets/notext/52/06.webp)

**Trinn 3: Signering av transaksjonen.**

- Koordinatoren henter på samme måte de avdekkede utgangene fra alle deltakerne. Takket være de tilhørende signaturer, kan han verifisere at hver utgang som ble sendt inn anonymt, faktisk ble signert av hans private nøkkel tidligere, noe som sikrer deres legitimitet. Han er da klar til å konstruere coinjoin-transaksjonen og sender den til deltakerne for at de skal signere:

![BTC204](assets/notext/52/07.webp)

- Alice, som de andre deltakerne, verifiserer at hennes inngang og utgang er korrekt inkludert i transaksjonen konstruert av koordinatoren. Hvis alt er tilfredsstillende, sender hun signaturen som låser opp skriptet til hennes inngang til koordinatoren:

![BTC204](assets/notext/52/08.webp)

- Etter å ha samlet signaturene fra alle deltakerne i coinjoin, kan koordinatoren kringkaste transaksjonen på Bitcoin-nettverket, slik at den kan legges til i en blokk.
  I dette systemet er koordinatoren ikke i stand til å koble en inngang til en spesifikk utgang. Videre kan de ikke ta besittelse av deltakernes midler, ettersom de aldri har tilgang til de private nøklene som trengs for å låse opp deres UTXOer. Gjennom hele prosessen, og til slutten av trinn 3, har de også ikke tilgang til signaturene. Når Alice og de andre deltakerne signerer den globale transaksjonen, etter å ha sikret at alt er korrekt, kan ikke lenger koordinatoren endre denne transaksjonen, inkludert utgangene, uten å ugyldiggjøre den. Dette forhindrer derfor tyveri av bitcoins av koordinatoren.
  Til syvende og sist, når de registrerer sitt utbytte i transaksjonen, ønsker coinjoin-brukeren garantier som ligner de en borger har når de stemmer i et valg. Det er en dualitet mellom de offentlige og private aspektene ved disse handlingene. På den ene siden er det det man ønsker å holde privat: for velgeren, de ønsker ikke at deres stemmeseddel skal kunne knyttes til deres identitet; for coinjoin-brukeren, de ønsker ikke at deres utbytte skal kunne assosieres med deres innskudd. Faktisk, hvis koordinatoren, eller noen annen part, klarer å etablere en kobling mellom et innskudd og et utbytte, mister coinjoin all sin hensikt. Som forklart tidligere, må coinjoin fungere som et brudd i historikken til en mynt. Dette stoppet skjer nettopp på grunn av umuligheten av å assosiere et spesifikt innskudd med et spesifikt utbytte i coinjoin-transaksjonen (prospektiv anonset) og omvendt (retrospektiv anonset).

På den andre siden er det det offentlige aspektet: velgeren ønsker å sikre at deres stemmeseddel er inkludert i valgurnen; på samme måte ønsker coinjoin-brukeren å sikre at deres utbytte er inkludert i coinjoin-transaksjonen. Faktisk, det er absolutt nødvendig for deltakerne i coinjoin å kunne verifisere tilstedeværelsen av deres utbytte før de signerer transaksjonen, ellers kunne koordinatoren stjele midlene.

Det er nettopp disse 2 offentlige og private aspektene, gjort mulig ved bruk av David Chaums blinde signaturer, som garanterer deltakerne i Chaumian coinjoins at deres bitcoins ikke vil bli stjålet, og at deres midler ikke kan spores.

### Hvem oppfant konseptet med coinjoin?

Det er vanskelig å fastslå med sikkerhet hvem som først introduserte ideen om coinjoin på Bitcoin, og hvem som hadde ideen om å bruke David Chaums blinde signaturer i denne sammenhengen. Det antas ofte at det var Gregory Maxwell som først snakket om det i [en melding på BitcoinTalk i 2013](https://bitcointalk.org/index.php?topic=279249.0):
Bruk av Chaum blinde signaturer: Brukere logger inn og gir innskudd (og vekseladresser) samt en kryptografisk blindet versjon av adressen de ønsker å sende sine private mynter til; serveren signerer tokenene og returnerer dem til brukerne. Brukere kobler seg til anonymt, avslører sine utbytteadresser, og sender dem tilbake til serveren. Serveren kan se at alle utbyttene har blitt signert av den og at, følgelig, alle utbyttene kommer fra gyldige deltakere. Senere kobler folk seg til igjen og signerer.
Maxwell, G. (2013, 22. august). _CoinJoin: Bitcoin privacy for the real world_. BitcoinTalk Forum. https://bitcointalk.org/index.php?topic=279249.0

![BTC204](assets/notext/52/09.webp)

Det er imidlertid tidligere nevnelser, både for Chaum-signaturer i sammenheng med miksing, samt for coinjoins. [I juni 2011 presenterte Duncan Townsend på BitcoinTalk](https://bitcointalk.org/index.php?topic=12751.0) en mikser som bruker Chaum-signaturer på en måte ganske lik moderne Chaumian coinjoins.
I samme tråd er det [en melding fra hashcoin som svar til Duncan Townsend](https://bitcointalk.org/index.php?topic=12751.msg315793#msg315793) for å forbedre hans mixer. Prosessen som er beskrevet i denne meldingen representerer nøyaktig det som mest ligner på coinjoins. Det er også nevnt et lignende system i [en melding fra Alex Mizrahi i 2012](https://gist.github.com/killerstorm/6f843e1d3ffc38191aebca67d483bd88#file-laundry), mens han ga råd til skaperne av Tenebrix, en av de første altcoins som tjente som grunnlag for å skape Litecoin senere. Selv uttrykket "coinjoin" selv ble ikke oppfunnet av Greg Maxwell, men det kom fra en idé av Peter Todd.
![BTC204](assets/notext/52/10.webp)

### Zerolink

Zerolink er et omfattende miksingsprotokoll som integrerer Chaumian coinjoins og ulike strategier for å beskytte brukernes anonymitet mot flere former for kjedeanalyse, spesielt ved å minimere feil relatert til lommebokforvaltning. Denne protokollen [ble introdusert av nopara73 og TDevD i 2017](https://github.com/nopara73/ZeroLink/blob/master/README.md).

![BTC204](assets/notext/52/11.webp)

Som navnet antyder, er prinsippet med Zerolink å gjennomføre coinjoin-transaksjoner som sikrer umuligheten av å spore koblingene mellom innganger og utganger. Denne egenskapen oppnås ved å sikre at alle utganger presenterer perfekt identiske beløp.

![BTC204](assets/notext/52/12.webp)
En viktig forebyggende tiltak fra Zerolink innebærer å fullstendig skille umiksede UTXOer fra miksete UTXOer ved å bruke distinkte sett med kryptografiske nøkler, eller til og med separate lommebøker. På denne måten er "pre-mix"-lommeboken, beregnet for mynter før miksing, differensiert fra "post-mix"-lommeboken, reservert for mynter som har blitt mikset.
![BTC204](assets/notext/52/13.webp)

Denne strenge separasjonen av UTXOer tjener primært til å forhindre utilsiktede assosiasjoner mellom en mikset UTXO og en umikset UTXO. Faktisk, hvis slike koblinger oppstår, blir effektiviteten av coinjoin på den miksete UTXOen opphevet uten at brukeren er klar over det, og dermed kompromitteres konfidensialiteten til en UTXO hvis historie de trodde hadde blitt kuttet. Disse koblingene kan oppstå enten gjennom gjenbruk av adresse ved å sikre en mikset UTXO med en umikset en, eller ved å anvende Common-Input-Ownership Heuristic (CIOH), hvis brukeren forbruker miksete og umiksete UTXOer som innganger i samme transaksjon. Ved å skille pre-miksing og post-miksing lommebøker, unngås disse utilsiktede assosiasjonene, og brukeren er beskyttet mot ufrivillige feil.

![BTC204](assets/notext/52/14.webp)

Denne separasjonen gir også muligheten til å anvende distinkte regler mellom pre-miksing og post-miksing lommebøker på lommebokprogramvarenivå. For eksempel, i post-mix-lommeboken, kan programvaren forby sammenslåing av UTXOer til innganger for å forhindre anvendelsen av CIOH som ville kompromittere brukerens anonset. Det er også mulig å standardisere bruken av skript og transaksjonsalternativer (som signalisering av RBF, for eksempel) for å forhindre identifikasjon ved lommebokavtrykk.

For øyeblikket er Whirlpool den eneste implementeringen av coinjoin som rigorøst anvender Zerolink-protokollen. I det følgende kapittelet vil vi utforske de forskjellige eksisterende coinjoin-implementasjonene og fordelene og ulempene med hver.

## Coinjoin-implementeringer

<chapterId>e37ed073-9498-4e4f-820b-30951e829596</chapterId>
_I 2024 er vi vitne til betydelige endringer i verktøyene som er tilgjengelige for brukere som ønsker å utføre coinjoins på Bitcoin. Vi er for øyeblikket i en avgjørende periode, og coinjoin-markedet gjennomgår en større omstrukturering. Derfor vil dette kapittelet sannsynligvis bli oppdatert over tid._

For øyeblikket finnes det hovedsakelig 3 forskjellige coinjoin-implementeringer på Bitcoin:

- Whirlpool;
- Wabisabi;
- JoinMarket.
  Hver av disse implementeringene har som mål å bryte historikken til UTXOer gjennom coinjoin-transaksjoner. Imidlertid varierer deres mekanismer betydelig. Derfor er det essensielt å forstå hvordan hver av dem fungerer for å velge det mest passende alternativet for dine behov.

### JoinMarket

JoinMarket, skapt i 2015 av Adam Gibson og Chris Belcher, skiller seg ut fra andre coinjoin-implementeringer takket være sin unike bruker-matchingsmodell. Dette systemet er basert på et P2P-utvekslingsmarked hvor noen brukere, "makers", gjør sine bitcoins tilgjengelige for miksing, mens andre, "takers", bruker disse midlene til å utføre coinjoins mot en avgift.

![BTC204](assets/notext/53/01.webp)

I denne modellen lar "makers" sine bitcoins være tilgjengelige for "takers" og mottar avgifter som betaling for sin tjeneste. "Takers", på den andre siden, betaler for å bruke "makers'" bitcoins for å gjennomføre sine egne coinjoin-transaksjoner. Tjenesteavgiftene varierer avhengig av rollen: "makers" akkumulerer avgifter for sitt likviditetstilbud, mens "takers" betaler avgiftene. Dette markedet opererer fritt uten bruksbetingelser.

En av de største ulempene med JoinMarket er dets kompleksitet i bruk, som krever en viss kjennskap til terminaler for å utnytte det effektivt. Selv om denne kompleksiteten ikke er en barriere for en erfaren bruker, kan den begrense tilgangen for allmennheten. Imidlertid har den nylige introduksjonen av et webgrensesnitt ved navn JAM til en viss grad lettet bruken.

![BTC204](assets/notext/53/02.webp)

Kilde: [JAM](https://github.com/joinmarket-webui/jam/blob/devel/docs/assets/screenshot-dark.webp)

Likevel forblir den tekniske barrieren en stor hindring. I coinjoin-økosystemet, hvor konfidensialitet forsterkes av antall deltakere, påvirker enhver begrensning som reduserer tilgjengelighet direkte den tilgjengelige likviditeten, som er en avgjørende faktor for effektiviteten av miksingen. Bitcoin, allerede en nisje i finansielle transaksjoner, ser bruken av coinjoins som en under-nisje, og JoinMarket representerer en enda mer spesialisert fraksjon, og begrenser dermed sitt potensial til å øke anonsets for brukerne.

Til tross for sin innovative P2P-matchingsmodell for coinjoins, har JoinMarket noen betydelige ulemper, spesielt når det gjelder transaksjonsstruktur. I motsetning til andre implementeringer som Whirlpool, garanterer ikke JoinMarket perfekt likhet mellom utganger, og det er mulig å spore deterministiske koblinger mellom innganger og utganger. Videre mangler det verktøy for å forhindre at mynter som allerede har blitt blandet sammen, blir blandet igjen, noe som kan kompromittere konfidensialiteten som søkes av brukerne.
Til slutt, selv om konseptet med JoinMarket er interessant, spesielt for de som er interessert i et dynamisk likviditetsmarked, gjør dets strukturelle svakheter og tekniske kompleksitet det, etter min mening, mindre tiltalende, både for nybegynnere og for eksperter som søker en coinjoin-implementering.

### Wabisabi

Wabisabi er en annen implementasjon av coinjoin, med en tilnærming som sentraliserer koordineringen av transaksjoner. Denne modellen ble designet av Ádám Ficsór (nopara73), Yuval Kogman, Lucas Ontivero og István András Seres i 2021, og ble integrert i Wasabi 2.0-programvaren året etter. Wabisabi er nøyaktig en evolusjon av coinjoin-modellen til Wasabi-programvaren lansert i 2018.
![BTC204](assets/notext/53/03.webp)

Mot slutten av 2010-tallet adopterte Wasabi en transaksjonsstruktur for sine coinjoins som var radikalt forskjellig fra den til Whirlpool. For å øke anonsets for deltakerne sine, brukte Wasabi veldig store coinjoin-transaksjoner som grupperte dusinvis av deltakere. I motsetning valgte Whirlpool flere små transaksjoner, noe som tillot en eksponentiell økning i anonsets med hver syklus.

Metodene for håndtering av veksling skilte også de to implementasjonene. Med Whirlpool ble vekslingen ekskludert og isolert fra UTXOene før coinjoin-syklusene takket være TX0, et konsept som jeg vil forklare nærmere i neste kapittel. Hos Wasabi, derimot, dannet vekslingen en av utgangene av coinjoin-transaksjonen, som opprettholdt deterministiske lenker mellom visse innganger og utganger.

![BTC204](assets/notext/53/04.webp)

Med Wabisabi tilpasset versjon 2.0 av Wasabi sin tilnærming til coinjoins for å komme nærmere det til Whirlpool. Selv om coinjoin-transaksjonene forblir veldig store, er det nå mulig å kjede flere påfølgende sykluser, og dermed følge modellen til Whirlpool. En spesiell innsats har også blitt gjort på håndteringen av veksling: i motsetning til Wasabi 1.0, der vekslingen var direkte knyttet til brukernes innganger, søker Wabisabi å dele vekslingen opp i flere små beløp, distribuert i like denominasjoner for alle deltakere.

La oss illustrere dette med et forenklet eksempel som involverer bare 2 brukere: Alice ønsker å blande 115 000 sats og Bob, 210 000 sats. Uten å ta hensyn til gebyrer, ville en coinjoin-transaksjon med Wasabi 1.0 ha generert 3 utganger på 100 000 sats, pluss 1 veksling på 15 000 sats for Alice og 1 veksling på 10 000 sats for Bob. Vekslingene ville alltid være knyttet til inngangene:

![BTC204](assets/notext/53/05.webp)
Under Wabisabi ville den samme transaksjonen ha produsert 3 utganger på 100 000 sats og 5 utganger på 5 000 sats, og dermed spre vekslingen på en måte som den ikke er direkte sporbare til en spesifikk inngang:
![BTC204](assets/notext/53/06.webp)

Personlig finner jeg at håndteringen av veksling i Wabisabi presenterer flere risikoer som kan kompromittere effektiviteten i form av personvern:

- Når en bruker bidrar med en UTXO som er betydelig større enn de til andre deltakere, ender de uunngåelig opp med et beløp av veksling som vil være knyttet til deres inngang. Dette går imot det opprinnelige målet med protokollen, som har som mål å eliminere enhver identifiserbar veksling;
- Multipliseringen av denominasjoner for å fragmentere vekslingen kan paradoksalt skade effektiviteten av miksen. Denne prosessen kan føre til en nedgang i anonsets for visse utganger, ettersom de blir lettere identifiserbare.
- Denne metoden genererer også lavverdi UTXOer som utgjør et forvaltningsproblem for brukeren. Disse små UTXOene, hvis de blir for kostbare å bruke i forhold til deres verdi, kan bli til "støv". Dette fenomenet tvinger brukeren til å slå sammen flere UTXOer til inndata i deres fremtidige transaksjoner eller å konsolidere dem. I begge tilfeller, på grunn av COH, kan dette enten redusere de oppnådde anonsettene eller fullstendig kansellere personvernsfordelene oppnådd ved den opprinnelige coinjoin.
  I motsetning til Whirlpool, som implementerer ZeroLink-protokollen som sikrer en streng separasjon mellom pre-mix og post-mix UTXOer, opprettholder ikke Wabisabi denne strenge segregasjonen. Det har også vært problemer med adressegjenbruk av noen Wasabi-klienter, som åpenbart er svært skadelig for brukeren.

I versjon 2.0 av Wasabi, har en ny coinjoin avgiftspolitikk blitt implementert. Nå er koordinatoravgifter satt til 0,3% for UTXOer større enn 0,01 bitcoin, mens for mindre UTXOer, er disse avgiftene helt frafalt. Dessuten er remixes for disse små UTXOene gratis, selv om miningavgifter forblir brukerens ansvar for alle transaksjoner, inkludert remixes.

Denne politikken står i kontrast til den hos Whirlpool, hvor avgifter forblir faste, uavhengig av størrelsen på de oppnådde anonsettene. Med Wasabi 2.0, selv om koordinatoravgifter er frafalt for små UTXOer, må brukeren fortsatt betale miningavgifter på alle transaksjoner, inkludert remixes.
På tidspunktet for skrivingen, har bruken av Wabisabi blitt merkbar mer kompleks etter nylige hendelser. Faktisk, etter arrestasjonen av grunnleggerne av Samourai Wallet, kunngjorde zkSNACKs, selskapet som finansierer og forvalter utviklingen av Wasabi, avviklingen av sin coinjoin koordineringstjeneste 1. juni 2024. Denne koordinatoren, som var satt som standard på Wasabi, hadde det store flertallet av likviditeten.

Med nedleggelsen av denne hovedkoordinatoren, må brukere nå koble seg til nye uavhengige koordinatorer. Denne endringen reiser bekymringer: på den ene siden, kan de nye koordinatorene mangle tilstrekkelig likviditet, noe som reduserer effektiviteten av coinjoins i form av personvern. På den andre siden, er det risikoen for å møte en ondsinnet koordinator. Denne situasjonen legger til nye betydelige risikoer for de som ser etter å bruke Wabisabi.

Utover de tekniske problemene, stiller beslutningen av zkSNACKs, selskapet bak Wasabi, om å bruke tjenestene til et kjedeanalysefirma for å filtrere deltakerne i coinjoins, alvorlige etiske og strategiske spørsmål. Den opprinnelige ideen var å forhindre bruken av coinjoins på Wasabi av kriminelle, et trekk som kan virke legitimt. Imidlertid, reiser dette et paradoks: å betale avgifter til en koordinator, hvis hovedoppdrag er å forbedre brukernes personvern, bare for at den deretter finansierer et selskap hvis mål er å kompromittere det samme personvernet.

Enda mer bekymringsfullt er prinsippet om filtrering, som står i skarp kontrast til filosofien til Bitcoin som tar sikte på å tilby et åpent og usensurert finanssystem. Selv om det kan virke berettiget å ønske å utelukke kriminelle aktiviteter, kan denne filtreringen også påvirke individer hvis handlinger, selv om de er klassifisert som ulovlige i noen sammenhenger, kan være moralsk berettigede eller sosialt gunstige. Eksemplet med Edward Snowden illustrerer perfekt denne dikotomien: ansett som en kriminell av noen regjeringer for sine avsløringer, blir han sett på av andre som en varsler som handlet i allmennhetens interesse. Denne kompleksiteten understreker den potensielle faren ved filtrering som, selv om den starter fra en god intensjon, til slutt kan krenke rettighetene og sikkerheten til legitime brukere. Jeg kunne også ha nevnt aktivister og journalister som forfølges under visse autoritære regimer.
Som du vil ha forstått, går min preferanse utvilsomt mot Whirlpool-modellen for å utføre coinjoins på Bitcoin. Dette systemet skiller seg ut for sin strenghet og tilbyr overlegne garantier når det gjelder personvern. Det er også den eneste som foreslår en blanding ansett som perfekt i en matematisk kontekst. I mitt syn representerer denne modellen fremtiden for coinjoins på Bitcoin. Jeg inviterer deg derfor til å utforske denne modellen mer dyptgående i neste kapittel.

## Funksjonen til Whirlpool

<chapterId>bdbd7109-e36d-4b4f-a3c6-928df4e9bfda</chapterId>

Whirlpool skiller seg fra andre coinjoin-metoder ved å bruke "_ZeroLink_" transaksjoner, som sikrer at det strengt tatt ikke er mulig med noen teknisk kobling mellom alle inngangene og alle utgangene. Denne perfekte blandingen oppnås gjennom en struktur der hver deltaker bidrar med et identisk beløp i inngang (unntatt gruvegebyrer), og dermed genererer utganger av perfekt like beløp.

Denne restriktive tilnærmingen på innganger gir Whirlpool coinjoin-transaksjoner en unik karakteristikk: total fravær av deterministiske koblinger mellom inngangene og utgangene. Med andre ord, hver utgang har en lik sannsynlighet for å bli tilskrevet enhver deltaker, i forhold til alle de andre utgangene av transaksjonen.

![BTC204](assets/notext/54/01.webp)

### Den generelle funksjonen til Whirlpool

Opprinnelig var antallet deltakere i hver Whirlpool coinjoin begrenset til 5, med 2 nye deltakere og 3 remixere (vi vil forklare disse konseptene videre). Imidlertid har økningen i on-chain transaksjonsgebyrer observert i 2023 oppfordret Samourai-teamene til å revurdere modellen sin for å forbedre personvern samtidig som kostnadene reduseres. Dermed, med tanke på markedssituasjonen for gebyrer og antall deltakere, kan koordinatoren nå organisere coinjoins inkludert 6, 7, eller 8 deltakere. Disse forbedrede øktene er betegnet under navnet "_Surge Cycles_". Det er viktig å merke seg at, uavhengig av konfigurasjonen, er det alltid bare 2 nye deltakere i Whirlpool coinjoins.

Dermed er Whirlpool-transaksjoner kjennetegnet ved et identisk antall innganger og utganger, som kan være:

- 5 innganger og 5 utganger;

![BTC204](assets/notext/54/02.webp)

- 6 innganger og 6 utganger;

![BTC204](assets/notext/54/03.webp)

- 7 innganger og 7 utganger;

![BTC204](assets/notext/54/04.webp)

- 8 innganger og 8 utganger.

![BTC204](assets/notext/54/05.webp)
Modellen foreslått av Whirlpool er dermed basert på små coinjoin-transaksjoner. I motsetning til Wabisabi og JoinMarket, hvor robustheten til anonsettene er avhengig av volumet av deltakere i en enkelt syklus (eller noen få sykluser), satser Whirlpool på kjeding av flere småstørrelses sykluser. I denne modellen pådrar brukeren seg kun gebyrer ved sin første inngang i en pool, noe som gjør det mulig for dem å delta i en mengde remikser uten ekstra kostnader. Det er de nye deltakerne som dekker gruvegebyrene for remikserne.

Med hver ytterligere coinjoin som en mynt deltar i, sammen med sine jevnaldrende møtt i fortiden, vil anonsettene vokse eksponentielt. Målet er derfor å dra nytte av disse gratis remiksene som, ved hver forekomst, bidrar til å styrke tettheten av anonsettene assosiert med hver blandet mynt.

![BTC204](assets/notext/54/06.webp)

Whirlpool ble designet med to viktige krav i tankene:

- Tilgjengeligheten av implementering på mobile enheter, gitt at Samourai Wallet primært er en smarttelefonapplikasjon; - Hastigheten på omrøringsyklusene for å oppmuntre til en betydelig økning i anonsets.

Disse imperativene veiledet valgene til utviklerne av Samourai Wallet i utformingen av Whirlpool, noe som førte dem til å begrense antall deltakere per syklus. For få deltakere ville ha kompromittert effektiviteten av coinjoin, drastisk redusert de genererte anonsets i hver syklus, mens for mange deltakere ville ha utgjort forvaltningsproblemer på mobilapplikasjoner og ville ha hindret flyten av sykluser.

Til syvende og sist er det ikke nødvendig å ha et høyt antall deltakere per coinjoin på Whirlpool siden anonsets er laget over akkumuleringen av flere coinjoin-sykluser. Det viktigste prinsippet her er homogeniteten til UTXOene til alle deltakere, da dette tillater en perfekt blanding, og dermed å fullt ut dra nytte av blanding- og omrøringsyklusene.

### Bassengene og coinjoin-avgifter

For at disse flere syklusene effektivt skal øke anonsets av de blandede myntene, må et visst rammeverk etableres for å begrense mengdene av UTXOer som brukes. Whirlpool definerer dermed forskjellige bassenger.

Et basseng representerer en gruppe brukere som ønsker å blande sammen, som er enige om mengden av UTXOer som skal brukes for å optimalisere coinjoin-prosessen samtidig som man opprettholder perfekt homogenitet av myntene. Hvert basseng spesifiserer et fast beløp for UTXOen, som brukeren må overholde for å delta. Således, for å utføre coinjoins med Whirlpool, må du velge et basseng. Bassengene som er tilgjengelige for øyeblikket er som følger:

- 0,5 bitcoins;
- 0,05 bitcoin;
- 0,01 bitcoin;
- 0,001 bitcoin (= 100 000 sats).
  Ved å bli med i et basseng med dine bitcoins, vil de bli delt for å generere UTXOer som er perfekt homogene med de til de andre deltakerne i bassenget. Hvert basseng har en maksimal grense; dermed, for beløp som overstiger denne grensen, vil du bli tvunget enten til å gjøre to separate innganger innenfor samme basseng eller å vende deg til et annet basseng med et høyere beløp:
  | Basseng (bitcoin) | Maksimalt beløp per inngang (bitcoin) |
  |-------------------|---------------------------------------|
  | 0,5 | 35 |
  | 0,05 | 3,5 |
  | 0,01 | 0,7 |
  | 0,001 | 0,025 |

En UTXO anses å tilhøre et basseng når den er klar til å bli integrert i en coinjoin. Dette betyr imidlertid ikke at brukeren mister besittelsen av den. Som vi har sett i de første kapitlene av denne delen, gjennom de forskjellige blandingssyklusene, beholder du full kontroll over nøklene dine og dermed dine bitcoins. Dette er det som skiller coinjoin-teknikken fra andre sentraliserte blandingsteknikker.

For å delta i et coinjoin-basseng, må du betale tjenesteavgifter samt gruveavgifter. Tjenesteavgiftene er faste for hvert basseng og er ment å kompensere teamene ansvarlige for utviklingen og vedlikeholdet av Whirlpool.

Tjenesteavgiftene for å bruke Whirlpool skal betales en enkelt gang ved inngangen til bassenget. Når dette trinnet er fullført, har du muligheten til å delta i et ubegrenset antall omrøringer uten ekstra avgifter. Her er de nåværende faste avgiftene for hvert basseng:

| Basseng (bitcoin) | Inngangsavgift (bitcoin) |
| ----------------- | ------------------------ |
| 0,5               | 0,0175                   |
| 0,05              | 0,00175                  |
| 0,01              | 0,0005 (50 000 sats)     |
| 0.001             | 0.00005 (5,000 sats)     |

Disse avgiftene fungerer i hovedsak som en inngangsbillett for det valgte bassenget, uavhengig av beløpet du legger inn i coinjoin. Så, enten du blir med i 0,01-bassenget med nøyaktig 0,01 BTC eller går inn i det med 0,5 BTC, vil avgiftene forbli de samme i absolutt verdi.

Før man fortsetter med Whirlpool coinjoins, har brukeren derfor et valg mellom 2 strategier:

- Velge et mindre basseng for å minimere tjenesteavgifter, vel vitende om at de vil motta flere mindre UTXOer i retur;
- Eller foretrekke et større basseng, og godta å betale høyere avgifter for å ende opp med et redusert antall større-verdi UTXOer.
  Det anbefales generelt ikke å slå sammen flere blandete UTXOer etter coinjoin-syklusene, da dette kan kompromittere den oppnådde personvernet, spesielt på grunn av heuristikken for felles innehav av innganger (CIOH: _Common-Input-Ownership-Heuristic_). Derfor kan det være lurt å velge et større basseng, selv om det betyr å betale mer, for å unngå å ha for mange småverdi UTXOer som utganger. Brukeren må vurdere disse avveiningene for å velge bassenget de foretrekker.
  I tillegg til tjenesteavgiftene, må også gruveavgiftene som er iboende i enhver Bitcoin-transaksjon, vurderes. Som Whirlpool-bruker vil du være nødt til å betale gruveavgiftene for forberedelsestransaksjonen (`Tx0`) samt de for den første coinjoin. Alle påfølgende remikser vil være gratis, takket være Whirlpools modell som stoler på betalingen fra nye deltakere.

Faktisk, i hver Whirlpool coinjoin, er 2 brukere blant inngangene nye deltakere. De andre inngangene kommer fra remiksere. Som et resultat, dekkes gruveavgiftene for alle deltakerne i transaksjonen av disse 2 nye deltakerne, som da også vil dra nytte av gratis remikser:

![BTC204](assets/en/54/07.webp)

Takket være dette avgiftssystemet, skiller Whirlpool seg virkelig ut fra andre coinjoin-implementeringer siden anonsettene til UTXOene ikke er proporsjonale med prisen betalt av brukeren. Dermed er det mulig å oppnå betydelig høye nivåer av anonymitet ved kun å betale inngangsavgiften til bassenget og gruveavgiftene for 2 transaksjoner (den `Tx0` og den første miksen).

Det er viktig å merke seg at brukeren også må dekke gruveavgiftene for å ta ut sine UTXOer fra bassenget etter å ha utført sine flere coinjoins, med mindre de har valgt `mix to`-alternativet, som tillater å oppgi en ekstern adresse som direkte vil motta midlene som en coinjoin-utgang, uten noen ekstra transaksjon.

### HD Wallet-kontoer

For å utføre en coinjoin via Whirlpool, må lommeboken generere flere distinkte kontoer. Dette er prinsippet til ZeroLink-protokollen. En konto, i konteksten av en HD (_Hierarchical Deterministic_) lommebok, utgjør en seksjon helt isolert fra de andre, denne separasjonen forekommer på det tredje dybdenivået av lommebokens hierarki, det vil si på nivået av `xpub`.

![BTC204](assets/en/54/08.webp)

En HD-lommebok kan teoretisk avlede opp til `2^(32/2)` forskjellige kontoer. Den opprinnelige kontoen, som brukes som standard på alle Bitcoin-lommebøker, tilsvarer indeksen `0'`.

For lommebøker tilpasset Whirlpool, brukes 4 kontoer for å møte behovene til ZeroLink-prosessen:

- **Innskuddskontoen**, identifisert ved indeksen `0'`;
- **Dårlig bank**-kontoen (eller "doxxic change"), identifisert ved indeksen `2 147 483 644'`;
- **Premix**-kontoen, identifisert ved indeksen `2 147 483 645`;
- **Postmix**-kontoen, identifisert ved indeksen `2 147 483 646`.

Hver av disse kontoene oppfyller en spesifikk funksjon i coinjoin-prosessen, som vi vil utforske i de følgende avsnittene.

Alle disse kontoene er knyttet til en enkelt seed, som lar brukeren gjenopprette tilgang til alle sine bitcoins ved hjelp av sin gjenopprettingsfrase og, om nødvendig, deres passfrase. Det er imidlertid nødvendig å spesifisere til programvaren, under denne gjenopprettingsoperasjonen, de forskjellige kontoindeksene som ble brukt.

La oss nå se på de forskjellige stadiene av en Whirlpool coinjoin innenfor disse kontoene.

### TX0

Utgangspunktet for enhver Whirlpool coinjoin er **innskuddskontoen**. Denne kontoen er den du automatisk bruker når du oppretter en ny Bitcoin-lommebok. Denne kontoen må krediteres med bitcoins du ønsker å mikse.

`Tx0` representerer det første steget i Whirlpool-miksingsprosessen. Målet er å forberede og likestille UTXOene for coinjoin, ved å dele dem inn i enheter som tilsvarer beløpet til det valgte bassenget, for å sikre homogeniteten av miksingen. De likestilte UTXOene sendes deretter til **premix**-kontoen. Når det gjelder differansen som ikke kan gå inn i bassenget, blir den skilt ut i en spesifikk konto: **bad bank** (eller "doxxic change").

Denne innledende transaksjonen `Tx0` tjener også til å avregne tjenestegebyrene som skyldes coinjoin-koordinatoren. I motsetning til de følgende trinnene, er denne transaksjonen ikke samarbeidsvillig; brukeren må derfor bære de fulle gruvegebyrene:

![BTC204](assets/en/54/09.webp)

I dette eksemplet på en `Tx0`-transaksjon, deles et innskudd på `372 000 sats` fra vår **innskudds**konto inn i flere utgående UTXOer, som er fordelt som følger:

- Et beløp på `5 000 sats` ment for koordinatoren for tjenestegebyrer, som tilsvarer inngangen til bassenget på `100 000 sats`;
- 3 UTXOer forberedt for miksing, omdirigert til vår **premix**-konto og registrert med koordinatoren. Disse UTXOene er likestilt til `108 000 sats` hver, for å dekke gruvegebyrene for deres fremtidige innledende miks;
- Overskuddet som ikke kan gå inn i bassenget, fordi det er for lite, anses som giftig endring. Det sendes til sin spesifikke konto. Her utgjør denne endringen `40 000 sats`;
- Til slutt er det `3 000 sats` som ikke utgjør en utgang, men er gruvegebyrene som kreves for å bekrefte `Tx0`.
  For eksempel, her er en ekte Tx0 Whirlpool (ikke fra meg): [edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46](https://mempool.space/fr/tx/edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46)

![BTC204](assets/notext/54/10.webp)

### Den Giftige Endringen

Overskuddet som ikke kunne integreres i bassenget, her tilsvarende `40 000 sats`, blir omdirigert til **bad bank**-kontoen, også referert til som "giftig endring", for å sikre en streng separasjon fra de andre UTXOene i lommeboken.
Denne UTXOen er farlig for brukerens personvern fordi den ikke bare fortsatt er knyttet til sin fortid, og dermed muligens til identiteten til eieren, men den er også merket som tilhørende en bruker som har deltatt i en coinjoin.
![BTC204](assets/notext/54/11.webp)

Hvis denne UTXOen slås sammen med blandete utdata, vil de miste alt personvernet som ble oppnådd under coinjoin-syklusene, spesielt på grunn av CIOH (_Common-Input-Ownership-Heuristic_). Hvis den slås sammen med andre giftige endringer, risikerer brukeren å miste personvern siden dette vil koble de forskjellige inngangene fra coinjoin-syklusene. Derfor må den håndteres med forsiktighet. Vi vil snakke mer i detalj om håndteringen av disse giftige UTXOene i den siste delen av dette kapittelet.

### Den første blandingen

Etter at `Tx0` er fullført, sendes de likestilte UTXOene til **premix**-kontoen i lommeboken vår, klare til å bli introdusert i deres første coinjoin-syklus, også kalt "initial mix." Hvis, som i vårt eksempel, `Tx0` genererer flere UTXOer beregnet for blanding, vil hver av dem bli integrert i en separat initial mix.

Ved slutten av disse første blandingene, vil **premix**-kontoen være tom, mens myntene våre, etter å ha betalt gruveavgiftene for denne første coinjoin, vil bli justert nøyaktig til beløpet definert av den valgte poolen. I vårt eksempel vil våre opprinnelige UTXOer på `108,000 sats` ha blitt redusert til nøyaktig `100,000 sats`.

![BTC204](assets/notext/54/12.webp)

### Remixene

Etter den første blandingen, overføres UTXOene til **postmix**-kontoen. Denne kontoen samler både allerede blandete UTXOer og de som venter på remixing. Når Whirlpool-klienten er aktiv, er UTXOene i **postmix**-kontoen automatisk tilgjengelige for remixing og vil bli tilfeldig valgt for å delta i disse nye syklusene.
Som en påminnelse, er remixene deretter 100% gratis: ingen ekstra tjenesteavgifter eller gruveavgifter kreves. Å holde UTXOene i **postmix**-kontoen opprettholder dermed deres intakte verdi og forbedrer samtidig deres anonsets. Derfor er det viktig å tillate at disse myntene deltar i flere coinjoin-sykluser. Det koster deg strengt tatt ingenting, og det øker deres anonymitetsnivåer.

Når du bestemmer deg for å bruke blandete UTXOer, kan du gjøre det direkte fra denne **postmix**-kontoen. Det er tilrådelig å beholde de blandete UTXOene i denne kontoen for å dra nytte av gratis remixes og for å forhindre at de forlater Whirlpool-kretsen, noe som kunne redusere deres personvern.

### Hvordan håndtere din postmix på riktig måte?

Etter å ha utført coinjoin-sykluser, er den beste strategien å beholde dine UTXOer i **postmix**-kontoen, i påvente av deres fremtidige bruk. Det er til og med tilrådelig å la dem remixe på ubestemt tid til du trenger å bruke dem.

Noen brukere kan vurdere å overføre sine blandete bitcoins til en lommebok sikret av en maskinvarelommebok. Dette er mulig, men det er viktig å nøye følge anbefalingene fra Samourai Wallet for å ikke kompromittere den oppnådde konfidensialiteten.

Å slå sammen UTXOer er den mest hyppig gjorte feilen. Det er nødvendig å unngå å kombinere blandete UTXOer med ublandede UTXOer i samme transaksjon, for å unngå Common-Input-Ownership-Heuristic (CIOH). Dette krever nøye håndtering av dine UTXOer innenfor lommeboken din, spesielt når det gjelder merking.

![BTC204](assets/notext/54/13.webp)
Det er også viktig å være forsiktig med å konsolidere blandede UTXOer seg imellom. Moderate konsolideringer er tenkelige hvis dine blandede UTXOer har betydelige anonset, men dette vil uunngåelig redusere konfidensialiteten til myntene dine. Sørg for at konsolideringene verken er for betydelige eller utført etter et utilstrekkelig antall remikser, med risikoen for å etablere deduserbare koblinger mellom dine UTXOer før og etter coinjoin-syklusene. I tilfelle tvil om disse manipulasjonene, er beste praksis å ikke konsolidere postmix-UTXOene, og overføre dem en etter en til din hardware-lommebok, og generere en ny blank adresse hver gang. Husk igjen å merke hver mottatt UTXO på riktig måte. Det frarådes også å overføre dine postmix-UTXOer til en lommebok som bruker uvanlige skript. For eksempel, hvis du går inn i Whirlpool fra en multisig-lommebok som bruker `P2WSH` skript, er det en liten sjanse for at du vil bli blandet med andre brukere som har samme type lommebok opprinnelig. Hvis du tar ut dine postmix til denne samme multisig-lommeboken, vil personvernivået til dine blandede bitcoins bli sterkt redusert. Utover skript, er det mange andre lommebokavtrykk som kan lure deg.
Som med enhver Bitcoin-transaksjon, er det også viktig å ikke gjenbruke mottaksadresser. Hver ny transaksjon bør mottas på en ny, blank adresse.

Den enkleste og sikreste løsningen er å la dine blandede UTXOer hvile i deres **postmix**-konto, la dem remixe og kun røre dem for å bruke. Samourai og Sparrow lommebøker har ekstra beskyttelser mot alle disse risikoene relatert til kjedeanalyse. Disse beskyttelsene hjelper deg med å unngå å gjøre feil.

### Hvordan håndtere din giftige veksel på riktig måte?

Videre må du være forsiktig med å håndtere din giftige veksel, vekselen som ikke kunne gå inn i coinjoin-bassenget. Disse giftige UTXOene, som er et resultat av bruk av Whirlpool, utgjør en risiko for ditt personvern siden de etablerer en kobling mellom deg og bruk av coinjoin. Derfor er det avgjørende å håndtere dem med forsiktighet og ikke kombinere dem med andre UTXOer, spesielt blandede UTXOer.

Her er forskjellige strategier å vurdere for å bruke dem:

- **Bland dem i mindre bassenger:** Hvis din giftige UTXO er stor nok til å gå inn i et mindre basseng på egen hånd, vurder å blande den. Dette er ofte det beste alternativet. Imidlertid er det frarådet å slå sammen flere giftige UTXOer for å få tilgang til et basseng, da dette kan koble dine forskjellige innganger;
- **Merk dem som "ikke-brukbare":** En annen tilnærming er å ikke lenger bruke dem, å merke dem som "ikke-brukbare" i deres dedikerte konto, og bare hodl. Dette sikrer at du ikke ved et uhell bruker dem. Hvis verdien av bitcoin øker, kan nye bassenger bedre egnet for dine giftige UTXOer dukke opp;
- **Gjør donasjoner:** Vurder å gjøre donasjoner, selv beskjedne, til utviklere som jobber med Bitcoin og tilhørende programvare. Du kan også donere til organisasjoner som aksepterer BTC. Hvis håndtering av dine giftige UTXOer virker for komplisert, kan du enkelt kvitte deg med dem ved å gjøre en donasjon.
- **Kjøp gavekort:** Plattformer som [Bitrefill](https://www.bitrefill.com/) lar deg bytte bitcoins mot gavekort som kan brukes hos ulike handlende. Dette kan være en måte å kvitte seg med dine giftige UTXOer uten å miste den tilknyttede verdien.
- **Konsolider dem på Monero:** Samourai Wallet tilbyr en atombyttetjeneste mellom BTC og XMR. Dette er ideelt for å håndtere giftige UTXOer ved å konsolidere dem på Monero, uten å kompromittere personvernet ditt gjennom KYC, før du sender dem tilbake til Bitcoin. Imidlertid kan dette alternativet være kostbart i form av gruvegebyrer og premier på grunn av likviditetsbegrensninger.
- **Send dem til Lightning Network:** Å overføre disse UTXOene til Lightning Network for å dra nytte av reduserte transaksjonsgebyrer er en interessant mulighet. Imidlertid kan denne metoden avsløre visse opplysninger avhengig av bruken din av Lightning og bør derfor praktiseres med forsiktighet.

### Hvordan bruke Whirlpool?

Etter arrestasjonen av grunnleggerne av Samourai Wallet og beslagleggelsen av deres servere den 24. april 2024, fungerer ikke Whirlpool-verktøyet lenger, selv for de som har sin egen Dojo. Tidligere var det tilgjengelig på Samourai Wallet og Sparrow Wallet.

![BTC204](assets/notext/54/14.webp)

Det er imidlertid fortsatt mulig at dette verktøyet kan settes tilbake i drift i de kommende ukene, avhengig av utfallet av rettssakene, eller relanseres på en annen måte. Uansett tror jeg at markedet for coinjoin på Bitcoin ikke vil være uten et tilbud lenge, ettersom det er en klar etterspørsel. Dessuten vil Whirlpool-modellen, som er den mest avanserte når det gjelder personvern, sikkert bli brukt i fremtiden for andre implementeringer.

Vi følger nøye med på utviklingen av denne saken samt utviklingen angående tilknyttede verktøy. Vær trygg på at vi vil oppdatere denne opplæringen etter hvert som ny informasjon blir tilgjengelig.

I neste kapittel vil vi oppdage hva "anonsets" er, hvordan disse indikatorene beregnes, og hvordan de kan hjelpe oss med å estimere effektiviteten av coinjoin-sykluser.

https://planb.network/tutorials/privacy/on-chain/coinjoin-sparrow-wallet-84def86d-faf5-4589-807a-83be60720c8b

https://planb.network/tutorials/privacy/on-chain/coinjoin-samourai-wallet-e566803d-ab3f-4d98-9136-5462009262ef

https://planb.network/tutorials/privacy/on-chain/coinjoin-dojo-c4b20263-5b30-4c74-ae59-dc8d0f8715c2

## Anonymitetssett

<chapterId>be1093dc-1a74-40e5-9545-2b97a7d7d431</chapterId>

Etter å ha studert hvordan coinjoins fungerer og utfordringene forbundet med effektiv miksing, vil vi nå lære hvordan vi måler denne effektiviteten. Hvordan bestemme om en coinjoin-prosess har vært effektiv og hvilken grad av anonymitet en mynt har oppnådd? Dette er hva vi vil utforske i dette kapittelet med anonymitetssett eller "anonsets" på engelsk.

### Påminnelse om nytten av Coinjoin

Nytten av CoinJoin ligger i dens evne til å produsere plausibel benektelse ved å fordype mynten din innenfor en gruppe av umulige å skille mynter. Målet med denne handlingen er å bryte sporbarhetslenkene, både fra fortiden til nåtiden og fra nåtiden til fortiden.
Med andre ord, en analytiker som kjenner din opprinnelige transaksjon (`Tx0`) ved inngangen av CoinJoin-syklusene, bør ikke kunne identifisere med sikkerhet din UTXO ved utgangen av remix-syklusene (analyse fra syklusinngang til syklusutgang).

![BTC204](assets/en/55/01.webp)

På samme måte bør en analytiker som kjenner din UTXO ved utgangen av CoinJoin-syklusene være ute av stand til å bestemme den opprinnelige transaksjonen ved inngangen av syklusene (analyse fra syklusutgang til syklusinngang).

![BTC204](assets/en/55/02.webp)
For å vurdere vanskelighetsgraden for en analytiker å koble fortiden til nåtiden og omvendt, er det nødvendig å kvantifisere størrelsen på gruppene av homogene mynter innenfor hvilke din mynt er skjult. Dette målet forteller oss antallet analyser som har en identisk sannsynlighet. Så, hvis den korrekte analysen er druknet blant 3 andre analyser med lik sannsynlighet, er ditt nivå av skjulthet veldig lavt. Derimot, hvis den korrekte analysen er innenfor et sett av 20 000 analyser alle like sannsynlige, er din mynt veldig godt skjult. Og nettopp, størrelsen på disse gruppene representerer indikatorer kalt "anonsets".

### Forståelse av Anonsets

Anonsets fungerer som indikatorer for å vurdere graden av personvern for en spesifikk UTXO. Mer spesifikt måler de antallet uatskillelige UTXOs innenfor settet som inkluderer den studerte mynten. Kravet om et homogent UTXO-sett betyr at anonsets vanligvis beregnes over CoinJoin-sykluser. Bruken av disse indikatorene er spesielt relevant for Whirlpool CoinJoins på grunn av deres uniformitet.

Anonsets tillater, der det er hensiktsmessig, å bedømme kvaliteten på CoinJoins. En stor anonset-størrelse betegner et høyt nivå av anonymitet, ettersom det blir vanskelig å skille en spesifikk UTXO innenfor det homogene settet.

Det er 2 typer anonsets:

- **Det prospektive anonset;**
- **Det retrospektive anonset.**

### Det Prospektive Anonset

Det prospektive anonset indikerer størrelsen på gruppen blant hvilken den studerte UTXO er skjult ved syklusens utgang, med kjennskap til UTXO ved inngangen, det vil si antallet uatskillelige mynter til stede innenfor denne gruppen. På engelsk er navnet på denne indikatoren "forward anonset", eller "forward-looking metrics".
Denne indikatoren tillater måling av myntens personvernmotstand mot en analyse fra fortid til nåtid (inngang til utgang).
![BTC204](assets/en/55/03.webp)

Denne metrikken anslår i hvilken grad din UTXO er beskyttet mot forsøk på å rekonstruere dens historie fra dens inngangspunkt til dens utgangspunkt i coinjoin-prosessen.

For eksempel, hvis din transaksjon deltok i sin første coinjoin-syklus og to ytterligere etterkommer-sykluser ble fullført, ville det prospektive anonset av din mynt være `13`:

![BTC204](assets/notext/55/04.webp)

For eksempel, la oss forestille oss at vår mynt ved inngangen av coinjoin-syklusen nyter godt av et prospektivt anonset på `86,871`. Praktisk betyr dette at den er skjult blant `86,871` uatskillelige mynter. For en ekstern observatør som er klar over denne mynten ved begynnelsen av coinjoin-syklusene og forsøker å spore dens utgang, ville de stå overfor `86,871` mulige UTXOs, hver med en identisk sannsynlighet for å være den ettertraktede mynten.

![BTC204](assets/en/55/05.webp)

### Det Retrospektive Anonset

Det retrospektive anonset indikerer antallet mulige kilder for en gitt mynt, med kjennskap til UTXO ved syklusens utgang. Denne indikatoren måler myntens personvernmotstand mot en analyse fra nåtid til fortid (utgang til inngang), det vil si hvor vanskelig det er for en analytiker å spore tilbake til opprinnelsen til din mynt, før coinjoin-syklusene. På engelsk er navnet på denne indikatoren "backward anonset," eller "backward-looking metrics."

![BTC204](assets/en/55/06.webp)

Med kjennskap til din UTXO ved utgangen av syklusene, bestemmer det retrospektive anonset antallet potensielle Tx0-transaksjoner som kunne ha utgjort din inngang i coinjoin-syklusene. I diagrammet nedenfor tilsvarer dette summen av alle de oransje boblene.
![BTC204](assets/notext/55/07.webp)
For eksempel, la oss forestille oss at vår mynt ved utgangen av coinjoin-syklusen nyter godt av et retrospektivt anonset på `42,185`. Praktisk betyr dette at det er `42,185` potensielle kilder for denne UTXOen. Hvis en ekstern observatør identifiserer denne mynten ved slutten av syklusene og søker å spore dens opprinnelse, vil de stå overfor `42,185` mulige kilder, alle med en like sannsynlig mulighet for å være den ettertraktede opprinnelsen.

![BTC204](assets/en/55/08.webp)

### Hvordan konkret beregne anonsets?

Det er mulig å manuelt beregne ens anonsets ved bruk av en blokkutforsker for små sett. Imidlertid, for større anonsets, blir bruken av et spesialisert verktøy avgjørende. Etter min kunnskap er den eneste programvaren som er i stand til å utføre denne oppgaven _Whirlpool Stats Tool_, et Python-verktøy utviklet av teamene hos Samourai og OXT. Dessverre er dette verktøyet for øyeblikket ute av drift etter arrestasjonen av grunnleggerne av Samourai og avviklingen av OXT, som ble brukt til å trekke ut data fra blokkjeden.
![BTC204](assets/notext/55/09.webp)

Som vi har sett i dette kapittelet, kan anonsets bare beregnes hvis det er en viss homogenitet i strukturen av coinjoins. Og nettopp, i neste kapittel, vil vi oppdage hvordan man kvantifiserer denne homogeniteten i en Bitcoin-transaksjon, enten det er en coinjoin eller en mer tradisjonell transaksjon.

https://planb.network/tutorials/privacy/analysis/wst-anonsets-0354b793-c301-48af-af75-f87569756375

## Entropi

<chapterId>e4fe289d-618b-49a2-84c9-68c562e708b4</chapterId>

Som vi har sett i denne delen om coinjoins, spiller homogeniteten til UTXOene i innganger og utganger en viktig rolle i å forbedre konfidensialiteten til en Bitcoin-transaksjon. Denne parameteren tillater plausibel benektelse mot kjedeanalyse. Flere metoder kan måle denne homogeniteten, men en av de mest effektive, etter min mening, er bruken av indikatorer levert av _Boltzmann_-verktøyet, utviklet av teamene hos OXT og Samourai Wallet, spesielt transaksjonens entropi. Dette er hva vi vil studere i detalj i dette kapittelet.

I motsetning til anonsets, som beregnes over et sett med transaksjoner, fokuserer indikatorene vi vil presentere her utelukkende på en enkelt transaksjon, enten det er en coinjoin eller en mer tradisjonell transaksjon.

### Antall tolkninger

Den første indikatoren som kan observeres på en Bitcoin-transaksjon er det totale antallet mulige tolkninger i øynene til en ekstern observatør som analyserer transaksjonen. Med tanke på verdiene til UTXOene involvert i transaksjonen, indikerer denne indikatoren antall måter inngangene kan assosieres med utgangene på. Med andre ord, den bestemmer antall mulige tolkninger en transaksjon kan generere i flyten av bitcoins fra perspektivet til en ekstern observatør som analyserer den.

For eksempel vil en enkel betalingstransaksjon med 1 inngang og 2 utganger bare ha én tolkning, nemlig at inngang #0 finansierte utgang #0 og utgang #1. Det er ingen andre mulige tolkninger:

![BTC204](assets/notext/56/01.webp)

I motsetning presenterer en coinjoin strukturert i henhold til Whirlpool 5x5-modellen $1,496$ mulige kombinasjoner:
![BTC204](assets/notext/56/02.webp)
En Whirlpool Surge Cycle 8x8 coinjoin presenterer seg selv med $9,934,563$ mulige tolkninger:

![BTC204](assets/notext/56/03.webp)

### Entropi

Fra antallet tolkninger av en Bitcoin-transaksjon kan vi beregne dens entropi.

I den generelle konteksten av kryptografi og informasjon, er entropi et kvantitativt mål på usikkerheten eller uforutsigbarheten forbundet med en datakilde eller en tilfeldig prosess. Med andre ord, entropi er en måte å måle hvor vanskelig informasjon er å forutsi eller gjette.

I den spesifikke konteksten av kjedeanalyse, er entropi også navnet på en indikator, avledet fra Shannon entropi og [oppfunnet av LaurentMT](https://gist.github.com/LaurentMT/e758767ca4038ac40aaf), som kan beregnes på en Bitcoin-transaksjon.

Når en transaksjon presenterer et høyt antall mulige tolkninger, er det ofte mer relevant å referere til dens entropi. Denne indikatoren tillater måling av mangel på kunnskap hos analytikere om den eksakte konfigurasjonen av transaksjonen. Med andre ord, jo høyere entropi, desto vanskeligere blir oppgaven med å identifisere strømmene av bitcoins mellom innganger og utganger for analytikere.

I praksis avslører entropi om, fra perspektivet til en ekstern observatør, en transaksjon presenterer flere mulige tolkninger, basert utelukkende på mengdene av innganger og utganger, uten å vurdere andre eksterne eller interne mønstre og heuristikker. Høy entropi er da synonymt med bedre konfidensialitet for transaksjonen.

Entropi er definert som den binære logaritmen av antallet mulige kombinasjoner. Her er formelen som brukes med $E$ som entropien til transaksjonen og $C$ antallet mulige tolkninger:

$$
E = \log_2(C)
$$

I matematikk tilsvarer den binære logaritmen (base 2 logaritmen) den inverse operasjonen av å opphøye 2. Med andre ord, den binære logaritmen av $x$ er eksponenten som $2$ må opphøyes til for å oppnå $x$. Denne indikatoren uttrykkes dermed i bits.

La oss ta eksemplet med å beregne entropien for en coinjoin-transaksjon strukturert i henhold til Whirlpool 5x5-modellen, som, som nevnt i forrige avsnitt, presenterer et antall mulige tolkninger på $1,496$:

$$
\begin{align*}
C &= 1,496 \\
E &= \log_2(1,496) \\
E &= 10.5469 \text{ bits}
\end{align*}
$$

Dermed viser denne coinjoin-transaksjonen en entropi på $10.5469$ bits, som anses som svært tilfredsstillende. Jo høyere denne verdien er, desto flere forskjellige tolkninger tillater transaksjonen, og dermed øker dens nivå av personvern.
For en 8x8 coinjoin-transaksjon som presenterer $9,934,563$ tolkninger, ville entropien være:

$$
\begin{align*}
C &= 9,934,563 \\
E &= \log_2(9,934,563) \\
E &= 23.244 \text{ bits}
\end{align*}
$$

La oss ta et annet eksempel med en standard betalingstransaksjon, med 1 inngang og 2 utganger: [1b1b0c3f0883a99f1161c64da19471841ed12a1f78e77fab128c69a5f578ccce](https://mempool.space/tx/1b1b0c3f0883a99f1161c64da19471841ed12a1f78e77fab128c69a5f578ccce)

![BTC204](assets/notext/56/04.webp)

I tilfellet med denne transaksjonen, er den eneste mulige tolkningen: `(In.0) > (Out.0 ; Out.1)`. Følgelig er dens entropi etablert til $0$:

$$
E_D &= 1.453 \text{ bits}
\end{align*}
$$

### Effektivitet

Fra transaksjonens entropi kan vi også beregne dens effektivitet med hensyn til personvern. Denne indikatoren vurderer transaksjonens effektivitet ved å sammenligne den med den optimale transaksjonen som er tenkelig i en identisk konfigurasjon.

Dette fører oss til å diskutere konseptet med maksimal entropi, som tilsvarer den høyeste entropien en spesifikk transaksjonsstruktur teoretisk kunne oppnå. Transaksjonens effektivitet beregnes deretter ved å konfrontere denne maksimale entropien med den faktiske entropien til den analyserte transaksjonen.

Formelen som brukes er som følger med:

- $E_R$: den faktiske entropien til transaksjonen uttrykt i bits;
- $E_M$: den maksimale mulige entropien for en transaksjonsstruktur også uttrykt i bits;
- $Ef$: effektiviteten til transaksjonen i bits:

$$
Ef = E_R - E_M
$$

For eksempel, for en Whirlpool 5x5 type coinjoin-struktur, er den maksimale entropien $10.5469$:

$$
\begin{align*}
E_R &= 10.5469 \\
E_M &= 10.5469 \\
Ef &= E_R - E_M \\
Ef &= 10.5469 - 10.5469 \\
Ef &= 0 \text{ bits}
\end{align*}
$$

Denne indikatoren uttrykkes også som en prosentandel. Formelen som brukes er som følger med:

- $C_R$: antall mulige reelle tolkninger;
- $C_M$: det maksimale antallet mulige tolkninger med samme struktur;
- $Ef$: effektivitet uttrykt i prosent:

$$
\begin{align*}
E_f &= \frac{C_R}{C_M} \\
E_f &= \frac{1\,496}{1\,496} \\
E_f &= 100\%
\end{align*}
$$

En effektivitet på $100\%$ indikerer dermed at transaksjonen maksimerer sitt potensial for personvern basert på sin struktur.

### Entropitetthet

Entropi er en god indikator for å måle personvernet til en transaksjon, men den avhenger delvis av antall innganger og utganger i transaksjonen. For å sammenligne entropien til 2 forskjellige transaksjoner som ikke har samme antall innganger og utganger, kan man beregne entropitettheten. Denne indikatoren gir et perspektiv på entropien i forhold til hver inngang eller utgang i transaksjonen. Tettheten er nyttig for å evaluere og sammenligne effektiviteten til transaksjoner av forskjellige størrelser.

For å beregne den, deler du ganske enkelt den totale entropien til transaksjonen med det totale antallet innganger og utganger som er involvert i transaksjonen:

- $E_D$: entropitettheten uttrykt i bits;
- $E$: entropien til transaksjonen uttrykt i bits;
- $T$: det totale antallet innganger og utganger i transaksjonen:

$$
E_D = \frac{E}{T}
$$

La oss ta eksemplet med en Whirlpool 5x5 coinjoin:

$$
\begin{align*}
T &= 5 + 5 = 10 \\
E &= 10.5469 \\
E_D &= \frac{E}{T} \\
E_D &= \frac{10.5469}{10} \\
E_D &= 1.054 \text{ bits}
\end{align*}
$$

La oss også beregne entropitettheten til en Whirlpool 8x8 coinjoin:

$$
\begin{align*}
T &= 8 + 8 = 16 \\
E &= 23.244 \\
E_D &= \frac{E}{T} \\
E_D &= \frac{23.244}{16} \\
E_D &= 1.453 \text{ bits}
\end{align*}
$$

Ved å analysere entropitettheten til disse to typene coinjoins, blir det tydelig at, selv når man normaliserer entropien etter antall elementer, genererer "Surge Cycle 8x8" coinjoin mer usikkerhet for analyse.

### The Boltzmann Score

Et annet stykke informasjon analysert i en transaksjon er Boltzmann-scoren for hvert element i forhold til et annet. Dette er en tabell over sannsynlighetene for matching mellom inngangene og utgangene. Denne tabellen indikerer, gjennom Boltzmann-scoren, den betingede sannsynligheten for at en spesifikk inngang er koblet til en gitt utgang. Det er derfor et kvantitativt mål på den betingede sannsynligheten for at en assosiasjon mellom en inngang og en utgang i en transaksjon forekommer, etablert på forholdet mellom antall gunstige forekomster av denne hendelsen sammenlignet med det totale antall mulige forekomster, i et sett med tolkninger.
Tar eksemplet med en Whirlpool coinjoin, ville tabellen over betingede sannsynligheter fremheve sjansene for en kobling mellom hver inngang og utgang, og gi et kvantitativt mål på tvetydigheten av assosiasjoner i transaksjonen:

| %         | Utgang 0 | Utgang 1 | Utgang 2 | Utgang 3 | Utgang 4 |
| --------- | -------- | -------- | -------- | -------- | -------- |
| Inngang 0 | 34%      | 34%      | 34%      | 34%      | 34%      |
| Inngang 1 | 34%      | 34%      | 34%      | 34%      | 34%      |
| Inngang 2 | 34%      | 34%      | 34%      | 34%      | 34%      |
| Inngang 3 | 34%      | 34%      | 34%      | 34%      | 34%      |
| Inngang 4 | 34%      | 34%      | 34%      | 34%      | 34%      |

Her er det klart at hver inngang har en like stor sjanse for å være assosiert med hvilken som helst utgang, noe som forbedrer konfidensialiteten til transaksjonen.

Beregningen av Boltzmann-scoren involverer å dele antall tolkninger der en viss hendelse manifesterer seg med det totale antall tilgjengelige tolkninger. Så, for å bestemme scoren som assosierer inngang #0 med utgang #3 (en hendelse til stede i $512$ tolkninger), er prosessen som følger:

$$
\begin{align*}
\text{Interpretasjoner (IN.0 > UT.3)} &= 512 \\
\text{Totalt antall interpretasjoner} &= 1496 \\
\text{Score} &= \frac{512}{1496} \\
\text{Score} &= 34 \%
\end{align*}
$$

Hvis vi ser på eksemplet med en Whirlpool coinjoin 8x8 Surge Cycle på nytt, ville Boltzmann-tabellen se slik ut:

|      | UT.0 | UT.1 | UT.2 | UT.3 | UT.4 | UT.5 | UT.6 | UT.7 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| IN.0 | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  |
| IN.1 | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  |
| IN.2 | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  |
| IN.3 | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  |
| IN.4 | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  |
| IN.5 | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  |
| IN.6 | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  |
| IN.7 | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  | 23%  |

Men, i tilfellet med en enkel transaksjon som involverer et enkelt innskudd og 2 uttak, er situasjonen annerledes:

| %          | Uttak 0 | Uttak 1 |
| ---------- | ------- | ------- |
| Innskudd 0 | 100%    | 100%    |

Her observerer vi at sannsynligheten for at hvert uttak stammer fra innskudd #0 er 100%. En lavere sannsynlighet oversetter dermed til større personvern ved å fortynne de direkte koblingene mellom innskuddene og uttakene.

### Deterministiske Koblinger

Det er også mulig å beregne antall deterministiske koblinger i en transaksjon. Denne indikatoren avslører hvor mange forbindelser mellom innskuddene og uttakene i den analyserte transaksjonen som er uomtvistelige, med en sannsynlighet på 100%. Denne indikatoren kan deretter komplementeres ved å beregne forholdet av deterministiske koblinger. Forholdet gir et perspektiv på vekten av disse deterministiske koblingene innenfor alle transaksjonskoblingene.

For eksempel viser en Whirlpool-type coinjoin-transaksjon ingen deterministisk kobling mellom innskuddene og uttakene, og viser dermed en indikator på 0 koblinger og et forhold på 0%. I motsetning, i vår andre undersøkte enkle betalingstransaksjon (med ett innskudd og 2 uttak), forteller indikatoren oss at det er 2 deterministiske koblinger og forholdet når 100%. Derfor signaliserer en nullindikator utmerket personvern på grunn av fraværet av direkte og uomtvistelige forbindelser mellom innskuddene og uttakene.

### Hvordan Beregne Disse Indikatorene?

Å manuelt beregne disse indikatorene ved hjelp av ligningene jeg har gitt er relativt enkelt. Hovedvanskeligheten ligger i å bestemme antall mulige tolkninger av en transaksjon. For en standardtransaksjon kan denne beregningen utføres for hånd. Imidlertid, for en coinjoin, er oppgaven betydelig mer kompleks.

Tidligere var det et Python-verktøy kalt _Boltzmann Calculator_, utviklet av teamene hos OXT og Samourai, som tillot automatisk beregning av alle disse indikatorene for en Bitcoin-transaksjon:

![BTC204](assets/notext/56/05.webp)

Det var også mulig å bruke nettstedet KYCP.org for disse analysene:

![BTC204](assets/notext/56/06.webp)
Dessverre, etter arrestasjonen av grunnleggerne av Samourai, er disse verktøyene for øyeblikket ikke operative.
Nå som vi har diskutert coinjoins i detalj, vil vi utforske andre personvernsteknikker tilgjengelige på Bitcoin i den siste delen av opplæringen vår. Vi vil se på payjoins, spesifikke transaksjonstyper pseudo-coinjoins, statiske adresseprotokoller, samt tiltak rettet mot å forbedre personvern ikke på transaksjonsnivå, men på nettverket av noder-nivå.

https://planb.network/tutorials/privacy/analysis/boltzmann-entropy-738e45af-18a6-4ce6-af1a-1bf58e15f1fe

# Forståelse av innsatsen for andre avanserte personvernsteknikker

<partId>19989ae6-d608-4acf-b698-2cf1e7e5e6ae</partId>

## Payjoin-transaksjoner

<chapterId>c1e90b95-f709-4574-837b-2ec26b11286f</chapterId>

Coinjoin representerer for øyeblikket den mest effektive metoden for å introdusere usikkerhet i sporingen av mynter under en kjedeanalyse. Som vi har sett i de foregående kapitlene, for å oppnå effektiv miksing, er det nødvendig at inngangene og utgangene er så homogene som mulig. Videre er det avgjørende at myntene blir integrert i så stor en gruppe som mulig for å maksimere anonsets. Dermed, for at coinjoins skal være effektive, må de involvere et stort antall uniforme mynter. Dette mangfoldet av krav betyr at coinjoin-transaksjoner har en veldig rigid struktur: beløpene er forhåndsbestemt, og alle deltakere må følge dem for å sikre uniformiteten i prosessen. I tillegg krever coinjoins synkronisering mellom alle deltakere og koordinatoren under konstruksjonen av transaksjonen.
Disse kravene gjør coinjoin dårlig egnet for direkte betalinger. For eksempel, hvis du eier en 1M sats del i en coinjoin-pool, ville det å bruke den direkte som betaling være komplekst. Det ville kreve synkronisering med de andre deltakerne og koordinatoren for å konstruere den samarbeidende transaksjonen nøyaktig i det øyeblikket du trenger å gjøre en betaling, og kjøpesummen måtte matche nøyaktig verdien av din del, noe som er praktisk talt uoppnåelig. Derfor er en coinjoin-transaksjon av natur en feiende samarbeidstransaksjon, noe som betyr at det generelt er de samme eierne av inngangene som finnes i utgangene.
Det ville imidlertid være interessant å ha transaksjonsstrukturer som tillater praktiske betalinger samtidig som de introduserer tvil i kjedeanalyse. Dette er nettopp det vi vil utforske i dette kapittelet og det neste.

### Hva er en payjoin-transaksjon?

Payjoin er en spesifikk Bitcoin-transaksjonsstruktur som forbedrer brukerens personvern under en utgift ved å samarbeide med betalingsmottakeren.

Det var i 2015 at LaurentMT først nevnte denne metoden under navnet "_steganografiske transaksjoner_", ifølge et dokument tilgjengelig [her](https://gist.githubusercontent.com/LaurentMT/e758767ca4038ac40aaf/raw/c8125f6a3c3d0e90246dc96d3b603690ab6f1dcc/gistfile1.txt). Denne teknikken ble senere adoptert av Samourai Wallet, som i 2018, var den første klienten som implementerte den med Stowaway-verktøyet. Konseptet med payjoin finnes også i [BIP79](https://github.com/bitcoin/bips/blob/master/bip-0079.mediawiki) og [BIP78](https://github.com/bitcoin/bips/blob/master/bip-0078.mediawiki). Flere termer brukes dermed for å betegne en payjoin:

- Payjoin;
- Stowaway;
- P2EP (_Pay-to-End-Point_);
- Steganografisk transaksjon.
  Det som er spesielt med payjoin er dens evne til å generere en transaksjon som ved første øyekast ser vanlig ut, men som i virkeligheten er en mini Coinjoin mellom to personer. For dette involverer transaksjonsstrukturen betalingsmottakeren i inngangene sammen med den faktiske avsenderen. Mottakeren inkluderer dermed en betaling til seg selv midt i transaksjonen som lar dem bli betalt.
  La oss ta et eksempel for å bedre forstå denne prosessen. Alice kjøper en baguette for 4 000 sats ved å bruke en UTXO på 10 000 sats og velger en payjoin. Hennes baker, Bob, legger til en UTXO på 15 000 sats som tilhører ham i inngangen, som han henter ut i fullt i utgangen, i tillegg til Alices 4 000 sats.

![BTC204](assets/notext/61/01.webp)
I dette eksempelet legger Bob bakeren inn 15 000 sats og kommer ut med 19 000 sats, forskjellen er nøyaktig 4 000 sats, som er prisen på baguetten. På Alices side, går hun inn med 10 000 sats og ender opp med 6 000 sats i utgangen, som representerer en balanse på -4 000 sats, nemlig prisen på baguetten. For å forenkle eksempelet har jeg med vilje utelatt gruveavgiftene i denne transaksjonen.

### Hva er formålet med payjoin?

Payjoin-transaksjonen oppfyller to mål som lar brukere forbedre personvernet til betalingen deres.

For det første, payjoin har som mål å villede en ekstern observatør ved å skape en avledning i kjedeanalysen. Dette gjøres mulig takket være CIOH-heuristikken (_Common Input Ownership Heuristic_). Som vi så i del 3, vanligvis, når en transaksjon på blokkjeden har flere innganger, antas det at alle disse inngangene tilhører samme enhet eller bruker.

Dermed, når en analytiker undersøker en payjoin-transaksjon, blir de ledet til å tro at alle inngangene kommer fra samme person. Imidlertid er denne oppfatningen feil, ettersom betalingsmottakeren også bidrar til inngangene sammen med den faktiske betaleren. Kjedeanalysen blir derfor omdirigert til en tolkning som viser seg å være feil.

La oss gå tilbake til vårt eksempel på en payjoin-transaksjon for betaling av en baguette:

![BTC204](assets/notext/61/02.webp)

Ved å se denne transaksjonen på blokkjeden, ville en ekstern observatør som følger de vanlige heuristikkene for kjedeanalyse tolke den slik: "_Alice slo sammen 2 UTXOer i inngangene av transaksjonen for å betale 19 000 sats til Bob_".

![BTC204](assets/en/61/03.webp)

Denne tolkningen er åpenbart feil, som du allerede vet, de to UTXOene i inngangene tilhører ikke samme person. En kommer fra Alice, kjøperen av baguetten, og den andre fra Bob, bakeren.

![BTC204](assets/notext/61/04.webp)

Analysen av den eksterne observatøren er dermed rettet mot en feil konklusjon, noe som sikrer bevaringen av konfidensialiteten til de involverte partene.

### Den steganografiske transaksjonen

Det andre målet med payjoin er å lure en ekstern observatør om det faktiske beløpet av betalingen som ble gjort. Ved å undersøke strukturen av transaksjonen, kan analytikeren tro at betalingen tilsvarer beløpet til en av utgangene.
Hvis vi ser på vårt eksempel med å kjøpe en baguette på nytt, vil analytikeren tenke at betalingsbeløpet tilsvarer enten UTXO-en på 6 000 sats eller UTXO-en på 19 000 sats. I dette tilfellet er det mer sannsynlig at analytikeren tenker at betalingsbeløpet er 19 000 sats, fordi det er 2 UTXO-er i utdataene, hvorav minst én er større enn 6 000 sats (det er ingen logisk grunn til å bruke 2 UTXO-er for å betale 6 000 sats når en enkelt UTXO ville ha vært tilstrekkelig for denne betalingen). ![BTC204](assets/en/61/05.webp)

Men i virkeligheten er denne analysen feil. Betalingsbeløpet tilsvarer ikke noen av utdataene. Det er faktisk forskjellen mellom mottakerens UTXO i utdata og mottakerens UTXO i inndata.

![BTC204](assets/en/61/06.webp)

I dette tilfellet faller payjoin-transaksjonen inn under området for steganografi. Det tillater å skjule det reelle beløpet av en transaksjon innenfor en falsk transaksjon som fungerer som en avledning.

Steganografi er en teknikk for å skjule informasjon innenfor andre data eller objekter, på en slik måte at tilstedeværelsen av den skjulte informasjonen ikke er merkbar. For eksempel kan en hemmelig melding skjules inne i et punkt i en tekst som er urelatert, noe som gjør den uoppdagelig for det blotte øye (dette er teknikken til [micropoint](https://fr.wikipedia.org/wiki/Micropoint)).

I motsetning til kryptering, som gjør informasjon uforståelig uten dekrypteringsnøkkelen, endrer ikke steganografi informasjonen. Den forblir synlig. Målet er heller å skjule selve eksistensen av den hemmelige meldingen, mens kryptering tydelig avslører tilstedeværelsen av skjult informasjon, selv om den er utilgjengelig uten nøkkelen. Dette er grunnen til at det opprinnelige navnet for payjoin var "_steganografiske transaksjoner_".

En analogi kan trekkes mellom kryptografi og coinjoin, samt mellom steganografi og payjoin. Faktisk har coinjoin attributter lik de til kryptering: metoden er gjenkjennelig, men informasjonen er uleselig. På den annen side er payjoin lik steganografi: informasjonen er teoretisk tilgjengelig, men siden metoden for skjuling ikke er gjenkjennelig, blir den utilgjengelig.

### Hvordan bruke payjoin?

Blant kjent programvare som støtter payjoin, finner vi Sparrow Wallet, Wasabi Wallet, Mutiny, BitMask, BlueWallet og JoinMarket, samt betalingsprosessoren BTCPay.

![BTC204](assets/notext/61/07.webp)
Den mest avanserte implementeringen av payjoin var kun Stowaway på Samourai Wallet. Men, siden arrestasjonen av programmets grunnleggere, fungerer dette verktøyet nå kun delvis. Fordelen med Stowaway er at det er et komplett og veldig enkelt-å-bruke protokoll, som støtter både mottak og sending av payjoins. Delvis signerte transaksjoner kan manuelt utveksles via skanning av flere QR-koder eller automatisk gjennom Tor via Soroban. Det er denne siste kommunikasjonsmuligheten som for øyeblikket er ute av drift.
![BTC204](assets/notext/61/08.webp)

Vanskeligheten med å bruke payjoin ligger i dens avhengighet av handlernes deltakelse. Som kunde er det umulig å bruke en payjoin hvis handelsmannen ikke støtter det. Dette legger til en ekstra vanskelighet under et kjøp: ikke bare er det komplisert å finne handelsmenn som aksepterer bitcoin, men hvis man også ser etter de som støtter payjoins, blir det enda mer komplisert.
En løsning ville være å bruke transaksjonsstrukturer som introduserer tvetydighet i kjedeanalysen uten å kreve samarbeid fra mottakeren. Dette ville tillate oss å forbedre personvernet til betalingene våre uten å være avhengig av aktiv deltakelse fra handelsmenn. Dette er nettopp det vi vil studere i neste kapittel.
https://planb.network/tutorials/privacy/on-chain/payjoin-sparrow-wallet-087a0e49-61cd-41f5-8440-ac7b157bdd62

https://planb.network/tutorials/privacy/on-chain/payjoin-samourai-wallet-48a5c711-ee3d-44db-b812-c55913080eab

## Betalings Mini-Coinjoins

<chapterId>300777ee-30ae-43d7-ab00-479dac3522c1</chapterId>

Når man ser etter å gjøre en betalingstransaksjon samtidig som man bevarer en viss grad av personvern, er payjoin et godt alternativ. Men som vi har sett, krever payjoin involvering av mottakeren. Hva gjør man da hvis sistnevnte nekter å delta i en payjoin, eller hvis du rett og slett foretrekker å ikke involvere dem? Et alternativ er å bruke en Stonewall eller Stonewall x2 transaksjon. La oss se nærmere på disse to typene transaksjoner.

### Stonewall-transaksjonen

Stonewall er en spesifikk form for Bitcoin-transaksjon rettet mot å øke brukerens personvern under en utgift ved å etterligne en pseudo-coinjoin mellom to personer, uten å faktisk være en. Faktisk er denne transaksjonen ikke samarbeidsbasert. En bruker kan konstruere den alene, kun ved å involvere UTXOene de eier som inndata. Du kan derfor opprette en Stonewall-transaksjon for enhver anledning, uten å trenge å synkronisere med en annen bruker eller mottakeren.

Operasjonen av Stonewall-transaksjonen er som følger: i inndataen av transaksjonen bruker avsenderen 2 UTXOer som tilhører dem. I utdata produserer transaksjonen 4 UTXOer, hvorav 2 vil være nøyaktig samme beløp. De andre 2 UTXOene vil utgjøre vekslepenger. Blant de 2 utdataene av samme beløp, vil kun én faktisk gå til mottakeren av betalingen.
Det er kun 2 roller i en Stonewall-transaksjon:

- Avsenderen, som utfører betalingen;
- Mottakeren, som kan være uvitende om transaksjonens spesifikke natur og rett og slett venter på en betaling fra avsenderen.

La oss ta et eksempel for å forstå denne transaksjonsstrukturen. Alice er hos Bob bakeren for å kjøpe sin baguette, som koster 4,000 sats. Hun ønsker å betale i bitcoins samtidig som hun opprettholder et visst nivå av personvern angående betalingen sin. Derfor bestemmer hun seg for å konstruere en Stonewall-transaksjon for betalingen.

![BTC204](assets/notext/62/01.webp)

Ved å analysere denne transaksjonen, kan vi se at Bob bakeren faktisk mottok 4,000 sats i betaling for baguetten. Alice brukte 2 UTXOer som inndata: en på 10,000 sats og en på 15,000 sats. I utdata mottok hun 3 UTXOer: en på 4,000 sats, en på 6,000 sats, og en på 11,000 sats. Alice har dermed en netto balanse på -4,000 sats på denne transaksjonen, som tilsvarer nøyaktig prisen på baguetten.

I dette eksemplet har jeg med vilje utelatt gruvegebyrene for å lette forståelsen. I virkeligheten bæres transaksjonsgebyrene helt av avsenderen.

### Hva er målene med en Stonewall-transaksjon?

Stonewall-strukturen tilfører mye entropi til transaksjonen og slører sporene for kjedeanalyse. Fra utsiden kan en slik transaksjon tolkes som en mini-coinjoin mellom to personer. Men i virkeligheten er det en betaling. Denne metoden genererer dermed usikkerheter i kjedeanalysen, eller kan til og med føre til falske spor.
La oss gå tilbake til eksemplet med Alice hos Bob bakeren. Transaksjonen på blokkjeden ville se slik ut:

![BTC204](assets/notext/62/02.webp)

En ekstern observatør som stoler på vanlige heuristikker for kjedeanalyse, kan feilaktig konkludere med at "_to personer har gjort en liten coinjoin, med ett UTXO hver i inngang og to UTXOer hver i utgang_". Analysen av denne transaksjonen fra utsiden fører ikke til anvendelsen av Common Input Ownership Heuristic (CIOH), fordi tilstedeværelsen av to utganger med samme beløp antyder et coinjoin-mønster. Fra et eksternt synspunkt er derfor CIOH ikke anvendelig i dette spesifikke tilfellet.

![BTC204](assets/notext/62/03.webp)

Denne tolkningen er unøyaktig, fordi, som du vet, ble ett UTXO sendt til Bob bakeren, de 2 UTXOene i innganger kommer fra Alice, og hun hentet 3 vekselutganger.

![BTC204](assets/notext/62/04.webp)
Og det som er spesielt interessant med strukturen til Stonewall-transaksjonen, er at fra perspektivet til en ekstern observatør, ser den nøyaktig ut som den til en Stonewall x2-transaksjon.

### Stonewall x2-transaksjonen

Stonewall x2 er en annen spesifikk form for Bitcoin-transaksjon som også har som mål å øke brukerens personvern under en utgift, men denne gangen ved å samarbeide med en tredjepart som ikke er involvert i utgiften. Denne metoden fungerer som en pseudo-coinjoin mellom to deltakere, samtidig som man gjør en betaling til en tredje person.

Operasjonen av Stonewall x2-transaksjonen er relativt enkel: man bruker et UTXO man eier for å gjøre betalingen og ber om hjelp fra en tredjepart som også bidrar med et UTXO de eier. Transaksjonen ender med fire utganger: to av dem med like beløp, en ment for adressen til betalingsmottakeren, den andre til en adresse som tilhører samarbeidspartneren. Et tredje UTXO sendes tilbake til en annen adresse til samarbeidspartneren, som lar dem gjenopprette det opprinnelige beløpet (en nøytral handling for dem, minus gruvegebyrene), og et siste UTXO returnerer til en adresse som tilhører oss, som utgjør vekselen av betalingen.

Dermed er tre forskjellige roller definert i Stonewall x2-transaksjonene:

- Avsenderen, som gjør den faktiske betalingen;
- Mottakeren, som kanskje ikke er klar over den spesifikke naturen til transaksjonen og bare venter på en betaling fra avsenderen;
- Samarbeidspartneren, som bidrar med bitcoins for å skape tvil i transaksjonsanalysen, samtidig som de fullstendig gjenoppretter sine midler til slutt (en nøytral handling for dem, minus gruvegebyrene).

La oss gå tilbake til vårt eksempel med Alice som er hos Bob bakeren for å kjøpe sin baguette som koster 4 000 sats. Hun ønsker å betale i bitcoins samtidig som hun opprettholder et visst nivå av personvern på betalingen sin. Så, hun ber vennen sin Charles om hjelp i denne prosessen.

![BTC204](assets/notext/62/05.webp)
Ved å analysere denne transaksjonen kan vi se at Bob bakeren faktisk har mottatt 4 000 sats i betaling for baguetten. Alice brukte 10 000 sats i innskudd og fikk tilbake 6 000 sats i uttak, noe som resulterte i en netto balanse på -4 000 sats, som tilsvarer prisen på baguetten. Når det gjelder Charles, la han inn 15 000 sats og mottok to uttak: ett på 4 000 sats og det andre på 11 000 sats, noe som gir en balanse på 0.
I dette eksemplet har jeg med vilje utelatt gebyrene for å forenkle forståelsen. I virkeligheten deles vanligvis gruvegebyrene likt mellom betalingsutstederen og samarbeidspartneren.

### Hva er målene med en Stonewall x2-transaksjon?

Liksom Stonewall-strukturen, legger Stonewall x2-strukturen til en betydelig mengde entropi til transaksjonen og skjuler sporene for kjedeanalyse. Fra et eksternt synspunkt kan en slik transaksjon tolkes som en liten coinjoin mellom to personer. Men i virkeligheten er det en betaling. Denne metoden skaper derfor usikkerheter i kjedeanalysen, til og med fører til falske spor.

La oss gjenbesøke eksemplet med Alice, Bob bakeren, og Charles. Transaksjonen på blokkjeden ville se slik ut:

![BTC204](assets/notext/62/06.webp)

En ekstern observatør som stoler på vanlige heuristikker for kjedeanalyse, kan feilaktig konkludere med at "_Alice og Charles har utført en liten coinjoin, med ett UTXO hver i innskudd og to UTXOer hver i uttak_". Igjen, analysen av denne transaksjonen fra utsiden fører ikke til anvendelsen av den vanlige inngangseierskap-heuristikken (CIOH), fordi tilstedeværelsen av to uttak av samme beløp antyder et coinjoin-mønster. Fra et eksternt synspunkt er derfor CIOH ikke anvendelig i dette spesifikke tilfellet.

![BTC204](assets/notext/62/07.webp)

Denne tolkningen er unøyaktig fordi, som du vet, ble ett UTXO sendt til Bob bakeren, Alice har bare ett vekseluttak, og Charles har to.

![BTC204](assets/notext/62/08.webp)

Og nok en gang, det som er spesielt interessant med Stonewall x2-transaksjonsstrukturen er at fra synspunktet til en ekstern observatør, ser den nøyaktig ut som den til en Stonewall-transaksjon.

### Hva er forskjellen mellom Stonewall og Stonewall x2?

En StonewallX2-transaksjon fungerer nøyaktig som en Stonewall-transaksjon, bortsett fra at den førstnevnte er samarbeidende, mens den sistnevnte ikke er det. Som vi har sett, involverer en Stonewall x2-transaksjon deltakelsen av en tredjepart (Charles), som er ekstern til betalingen, og som bidrar med sine bitcoins for å øke konfidensialiteten til transaksjonen. I en klassisk Stonewall-transaksjon, tas rollen som samarbeidspartner av avsenderen.

![BTC204](assets/notext/62/09.webp)

Fra et eksternt synspunkt er derfor mønsteret av transaksjonen nøyaktig det samme.

![BTC204](assets/notext/62/10.webp)

Det faktum at disse to transaksjonsstrukturene deler nøyaktig samme mønster innebærer at selv om en ekstern observatør klarer å identifisere et "Stonewall(x2)"-mønster, vil de ikke ha all informasjon. De vil ikke kunne bestemme hvilket av de to UTXOene av samme beløp som tilsvarer betalingen. Videre vil de ikke kunne bestemme om de to UTXOene i innskudd kommer fra to forskjellige personer (Stonewall x2) eller om de tilhører en enkelt person som har slått dem sammen (Stonewall).
Dette siste punktet skyldes det faktum at Stonewall x2-transaksjoner følger nøyaktig samme mønster som Stonewall-transaksjoner. Fra utsiden og uten ytterligere informasjon om konteksten, er det umulig å skille en Stonewall-transaksjon fra en Stonewall x2-transaksjon. Imidlertid er ikke de førstnevnte samarbeidstransaksjoner, mens de sistnevnte er det. Dette legger enda mer tvil i analysen av en av disse transaksjonene.

### Når skal man bruke Stonewall og Stonewall x2-transaksjoner?

Logikken bør være som følger når man ønsker å bruke et personvernsverktøy for en transaksjon:

- Som en prioritet, kan man velge å gjøre en payjoin;
- Hvis forhandleren ikke støtter payjoins, kan man gjøre en samarbeidstransaksjon med en annen person utenfor betalingen ved å bruke Stonewall x2-strukturen;
- Hvis ingen blir funnet for å gjøre en Stonewall x2-transaksjon, kan man gjøre en Stonewall-transaksjon alene, som vil etterligne oppførselen til en Stonewall x2-transaksjon.

### Hvordan bruke Stonewall og Stonewall x2-transaksjoner?

Stonewall og Stonewall x2-transaksjoner er tilgjengelige både på Samourai Wallet-appen og på Sparrow Wallet-programvaren.

![BTC204](assets/notext/62/11.webp)

Men, akkurat som med payjoins, etter arrestasjonen av grunnleggerne av Samourai, fungerer nå Stonewall x2-transaksjoner kun ved manuelt å utveksle PSBT-ene mellom de involverte partene. Den automatiske utvekslingen via Soroban er dessverre ikke tilgjengelig for øyeblikket.

Det er også mulig å manuelt utføre denne typen transaksjon fra hvilken som helst Bitcoin-lommebokprogramvare.

I neste kapittel vil vi studere en annen personvernsteknikk som er relativt ukjent, men som er veldig nyttig i tillegg til det vi allerede har studert.

https://planb.network/tutorials/privacy/on-chain/stonewall-033daa45-d42c-40e1-9511-cea89751c3d4

https://planb.network/tutorials/privacy/on-chain/stonewall-x2-05120280-f6f9-4e14-9fb8-c9e603f73e5b

## Ricochets

<chapterId>db9a20ac-a149-443d-884b-ea6c03f28499</chapterId>

Bruken av Bitcoin-transaksjonsstrukturer som legger til tvetydighet i kjedeanalyse, som coinjoin, er spesielt gunstig for personvernbeskyttelse. Imidlertid, som vi diskuterte i kapittelet om payjoins, er coinjoin-transaksjoner naturlig identifiserbare på kjeden. Husk analogien vi etablerte mellom kryptering og coinjoins: når man krypterer en fil, kan en tredjepart som oppdager denne krypterte filen ikke få tilgang til innholdet, men kan tydelig identifisere at det har vært en modifikasjon av filen for å skjule innholdet. Det samme gjelder for coinjoin: når en analytiker undersøker en coinjoin-transaksjon, selv om de ikke kan etablere direkte koblinger mellom innganger og utganger (og omvendt), kan de likevel gjenkjenne at den observerte transaksjonen er en coinjoin.
Avhengig av den tiltenkte bruken for mynten din etter å ha gjennomgått coinjoin-sykluser, kan det faktum at den har gjennomgått denne prosessen være problematisk. For eksempel, hvis du planlegger å selge mynten din på en regulert utvekslingsplattform, men den nylig har gjennomgått en coinjoin, vil plattformens kjedeanalyseverktøy oppdage dette faktum. Plattformen kan da nekte å akseptere din UTXO som har gjennomgått en coinjoin, eller til og med kreve forklaringer fra deg, med risikoen for å få kontoen din suspendert eller midlene dine frosset. I noen tilfeller kan plattformen også rapportere din oppførsel til statlige myndigheter (for eksempel, dette er det TRACFIN krever fra digitale aktiva tjenesteleverandører (PSAN) i Frankrike).
![BTC204](assets/notext/63/01.webp)
Det vi trenger for å unngå dette er et verktøy som er i stand til å sløre sporene av en Bitcoins fortid, for å gjenopprette en viss form for fungibilitet. Dette er nettopp målet med ricochet.
![BTC204](assets/notext/63/02.webp)

### Hva er en ricochet?

Ricochet er en teknikk som innebærer å utføre flere fiktive transaksjoner til seg selv (sweeping) for å simulere en overføring av eierskap av bitcoins. Dette verktøyet er forskjellig fra andre transaksjonsstrukturer vi har diskutert fordi det ikke tillater fremtidig anonymitet, men heller en form for retrospektiv anonymitet. Faktisk tillater ricochet å sløre de spesifikke detaljene som kunne kompromittere fungibiliteten til en Bitcoin på grunn av dens fortid.

For å sløre avtrykket som er igjen av en tidligere hendelse på en mynt, som for eksempel coinjoin-sykluser, utfører ricochet fire påfølgende transaksjoner der brukeren overfører midler til seg selv på forskjellige adresser.

![BTC204](assets/en/63/03.webp)

Etter denne sekvensen av transaksjoner, ruter ricochet-verktøyet til slutt bitcoinene til deres endelige destinasjon, som for eksempel en utvekslingsplattform.

![BTC204](assets/en/63/04.webp)

Målet er å skape avstand som påvirker fungibiliteten til mynten, som en coinjoin-transaksjon, og den endelige handlingen med å bruke denne mynten som kunne avvise den på grunn av dens fortid. Dermed kan kjedeanalyseverktøy konkludere med at det sannsynligvis har skjedd et eierskapsbytte etter hendelsen, og vurdere at denne mynten er fungibel. I tilfellet med en coinjoin, kan kjedeanalyseverktøy deretter anta at det ikke er samme person som sendte bitcoinene og utførte coinjoin, og derfor er det unødvendig å iverksette tiltak mot avsenderen.

![BTC204](assets/notext/63/05.webp)

### Hvorfor fungerer dette?

Når man står overfor denne ricochet-metoden, kan man forestille seg at kjedeanalyseprogramvare ville fordype sin undersøkelse utover fire hopp. Imidlertid står disse plattformene overfor et dilemma i å optimalisere deteksjonsterskelen. De må etablere en grense for antall hopp etter hvilket de innrømmer at et eierskapsbytte sannsynligvis har funnet sted, og at forbindelsen med en tidligere hendelse (som en coinjoin) bør ignoreres.
![BTC204](assets/en/63/06.webp)

Men å bestemme denne terskelen viser seg risikabelt: hver forlengelse av det observerte antallet hopp øker eksponentielt volumet av falske positiver, det vil si, individer feilaktig merket som deltakere i en hendelse, når operasjonen ble utført av noen andre. Dette scenariet utgjør en stor risiko for disse selskapene, da falske positiver fører til misnøye, som kan presse berørte kunder mot konkurransen. På lang sikt fører en for bred deteksjonsterskel til at en plattform mister flere kunder enn sine konkurrenter, noe som kan true dens levedyktighet. Derfor er det komplisert for disse plattformene å øke antall observerte hopp, og 4 er ofte et tilstrekkelig antall for å motvirke deres analyser.

Fenomenet observert her er noe analogt til teorien om seks grader av separasjon.

Teorien om seks grader av separasjon antyder at enhver person på jorden er forbundet med enhver annen gjennom en kjede av bekjente som ikke inkluderer mer enn seks mellomledd. Det ville være nok å gå gjennom en serie på seks personer, hver personlig kjent med den neste, for å nå hvilken som helst person i verden.

For Bitcoin-transaksjoner finnes et lignende fenomen. Ved å spore tilbake et tilstrekkelig antall Bitcoin-transaksjoner, ender man uunngåelig opp med å møte en coinjoin. Ricochet-metoden utnytter dette prinsippet ved å bruke et antall hopp høyere enn det utvekslingsplattformer rimeligvis kan følge. Hvis plattformer bestemmer seg for å følge flere transaksjoner, er det da mulig å enkelt legge til et ekstra hopp for å omgå dette tiltaket.

### Når og hvordan bruke ricochet?

Det mest vanlige bruksområdet for ricochet oppstår når det er nødvendig å skjule tidligere deltakelse i en coinjoin på en UTXO som du eier. Ideelt sett er det bedre å unngå å overføre bitcoins som har gjennomgått en coinjoin til regulerte enheter. Likevel, i tilfelle man finner seg selv uten noen annen mulighet, spesielt i hastverket med å likvidere bitcoins til fiatvaluta, tilbyr ricochet en effektiv løsning.
Denne metoden er effektiv ikke bare for coinjoins, men også for ethvert annet merke som kunne kompromittere en mynts fungibilitet.
Idéen om denne ricochet-metoden kommer opprinnelig fra teamene hos Samourai Wallet, som integrerte den i sin applikasjon for å automatisere prosessen. Tjenesten er betalt på Samourai, ettersom en ricochet innebærer et tjenestegebyr på 100 000 sats, i tillegg til gruvegebyrer. Dermed anbefales bruken heller for overføringer av betydelige beløp.

![BTC204](assets/notext/63/07.webp)

Samourai-applikasjonen tilbyr to varianter av ricochet:

- Den forbedrede ricochet, eller "staggered delivery", som har fordelen av å spre Samourai-tjenestegebyrene over fem påfølgende transaksjoner. Denne muligheten sikrer også at hver transaksjon sendes på et distinkt tidspunkt og registreres i en annen blokk, noe som lar den etterligne oppførselen til et eierskapsskifte så nært som mulig. Selv om den er tregere, er denne metoden å foretrekke for de som ikke har det travelt, ettersom den maksimerer effektiviteten av ricochet ved å styrke motstanden mot kjedeanalyse;

![BTC204](assets/notext/63/08.webp)

- Den klassiske ricochet, som er designet for å utføre operasjonen raskt ved å sende alle transaksjoner innenfor en kort tidsramme. Denne metoden tilbyr derfor mindre personvern og lavere motstand mot analyse enn den forbedrede metoden. Den bør kun brukes for hastende sendinger.

![BTC204](assets/notext/63/09.webp)

Ricochet innebærer ganske enkelt å sende bitcoins til seg selv. Det er fullt mulig å utføre en ricochet manuelt på hvilken som helst lommebokprogramvare, uten å bruke et spesialisert verktøy. Bare overfør den samme mynten til deg selv suksessivt, ved å bruke en ny blank adresse hver gang.

I det følgende kapittelet utforsker vi ulike teknikker for hemmelige eiendomsoverføringer. Disse metodene skiller seg radikalt fra de vi har undersøkt så langt, både med hensyn til drift og resultater.

https://planb.network/tutorials/privacy/on-chain/ricochet-e0bb1afe-becd-44a6-a940-88a463756589

## Hemmelige Eiendomsoverføringer

<chapterId>a2067036-849c-4d6b-87d2-44235cfae7a1</chapterId>

Blant personvernsteknikkene på Bitcoin finnes også hemmelig eiendomsoverføring. Denne metoden har som mål å overføre eierskapet av bitcoins fra én person til en annen, og omvendt, uten at denne transaksjonen er eksplisitt synlig på blokkjeden.

### CoinSwap

CoinSwap er basert på et relativt enkelt konsept: det bruker smarte kontrakter for å lette en overføring av bitcoin-eierskap mellom to brukere, uten behov for tillit og uten at denne overføringen er eksplisitt synlig på blokkjeden.

![BTC204](assets/notext/64/01.webp)
La oss forestille oss et forenklet eksempel med Alice og Bob. Alice eier 1 BTC sikret med den private nøkkelen $A$, og Bob eier også 1, sikret med den private nøkkelen $B$. Teoretisk kunne de utveksle sine private nøkler via en ekstern kommunikasjonskanal for å gjennomføre en hemmelig overføring.
![BTC204](assets/notext/64/02.webp)
Men, denne naive metoden presenterer en høy risiko i form av tillit. Ingenting hindrer Alice i å beholde en kopi av den private nøkkelen $A$ etter utvekslingen og bruke den senere for å stjele bitcoins, når nøkkelen er i Bobs besittelse.
![BTC204](assets/notext/64/03.webp)

I tillegg er det ingen garanti som hindrer Alice i å motta Bobs private nøkkel $B$ og aldri sende sin private nøkkel $A$ tilbake. Denne utvekslingen er derfor avhengig av overdreven tillit mellom partene og viser seg å være ineffektiv i å sikre en hemmelig overføring av eierskap på en sikker måte.

![BTC204](assets/notext/64/04.webp)

For å løse disse problemene og tillate utvekslinger mellom parter som ikke stoler på hverandre, kan vi i stedet bruke smartkontraktsystemer. En smartkontrakt er et program som automatisk utfører når forhåndsdefinerte betingelser er oppfylt, som i vårt tilfelle sikrer at overføringen av eierskap skjer automatisk uten å kreve gjensidig tillit.

For å gjøre dette, kan vi bruke HTLC (_Hash Time-Locked Contracts_) eller PTLC (_Point Time-Locked Contracts_). Disse to protokollene fungerer på lignende måter ved å bruke et tidsbegrensende system som garanterer at utvekslingen enten fullføres vellykket eller blir helt avbrutt, og beskytter dermed integriteten til begge parters midler. Hovedforskjellen mellom HTLCs og PTLCs er at HTLCs bruker hasher og preimages for å sikre transaksjonen, mens PTLCs bruker Adaptor Signatures.

I et coinswap-scenario som bruker en HTLC eller en PTLC mellom Alice og Bob, skjer utvekslingen sikkert: enten lykkes den, og hver mottar den andres BTC, eller den mislykkes, og hver beholder sin egen BTC. Det er dermed umulig for en av partene å jukse eller stjele BTC fra den andre.

> _HTLCs er også mekanismen som brukes for å rute betalinger sikkert gjennom de toveis kanalene til Lightning Network._

Bruken av Adaptor Signatures er spesielt interessant i denne sammenhengen, da det tillater å omgå tradisjonelle skript (dette er en mekanisme som noen ganger refereres til som "_scriptless scripts_"). Denne funksjonen bidrar til å redusere gebyrene forbundet med utvekslingen. En annen stor fordel med Adaptor Signatures er at de ikke krever bruk av en felles hash for begge partene i transaksjonen, og unngår dermed å avsløre en direkte kobling mellom dem i visse typer utvekslinger.

### Adaptor Signatures

Adaptor Signatures er en kryptografisk metode som integrerer en gyldig signatur med en ekstra signatur, kalt en "_adaptor signature_", for å avsløre et hemmelig stykke data. Denne mekanismen er utformet på en slik måte at å kjenne 2 av de følgende 3 elementene: den gyldige signaturen, adaptor signaturen, og hemmeligheten, tillater deduksjon av det manglende tredje elementet. En interessant egenskap ved denne metoden er at hvis vi kjenner vår motparts adaptor signatur og det spesifikke punktet på den elliptiske kurven assosiert med hemmeligheten brukt til å beregne denne adaptor signaturen, kan vi utlede vår egen adaptor signatur som vil være kompatibel med den samme hemmeligheten, uten å noensinne ha direkte tilgang til hemmeligheten selv.

I et coinswap bruker bruken av Adaptor Signatures muligheten for samtidig avsløring av to sensitive informasjonsstykker mellom deltakerne, og unngår dermed behovet for gjensidig tillit. La oss ta et eksempel for å illustrere denne prosessen med Alice og Bob, som ønsker å utveksle eierskapet av 1 BTC hver, men ikke stoler på hverandre. De bruker Adaptor Signatures for å eliminere behovet for tillit i denne utvekslingen. Her er hvordan de går frem:

- Alice initierer utvekslingen ved å opprette en transaksjon $m_A$ som sender 1 BTC til Bob. Hun genererer en signatur $s_A$, som validerer denne transaksjonen, ved å bruke sin private nøkkel $p_A$ ($P_A = p_A \cdot G$), en nonce $n_A$ ($N_A = n_A \cdot G$), og en hemmelighet $t$ ($T = t \cdot G$):
  $$s_A = n_A + t + H(N_A + T \parallel P_A \parallel m_A) \cdot p_A$$

- Alice beregner den tilpassede signaturen $s_A'$ ved å trekke fra hemmeligheten $t$ fra hennes ekte signatur $s_A$:

$$s_A' = s_A - t$$

- Alice sender til Bob hennes tilpassede signatur $s'_A$, hennes usignerte transaksjon $m_A$, punktet som tilsvarer hemmeligheten ($T$), og punktet som tilsvarer noncen ($N_A$). Disse elementene utgjør det som kalles en "_adaptor_". Det er viktig å merke seg at, med kun denne informasjonen, kan ikke Bob gjenopprette Alice's BTC.
- Imidlertid har Bob muligheten til å verifisere at Alice ikke prøver å stjele fra ham. For å gjøre dette, sjekker han om Alice's tilpassede signatur $s_A'$ faktisk tilsvarer den foreslåtte transaksjonen $m_A$. Hvis følgende ligning er korrekt, kan han da være sikker på at Alice's tilpassede signatur er gyldig:
  $$s_A' \cdot G = N_A + H(N_A + T \parallel P_A \parallel m_A) \cdot P_A$$

- Denne verifiseringen gir Bob tilstrekkelige garantier for å fortsette med utvekslingen med tillit. Han oppretter deretter sin egen transaksjon $m_B$, ment for å sende 1 BTC til Alice, og genererer sin tilpassede signatur $s_B'$, som også vil være knyttet til den samme hemmeligheten $t$. På dette tidspunktet kjenner kun Alice verdien av $t$; Bob kjenner kun det tilsvarende punktet $T$ som Alice har overført til ham:

$$s_B' = n_B + H(N_B + T \parallel P_B \parallel m_B) \cdot p_B$$

- Bob overfører til Alice sin tilpassede signatur $s_B'$, hans usignerte transaksjon $m_B$, samt punktet som tilsvarer hemmeligheten ($T$) og punktet som tilsvarer noncen ($N_B$). Alice, som kjenner hemmeligheten $t$, kan nå kombinere Bobs tilpassede signatur $s_B'$ med denne hemmeligheten for å generere en gyldig signatur $s_B$ for transaksjonen $m_B$ som vil overføre Bobs BTC til henne:

$$s_B = s_B' + t$$

$$(s_B' + t) \cdot G = N_B + T + H(N_B + T \parallel P_B \parallel m_B) \cdot P_B$$

- Alice kringkaster denne signerte transaksjonen $m_B$ på Bitcoin-blockchainen for å gjenopprette BTC-en som Bob lovet. Når Bob ser denne transaksjonen på blockchainen, kan han trekke ut signaturen $s_B = s_B' + t$. Med denne informasjonen, er Bob da i stand til å isolere den berømte hemmeligheten $t$ han trengte:

$$t = (s_B' + t) - s_B' = s_B - s_B'$$

- Og faktisk, denne hemmeligheten $t$ var det eneste manglende elementet for Bob for å generere den gyldige signaturen $s_A$ fra Alice's tilpassede signatur $s_A'$. Denne signaturen tillater validering av transaksjonen $m_A$ som sender en BTC fra Alice til Bob. Bob beregner deretter $s_A$ og kringkaster i sin tur transaksjonen $m_A$ på blockchainen:

$$s_A = s_A' + t$$
$$ (s_A' + t) \cdot G = N_A + T + H(N_A + T \parallel P_A \parallel m_A) \cdot P_A $$
La oss oppsummere hvordan en Adaptor Signature fungerer i en coinswap. I utgangspunktet sender Alice Bob en usignert transaksjon sammen med en adaptor, som lar Bob verifisere at hemmeligheten som avsløres senere vil gi ham tilgang til bitcoinene. Som svar sender Bob Alice sin egen usignerte transaksjon og hans adaptor. Alice kan deretter fullføre Bobs transaksjon og gjenvinne bitcoinene ved å kringkaste en gyldig transaksjon ved bruk av hemmeligheten. Når denne transaksjonen publiseres på blockchain, har Bob muligheten til å trekke ut hemmeligheten og dermed låse opp Alices transaksjon. Følgelig, hvis Alice initierer en overføring av Bobs bitcoin, kan han i sin tur få tilgang til Alices bitcoin uten å kreve gjensidig tillit.
Det er verdt å merke seg at coinswaps først ble foreslått av [Gregory Maxwell i oktober 2013 på BitcoinTalk](https://bitcointalk.org/index.php?topic=321228.0).

### The Atomic Swap

Likt som coinswap og ved bruk av samme typer smartkontrakter, er det også mulig å utføre atomic swaps. En atomic swap tillater en direkte utveksling av forskjellige kryptovalutaer, som BTC og XMR, mellom to brukere uten å kreve tillit eller inngripen fra en mellommann. Disse utvekslingene kalles "atomiske" fordi de kun har to mulige utfall: enten er utvekslingen vellykket og begge parter er fornøyde, eller den mislykkes og hver beholder sine opprinnelige kryptovalutaer, og eliminerer dermed behovet for tillit til den andre parten.

![BTC204](assets/notext/64/05.webp)

Atomic swap og coinswap deler en lignende driftsmetode og tilbyr de samme fordelene og ulempene når det gjelder personvern. Faktisk, fra perspektivet til Bitcoin, er en atomic swap sammenlignbar med en coinswap utført i to trinn. Først bytter vi våre BTC for en annen kryptovaluta, og deretter kan denne kryptovalutaen byttes for andre BTC. Til slutt gjenvinner vi BTC av en annen bruker. Dette er grunnen til at jeg i analysen av personvernproblemer grupperer disse to protokollene under kategorien hemmelige eierskapsutvekslinger.

![BTC204](assets/notext/64/06.webp)

Imidlertid, i motsetning til coinswap, kan atomic swap ha ubalanser når det gjelder tilgjengelig likviditet, spesielt i BTC/XMR-utvekslinger. Det er generelt lettere å bytte bitcoins for altcoins, ettersom det er høy etterspørsel etter bitcoins, noe som holder premiene lave for denne retningen av konvertering. Men å bytte altcoins for å få BTC kan være mer komplekst på grunn av lavere etterspørsel, ofte resulterer i veldig høye premier.

Til slutt, når en atomisk utveksling involverer onchain bitcoins og bitcoins på Lightning-nettverket, refererer vi da til det som en "_submarine swap_".

### Er Det Virkelig Nyttig?

Hemmelige eiendomsoverføringer, som coinswaps og atomic swaps, har fordelen av å lure kjedeanalyseheuristikker. Disse metodene kan gi inntrykk av at transaksjoner involverer samme bruker, selv om det faktiske eierskapet har skiftet hender. Imidlertid er hovedulempen med disse metodene at de er veldig risikable uten bruk av en ekstra teknikk for å bryte myntens historie.

Faktisk, når Alice utfører en coinswap eller en atomic swap med Bob, bytter hun eierskapet til sine bitcoins med Bobs. I tilfellet med en atomic swap inkluderer utvekslingen en altcoin, men prinsippet forblir det samme. Således ender Alice opp med mynt $B$ og Bob med mynt $A$. Dette legger tvil i kjedeanalyse, men historikken til myntene forblir sporbar. Hvis en analytiker undersøker mynt $A$, kan de spore tilbake til Alices tidligere aktiviteter, og omvendt for mynt $B$.
Fra Alice sitt perspektiv er risikoen at historikken til mynt $B$ kan anses som mistenkelig av visse enheter. Hvis for eksempel Bob hadde skaffet seg mynt $B$ gjennom en kriminell handling som hacking, ville denne mynten forbli knyttet til hans ulovlige aktiviteter. Alice kunne da finne seg selv i besittelse av en mynt som hun ikke kunne overføre på regulerte utvekslingsplattformer uten å risikere å få midlene sine frosset, eller til og med bli anklaget for Bobs forbrytelser, selv om hun ikke hadde noe med dem å gjøre.

Og selvfølgelig er privatlivsmetoder som coinswap eller atomic swap favorisert av kriminelle hvis midler overvåkes av myndighetene. Disse protokollene gir dem muligheten til å kvitte seg med deres overvåkede bitcoins i bytte mot perfekt fungible bitcoins. Dette lar dem også skape en avledning, og dirigere myndighetene mot andre brukere. Det er dermed en dobbel nytte for disse individene.

Med coinjoin, selv om din mynt er blandet med overvåkede bitcoins, er myntens historikk brutt, noe som gir en form for plausibel benektelse som ikke eksisterer i hemmelige eiendomsoverføringsprotokoller som coinswap eller atomic swap.

Hvis Alice ønsker å unngå enhver risiko, må hun nødvendigvis bruke en metode for å bryte historikken til mynt $B$, som for eksempel å kjøre den gjennom coinjoins. Dette reiser et spørsmål om nytten av å kombinere hemmelig overføring av eierskap og coinjoin. Coinjoin, ved å bryte historikken til en mynt, gir allerede et tilstrekkelig nivå av privatliv for Alice. Dermed er min mening at hvis Alice ser etter å beskytte sitt privatliv, ville det være mer forsiktig å gå direkte med en coinjoin i stedet for å engasjere seg i en coinswap etterfulgt av en coinjoin.
For at metodene for hemmelig eierskapsoverføring skal være virkelig effektive og unngå risikoen for å koble historikken til en bruker $A$ til en bruker $B$, ville det paradoksalt nok være nødvendig at deres bruk var allment kjent. Hvis coinswap brukes massivt og myndighetene er klar over denne vanlige praksisen, da kunne en form for plausibel benektelse etableres. Imidlertid, så lenge bruken av disse overføringene forblir marginal, tror jeg disse metodene vil forbli for risikable for brukere.

Så langt har vi hovedsakelig studert privatlivsmetoder på transaksjonsnivået selv. I neste kapittel vil vi utforske problemene på nettverksnivået og spredningen av transaksjoner.

## Personvern på P2P-nettverket

<chapterId>04a2467b-db84-4076-a9ff-919be5135106</chapterId>

I del 4 diskuterte vi viktigheten av å bruke en full node for å beskytte privatlivet til transaksjonene dine. Det er imidlertid viktig å forstå at noden din selv kan være utsatt for angrep som søker å trekke ut informasjon om dine aktiviteter. I dette kapittelet vil vi derfor undersøke de forskjellige personvernbeskyttelsestiltakene, ikke på nivået av transaksjonene selv eller flytene av bitcoins, men på nettverksnivået.

### Dandelion

En måte å unngå ulike de-anonymiseringsangrep på er å bruke Dandelion-forslaget. Denne kringkastingsprotokollen ble formalisert i BIP156, men den har aldri blitt implementert på Bitcoin.

Ideen med Dandelion er å forbedre personvernet for transaksjonsruting i Bitcoin-nettverket for å motvirke ulike former for angrep. Hovedmålet er å skjule kildenoden som opprinnelig kringkastet en transaksjon på nettverket. Avsløringen av denne noden kunne koble en Bitcoin-transaksjon til en spesifikk IP-adresse (hvis noden opererer på clearnet), noe som kunne gi et inngangspunkt for kjedeanalyse.
Denne assosiasjonen mellom en aktivitet på Bitcoin og en IP-adresse representerer en betydelig risiko for brukerens personvern. Faktisk kan mange enheter enkelt koble en IP-adresse til en personlig identitet. Dette inkluderer spesielt regjeringer og internettleverandører. Videre kan denne informasjonen bli offentlig tilgjengelig, for eksempel hvis din IP-adresse og personlige data blir eksponert på grunn av en lekkasje under hackingen av en nettsidedatabase. I standard drift av Bitcoin, blir transaksjoner konstruert av en bruker på deres lommebokprogramvare overført til deres personlige node. Denne noden sender umiddelbart den nye transaksjonen til alle de tilkoblede peerne.

![BTC204](assets/notext/65/01.webp)

Disse peerne verifiserer deretter transaksjonen for å sikre at den overholder konsensusreglene og lokale standardiseringsregler. Når den er validert, sender hver peer i sin tur transaksjonen til sine egne peers, og så videre.

![BTC204](assets/notext/65/02.webp)

Distribusjonen av transaksjoner som venter på integrering i en blokk, gjøres på en ganske balansert og statistisk forutsigbar måte. Denne sårbarheten kan utnyttes av sammensvergede spionnoder, som samarbeider for å overvåke og analysere nettverket, for å identifisere den første noden som har kringkastet en transaksjon. Hvis en observatør klarer å lokalisere kildenoden, kan de anta at transaksjonen stammer fra operatøren av den noden. Denne typen observasjon kan koble transaksjoner, som normalt er anonyme, til spesifikke IP-adresser.

![BTC204](assets/notext/65/03.webp)

Målet med BIP156 er å adressere dette problemet. For å gjøre dette, introduserer det en ekstra fase i kringkastingen av en ny transaksjon for å bevare anonymitet før utbredt offentlig spredning. Dandelion bruker først en "stilk"-fase der transaksjonen sendes gjennom en tilfeldig sti av noder.

![BTC204](assets/notext/65/04.webp)

Transaksjonen blir deretter kringkastet til hele nettverket i "fnugg"-fasen.

![BTC204](assets/notext/65/05.webp)

Stilk og fnugg er referanser til oppførselen til transaksjonens spredning gjennom nettverket, som ligner formen på en løvetann.

Dermed kan spionnoder potensielt spore transaksjonen tilbake til noden som initierte fnugg-fasen (den massive kringkastingen), men denne noden er ikke den som først kringkastet transaksjonen, da den mottok den fra den siste noden i stilken. Hvis spionnoder ikke kan spore tilbake opp stilken, kan de heller ikke identifisere kildenoden.

![BTC204](assets/notext/65/06.webp)
Selv i nærvær av spionnoder under stilk-fasen, forblir tvil alltid fordi så snart de møter en ærlig node i diffusjonsgrafikken, kan spionene ikke bestemme om denne noden er den opprinnelige kilden eller bare en mellommann.
![BTC204](assets/notext/65/07.webp)

Denne ruteringsmetoden slører sporet som leder til kildenoden, noe som gjør det vanskelig å spore en transaksjon gjennom nettverket tilbake til sin opprinnelse. Dandelion forbedrer dermed personvern ved å begrense motstandernes evne til å deanonymisere nettverket. Denne metoden er enda mer effektiv når transaksjonen krysser under "stilk"-fasen en node som krypterer sine nettverkskommunikasjoner, som med Tor eller P2P Transport V2.
BIP156 har ikke blitt integrert i Bitcoin Core og er for øyeblikket klassifisert under statusen "avvist". En av de viktigste bekymringene rundt dette protokollet ligger i det faktum at, under stegfasen, må transaksjoner videresendes av mellomliggende noder før de blir verifisert. Som vi har sett, i den normale modellen av Bitcoin, verifiserer hver node først transaksjonen før den kringkaster den til sine jevnaldrende. Hvis en transaksjon ikke overholder konsensusreglene eller nodens lokale standardiseringsregler, ignorerer den og kringkaster den ikke. Denne prosessen er viktig for å motvirke DoS-angrep, ettersom kun gyldige transaksjoner blir kringkastet til hele nettverket. Ugyldige transaksjoner, potensielt generert i masse for å overbelaste nettverket, stoppes ved den første noden de møter og sprer seg ikke. Den største risikoen med Dandelion er at dette nye protokollet kunne introdusere nye vektorer for DoS-angrep ved å tillate kringkasting av ugyldige transaksjoner gjennom deler av nettverket.

### P2P Transport V2

P2P Transport V2 er et annet nettverksprotokoll presentert i BIP324. Det er en ny versjon av Bitcoin P2P transportprotokollen som inkorporerer opportunistisk kryptering for å forbedre konfidensialiteten og sikkerheten til kommunikasjonen mellom noder.

Denne forbedringen sikter mot å løse flere problemer med den grunnleggende versjonen av P2P-protokollen. På den ene siden gjør den dataene som utveksles ugjenkjennelige fra andre typer data som sirkulerer på Internett for en passiv observatør. Hovedmålet er å forhindre at regjeringer, internettleverandører eller VPN-leverandører massivt overvåker Bitcoin-brukere. Dette kompliserer også oppgaven for disse enhetene med å bestemme om en internettbruker også er en Bitcoin-bruker, det vil si om de opererer en full node.
P2P V2 bidrar også til å redusere risikoen for sensur og angrep gjennom deteksjon av spesifikke mønstre i datapakker. Det kompliserer og gjør utførelsen av ulike typer Sybil-angrep dyrere på nettverksnivå. Et Sybil-angrep forekommer når en aktør skaper flere falske identiteter for å oppnå en urettmessig fordel. I konteksten av Bitcoin-nettverket manifesterer dette seg ofte som en aktør som kontrollerer et stort antall fullnoder og bruker dem aggressivt for å multiplisere tilkoblinger. Sybil-angrep kan være passive, med mål om å samle informasjon og kompromittere brukerkonfidensialitet, eller aktive, i form av Eclipse-angrep. Sistnevnte isolerer en spesifikk node fra resten av nettverket, noe som enten tillater å sensurere brukeren eller å endre dataene de mottar. Til slutt gjør P2P V2 også _Man-In-The-Middle_ (MITM) angrep dyrere og lettere å oppdage.
Krypteringen implementert av P2P V2 inkluderer ikke autentisering for ikke å legge til unødvendig kompleksitet, og for ikke å kompromittere den tillatelsesløse naturen til nettverkstilkobling. Denne nye P2P transportprotokollen tilbyr likevel bedre sikkerhet mot passive angrep og gjør aktive angrep betydelig dyrere og mer oppdagbare. Introduksjonen av en pseudo-tilfeldig datastrøm i nettverksmeldinger kompliserer oppgaven for angripere som ønsker å sensurere eller manipulere kommunikasjon.

P2P V2 transport ble inkludert som et alternativ (deaktivert som standard) i versjon 26.0 av Bitcoin Core, utplassert i desember 2023. Den ble deretter aktivert som standard i versjon 27.0 i april 2024. Den kan modifiseres med `v2transport=`-alternativet i konfigurasjonsfilen.

### Tor

En annen relativt enkel løsning for å unngå risikoen for tap av konfidensialitet for en node på nettverksnivå er å kjøre den helt under Tor.
Tor er et nettverk av reléservere (noder) som anonymiserer opprinnelsen til TCP-tilkoblinger på internett. Det fungerer ved å kapsle inn data i flere lag med kryptering. Hver relén node fjerner et lag for å avsløre adressen til neste node, inntil den når den endelige destinasjonen. Tor-nettverket sikrer anonymitet ved å forhindre at mellomliggende noder kjenner både opprinnelsen og destinasjonen til dataene, noe som gjør det svært vanskelig for en observatør å spore brukerens aktivitet.
![BTC204](assets/notext/65/08.webp)
Tor krypterer derfor ikke bare dataene som kommuniseres, men tillater også maskering av opprinnelsen og destinasjonen til kommunikasjonen. Ved å bruke Tor for kommunikasjonen til vår personlige node, forbedrer vi personvernet til transaksjonene våre: Internettleverandøren (ISP) kan ikke dekryptere kommunikasjonen, og andre noder i Bitcoin-nettverket kan ikke identifisere IP-adressen til kildenoden. Dessuten skjuler Tor også bruken din av Bitcoin fra din ISP.

Den største risikoen forbundet med denne metoden er at Tor er et protokoll uavhengig av Bitcoin. Hvis du har en Bitcoin-node under Tor og Tor slutter å fungere, vil din Bitcoin-node ikke lenger kunne kommunisere.

Det er også viktig å merke seg at kommunikasjon over Tor er tregere. Denne latenstiden er spesielt plagsom under den første oppstarten av en node, ettersom den første blokknedlastingen (IBD) krever mye kommunikasjon. Som et resultat kan din første synkronisering med Bitcoin-nettverket ta betydelig lengre tid ved bruk av Tor. Det er også mulig å utføre IBD på clearnet, for deretter å aktivere Tor senere. Selv om denne metoden avslører eksistensen av din Bitcoin-node for din ISP, beskytter den informasjonen relatert til dine personlige transaksjoner når du bytter til Tor.

Etter å ha utforsket de forskjellige nettverksnivå personvernmetodene, ønsker jeg også å introdusere i de kommende kapitlene to elegante løsninger for å unngå adressebruk på nytt: BIP47 og Silent Payments.

## BIP47 og Gjenbrukbare Betalingskoder

<chapterId>ad88e076-a04b-4aec-b3b2-7b4760175504</chapterId>

Som vi så i del 3, utgjør adressebruk på nytt en alvorlig hindring for brukerens personvern i Bitcoin-protokollen. For å redusere disse risikoene, anbefales det sterkt å generere en ny mottaksadresse for hver ny betaling mottatt i en lommebok. Selv om generering av en ny adresse i dag er forenklet ved bruk av moderne programvare og hierarkiske deterministiske lommebøker, kan denne praksisen virke motintuitiv.

![BTC204](assets/notext/66/1.webp)

I det tradisjonelle banksystemet, for eksempel, er vi vant til å dele vår IBAN, som alltid forblir den samme. Når den er kommunisert til noen, kan de sende oss flere betalinger uten å måtte samhandle med oss igjen. Neo-banker tilbyr også mer moderne muligheter som bruk av unike e-postadresser på PayPal eller RevTags på Revolut. Selv utenfor det finansielle domenet, er våre daglige identifikatorer som vår postadresse, telefonnummer og e-postadresse også unike og permanente. Vi trenger ikke å fornye dem med hver ny interaksjon.

![BTC204](assets/notext/66/2.webp)
Men, driften av Bitcoin er annerledes: det er avgjørende å generere en ny mottaksadresse for hver innkommende transaksjon. Dette kompromisset mellom brukervennlighet og personvern går tilbake til selve opprinnelsen til Bitcoin White Paper. Fra publiseringen av den første versjonen av hans dokument i slutten av 2008, advarte Satoshi Nakamoto oss allerede om denne risikoen:
**"_Som en ekstra brannmur, kunne et nytt par med nøkler brukes for hver transaksjon for å holde dem ulinket til en felles eier._"**
Det finnes mange metoder for å motta flere betalinger til en enkelt identifikator uten å forårsake adressebruk på nytt. Hver har sine egne kompromisser og ulemper. Blant disse metodene er BIP47, et forslag utviklet av Justus Ranvier og publisert i 2015. Dette forslaget har som mål å skape gjenbrukbare betalingskoder som tillater flere transaksjoner til samme person samtidig som det unngås adressebruk på nytt. I sin essens søker BIP47 å tilby et betalingssystem like intuitivt som en unik identifikator, samtidig som det bevarer transaksjonenes privatliv.
![BTC204](assets/notext/66/3.webp)

BIP47 forbedrer ikke direkte brukerens privatliv, ettersom en BIP47-betaling tilbyr samme nivå av privatliv som en klassisk Bitcoin-transaksjon som bruker ferske adresser. Imidlertid gjør det bruken av Bitcoin mer praktisk og intuitiv, en enkelhet som normalt sett skulle kompromittere privatlivet. Takket være BIP47 oppnår denne brukervennligheten samme nivå av privatliv som en klassisk transaksjon. Dette er grunnen til at BIP47 er et verdifullt verktøy for bevaring av privatliv.

Opprinnelig var BIP47 et forslag formulert for å bli integrert i Bitcoin Core, men det ble aldri adoptert. Noen programvarer har likevel valgt å implementere det på egen hånd på applikasjonsnivå. Dermed har teamene hos Samourai Wallet utviklet sin egen implementering av BIP47 kalt "PayNym".

### Generelt Prinsipp for BIP47 og PayNym

Målet med BIP47 er å tillate mottak av mange betalinger uten å forårsake adressebruk på nytt. Det stoler på bruken av en gjenbrukbar betalingskode, som lar forskjellige avsendere sende flere betalinger til en enkelt kode som tilhører en annen bruker. Dermed trenger ikke mottakeren å oppgi en ny fersk adresse for hver transaksjon, noe som i stor grad letter deres utvekslinger samtidig som det bevarer deres privatliv.

![BTC204](assets/en/66/4.webp)

En bruker kan derfor dele sin betalingskode fritt, enten på sosiale nettverk eller på sin nettside, uten å risikere å miste privatliv, i motsetning til hva som ville skje med en klassisk mottaksadresse eller en offentlig nøkkel.
For å gjennomføre en transaksjon må begge parter ha en Bitcoin-lommebok med en implementering av BIP47, som PayNym på Samourai Wallet eller Sparrow Wallet. Den felles bruken av deres betalingskoder skaper en hemmelig kanal mellom dem. For å etablere denne kanalen effektivt, må avsenderen utføre en spesifikk transaksjon på Bitcoin-blockchainen, kjent som en "varslingstransaksjon" (jeg vil gi deg flere detaljer om dette senere).

Kombinasjonen av betalingskodene til begge brukerne genererer delte hemmeligheter, som igjen tillater opprettelsen av et stort antall unike Bitcoin mottaksadresser (nøyaktig 2^32, eller omtrent 4 milliarder). Dermed er betalinger gjort via BIP47 faktisk ikke adressert til betalingskoden i seg selv, men heller til klassiske mottaksadresser avledet fra betalingskodene til de involverte brukerne.

Betalingskoden fungerer dermed som en virtuell identifikator avledet fra lommebokens frø. I den hierarkiske avledningsstrukturen til lommeboken, er betalingskoden plassert på nivå 3, det vil si på kontonivå.

![BTC204](assets/en/66/5.webp)

Avledningsmålet for BIP47 er identifisert av indeksen `47'` (`0x8000002F`), som refererer til BIP47. Et eksempel på en avledningssti for en gjenbrukbar betalingskode ville være som følger:

```plaintext
m/47'/0'/0'/
```

For å gi deg en ide om hvordan en betalingskode ser ut, her er min:

````plaintext
Denne koden kan også kodes inn i en QR-kode, for å lette kommunikasjonen, akkurat som en klassisk mottaksadresse.

Når det gjelder PayNym Bots, disse robotene som noen ganger ses på Twitter, er de visuelle representasjoner av betalingskoden, skapt av Samourai Wallet. De genereres via en hashing-funksjon, som gir dem nesten unikhet. De vises i form av en liten streng med tegn som starter med `+`:
```plaintext
+throbbingpond8B1
+twilightresonance487
+billowingfire340
````

Disse avatarer kan også representeres i form av bilder:

![BTC204](assets/notext/66/6.webp)

Selv om disse robotene ikke har en spesifikk teknisk funksjonalitet innenfor rammen av BIP47, spiller de en rolle i å lette interaksjoner mellom brukere ved å tilby en lett gjenkjennelig visuell identitet.

---
*I de følgende delene av dette kapittelet viet til BIP47, vil vi undersøke hvordan det fungerer i detalj, med spesielt fokus på de kryptografiske metodene som brukes. For å forstå disse noe tekniske forklaringene fullt ut, er det viktig først å forstå strukturen til HD-lommebøker, nøkkelavledningsprosesser og de grunnleggende prinsippene for elliptisk kurve-kryptografi. Hvis du ønsker å fordype deg i disse konseptene, er et annet gratis kurs tilgjengelig på Plan ₿ Network:*

https://planb.network/courses/cyp201

*Jeg anbefaler på det sterkeste å ta kurset, fordi forståelse av den tekniske funksjonen til BIP47 vil gjøre det mye enklere å forstå andre lignende forslag vi vil diskutere i de følgende kapitlene.*

---


### Gjenbrukbar Betalingskode

Som nevnt tidligere, er den gjenbrukbare betalingskoden lokalisert på dybde 3 av HD-lommeboken, noe som gjør den sammenlignbar med en `xpub`, både i sin posisjon innenfor lommebokstrukturen og i sin rolle.

Den 80-byte store betalingskoden brytes ned som følger:

- **Byte `0`: Versjonen**. For den første versjonen av BIP47, er denne byten satt til `0x01`;
- **Byte `1`: Bitfeltet**. Dette området er reservert for å integrere ytterligere indikasjoner under spesifikke bruksområder. For standard bruk med PayNym, er denne byten definert som `0x00`;
- **Byte `2`: `y`-pariteten**. Denne byten er `0x02` eller `0x03`, som indikerer om den offentlige nøkkelens ordinat er jevn eller odde, ettersom en komprimert offentlig nøkkel brukes;
- **Fra byte `3` til byte `34`: `x`-verdien**. Disse bytene representerer abscissaen til den offentlige nøkkelen. Sammenslåingen av `x` og `y`-pariteten former den komplette komprimerte offentlige nøkkelen;
- **Fra byte `35` til byte `66`: Kjedekoden**. Dette området inneholder kjedekoden assosiert med den offentlige nøkkelen;
- **Fra byte `67` til byte `79`: Polstringen**. Dette området er ment for mulige fremtidige utviklinger. For den nåværende versjonen, er nuller enkelt plassert her for å nå den nødvendige 80-byte størrelsen for en `OP_RETURN`-utgang.

Her er den heksadesimale representasjonen av min gjenbrukbare betalingskode allerede presentert i det forrige avsnittet:

````plaintext
0x010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000

![BTC204](assets/en/66/7.webp)

Først er det også nødvendig å legge til prefiksbyte `P` i begynnelsen for å tydelig indikere at det er en betalingskode. Dette bytet representeres av `0x47`:
```plaintext
0x47010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000
````

Til slutt, for å sikre integriteten til betalingskoden, utføres en sjekksumberegning ved hjelp av `HASH256`, som består av en dobbel hashing med `SHA256`-funksjonen. De første fire bytene som resulterer fra denne hashen blir deretter konkatenert til slutten av betalingskoden:

```plaintext
0x47010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000567080c4
```

![BTC204](assets/en/66/8.webp)

Når disse trinnene er fullført, er betalingskoden klar. Det eneste som gjenstår er å konvertere den til base 58 for å få dens endelige versjon:

```plaintext
PM8TJSBiQmNQDwTogMAbyqJe2PE2kQXjtgh88MRTxsrnHC8zpEtJ8j7Aj628oUFk8X6P5rJ7P5qDudE4Hwq9JXSRzGcZJbdJAjM9oVQ1UKU5j2nr7VR5
```

I løpet av denne prosessen med å lage betalingskode, bruker vi en komprimert offentlig nøkkel og en kjedekode. Begge er avledet fra en deterministisk og hierarkisk avledning fra lommebokens frø. Avledningsstien som brukes for å oppnå dette er:

```plaintext
m/47'/0'/0'/
```

For å generere den komprimerte offentlige nøkkelen og den tilhørende kjedekoden for den gjenbrukbare betalingskoden, starter vi med å beregne hovedprivatnøkkelen fra lommebokens frø. Deretter fortsetter vi med å avlede et par barnenøkler ved hjelp av indeksen `47 + 2^31` (hardened derivation). Dette trinnet følges av to flere påfølgende avledninger av barnepar, hver ved hjelp av indeksen `2^31` (hardened derivation).
![BTC204](assets/notext/66/9.webp)

### Den elliptiske kurve Diffie-Hellman (ECDH) nøkkelutvekslingen

Kryptografiprotokollen i hjertet av BIP47 refereres til ved akronymet ECDH, for _Elliptic-Curve Diffie-Hellman_. Denne metoden er en variant av den opprinnelige Diffie-Hellman nøkkelutvekslingen.
Introdusert i 1976, er Diffie-Hellman en nøkkelavtaleprotokoll som lar to parter, hver utstyrt med et par nøkler (offentlig og privat), bli enige om et felles hemmelig, selv mens de kommuniserer utelukkende over en offentlig og usikker kanal.

![BTC204](assets/en/66/10.webp)

Dette felles hemmelige (her, den blå nøkkelen), kan deretter brukes til andre operasjoner. Typisk kan dette delte hemmelige brukes til å kryptere og dekryptere kommunikasjon over et usikkert nettverk:

![BTC204](assets/notext/66/11.webp)

For å oppnå denne utvekslingen, bruker Diffie-Hellman modulær aritmetikk for å beregne det delte hemmelige. Her er en forenklet forklaring på hvordan det fungerer:

- Alice og Bob blir enige om en felles farge, her gul, som utgjør offentlige data (angripere kjenner denne fargen);
- Alice velger en hemmelig farge, her rød, og blander de to for å oppnå oransje;
- Bob velger også en hemmelig farge, her blå, og blander den med den gule for å oppnå grønn;
- De utveksler deretter de oppnådde fargene, oransje og grønn. Denne utvekslingen kan finne sted over et usikkert og observert nettverk;
- Ved å blande Bobs grønne med sin egen hemmelige farge, produserer Alice brun;
- Bob, som gjør det samme med Alices oransje og hans hemmelige blå, oppnår også brun.

![BTC204](assets/en/66/12.webp)

I denne forenklingen representerer den brune fargen det delte hemmelige mellom Alice og Bob. Det er viktig å forstå at, i virkeligheten, er det umulig for angriperen å skille de oransje og grønne fargene for å oppdage de hemmelige fargene til Alice eller Bob.

Nå, la oss undersøke hvordan denne protokollen faktisk fungerer, ikke med fargeanalogier, men ved å bruke ekte tall og modulær aritmetikk!
Før vi diskuterer Diffie-Hellman-mekanismene, la meg kort minne deg på to essensielle matematiske konsepter som vi vil trenge:

- Et **primtall** er et naturlig tall som kun har to divisorer: $1$ og seg selv. For eksempel, $7$ er et primtall fordi det kun kan deles av $1$ og $7$. På den andre siden, er $8$ ikke et primtall siden det kan deles av $1$, $2$, $4$, og $8$. Derfor har det fire positive heltallsdivisorer i stedet for to;
- **Modulo** (betegnet $mod$ eller $\%$) er en matematisk operasjon som, mellom to heltall, returnerer resten av den euklidiske divisjonen av det første med det andre. For eksempel, $16 \bmod 5 = 1$.

**Diffie-Hellman nøkkelutvekslingen mellom Alice og Bob foregår som følger:**

- Alice og Bob blir enige om to felles tall: $p$ og $g$. $p$ er et primtall, og jo større dette tallet er, desto sikrere vil Diffie-Hellman være. $g$ er en primitiv rot av $p$. Disse to tallene kan kommuniseres åpent over et usikret nettverk. De representerer tilsvarende **den gule fargen** i den tidligere forenklingen. Det er derfor viktig at Alice og Bob bruker nøyaktig de samme verdiene for $p$ og $g$.
- Når disse parameterne er definert, velger Alice og Bob hver sitt hemmelige tilfeldige tall. Alice kaller sitt hemmelige tilfeldige tall $a$ (tilsvarende **fargen rød**) og Bob kaller sitt $b$ (tilsvarende **fargen blå**). Disse tallene må forbli strengt konfidensielle.
- I stedet for å direkte utveksle tallene $a$ og $b$, beregner hver part $A$ og $B$ som følger:

$A$ er lik $g$ opphøyd i potensen av $a$ modulo $p$:

$$
A = g^a \bmod p
$$

$B$ er lik $g$ opphøyd i potensen av $b$ modulo $p$:

$$
B = g^b \bmod p
$$

- Verdiene $A$ (tilsvarende **fargen oransje**) og $B$ (tilsvarende **fargen grønn**) utveksles mellom de to partene. Denne utvekslingen kan finne sted åpent over et usikret nettverk;

- Alice, etter å ha mottatt $B$, beregner verdien av $z$ som følger:

$z$ er lik $B$ opphøyd i potensen av $a$ modulo $p$:

$$
z = B^a \bmod p
$$

For å minne om:

$$
B = g^b \bmod p
$$

Dermed får vi:

$$
z = B^a \bmod p
$$

$$
z = (g^b)^a \bmod p
$$

Ved å anvende reglene for eksponenter:

$$
(x^n)^m = x^{nm}
$$

Da får vi:

$$
z = g^{ba} \bmod p
$$

- På sin side, Bob, etter å ha mottatt $A$, beregner også verdien av $z$ på følgende måte:

$z$ er lik $A$ opphøyd i potensen av $b$ modulo $p$:

$$
z = A^b \bmod p
$$

Dermed får vi:

$$
z = (g^a)^b \bmod p
$$

$$
z = g^{ab} \bmod p
$$

$$
z = g^{ba} \bmod p
$$

Takket være distributiviteten til modulo-operatøren, oppnår Alice og Bob nøyaktig samme verdi $z$. Dette tallet representerer deres felles hemmelighet, tilsvarende **den brune fargen** i den tidligere forenklingen med malingkrukkene. De kan nå bruke denne felles hemmeligheten til å kryptere deres kommunikasjon symmetrisk over et usikret nettverk.

![BTC204](assets/notext/66/13.webp)

En angriper, selv i besittelse av $p$, $g$, $A$, og $B$ (de offentlige verdiene), vil ikke kunne beregne $a$, $b$, eller $z$ (de private verdiene). For å oppnå dette, måtte man reversere eksponentieringen, en operasjon umulig uten å prøve alle muligheter en etter en, da det tilsvarer å beregne den diskrete logaritmen, det vil si inversen av eksponentialen i en endelig syklisk gruppe.

Så lenge verdiene av $a$, $b$, og $p$ er tilstrekkelig store, er Diffie-Hellman-protokollen sikker. Typisk, med 2048-bits parametere (et tall med 600 sifre i desimal), ville testing av alle muligheter for $a$ og $b$ være upraktisk. Til denne dag, med slike tall, anses denne algoritmen som sikker.
Dette er nettopp hvor hovedulempen med Diffie-Hellman-protokollen ligger. For å være sikker, må algoritmen bruke store tall. Derfor foretrekkes nå ECDH-algoritmen (_Elliptic Curve Diffie-Hellman_), en variant av Diffie-Hellman som støtter seg på en algebraisk kurve, mer presist en elliptisk kurve. Denne tilnærmingen tillater arbeid med mye mindre tall samtidig som man opprettholder tilsvarende sikkerhet, og dermed reduserer ressursene som trengs for beregning og lagring.
Det generelle prinsippet for algoritmen forblir det samme. Imidlertid, i stedet for å bruke et tilfeldig tall $a$ og et tall $A$ beregnet fra $a$ ved modulær eksponentiering, bruker vi et par nøkler etablert på en elliptisk kurve. I stedet for å stole på distributiviteten av modulo-operatøren, bruker vi gruppeloven på elliptiske kurver, og mer spesifikt assosiativiteten av denne loven.
For å kort forklare prinsippet for kryptografi med elliptiske kurver, representeres en privat nøkkel av et tilfeldig tall mellom $1$ og $n-1$, hvor $n$ representerer ordenen til kurven. Den offentlige nøkkelen, derimot, er et spesifikt punkt på denne kurven, oppnådd fra den private nøkkelen gjennom operasjoner av punktaddisjon og dobling startende fra generatorpunktet, i henhold til ligningen:

$$
K = k \cdot G
$$

I denne formelen betegner $K$ den offentlige nøkkelen, $k$ den private nøkkelen, og $G$ generatorpunktet.

En av de essensielle karakteristikkene til disse nøklene er enkelheten av å beregne $K$ fra $k$ og $G$, mens det er praktisk talt umulig å finne $k$ fra $K$ og $G$. Denne asymmetrien skaper en enveisfunksjon. Med andre ord, det er enkelt å beregne den offentlige nøkkelen hvis man kjenner den private nøkkelen, men å finne den private nøkkelen fra den offentlige nøkkelen er umulig. Denne sikkerheten er fortsatt basert på den beregningsmessige vanskeligheten av den diskrete logaritmen.

Vi vil bruke denne egenskapen til å tilpasse vår Diffie-Hellman-algoritme. **Driftsprinsippet for ECDH er som følger:**

- Alice og Bob blir enige sammen om en kryptografisk sikker elliptisk kurve og dens parametere. Denne informasjonen er offentlig;

- Alice genererer et tilfeldig tall $ka$ som vil være hennes private nøkkel. Denne private nøkkelen må forbli hemmelig. Hun bestemmer sin offentlige nøkkel $Ka$ ved addisjon og dobling av punkter på den valgte elliptiske kurven:

$$
K_a = k_a \cdot G
$$

- Bob genererer også et tilfeldig tall $kb$ som vil være hans private nøkkel. Han beregner den tilknyttede offentlige nøkkelen $Kb$:

$$
K_b = k_b \cdot G
$$

- Alice og Bob utveksler sine offentlige nøkler $Ka$ og $Kb$ over et usikret offentlig nettverk.

- Alice beregner et punkt $(x,y)$ på kurven ved å anvende sin private nøkkel $ka$ på Bobs offentlige nøkkel $Kb$:

$$
(x,y) = k_a \cdot K_b
$$

- Bob beregner et punkt $(x,y)$ på kurven ved å anvende sin private nøkkel $kb$ på Alices offentlige nøkkel $Ka$:

$$
(x,y) = k_b \cdot K_a
$$

- Alice og Bob oppnår det samme punktet på den elliptiske kurven. Det delte hemmeligheten vil være x-koordinaten $x$ til dette punktet.

De oppnår faktisk den samme delte hemmeligheten fordi:
(x,y) = k_a \cdot K_b = k_a \cdot (k_b \cdot G) = (k_a \cdot k_b) \cdot G = (k_b \cdot k_a) \cdot G = k_b \cdot (k_a \cdot G) = k_b \cdot K_a$$
En angriper som observerer det usikrede offentlige nettverket kan kun oppnå de offentlige nøklene til hver part og parameterne for den valgte elliptiske kurven. Som tidligere forklart, er ikke denne informasjonen alene nok til å bestemme de private nøklene. Derfor kan ikke angriperen finne det delte hemmelige mellom Alice og Bob.

ECDH er dermed en algoritme som tillater nøkkelutveksling. Den brukes ofte i kombinasjon med andre kryptografiske metoder for å etablere et komplett protokoll. For eksempel er ECDH integrert i kjernen av TLS (_Transport Layer Security_), et krypterings- og autentiseringsprotokoll brukt for internettets transportlag. TLS bruker ECDHE for nøkkelutveksling, en variant av ECDH hvor nøklene er ephemeral, for å tilby vedvarende konfidensialitet. I tillegg bruker TLS autentiseringsalgoritmer som ECDSA, krypteringsalgoritmer som AES, og hash-funksjoner som SHA256.

TLS er spesielt ansvarlig for `s`-en i `https` samt hengelåsen synlig i nettleserens adressefelt, symboler på krypterte kommunikasjoner. Ved å følge dette kurset bruker du derfor ECDH, og det er svært sannsynlig at du bruker det daglig uten å engang vite om det.

### Varslingstransaksjonen

Som vi så i forrige seksjon, er ECDH en variant av Diffie-Hellman-utvekslingen som bruker nøkkelpar etablert på en elliptisk kurve. Heldigvis har vi allerede mange nøkkelpar som følger denne standarden i våre Bitcoin-lommebøker! Ideen med BIP47 er å bruke nøkkelparene fra Bitcoin deterministiske hierarkiske lommebøker fra begge parter for å etablere delte og ephemeral hemmeligheter mellom dem. I konteksten av BIP47, brukes ECDHE (_Elliptic Curve Diffie-Hellman Ephemeral_) i stedet.

![BTC204](assets/notext/66/14.webp)

ECDHE brukes for første gang i BIP47 for å overføre betalingskoden fra avsenderen til mottakeren. Dette er den berømte **varslingstransaksjonen**. Dette steget er essensielt fordi for at BIP47 skal fungere effektivt, må begge parter involvert (avsenderen og mottakeren) kjenne hverandres betalingskode. Denne kunnskapen tillater derivasjon av ephemeral offentlige nøkler og, dermed, tilknyttede blanke mottaksadresser.
Før denne utvekslingen er avsenderen logisk allerede klar over mottakerens betalingskode siden de har hentet den off-chain, for eksempel fra deres nettside, en faktura, eller deres sosiale medier. Imidlertid kan det hende at mottakeren ikke nødvendigvis kjenner avsenderens betalingskode. Likevel må denne koden overføres til dem; ellers vil de ikke være i stand til å derivere de ephemeral nøklene som er nødvendige for å identifisere adressene hvor deres bitcoins er lagret, eller få tilgang til sine midler. Selv om denne overføringen av avsenderens kode teknisk kan utføres off-chain gjennom andre kommunikasjonsmidler, stiller dette et problem hvis lommeboken må gjenopprettes kun fra frøet.
Faktisk, i motsetning til konvensjonelle adresser, er ikke BIP47-adresser direkte avledet fra mottakerens seed – å bruke en `xpub` ville vært enklere i dette tilfellet – men resultatet av en beregning som kombinerer begge betalingskodene: den fra senderen og den fra mottakeren. Dermed, hvis mottakeren mister lommeboken sin og prøver å gjenopprette den fra sin seed, vil de gjenopprette sin egen betalingskode, som er direkte avledet fra deres seed. Imidlertid, for å finne de efemere adressene, vil det være essensielt for dem å også ha betalingskodene til alle som har sendt dem bitcoins via BIP47. Derav viktigheten av varslingstransaksjonen, som tillater lagring av denne informasjonen på Bitcoin-blockchainen, samtidig som den kan finnes veldig enkelt uten å måtte søke gjennom milliarden transaksjoner utført siden lanseringen i 2009.
![BTC204](assets/en/66/15.webp)

Derfor ville det være mulig å implementere BIP47 uten å ty til varslingstransaksjonen, forutsatt at hver bruker beholder en sikkerhetskopi av sine jevnaldrendes betalingskoder. Imidlertid viser denne metoden seg kompleks å håndtere så lenge en enkel, robust og effektiv løsning for å opprette, lagre og oppdatere disse sikkerhetskopiene ikke er utviklet. I den nåværende tilstanden blir varslingstransaksjonen dermed nesten uunnværlig.

I de følgende kapitlene vil vi studere andre protokoller med målsetninger lik de til BIP47, men som ikke krever en varslingstransaksjon. Disse alternativene introduserer imidlertid sine egne kompromisser.

I tillegg til sin rolle i sikkerhetskopiering av betalingskoder, tjener varslingstransaksjonen også en varslingfunksjon for mottakeren, som navnet antyder. Den signaliserer til mottakerens klient at en ny betalingskanal har blitt etablert, og antyder dermed overvåking av de resulterende efemere adressene.

### Personvernmodellen til BIP47

Før vi detaljerer den tekniske operasjonen av varslingstransaksjonen, er det viktig å diskutere personvernmodellen assosiert med BIP47, som rettferdiggjør visse tiltak tatt under opprettelsen av denne innledende transaksjonen.
Betalingskoden i seg selv utgjør ikke en direkte risiko for personvernet. I motsetning til den tradisjonelle Bitcoin-modellen, som har som mål å bryte koblingen mellom en brukers identitet og deres transaksjoner (som er offentlige) ved å bevare anonymiteten til nøkler og adresser, kan betalingskoden åpent assosieres med en identitet uten å utgjøre en trussel.
Faktisk brukes ikke betalingskoden til å direkte avlede adressene som mottar BIP47-betalinger. Disse adressene genereres i stedet gjennom anvendelsen av ECDH mellom de avledede nøklene til betalingskodene til de to involverte partene.

Dermed fører en betalingskode i seg selv ikke direkte til et tap av personvern, siden bare varslingadressen er avledet fra den. Selv om denne adressen kan avsløre noe informasjon, tillater den normalt ikke oppdagelsen av partene du gjennomfører transaksjoner med, med mindre gjennom en grundig kjedeanalyse. Faktisk, hvis avsenderen bruker UTXOer som kan knyttes til deres identitet for å utføre varslingstransaksjonen, blir det mulig å dedusere at deres identitet sannsynligvis er knyttet til BIP47-betalinger til din betalingskode. Dette vil ikke avsløre de underliggende transaksjonene, men vil indikere deres sannsynlige eksistens.

Derfor er det essensielt å opprettholde denne strenge separasjonen mellom brukernes betalingskoder. Mot dette målet er det innledende kommunikasjonstrinnet av koden et kritisk øyeblikk for betalingens personvern, men obligatorisk for den korrekte funksjonen av protokollen. Hvis en av betalingskodene kan oppnås offentlig (som på en nettside), må den andre koden, den fra avsenderen, under ingen omstendighet være knyttet til den første.

La oss ta et konkret eksempel: Jeg ønsker å gjøre en donasjon til en politisk bevegelse via BIP47:

- Organisasjonen har gjort sin betalingskode offentlig på sin nettside eller gjennom sine sosiale nettverk;
- Denne koden er dermed knyttet til den politiske bevegelsen;
- Jeg henter denne betalingskoden;
- Før jeg fortsetter med en sending, må jeg sørge for at de kjenner min egen betalingskode, som også er knyttet til min identitet siden jeg bruker den til å motta transaksjoner på mine sosiale nettverk.

Hvordan overføre koden min uten risiko? Bruken av konvensjonelle kommunikasjonsmidler kan føre til en informasjonslekkasje, og dermed assosiere meg med denne politiske bevegelsen. Varslingstransaksjonen tilbyr en løsning takket være et krypteringslag som nettopp forhindrer denne assosiasjonen mellom to koder. Selv om dette ikke er den eneste metoden for å hemmelig overføre avsenderens betalingskode, viser det seg å være svært effektivt.

I diagrammet nedenfor indikerer de oransje linjene punktene hvor informasjonsflyten må avbrytes, og de svarte pilene viser tilkoblingene som potensielt kan observeres av tredjeparter:
![BTC204](assets/en/66/16.webp)
I virkeligheten, innenfor Bitcoins tradisjonelle personvernmodell, er det ofte komplekst å fullstendig skille informasjonsflyten mellom nøkkelparet og brukeren, spesielt under fjerntransaksjoner. For eksempel, i konteksten av en donasjonskampanje, må mottakeren uunngåelig avsløre en adresse eller en offentlig nøkkel via deres nettsted eller sosiale nettverk. Den korrekte bruken av BIP47, spesielt med varslingstransaksjonen, tillater å omgå dette problemet takket være ECDHE og krypteringslaget som vi vil studere videre.

Selvfølgelig gjelder Bitcoins klassiske personvernmodell fortsatt for flyktige offentlige nøkler, som er avledet fra kombinasjonen av de to betalingskodene. De to modellene er faktisk komplementære. Det jeg ønsker å fremheve her er at, i motsetning til den vanlige bruken av en offentlig nøkkel for å motta bitcoins, kan betalingskoden være knyttet til en spesifikk identitet, fordi informasjonen "_Alice utfører en transaksjon med Bob_" brytes på et annet stadium. Betalingskoden brukes til å generere betalingsadresser, men basert kun på observasjon av blockchain, er det umulig å koble en BIP47-betalings transaksjon til betalingskodene som ble brukt for å utføre den, med mindre UTXOene som var involvert allerede var knyttet til en identitet tidligere og brukerne har assosiert sine betalingskoder med sine respektive identiteter.

For å oppsummere, kan personvernmodellen som tilbys av BIP47-betalinger anses som overlegen i forhold til den til Bitcoins base, selv om den på ingen måte er magisk.

### Konstruksjon av Varslingstransaksjonen

Nå, la oss se hvordan denne varslingstransaksjonen fungerer. Forestill deg at Alice ønsker å sende midler til Bob med BIP47. I mitt eksempel, handler Alice som avsender og Bob som mottaker. Sistnevnte har publisert sin betalingskode på sin nettside. Derfor er Alice allerede klar over Bobs betalingskode.

**1- Alice beregner et delt hemmelig med ECDH:**

- Hun velger et nøkkelpar fra sin HD-lommebok som ligger på en annen gren enn hennes betalingskode. Merk, dette paret bør ikke lett kunne assosieres med Alices varslingadresse, eller med Alices identitet (se forrige seksjon);

- Alice velger den private nøkkelen fra dette paret. Vi kaller den $a$ (liten bokstav);

$$
a
$$

- Alice henter den offentlige nøkkelen assosiert med Bobs varslingadresse. Denne nøkkelen er den første datteren avledet fra Bobs betalingskode (indeks $/0$). Vi kaller denne offentlige nøkkelen $B$ (stor bokstav). Den private nøkkelen assosiert med denne offentlige nøkkelen kalles $b$ (liten bokstav). $B$ er bestemt ved addisjon og dobling av punkter på den elliptiske kurven fra $G$ (generatorenpunktet) med $b$ (den private nøkkelen):
  $$ B = b \cdot G $$
- Alice beregner et hemmelig punkt $S$ (stor bokstav) på den elliptiske kurven ved å legge sammen og doble punkter ved å bruke sin private nøkkel $a$ fra Bobs offentlige nøkkel $B$.
  $$ S = a \cdot B $$

- Alice beregner blendingsfaktoren $f$ som vil tillate henne å kryptere sin betalingskode. For å gjøre dette, vil hun bestemme et pseudo-tilfeldig tall med HMAC-SHA512-funksjonen. I det andre inndatafeltet til denne funksjonen, bruker hun en verdi som bare Bob vil kunne hente ut: $x$ som er x-koordinaten til det tidligere beregnede hemmelige punktet. Det første inndatafeltet er $o$ som er UTXOen som forbrukes i inngangen til denne transaksjonen (utgangspunkt).

$$ f = \text{HMAC-SHA512}(o, x) $$

**2- Alice konverterer sin personlige betalingskode til base 2 (binær).**

**3- Hun bruker denne blendingsfaktoren som en nøkkel for å utføre symmetrisk kryptering på nyttelasten til sin betalingskode.** Krypteringsalgoritmen som brukes er rett og slett en `XOR`. Operasjonen som utføres er sammenlignbar med Vernam-chifferet, også kalt "One-Time Pad".

- Alice deler først sin blendingsfaktor i to: de første 32 bytene er navngitt $f1$ og de siste 32 bytene er navngitt $f2$. Så vi har:

$$ f = f1 || f2 $$

- Alice beregner den krypterte $x'$ av x-koordinaten til den offentlige nøkkelen $x$ til sin betalingskode, og den krypterte $c'$ av hennes kjedekode $c$ separat. $f1$ og $f2$ fungerer henholdsvis som krypteringsnøkler. Operasjonen som brukes er `XOR` (eksklusiv eller).

$$ x' = x \oplus f1 $$
$$ c' = c \oplus f2 $$

- Alice erstatter de reelle verdiene av x-koordinaten til den offentlige nøkkelen $x$ og kjedekoden $c$ i sin betalingskode med de krypterte verdiene $x'$ og $c'$.
  **4-** Alice har nå sin betalingskode med en kryptert nyttelast. Hun vil konstruere og kringkaste en transaksjon som involverer hennes offentlige nøkkel $A$ som inngang, en utgang til Bobs varselsadresse, og en `OP_RETURN` utgang som inneholder hennes betalingskode med den krypterte nyttelasten. **Denne transaksjonen er varslingstransaksjonen**.
  En `OP_RETURN` er en opcode som markerer en Bitcoin-transaksjonsutgang som ugyldig. I dag brukes den til å kringkaste eller forankre informasjon på Bitcoin-blockchainen. Opptil 80 byte med data kan lagres, som er skrevet på kjeden og dermed synlige for alle andre brukere.

Som vi har sett i de foregående avsnittene, brukes ECDH til å generere et delt hemmelig mellom to brukere som kommuniserer over et usikkert nettverk, potensielt observert av angripere. I BIP47 brukes ECDH for kommunikasjon over Bitcoin-nettverket, som av sin natur er et transparent kommunikasjonsnettverk observert av mange angripere. Det delte hemmelige beregnet gjennom ECDH-nøkkelutvekslingen brukes deretter til å kryptere den hemmelige informasjonen som skal overføres: avsenderens (Alices) betalingskode.

La oss oppsummere trinnene vi nettopp har gjennomgått sammen for å utføre en varslingstransaksjon:

- Alice henter Bobs betalingskode og varselsadresse;
- Alice velger en UTXO som hun eier i sin HD-lommebok med det tilsvarende nøkkelparet;
- Hun beregner et hemmelig punkt på den elliptiske kurven ved hjelp av ECDH;
- Hun bruker dette hemmelige punktet til å beregne en HMAC, som er blendingsfaktoren;
- Hun bruker denne blendingsfaktoren til å kryptere nyttelasten til sin personlige betalingskode;
- Hun bruker en `OP_RETURN` transaksjonsutgang for å kommunisere den maskerte betalingskoden til Bob.
  ![BTC204](assets/en/66/17.webp)

### Varslingstransaksjon: Konkret Studie

For å forstå funksjonen mer detaljert, spesielt bruken av `OP_RETURN`, la oss undersøke en ekte varslingstransaksjon sammen. Jeg utførte en slik transaksjon på testnet, som du kan finne [ved å klikke her](https://mempool.space/fr/testnet/tx/0e2e4695a3c49272ef631426a9fd2dae6ec3a469e3a39a3db51aa476cd09de2e).

![BTC204](assets/notext/66/18.webp)

Ved å observere denne transaksjonen, kan vi se at den har en enkelt inngang og 4 utganger:

- Den første utgangen er `OP_RETURN` som inneholder min maskerte betalingskode;
- Den andre utgangen på 546 sats peker på mottakerens varslingadresse;
- Den tredje utgangen på 15 000 sats representerer tjenestegebyrene, siden jeg brukte Samourai Wallet for å konstruere denne transaksjonen;
- Den fjerde utgangen på 2 millioner sats representerer vekslingen, som betyr den gjenværende differansen fra min inngang som går tilbake til en annen adresse som tilhører meg.
  Den mest interessante å studere er åpenbart utgang 0 som bruker `OP_RETURN`. La oss se nærmere på hva den inneholder. Her er `scriptPubKey` i heksadesimal:

```text
6a4c50010002b13b2911719409d704ecc69f74fa315a6cb20fdd6ee39bc9874667703d67b164927b0e88f89f3f8b963549eab2533b5d7ed481a3bea7e953b546b4e91b6f50d800000000000000000000000000
```

I dette skriptet kan vi dissekere flere deler. Først og fremst, opcodes:

```text
6a4c
```

Blant opcodes, kan vi gjenkjenne `0x6a` som betegner `OP_RETURN` og `0x4c` som betegner `OP_PUSHDATA1`.

Byten som følger denne siste opcode indikerer størrelsen på den etterfølgende nyttelasten. Den indikerer `0x50`, eller 80 bytes:

```text
6a4c50
```

Deretter har vi metadataen til min betalingskode i klartekst:

```text
010002
```

Den krypterte x-koordinaten til den offentlige nøkkelen til min betalingskode:

```text
b13b2911719409d704ecc69f74fa315a6cb20fdd6ee39bc9874667703d67b164
```

Den krypterte kjedekoden til min betalingskode:

```text
927b0e88f89f3f8b963549eab2533b5d7ed481a3bea7e953b546b4e91b6f50d8
```

Og til slutt, utfylling for å nå 80 bytes, standardstørrelsen på en `OP_RETURN`:

```text
00000000000000000000000000
```

For å forstå bedre, her er min betalingskode i klartekst i base 58:

````text
Når vi sammenligner min klartekst betalingskode med `OP_RETURN`, er det merkbart at HRP (`0x47`) og sjekksummen (`0x8604e4db`) ikke overføres. Dette er forventet, ettersom disse stykkene informasjon er ment for mennesker.
Videre kan vi identifisere versjonen (`0x01`), bitfeltet (`0x00`), og offentlig nøkkels paritet (`0x02`). Og, på slutten av betalingskoden, brukes de tomme bytene (`0x00000000000000000000000000`) for å polstre koden til totalt 80 bytes. Alle disse metadataene overføres i klartekst (ukryptert).

Til slutt kan det observeres at den offentlige nøkkels x-koordinat (`0x77507c9c17a89cfca2d3af554745d6c2db0e7f6b2721a3941a504933103cc42a`) og kjedekoden (`0xdd94881210d6e752a9abc8a9fa0070e85184993c4f643f1121dd807dd556d1dc`) har blitt kryptert. Dette utgjør nyttelasten av betalingskoden.

### Hva er XOR?

I de foregående avsnittene så vi at betalingskoden ble overført kryptert ved bruk av XOR-operasjonen. La oss ta et øyeblikk for å forstå hvordan denne operatøren fungerer, ettersom den er mye brukt i kryptografi.

XOR er en bitvis logisk operatør basert på boolsk algebra. Med to bit-operander returnerer den `1` hvis bitene av samme rang er forskjellige, og den returnerer `0` hvis bitene av samme rang er like. Her er sannhetstabellen for XOR basert på operandverdiene `D` og `E`:

| D   | E   | D XOR E |
| --- | --- | ------- |
| 0   | 0   | 0       |
| 0   | 1   | 1       |
| 1   | 0   | 1       |
| 1   | 1   | 0       |

For eksempel:

$$
0110 \oplus 1110 = 1000
$$

Eller:

$$
010011 \oplus 110110 = 100101
$$

Med ECDH er bruk av XOR som et krypteringslag spesielt passende. Først og fremst, på grunn av denne operatøren, er krypteringen symmetrisk. Dette lar mottakeren dekryptere betalingskoden med samme nøkkel som ble brukt for kryptering. Krypterings- og dekrypteringsnøkkelen beregnes fra det delte hemmelige takket være ECDH. Denne symmetrien er muliggjort av de kommutative og assosiative egenskapene til XOR-operatøren:

- Andre egenskaper:

$$
D \oplus D = 0
$$
D ⊕ 0 = D
- Kommutativitet:

$$
D \oplus E = E \oplus D
$$

- Assosiativitet:

$$
D \oplus (E \oplus Z) = (D \oplus E) \oplus Z = D \oplus E \oplus Z
$$

Hvis:

$$
D \oplus E = L
$$

Da:

$$
D \oplus L = D \oplus (D \oplus E) = D \oplus D \oplus E = 0 \oplus E = E \\
\therefore D \oplus L = E
$$

Videre ligner denne krypteringsmetoden sterkt på Vernam-chifferet (One-Time Pad), den eneste krypteringsalgoritmen kjent til dags dato som har ubetinget (eller absolutt) sikkerhet. For at Vernam-chifferet skal ha denne egenskapen, må krypteringsnøkkelen være fullstendig tilfeldig, den må være av samme størrelse som meldingen, og den må kun brukes én gang. I krypteringsmetoden som brukes her for BIP47, er nøkkelen faktisk av samme størrelse som meldingen, blendingsfaktoren er nøyaktig samme størrelse som sammenkjedningen av den offentlige nøkkelens x-koordinat med betalingskodens kjedekode. Denne krypteringsnøkkelen brukes faktisk bare én gang. Imidlertid er denne nøkkelen ikke et resultat av perfekt tilfeldighet siden det er en HMAC. Den er heller pseudotilfeldig. Derfor er det ikke et Vernam-chiffer, men metoden er lik.

### Motta Varslingstransaksjonen

Nå som Alice har sendt varslingstransaksjonen til Bob, la oss se hvordan han tolker den. Som en påminnelse, må Bob kunne få tilgang til Alices betalingskode. Uten denne informasjonen, som vi vil se i følgende avsnitt, vil han ikke kunne utlede nøkkelparene opprettet av Alice, og derfor vil han ikke kunne få tilgang til sine bitcoins mottatt via BIP47. For øyeblikket er nyttelasten til Alices betalingskode kryptert. La oss se hvordan Bob dekrypterer den.

**1-** Bob overvåker transaksjoner som oppretter utganger med hans varslingadresse.

**2-** Når en transaksjon har en utgang på hans varslingadresse, analyserer Bob den for å se om den inneholder en OP_RETURN-utgang som følger BIP47-standarden.

**3-** Hvis det første bytet av OP_RETURN-nyttelasten er `0x01`, begynner Bob sin søk etter et mulig delt hemmelighet med ECDH:
- Bob velger den offentlige nøkkelen i inngangen av transaksjonen. Det vil si, Alices offentlige nøkkel kalt $A$ med:

$$ A = a \cdot G $$

- Bob velger den private nøkkelen $b$ assosiert med hans personlige varslingadresse:

$$ b $$
- Bob beregner det hemmelige punktet $S$ (delt ECDH-hemmelighet) på den elliptiske kurven ved å legge til og doble punkter, ved å anvende sin private nøkkel $b$ på Alices offentlige nøkkel $A$:
$$ S = b \cdot A $$

- Bob bestemmer blendingsfaktoren $f$ som vil tillate ham å dekryptere nyttelasten av Alices betalingskode. På samme måte som Alice tidligere hadde beregnet, vil Bob finne $f$ ved å anvende HMAC-SHA512 på $x$ x-koordinaten til det hemmelige punktet $S$, og på $o$ UTXOen som ble brukt som inngang i denne varslingstransaksjonen:

$$ f = \text{HMAC-SHA512}(o, x) $$

**4-** Bob tolker dataene i OP_RETURN av varslingstransaksjonen som en betalingskode. Han vil ganske enkelt dekryptere nyttelasten av denne potensielle betalingskoden ved å bruke blendingsfaktoren $f$:
- Bob splitter den blendende faktoren $f$ i 2 deler: de første 32 bytene av $f$ vil være $f1$ og de siste 32 bytene vil være $f2$;
- Bob dekrypterer den krypterte x-koordinaten $x'$ til offentlig nøkkel fra Alices betalingskode:

$$ x = x' \oplus f1 $$

- Bob dekrypterer den krypterte kjedekodeverdien $c'$ fra Alices betalingskode:

$$ c = c' \oplus f2 $$

**5-** Bob sjekker om verdien av den offentlige nøkkelen fra Alices betalingskode faktisk er en del av secp256k1-gruppen. Hvis dette er tilfellet, tolker han dette som en gyldig betalingskode. Ellers ignorerer han denne transaksjonen.

Nå som Bob er klar over Alices betalingskode, kan hun sende ham opptil `2^32` betalinger, uten å noensinne trenge å gjøre en annen varslingstransaksjon av denne typen igjen.

Hvorfor fungerer dette? Hvordan kan Bob klare å bestemme den samme blendende faktoren som Alice, og dermed dekryptere hennes betalingskode? La oss se nærmere på rollen til ECDH i det vi nettopp har beskrevet.

Først og fremst har vi å gjøre med symmetrisk kryptering. Dette betyr at krypteringsnøkkelen og dekrypteringsnøkkelen er den samme verdien. Denne nøkkelen i varslingstransaksjonen er den blendende faktoren:

$$ f = f1 || f2 $$

Derfor må Alice og Bob oppnå den samme verdien for $f$, uten å direkte overføre den siden en angriper kunne stjele den og dekryptere den hemmelige informasjonen. Denne blendende faktoren oppnås ved å anvende HMAC-SHA512 på 2 verdier:
- x-koordinaten til et hemmelig punkt;
- og UTXOen som brukes som inngang i transaksjonen.
Bob trenger derfor disse to stykkene informasjon for å dekryptere innholdet i Alices betalingskode. For UTXOen som inngang, kan Bob enkelt hente den ved å observere varslingstransaksjonen. For det hemmelige punktet, vil Bob måtte bruke ECDH. Som sett i det forrige avsnittet om Diffie-Hellman, bare ved å utveksle sine respektive offentlige nøkler og hemmelig anvende sine private nøkler på den andres offentlige nøkkel, kan Alice og Bob finne et spesifikt og hemmelig punkt på den elliptiske kurven. Varslingstransaksjonen er avhengig av denne mekanismen:
- Bobs nøkkelpar:

$$ B = b \cdot G $$

- Alices nøkkelpar:

$$ A = a \cdot G $$

- For et hemmelig $S (x, y)$:

$$ S = a \cdot B = a \cdot (b \cdot G) = (b \cdot a) \cdot G = b \cdot A $$

![BTC204](assets/en/66/19.webp)

Nå som Bob kjenner Alices betalingskode, vil han kunne oppdage hennes BIP47-betalinger, og han kan avlede de private nøklene som låser de mottatte bitcoinene.

La oss oppsummere trinnene vi nettopp har gått gjennom for å motta og tolke en varslingstransaksjon:
- Bob overvåker transaksjonsutganger til sin varslingadresse;
- Når han oppdager en, henter han informasjonen som er inneholdt i OP_RETURN;
- Bob velger den offentlige nøkkelen i inngangen og beregner et hemmelig punkt ved hjelp av ECDH;
- Han bruker dette hemmelige punktet til å beregne en HMAC som er den blendende faktoren;
- Han bruker denne blendende faktoren til å dekryptere innholdet av Alices betalingskode som er inneholdt i OP_RETURN.

![BTC204](assets/en/66/20.webp)

### BIP47-betalingstransaksjonen

La oss nå studere betalingsprosessen med BIP47 sammen. For å minne deg om den nåværende situasjonen:
- Alice kjenner Bobs betalingskode, som hun enkelt hentet fra hans nettsted;
- Bob kjenner til Alices betalingskode takket være varslingstransaksjonen;
- Alice vil gjøre en første betaling til Bob. Hun vil kunne gjøre mange andre på samme måte.

Før vi forklarer denne prosessen, tror jeg det er viktig å minne om indeksene vi for øyeblikket jobber med. Avledningsveien for en betalingskode er beskrevet som følger: `m/47'/0'/0'`. Det neste nivået distribuerer indeksene på denne måten:
- Det første normale (ikke-herdede) barne-paret er det som brukes til å generere varslingsadressen vi snakket om i den forrige delen: `m/47'/0'/0'/0`;
- Normale barne-nøkkelpar brukes innen ECDH for å generere BIP47 betalingsmottaksadresser som vi vil se i denne seksjonen: fra `m/47'/0'/0'/0` til `m/47'/0'/0'/2 147 483 647`;
- Herdede barne-nøkkelpar er flyktige betalingskoder: fra `m/47'/0'/0'/0'` til `m/47'/0'/0'/2 147 483 647'`.

Når Alice ønsker å sende en betaling til Bob, avleder hun en ny unik jomfruadresse, takket være ECDH-protokollen igjen:
- Alice velger den første private nøkkelen avledet fra hennes personlige gjenbrukbare betalingskode:

$$ a $$

- Alice velger den første ubrukte offentlige nøkkelen avledet fra Bobs betalingskode. Denne offentlige nøkkelen, vil vi kalle den $B$. Den er assosiert med den private nøkkelen $b$ som bare Bob kjenner:

$$ B = b \cdot G $$

- Alice beregner et hemmelig punkt $S$ på den elliptiske kurven ved punktaddisjon og dobling ved å anvende sin private nøkkel $a$ på Bobs offentlige nøkkel $B$:

$$ S = a \cdot B $$

- Fra dette hemmelige punktet vil Alice beregne det delte hemmelige $s$ (små bokstaver). For å gjøre dette, velger hun x-koordinaten til det hemmelige punktet $S$ kalt $Sx$, og hun passerer denne verdien gjennom SHA256 hash-funksjonen:

$$ S = (Sx, Sy) $$
$$ s = \text{SHA256}(Sx) $$

- Alice bruker dette delte hemmelige $s$ til å beregne en Bitcoin betalingsmottaksadresse. Først verifiserer hun at $s$ er inneholdt innenfor ordenen til secp256k1-kurven. Hvis ikke, øker hun indeksen til Bobs offentlige nøkkel for å avlede et annet delt hemmelig;
- For det andre beregner hun en offentlig nøkkel $K0$ ved å legge til på den elliptiske kurven punktene $B$ og $s·G$. Med andre ord, Alice legger til den offentlige nøkkelen avledet fra Bobs betalingskode $B$ med et annet punkt beregnet på den elliptiske kurven ved punktaddisjon og dobling med det delte hemmelige $s$ fra secp256k1-kurvens generatorpunkt $G$. Dette nye punktet representerer en offentlig nøkkel, og vi kaller det $K0$:

$$ K0 = B + s \cdot G $$

- Med denne offentlige nøkkelen $K0$, kan Alice avlede en standard jomfru mottaksadresse (for eksempel, SegWit V0 i bech32).
Når Alice har oppnådd Bobs mottaksadresse $K0$, kan hun utføre en Bitcoin-transaksjon på en standard måte. For å gjøre dette, velger hun en UTXO som hun eier, sikret av et par nøkler fra en annen gren av hennes HD-lommebok, og bruker den for å tilfredsstille en utgang til Bobs adresse $K0$. Det er viktig å merke seg at denne betalingen, når adressen er avledet, følger en konvensjonell prosess og ikke lenger avhenger av nøklene assosiert med BIP47.
La oss oppsummere stegene vi nettopp har gått gjennom sammen for å sende en BIP47-betaling:
- Alice velger den første avledede barnenøkkelen fra sin personlige betalingskode;
- Hun beregner et hemmelig punkt på den elliptiske kurven ved bruk av ECDH fra den første ubrukte avledede barnenøkkelen fra Bobs betalingskode;
- Hun bruker dette hemmelige punktet til å beregne et delt hemmelig med SHA256;
- Hun bruker dette delte hemmelige til å beregne et nytt hemmelig punkt på den elliptiske kurven;
- Hun legger til dette nye hemmelige punktet til Bobs offentlige nøkkel;
- Hun oppnår en ny efemer offentlig nøkkel som kun Bob har den tilhørende private nøkkelen til;
- Alice kan gjøre en standard transaksjon til Bob med den avledede efemere mottaksadressen.

![BTC204](assets/en/66/21.webp)

Hvis Alice ønsker å gjøre en andre betaling, vil hun følge de samme stegene som før, bortsett fra at denne gangen vil hun velge den andre avledede offentlige nøkkelen fra Bobs betalingskode. Spesifikt vil hun bruke den neste ubrukte nøkkelen. Hun vil dermed oppnå en ny mottaksadresse som tilhører Bob, betegnet $K1$:

![BTC204](assets/en/66/22.webp)

Hun kan fortsette på denne måten og avlede opptil `2^32` ubrukte adresser som tilhører Bob.

Fra et eksternt synspunkt, ved å observere blockchain, er det teoretisk umulig å skille en BIP47-betaling fra en standard betaling. Her er et eksempel på en BIP47-betalingstransaksjon på Testnet:

```text
94b2e59510f2e1fa78411634c98a77bbb638e28fb2da00c9f359cd5fc8f87254
````

Dette ser ut som en standard transaksjon med et brukt inngang, en betalingsutgang, og en endring:

![BTC204](assets/notext/66/23.webp)

### Motta BIP47-betalingen og Avlede den Private Nøkkelen

Alice har nettopp gjort sin første betaling til en ny BIP47-adresse som tilhører Bob. Nå skal vi se hvordan Bob mottar denne betalingen. Vi vil også se hvorfor Alice ikke har tilgang til den private nøkkelen til adressen hun nettopp har generert selv, og hvordan Bob henter denne nøkkelen for å bruke bitcoinsene han nettopp har mottatt.
Så snart Bob mottar varslingstransaksjonen fra Alice, avleder han den offentlige nøkkelen BIP47 $K0$ selv før hun har sendt noen betaling. Han overvåker deretter eventuelle betalinger til den tilknyttede adressen. Faktisk avleder han umiddelbart flere adresser som han vil overvåke ($K0$, $K1$, $K2$, $K3$...). Her er hvordan han avleder denne offentlige nøkkelen $K0$:

- Bob velger den første private barnenøkkelen avledet fra sin betalingskode. Denne private nøkkelen er navngitt $b$. Den er assosiert med den offentlige nøkkelen $B$ som Alice hadde gjort sine beregninger med i det forrige steget:

$$ b $$

- Bob velger den første offentlige nøkkelen til Alice avledet fra hennes betalingskode. Denne nøkkelen er navngitt $A$. Den er assosiert med den private nøkkelen $a$ som Alice hadde gjort sine beregninger med, og som kun Alice er klar over. Bob kan utføre denne prosessen siden han er klar over Alices betalingskode som ble overført til ham med varslingstransaksjonen:

$$ A = a \cdot G $$

- Bob beregner det hemmelige punktet $S$, ved addisjon og dobling av punkter på den elliptiske kurven, ved å anvende sin private nøkkel $b$ på Alices offentlige nøkkel $A$. Her finner vi bruken av ECDH som garanterer at dette punktet $S$ vil være det samme for både Bob og Alice:

$$ S = b \cdot A $$

- Akkurat som Alice gjorde, isolerer Bob x-koordinaten til dette punktet $S$. Vi har kalt denne verdien $Sx$. Han sender denne verdien gjennom SHA256-funksjonen for å finne den delte hemmeligheten $s$ (med små bokstaver):
  $$ s = \text{SHA256}(Sx) $$

- Akkurat som Alice, beregner Bob punktet $s·G$ på den elliptiske kurven. Deretter legger han til dette hemmelige punktet til sin offentlige nøkkel $B$. Han oppnår da et nytt punkt på den elliptiske kurven som han tolker som en offentlig nøkkel $K0$:

$$ K0 = B + s \cdot G $$

Når Bob har denne offentlige nøkkelen $K0$, kan han utlede den tilhørende private nøkkelen for å kunne bruke sine bitcoins. Han er den eneste som kan generere denne private nøkkelen:

- Bob legger til sin barns private nøkkel $b$ utledet fra sin personlige betalingskode. Han er den eneste som kan oppnå verdien av $b$. Deretter legger han til $b$ med den delte hemmeligheten $s$ for å oppnå $k0$, den private nøkkelen til $K0$:

$$ k0 = b + s $$

Takket være gruppeloven for den elliptiske kurven, oppnår Bob nøyaktig den private nøkkelen som tilsvarer den offentlige nøkkelen som Alice brukte. Vi har dermed:

$$ K0 = k0 \cdot G $$
Jeg vil oppsummere stegene vi nettopp gikk gjennom sammen for å motta en BIP47-betaling og beregne den tilsvarende private nøkkelen:

- Bob velger den første avledede barns private nøkkelen fra sin personlige betalingskode;
- Han beregner et hemmelig punkt på den elliptiske kurven ved hjelp av ECDH fra den første avledede barns offentlige nøkkelen fra Alices kjedekode;
- Han bruker dette hemmelige punktet til å beregne en delt hemmelighet med SHA256;
- Han bruker denne delte hemmeligheten til å beregne et nytt hemmelig punkt på den elliptiske kurven;
- Han legger til dette nye hemmelige punktet til sin personlige offentlige nøkkel;
- Han oppnår en ny efemer offentlig nøkkel, som Alice vil sende sin første betaling til;
- Bob beregner den private nøkkelen assosiert med denne efemere offentlige nøkkelen ved å legge til sin avledede barns private nøkkel fra sin betalingskode og den delte hemmeligheten.

![BTC204](assets/en/66/24.webp)

Siden Alice ikke kan oppnå $b$ (Bobs private nøkkel), er hun ute av stand til å bestemme $k0$ (den private nøkkelen assosiert med Bobs BIP47 mottaksadresse). Skjematisk kan vi representere beregningen av den delte hemmeligheten $S$ slik:

![BTC204](assets/en/66/19.webp)

Når den delte hemmeligheten er funnet med ECDH, beregner Alice og Bob den BIP47 betalingsoffentlige nøkkelen $K0$, og Bob beregner også den tilhørende private nøkkelen $k0$:

![BTC204](assets/en/66/25.webp)

### Refusjon av BIP47-betalingen

Siden Bob er klar over Alices gjenbrukbare betalingskode, har han allerede all nødvendig informasjon for å sende henne en refusjon. Han trenger ikke å kontakte Alice igjen for å be om informasjon. Han trenger bare å varsle henne med en varslingstransaksjon, spesielt slik at hun kan hente sine BIP47-adresser med sitt frø, og deretter kan han også sende henne opp til `2^32` betalinger.

Refusjonsfunksjonaliteten er spesifikk for BIP47 og er en av dens fordeler over andre metoder som vi vil studere i de kommende kapitlene, som Silent Payments.

Bob kan deretter refundere Alice på samme måte som hun sendte ham betalinger. Rollene er reversert:

![BTC204](assets/en/66/26.webp)
_En stor takk til [Fanis Michalakis](https://x.com/FanisMichalakis) for hans gjennomgang og verdifulle ekspertise som inspirerte skrivingen av dette kapittelet!_
https://planb.network/tutorials/privacy/on-chain/paynym-bip47-a492a70b-50eb-4f95-a766-bae2c5535093

## Stille Betalinger

<chapterId>2871d594-414e-4598-a830-91c9eb84dfb8</chapterId>
BIP47 har blitt kritisert for sin ineffektivitet påkjeden. Som forklart i det forrige kapittelet, krever det en varslingstransaksjon for hver ny mottaker. Denne begrensningen blir ubetydelig hvis man planlegger å etablere en varig betalingskanal med denne mottakeren. Faktisk baner en enkelt varslingstransaksjon vei for et nesten uendelig antall påfølgende BIP47-betalinger.

Imidlertid, i visse situasjoner, kan varslingstransaksjonen være en hindring for brukeren. Ta eksemplet med en engangsdonasjon til en mottaker: med en klassisk Bitcoin-adresse, er en enkelt transaksjon nok til å gjøre donasjonen. Men med BIP47, er to transaksjoner nødvendige: en for varslingen og en annen for selve betalingen. Når etterspørselen etter blokkplass er lav og transaksjonsgebyrer er minimale, er dette ekstra steget generelt ikke et problem. Imidlertid, under perioder med overbelastning, kan transaksjonsgebyrer bli eksorbitante for en enkelt betaling, potensielt doble kostnaden for brukeren sammenlignet med en standard Bitcoin-transaksjon, noe som kan være uakseptabelt for brukeren.

For situasjoner der brukeren planlegger å gjøre bare noen få betalinger til en statisk identifikator, har andre løsninger blitt utviklet. Blant dem er Stille Betalinger, beskrevet i [BIP352](https://github.com/bitcoin/bips/blob/master/bip-0352.mediawiki). Dette protokollen tillater bruk av en statisk identifikator for å motta betalinger uten å generere adressegjenbruk, og uten å kreve bruk av varslingstransaksjoner. La oss se nærmere på hvordan denne protokollen fungerer.

---

_For å fullt ut forstå dette kapittelet, er det essensielt å være kjent med virkemåten til ECDH (Elliptic Curve Diffie-Hellman) og kryptografisk nøkkelavledning i en HD-lommebok. Disse konseptene ble detaljert i det forrige kapittelet om BIP47. Jeg vil ikke gå over dem igjen her. Hvis du ikke er kjent med disse begrepene ennå, anbefaler jeg å konsultere det forrige kapittelet før du fortsetter med dette. Jeg vil heller ikke gjenbesøke risikoene forbundet med å gjenbruke mottaksadresser, eller viktigheten av å ha en unik identifikator for å motta betalinger._

---

### Hvorfor ikke flytte varslingen?

Som diskutert i kapittelet om BIP47, tjener varslingstransaksjonen primært to funksjoner:

- Den varsler mottakeren;
- Den overfører avsenderens betalingskode.

Man kan naivt tenke at denne varslingsprosessen kunne utføres off-chain. I teorien er dette fullt mulig: det ville være nok for mottakeren å angi et kommunikasjonsmiddel for å motta BIP47-betalingskoder fra avsendere. Imidlertid presenterer denne tilnærmingen to store problemer:

- For det første ville dette flytte kodeoverføringsprosessen til et annet kommunikasjonsprotokoll. Problemene knyttet til kostnader og personvernet for utvekslingen ville forbli, men ville ganske enkelt bli overført til denne nye protokollen. Når det gjelder personvern, kunne dette også skape en kobling mellom en brukers identitet og onchain-aktivitet, noe vi sikter på å unngå ved å utføre varslingen direkte på blockchain. Videre ville utførelsen av varslingen utenfor blockchain introdusere sensurrisikoer (som blokkering av midler) som ikke eksisterer på Bitcoin;
- Deretter ville dette utgjøre et gjenopprettingsproblem. Med BIP47 må mottakeren absolutt kjenne betalingskodene til avsenderne for å få tilgang til midlene. Dette gjelder ved tidspunktet for mottak, men også i tilfelle av fondsgjenoppretting via frøet i tilfelle tap av lommebok. Med onchain-varslinger unngås denne risikoen, ettersom brukeren kan finne og dekryptere varslingstransaksjonene bare ved å kjenne sitt frø. Imidlertid, hvis varslingen utføres utenfor blokkjeden, må brukeren opprettholde en dynamisk sikkerhetskopi av alle mottatte betalingskoder, noe som er upraktisk for gjennomsnittsbrukeren.
  Alle disse begrensningene gjør bruk av onchain-varsling uunnværlig i konteksten av BIP47. Likevel søker Silent Payments spesifikt å unngå dette onchain-varslingstrinnet på grunn av kostnadene. Derfor er den vedtatte løsningen ikke å flytte varslingen, men å eliminere den helt. For å oppnå dette må et kompromiss aksepteres: det å skanne. I motsetning til BIP47, der brukeren vet nøyaktig hvor de kan finne midlene sine takket være varslingstransaksjoner, må brukeren i konteksten av Silent Payments undersøke alle eksisterende Bitcoin-transaksjoner for å oppdage eventuelle betalinger som kan være ment for dem. For å redusere denne operative byrden, er søket etter Silent Payments begrenset kun til transaksjoner som sannsynligvis inneholder slike betalinger, nemlig de som inkluderer minst én Taproot P2TR-utgang. Skanningen fokuserer også utelukkende på transaksjoner fra lommebokens opprettelsesdato (det er ikke nødvendig å skanne transaksjoner tilbake til 2009 hvis lommeboken ble opprettet i 2024).

Derfor kan du se hvorfor BIP47 og Silent Payments, selv om de sikter mot et lignende mål, innebærer forskjellige kompromisser og **dermed faktisk imøtekommer distinkte bruksområder**. For engangsbetalinger, som sporadiske donasjoner, er Silent Payments mer passende på grunn av deres lavere kostnad. Omvendt, for regelmessige transaksjoner til samme mottaker, som i tilfellet med børsplattformer eller miningbassenger, kan BIP47 være å foretrekke.
La oss utforske de tekniske arbeidsmåtene til Silent Payments for å bedre forstå deres implikasjoner. For å gjøre dette foreslår jeg at vi tar samme tilnærming som det forklarende dokumentet til BIP352. Vi vil gradvis bryte ned beregningene som skal utføres, element for element, og rettferdiggjøre hver ny tillegg.

### Noen konsepter å forstå

Før vi begynner, er det viktig å klargjøre at Silent Payments utelukkende støtter seg på bruk av P2TR (_Pay to Taproot_) skripttyper. I motsetning til BIP47, er det ikke nødvendig å utlede mottaksadresser fra barneoffentlige nøkler ved å hashe dem. Faktisk, i P2TR-standarden, brukes den justerte offentlige nøkkelen direkte og åpent i adressen. Dermed er en Taproot-mottaksadresse i hovedsak en offentlig nøkkel ledsaget av noe metadata. Denne justerte offentlige nøkkelen er aggregasjonen av to andre offentlige nøkler: en som tillater direkte og tradisjonell bruk via en enkel signatur, og den andre representerer Merkle-roten til MAST, som autoriserer bruk underlagt tilfredsstillelsen av en av betingelsene potensielt innskrevet i Merkle-treet.

![BTC204](assets/en/67/01.webp)

Beslutningen om å begrense Silent Payments utelukkende til Taproot er motivert av to hovedgrunner:

- Først, det letter betydelig implementeringen og fremtidige oppdateringer i lommebokprogramvare, siden bare én standard trenger å bli fulgt;
- For det andre, hjelper denne tilnærmingen til å forbedre anonymitetssettet til brukere ved å oppmuntre dem til ikke å spre seg blant forskjellige typer skripter, som genererer distinkte lommebokavtrykk i kjedeanalyse (for mer informasjon om dette konseptet, inviterer jeg deg til å konsultere kapittel 4 i del 2).

### Naiv derivasjon av en Silent Payments offentlig nøkkel

La oss starte med et enkelt eksempel som vil hjelpe deg å forstå den grunnleggende funksjonen til SP (Silent Payments). Ta Alice og Bob, to Bitcoin-brukere. Alice ønsker å sende bitcoins til Bob på en ny mottaksadresse. Tre mål må oppnås i denne prosessen:

- Alice må kunne generere en ny adresse;
- Bob må kunne identifisere en betaling sendt til denne spesifikke adressen;
- Bob må kunne skaffe den private nøkkelen assosiert med denne adressen for å kunne bruke sine midler.

Alice har en UTXO i sin Bitcoin-lommebok sikret med følgende nøkkelpar:

- $a$: den private nøkkelen;
- $A$: den offentlige nøkkelen ($A = a \cdot G$)

Bob har en SP-adresse som han har publisert på internett med:

- $b$: den private nøkkelen;
- $B$: den offentlige nøkkelen ($B = b \cdot G$)
  Ved å hente Bobs adresse, kan Alice beregne en ny blank adresse som tilhører Bob ved hjelp av ECDH. La oss kalle denne adressen $P$:
  $$ P = B + \text{hash}(a \cdot B) \cdot G $$

I denne ligningen beregnet Alice ganske enkelt prikkproduktet av sin private nøkkel $a$ og Bobs offentlige nøkkel $B$. Hun sendte dette resultatet gjennom en hash-funksjon kjent for alle. Utgangsverdien blir deretter skalar multiplisert med generatorenpunktet $G$ på elliptisk kurve `secp256k1`. Til slutt legger Alice til det oppnådde punktet til Bobs offentlige nøkkel $B$. Når Alice har denne adressen $P$, bruker hun den som en utgang i en transaksjon, noe som betyr at hun sender bitcoins til den.

> _I konteksten av Silent Payments, tilsvarer "hash"-funksjonen en SHA256 hash-funksjon merket spesifikt med `BIP0352/SharedSecret`, noe som sikrer at de genererte hashene er unike for dette protokollen og kan ikke gjenbrukes i andre sammenhenger, samtidig som det gir ekstra beskyttelse mot gjenbruk av nonces i signaturer. Denne standarden tilsvarer den som er [spesifisert i BIP340 for Schnorr-signaturer](https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki) på `secp256k1`._

Takket være egenskapene til den elliptiske kurven som ECDH stoler på, vet vi at:

$$ a \cdot B = b \cdot A $$

Bob vil derfor kunne beregne mottaksadressen som Alice sendte bitcoins til. For å gjøre dette, overvåker han alle Bitcoin-transaksjoner som oppfyller kriteriene for Silent Payments og anvender følgende beregning på hver av dem for å se om betalingen er adressert til ham (_skanning_):

$$ P' = B + \text{hash}(b \cdot A) \cdot G $$

Når han skanner Alices transaksjon, innser han at $P'$ er lik $P$. Han vet dermed at denne betalingen er adressert til ham:

$$ P' = B + \text{hash}(b \cdot A) \cdot G = B + \text{hash}(a \cdot B) \cdot G = P $$

Fra dette punktet vil Bob kunne beregne den private nøkkelen $p$ som tillater bruk av adressen $P$:

$$ p = (b + \text{hash}(b \cdot A)) \bmod n $$

Som du kan se, for å beregne denne private nøkkelen $p$, må man nødvendigvis ha den private nøkkelen $b$. Bare Bob har denne private nøkkelen $b$. Han vil derfor faktisk være den eneste som kan bruke bitcoins sendt til hans Silent Payments-adresse.

![BTC204](assets/notext/67/02.webp)
_Bildetekst:_

- $B$: Den offentlige nøkkelen / statiske adressen publisert av Bob
- $b$: Bobs private nøkkel
- $A$: Den offentlige nøkkelen til Alices UTXO brukt som inndata for transaksjonen
- $a$: Alices private nøkkel
- $G$: Generasjonspunktet for elliptisk kurve `secp256k1`
- $\text{SHA256}$: SHA256 hashfunksjonen merket med `BIP0352/SharedSecret`
- $s$: Den felles ECDH-hemmeligheten
- $P$: Den offentlige nøkkelen / unike adressen for betaling til Bob

Her er en opprinnelig ganske naiv tilnærming til å bruke Bobs statiske adresse, betegnet $B$, for å utlede en unik adresse $P$ for å sende bitcoins. Imidlertid er denne metoden for enkel og har flere feil som trenger korrigering. Det første problemet er at i dette opplegget kan ikke Alice opprette flere utganger til Bob innenfor samme transaksjon.

### Hvordan opprette flere utganger?

I eksemplet fra forrige avsnitt oppretter Alice en enkelt utgang som vil gå til Bob på hans unike adresse $P$. Med samme inndata valgt, er det umulig for Alice å opprette to distinkte jomfruadresser for Bob, ettersom metoden som ble brukt alltid ville føre til samme resultat for $P$, dermed samme adresse. Det kan imidlertid være mange situasjoner der Alice ønsker å dele opp betalingen sin til Bob i flere mindre beløp, og dermed opprette flere UTXOer. Det er derfor nødvendig å finne en metode som tillater at dette kan gjøres.

For å oppnå dette, vil vi gjøre en liten endring i beregningen som Alice utfører for å utlede $P$, slik at hun kan generere to distinkte adresser for Bob, nemlig $P_0$ og $P_1$.

For å endre beregningen og oppnå 2 forskjellige adresser, er det tilstrekkelig å legge til et heltall som endrer resultatet. Dermed vil Alice legge til $0$ i beregningen sin for å oppnå adressen $P_0$ og $1$ for å oppnå adressen $P_1$. La oss kalle dette heltallet $i$:

$$ P_i = B + \text{hash}(a \cdot B \text{ ‖ } i) \cdot G $$

Beregningsprosessen forblir uendret fra den forrige metoden, bortsett fra at denne gangen vil Alice konkatenere $a \cdot B$ med $i$ før hun fortsetter til hashen. Det er da nok å endre $i$ for å ha en ny adresse som tilhører Bob. For eksempel:

$$ P_0 = B + \text{hash}(a \cdot B \text{ ‖ } 0) \cdot G $$

$$ P_1 = B + \text{hash}(a \cdot B \text{ ‖ } 1) \cdot G $$
Når Bob skanner blockchain for Silent Payments ment for ham, starter han med å bruke $i = 0$ for adressen $P_0$. Hvis han ikke finner noen betaling på $P_0$, konkluderer han med at denne transaksjonen ikke inneholder noen Silent Payments for ham og stopper analysen. Men hvis $P_0$ er gyldig og inneholder en betaling for ham, fortsetter han med $P_1$ i samme transaksjon for å sjekke om Alice gjorde en andre betaling. Hvis $P_1$ viser seg å være ugyldig, stopper han søket for denne transaksjonen; ellers fortsetter han å teste påfølgende verdier av $i$:
$$ P_1 = B + \text{hash}(b \cdot A \text{ ‖ } 1) \cdot G $$
Siden Bob umiddelbart stopper ved $i = 0$ hvis $P_0$ ikke gir noe, legger bruken av dette heltallet nesten ingen ekstra operasjonell belastning på Bob for skannetrinnet av transaksjonene.

Bob kan deretter beregne de private nøklene på samme måte:

$$
p_0 = (b + \text{hash}(b \cdot A \text{ ‖ } 0)) \bmod n
$$

$$
p_1 = (b + \text{hash}(b \cdot A \text{ ‖ } 1)) \bmod n
$$

![BTC204](assets/notext/67/03.webp)

_Bildetekst:_

- $B$: Den offentlige nøkkelen / statiske adressen publisert av Bob
- $b$: Bobs private nøkkel
- $A$: Den offentlige nøkkelen til Alices UTXO brukt som inndata for transaksjonen
- $a$: Alices private nøkkel
- $G$: Generasjonspunktet for elliptisk kurve `secp256k1`
- $\text{SHA256}$: SHA256 hash-funksjonen merket med `BIP0352/SharedSecret`
- $s_0$: Det første delte ECDH-hemmeligheten
- $s_1$: Den andre delte ECDH-hemmeligheten
- $P_0$: Den første offentlige nøkkelen / unike adressen for betalingen til Bob
- $P_1$: Den andre offentlige nøkkelen / unike adressen for betalingen til Bob

Med denne metoden begynner vi å få et fint protokoll, men det er fortsatt noen utfordringer å overvinne, spesielt forebygging av adressegjenbruk.

### Hvordan unngå adressegjenbruk?

Som vi har sett i de foregående avsnittene, bruker Alice nøkkelparet som sikrer hennes UTXO, som hun vil bruke til å beregne det delte ECDH-hemmeligheten med Bob. Denne hemmeligheten lar henne utlede den unike adressen $P_0$. Imidlertid kan nøkkelparet ($a$, $A$) brukt av Alice sikre flere UTXOer hvis hun har gjenbrukt denne adressen flere ganger. I tilfellet at Alice gjør to betalinger til Bobs statiske adresse $B$ ved bruk av to UTXOer sikret av samme nøkkel $A$, ville dette resultere i adressegjenbruk for Bob.

> _Adressegjenbruk er en veldig dårlig praksis for brukerens personvern. For å forstå hvorfor, anbefaler jeg deg å se gjennom de første delene av denne opplæringen._

Faktisk, siden den unike adressen $P_0$ er utledet fra $A$ og $B$, hvis Alice utleder en andre adresse for en andre betaling til $B$, med samme nøkkel $A$, vil hun ende opp med samme adresse $P_0$. For å unngå denne risikoen og forhindre adressegjenbruk innenfor Silent Payments, må vi endre beregningene våre litt.

Det vi ønsker er at hver UTXO forbrukt av Alice som en inndata av en betaling skal gi en unik adresse på Bobs side, selv om flere UTXOer er sikret av samme nøkkelpar. Det er derfor tilstrekkelig å legge til en referanse til UTXOen i beregningen av den unike adressen $P_0$. Denne referansen vil ganske enkelt være hashen av UTXOen forbrukt som inndata:

$$ \text{inputHash} = \text{hash}(\text{outpoint} \text{ ‖ } A) $$

Og denne inngangsreferansen vil Alice legge til i hennes beregning av den unike adressen $P_0$:
$$ P_0 = B + \text{hash}(\text{inputHash} \cdot a \cdot B \text{ ‖ } 0) \cdot G $$
Under skanningen kan Bob også legge til $\text{inputHash}$, siden alt han trenger å gjøre er å observere transaksjonen for å utlede $\text{outpoint}$:

$$ P_0 = B + \text{hash}(\text{inputHash} \cdot b \cdot A \text{ ‖ } 0) \cdot G $$

Når han finner en gyldig $P_0$, kan han beregne den tilsvarende private nøkkelen $p_0$:

$$
p_0 = (b + \text{hash}(\text{inputHash} \cdot b \cdot A \text{ ‖ } 0)) \bmod n
$$

![BTC204](assets/notext/67/04.webp)

_Forklaring:_

- $B$: Den offentlige nøkkelen / statiske adressen publisert av Bob
- $b$: Bobs private nøkkel
- $A$: Den offentlige nøkkelen til Alices UTXO brukt som inndata for transaksjonen
- $a$: Alices private nøkkel
- $H$: Hashen av UTXOen brukt som inndata
- $G$: Generasjonspunktet for den elliptiske kurven `secp256k1`
- $\text{SHA256}$: SHA256 hash-funksjonen merket med `BIP0352/SharedSecret`
- $s_0$: Det første delte ECDH-hemmeligheten
- $P_0$: Den første offentlige nøkkelen / unike adressen for betaling til Bob

For øyeblikket antar våre beregninger at Alice bruker en enkelt inndata for hennes transaksjon. Imidlertid bør hun kunne bruke flere inndata. Følgelig, på Bobs side, for hver transaksjon som inneholder flere inndata, ville han teoretisk sett trenge å beregne ECDH for hver inndata for å bestemme om en betaling er ment for ham. Denne metoden er ikke tilfredsstillende, så vi trenger å finne en løsning for å redusere arbeidsmengden!

### Justering av de offentlige nøklene i inndata

For å løse dette problemet, i stedet for å bruke nøkkelparet som sikrer en spesifikk inndata på Alices side, vil vi bruke summen av alle nøkkelparene som brukes i inndataene til transaksjonen. Denne summen vil da bli betraktet som et nytt nøkkelpar. Denne teknikken er kjent som "tweak".

For eksempel, forestill deg at Alices transaksjon har 3 inndata, hver sikret med et forskjellig nøkkelpar:

- $a_0$ sikrer inndata #0;
- $a_1$ sikrer inndata #1;
- $a_2$ sikrer inndata #2.

![BTC204](assets/notext/67/05.webp)

Følgende metoden beskrevet ovenfor, ville Alice måtte velge et enkelt nøkkelpar blant $a_0$, $a_1$, og $a_2$ for å beregne ECDH-hemmeligheten og generere den unike betalingsadressen $P$ fra Bobs statiske adresse $B$. Imidlertid krever denne tilnærmingen at Bob tester hver mulighet sekvensielt, startende med $a_0$, deretter $a_1$, og så videre, til han identifiserer et par som genererer en gyldig adresse $P$. Denne prosessen krever at Bob utfører ECDH-beregningen på alle inndataene til alle transaksjonene, noe som betydelig øker den operasjonelle skannebelastningen.

For å unngå dette, vil vi be Alice om å utføre hennes beregning av $P$ ved å bruke summen av alle nøklene i inndata. Tar vårt eksempel, ville den justerte private nøkkelen $a$ bli beregnet som følger:

$$ a = a_0 + a_1 + a_2 $$
På samme måte vil Alice og Bob kunne beregne den justerte offentlige nøkkelen:
$$ A = A_0 + A_1 + A_2 $$
Takket være denne metoden trenger Bob bare å beregne summen av de offentlige nøklene for transaksjonen, deretter beregne ECDH-hemmeligheten fra $A$ alene, noe som sterkt reduserer antallet beregninger som må gjøres for skannetrinnet. Husk imidlertid fra forrige avsnitt. Vi hadde inkludert i vår beregning hashen $\text{inputHash}$ som brukes som en nonce for å forhindre gjenbruk av adresser:

$$ \text{inputHash} = \text{hash}(\text{outpoint} \text{ ‖ } A) $$

Men hvis det er flere inndata i en transaksjon, er det nødvendig å bestemme hvilken $\text{outpoint}$ som velges i denne beregningen. Ifølge BIP352 er utvelgelseskriteriet for $\text{outpoint}$ å bruke, å velge den minste leksikografisk, noe som betyr å velge UTXOen som vises først i alfabetisk rekkefølge. Denne metoden standardiserer UTXOen som skal velges i hver transaksjon. For eksempel, hvis denne minste $\text{outpoint}$ leksikografisk er $\text{outpoint}_L$, vil beregningen av $\text{inputHash}$ være:

$$ \text{inputHash} = \text{hash}(\text{outpoint}\_L \text{ ‖ } A) $$

Beregningene forblir deretter identiske med de som ble presentert i forrige avsnitt, bortsett fra at den private nøkkelen $a$ og dens tilsvarende offentlige nøkkel $A$ ikke lenger er et par som sikrer en enkelt inndata, men nå representerer justeringen av alle nøkkelpar i inndata.

### Separering av utgifts- og skanningsnøkler

Så langt har vi diskutert den stille betalings statiske adressen $B$ som en unik offentlig nøkkel. Husk, det er denne offentlige nøkkelen $B$ som brukes av Alice for å skape den delte ECDH-hemmeligheten, som igjen brukes til å beregne den unike betalingsadressen $P$. Bob bruker denne offentlige nøkkelen $B$ og den tilsvarende private nøkkelen $b$ for skanningstrinnet. Men han vil også bruke den private nøkkelen $b$ for å beregne den private nøkkelen $p$ som tillater utgifter fra adressen $P$.

Ulempen med denne metoden er at den private nøkkelen $b$, som brukes til å beregne alle de private nøklene for adresser som mottar stille betalinger, også brukes av Bob for å skanne transaksjoner. Dette trinnet krever at nøkkelen $b$ er tilgjengelig på en lommebokprogramvare koblet til internett, noe som eksponerer den for en større risiko for tyveri sammenlignet med å holde den på en kald lommebok. Ideelt sett ville det være fordelaktig å kunne dra nytte av stille betalinger samtidig som den private nøkkelen $b$, som kontrollerer tilgangen til alle andre private nøkler, sikres på en maskinvarelommebok. Heldigvis har protokollen blitt tilpasset for å tillate nettopp det.
For å oppnå dette spesifiserer BIP352 at mottakeren bruker 2 forskjellige par nøkler:

- $B_{\text{spend}}$: for å beregne de private nøklene til unike betalingsadresser;
- $B_{\text{scan}}$: for å finne unike betalingsadresser.

På denne måten kan Bob holde den private nøkkelen $b_{\text{spend}}$ på en maskinvarelommebok og bruke den private nøkkelen $b_{\text{scan}}$ på nettbasert programvare for å finne sine stille betalinger, uten å avsløre $b_{\text{spend}}$. Imidlertid er de offentlige nøklene $B_{\text{scan}}$ og $B_{\text{spend}}$ begge offentlig avslørt, ettersom de finnes i Bobs statiske adresse $B$:
$$ B = B*{\text{scan}} \text{ ‖ } B*{\text{spend}} $$
For å beregne en unik betalingsadresse $P_0$ som tilhører Bob, vil Alice nå utføre følgende beregning:

$$ P*0 = B*{\text{spend}} + \text{hash}(\text{inputHash} \cdot a \cdot B\_{\text{scan}} \text{ ‖ } 0) \cdot G $$

For å finne betalingene adressert til seg, vil Bob utføre følgende beregning:

$$ P*0 = B*{\text{spend}} + \text{hash}(\text{inputHash} \cdot b\_{\text{scan}} \cdot A \text{ ‖ } 0) \cdot G $$

Som du kan se, så langt, har Bob ikke trengt å bruke $b_{\text{spend}}$ som er på hans maskinvarelommebok. Når han ønsker å bruke $P_0$, kan han da utføre følgende beregning for å finne den private nøkkelen $p_0$:

$$ p*0 = (b*{\text{spend}} + \text{hash}(\text{inputHash} \cdot b\_{\text{scan}} \cdot A \text{ ‖ } 0)) \bmod n $$

![BTC204](assets/notext/67/06.webp)

_Bildetekst:_

- $B_{\text{scan}}$: Bobs offentlige skannenøkkel (statisk adresse)
- $b_{\text{scan}}$: Bobs private skannenøkkel
- $B_{\text{spend}}$: Bobs offentlige utgiftnøkkel (statisk adresse)
- $b_{\text{spend}}$: Bobs private utgiftnøkkel
- $A$: Summen av offentlige nøkler i inndata (justering)
- $a$: Den private nøkkelen som tilsvarer den justerte offentlige nøkkelen
- $H$: Hashen av den minste UTXO (leksikografisk) brukt i inndata
- $G$: Generasjonspunktet for elliptisk kurve `secp256k1`
- $\text{SHA256}$: SHA256 hashfunksjonen merket med `BIP0352/SharedSecret`
- $s_0$: Den første delte ECDH-hemmeligheten
- $P_0$: Den første offentlige nøkkelen / unike betalingsadressen for Bob

### Bruk av SP-adresser med etikett

Bob har dermed en statisk adresse $B$ for Stille Betalinger som følger:

$$ B = B*{\text{scan}} \text{ ‖ } B*{\text{spend}} $$

Problemet med denne metoden er at den ikke tillater å skille mellom de forskjellige betalingene som sendes til denne adressen. For eksempel, hvis Bob har 2 forskjellige kunder for sin virksomhet og han ønsker å tydelig differensiere betalingene fra hverandre, ville han trenge 2 forskjellige statiske adresser. En naiv løsning, med den nåværende tilnærmingen, ville være for Bob å opprette to separate lommebøker, hver med sin egen statiske adresse, eller til og med å etablere to forskjellige statiske adresser innenfor samme lommebok. Imidlertid krever denne løsningen å skanne hele blokkjeden to ganger (en gang for hver adresse) for å henholdsvis oppdage betalingene ment for hver adresse. Denne doble skanningen øker urimelig den operative belastningen for Bob.
For å løse dette problemet, bruker BIP352 et etiketteringssystem som tillater forskjellige statiske adresser uten å urimelig øke arbeidsmengden for å finne Silent Payments på blockchain. For å gjøre dette, legges et heltall $m$ til den offentlige utgiftsnøkkelen $B_{\text{spend}}$. Dette heltallet kan ta verdien $1$ for den første statiske adressen, deretter $2$ for den andre, og så videre. Utgiftsnøklene $B_{\text{spend}}$ vil heretter bli kalt $B_m$ og vil bli konstruert på denne måten:
$$ B*m = B*{\text{spend}} + \text{hash}(b\_{\text{scan}} \text{ ‖ } m) \cdot G $$

For eksempel, for den første utgiftsnøkkelen med etiketten $1$:

$$ B*1 = B*{\text{spend}} + \text{hash}(b\_{\text{scan}} \text{ ‖ } 1) \cdot G $$

Den statiske adressen publisert av Bob vil nå bestå av $B_{\text{scan}}$ og $B_m$. For eksempel, den første statiske adressen med etiketten $1$ vil være:

$$ B = B\_{\text{scan}} \text{ ‖ } B_1 $$

> _Vi starter kun fra etikett 1 fordi etikett 0 er reservert for veksling._

Alice, på sin side, vil utlede den unike betalingsadressen $P$ på samme måte som før, men ved å bruke den nye $B_1$ i stedet for $B_{\text{spend}}$.
$$ P*0 = B_1 + \text{hash}(\text{inputHash} \cdot a \cdot B*{\text{scan}} \text{ ‖ } 0) \cdot G $$

I virkeligheten, kan det hende at Alice ikke engang vet at Bob har en etikettert adresse, ettersom hun rett og slett bruker den andre delen av den statiske adressen han ga henne, som i dette tilfellet, er verdien $B_1$ i stedet for $B_{\text{spend}}$.

For å skanne etter betalinger, vil Bob alltid bruke verdien av sin opprinnelige statiske adresse med $B_{\text{spend}}$ på denne måten:

$$ P*0 = B*{\text{spend}} + \text{hash}(\text{inputHash} \cdot b\_{\text{scan}} \cdot A \text{ ‖ } 0) \cdot G $$

Deretter trekker han ganske enkelt fra verdien han finner for $P_0$ fra hver utgang en etter en. Han sjekker deretter om ett av resultatene av disse subtraksjonene matcher verdien av en av etikettene han bruker i lommeboken sin. Hvis det matcher, for eksempel, for utgang #4 med etiketten $1$, betyr dette at denne utgangen er en Silent Payment assosiert med hans etiketterte statiske adresse $B_1$:

$$ Out*4 - P_0 = \text{hash}(b*{\text{scan}} \text{ ‖ } 1) \cdot G $$

Dette fungerer fordi:

$$ B*1 = B*{\text{spend}} + \text{hash}(b*{\text{scan}} \text{ ‖ } 1) \cdot G $$
Takket være denne metoden kan Bob bruke en mengde statiske adresser ($B_1$, $B_2$, $B_3$...), alle avledet fra hans grunnleggende statiske adresse ($B = B*{\text{scan}} \text{ ‖ } B*{\text{spend}}$), for å skikkelig skille bruksområder.
Men, denne separasjonen av statiske adresser er kun gyldig fra et personlig lommebokforvaltningsperspektiv og tillater ikke separasjon av identiteter. Siden de alle har samme $B*{\text{scan}}$, er det veldig enkelt å assosiere alle de statiske adressene sammen og slutte at de tilhører en enkelt enhet.

![BTC204](assets/notext/67/07.webp)

_Bildetekst:_

- $B_{\text{scan}}$: Bobs offentlige skanne-nøkkel (statisk adresse)
- $b_{\text{scan}}$: Bobs private skanne-nøkkel
- $B_{\text{spend}}$: Bobs offentlige bruk-nøkkel (innledende adresse)
- $B_m$: Bobs merkede offentlige bruk-nøkkel (statisk adresse)
- $b_m$: Bobs merkede private bruk-nøkkel
- $A$: Summen av inngående offentlige nøkler (justering)
- $a$: Den private nøkkelen som svarer til den justerte offentlige nøkkelen
- $H$: Hashen av den minste UTXO (leksikografisk) brukt som inngang
- $G$: Generasjonspunktet for elliptisk kurve `secp256k1`
- $\text{SHA256}$: SHA256 hashfunksjonen merket med `BIP0352/SharedSecret`
- $s_0$: Den første delte ECDH-hemmeligheten
- $P_0$: Den første offentlige nøkkelen / unike adressen for betaling til Bob
- $p_0$: Den private nøkkelen til den første unike betalingsadressen til Bob
- $X$: Hashen av den private skanne-nøkkelen med etiketten

### Hvordan konstruere en adresse for stille betalinger?

For å konstruere en dedikert adresse for stille betalinger, må man først avlede 2 par nøkler i sin Bitcoin HD-lommebok:

- Paret $b_{\text{scan}}$, $B_{\text{scan}}$ for å søke etter betalinger adressert til oss;
- Paret $b_{\text{spend}}$, $B_{\text{spend}}$ for å bruke bitcoinsene vi har mottatt.

Disse parene avledes følgende stier (_Bitcoin Mainnet_):

```text
scan: m / 352' / 0' / 0' / 1' / 0
spend: m / 352' / 0' / 0' / 0' / 0
```

Når disse 2 parene av nøkler er tilgjengelige, konkatenerer man dem (ende-til-ende) for å lage nyttelasten til den statiske adressen:

$$ B = B*{\text{scan}} \text{ ‖ } B*{\text{spend}} $$

Hvis man ønsker å bruke etiketter, erstattes $B_{\text{spend}}$ med $B_m$:

$$ B = B\_{\text{scan}} \text{ ‖ } B_m $$

Med etiketten $m$:

$$ B*m = B*{\text{spend}} + \text{hash}(b\_{\text{scan}} \text{ ‖ } m) \cdot G $$

Når denne nyttelasten er tilgjengelig, legger man til HRP (_Human-Readable Part_) `sp` og versjonen `q` (= versjon 0). En sjekksum legges også til, og adressen formateres i bech32m.
For eksempel, her er min statiske Silent Payments-adresse:

```text
sp1qqvhjvsq2vz8zwrw372vuzle7472zup2ql3pz64yn5cpkw5ngv2n6jq4nl8cgm6zmu48yk3eq33ryc7aam6jrvrg0d0uuyzecfhx2wgsumcurv77e
```

Et viktig poeng angående statiske adresser, som du kanskje har lagt inn i de foregående seksjonene, er at disse adressene ikke er synlige i Bitcoin-transaksjoner. Kun betalingsadressene $P$, som brukes i utdataene, vises på blockchain i det standard Taproot-formatet. Dermed er det umulig å skille en transaksjon som involverer en Silent Payment fra en vanlig transaksjon som bruker P2TR-utdata fra utsiden.
Akkurat som med BIP47, er det umulig å etablere en forbindelse mellom en statisk adresse $B$ og en betalingsadresse $P$ som er avledet fra $B$. Faktisk, selv om Eve, en potensiell angriper, prøver å skanne blockchain med Bobs statiske adresse $B$, vil hun ikke kunne utføre de nødvendige beregningene for å bestemme $P$. For å gjøre dette, ville hun trenge enten Bobs private skanningsnøkkel $b_{\text{scan}}$ eller avsenderens private nøkler $a$, men begge disse elementene er, selvfølgelig, private. Det er derfor mulig å eksplisitt koble ens statiske adresse med en form for personlig identitet.

### Hvordan bruke Silent Payments?

Forslaget til Silent Payments er relativt nytt og har så langt bare blitt implementert av et veldig begrenset antall lommebøker. Så vidt jeg vet, er det bare 3 programvarer som støtter dem:

- [CakeWallet](https://cakewallet.com/)
- [Silentium](https://app.silentium.dev/)
- [DonationWallet](https://github.com/Sosthene00/donationwallet)

Vi vil snart tilby en detaljert veiledning om hvordan du setter opp din egen statiske Silent Payments-adresse.

Siden denne funksjonen er ny, er det tilrådelig å utøve forsiktighet og unngå å bruke Silent Payments for store beløp på hovednettet.

_For å lage dette kapittelet om Silent Payments, brukte jeg [nettstedet for forklaring av Silent Payments](https://silentpayments.xyz/) og [dokumentet for forklaring av BIP352](https://github.com/bitcoin/bips/blob/master/bip-0352.mediawiki)._

# Konklusjon

<partId>2aee56c0-b285-4799-b4f7-373a552ee2b2</partId>

## Evaluer dette kurset

<chapterId>195d149f-80fa-5816-8b46-995a9226d082</chapterId>
<isCourseReview>true</isCourseReview>

## Avsluttende eksamen

<chapterId>e803d394-e3c1-5816-a6b4-a69a2472019c</chapterId>
<isCourseExam>true</isCourseExam>

## Konklusjon

<chapterId>cd8e5c67-50e4-4dcd-8e04-88ba5ec95305</chapterId>
Gratulerer med fullført opplæring om Bitcoin-personvern!

I denne opplæringen har vi tatt for oss mange avanserte og tekniske emner, men det er ikke nødvendig å bruke alle verktøyene som er presentert. Hovedmålet var å gi deg muligheten til å velge hvilken informasjon du vil dele og hvilken du foretrekker å holde konfidensiell i din bruk av Bitcoin. Dette legemliggjør selve essensen av personvern. For å ta informerte valg om hvilken informasjon som skal deles eller skjules, må man være klar over konsekvensene av våre handlinger. Jeg håper denne opplæringen har hjulpet deg med å tilegne deg denne kunnskapen.

Hvis jeg skulle velge den viktigste delen av denne opplæringen, ville jeg valgt seksjonen dedikert til kjedeanalyse. Å forstå teknikkene som brukes av potensielle angripere er den beste måten å beskytte seg mot dem. Mitt råd ville derfor være å gjennomgå denne delen nøye og prøve å forstå alle detaljene.

I denne opplæringen fokuserte vi utelukkende på Bitcoin-personvern på hovedkjeden. Personvernspørsmål på andrelags-systemer, som Lightning Network og sidekjeder, er også viktige og har svært spesifikke egenskaper. Mens bruk av off-chain-transaksjoner kan være en effektiv strategi for å omgå mange av Bitcoin-sporbarhetsrisikoene vi har studert, utsetter det deg for andre risikoer som det også er viktig å kjenne til. Det er derfor disse temaene vil bli dekket i en fremtidig dedikert opplæring på Plan ₿ Network.

Hvis du likte denne opplæringen, ville jeg vært veldig takknemlig om du ville dele den med dine nærmeste og på sosiale medier. Takk! :)

For å fortsette å fordype deg i Bitcoin-universet, inviterer vi deg til å utforske andre kurs tilgjengelig på Plan ₿ Network som:

#### Forstå hvordan en Bitcoin-lommebok fungerer med

https://planb.network/courses/cyp201

#### Lær å skape ditt Bitcoin-fellesskap med

https://planb.network/courses/btc302

#### Oppdag historien om Bitcoins opprinnelse med

https://planb.network/courses/his201

#### Konfigurer en BTC-betalingsserver med

https://planb.network/courses/btc305

#### Oppdag Lightning Network med

https://planb.network/courses/lnp201

#### Oppdag frihetens utvikling gjennom tidene med

https://planb.network/courses/phi201



